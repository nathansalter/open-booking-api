<!DOCTYPE html><html xmlns="https://www.w3.org/1999/xhtml" lang="en"><head><meta charset="utf-8"><meta name="generator" content="ReSpec 24.3.1"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><style>/* --- EXAMPLES --- */
span.example-title {
    text-transform: none;
}
aside.example, div.example, div.illegal-example {
    padding: 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
div.illegal-example { color: red }
div.illegal-example p { color: black }
aside.example, div.example {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
    border-color: #e0cb52;
    background: #fcfaee;
}

aside.example div.example {
    border-left-width: .1em;
    border-color: #999;
    background: #fff;
}
aside.example div.example span.example-title {
    color: #999;
}
</style><style>/* --- ISSUES/NOTES --- */
div.issue-title, div.note-title , div.ednote-title, div.warning-title {
    padding-right:  1em;
    min-width: 7.5em;
    color: #b9ab2d;
}
div.issue-title { color: #e05252; }
div.note-title, div.ednote-title { color: #2b2; }
div.warning-title { color: #f22; }
div.issue-title span, div.note-title span, div.ednote-title span, div.warning-title span {
    text-transform: uppercase;
}
div.note, div.issue, div.ednote, div.warning {
    margin-top: 1em;
    margin-bottom: 1em;
}
.warning > p:first-child { margin-top: 0 }
.warning {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
}
div.issue, div.note , div.ednote,  div.warning {
    padding: 1em 1.2em 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
span.warning { padding: .1em .5em .15em; }

.issue.closed span.issue-number {
    text-decoration: line-through;
}

.warning {
    border-color: #f11;
    border-width: .2em;
    border-style: solid;
    background: #fbe9e9;
}

.warning-title:before{
    content: "⚠"; /*U+26A0 WARNING SIGN*/
    font-size: 3em;
    float: left;
    height: 100%;
    padding-right: .3em;
    vertical-align: top;
    margin-top: -0.5em;
}

li.task-list-item {
    list-style: none;
}

input.task-list-item-checkbox {
    margin: 0 0.35em 0.25em -1.6em;
    vertical-align: middle;
}

.issue a.respec-gh-label {
  padding: 5px;
  margin: 0 2px 0 2px;
  font-size: 10px;
  text-transform: none;
  text-decoration: none;
  font-weight: bold;
  border-radius: 4px;
  position: relative;
  bottom: 2px;
}

.issue a.respec-label-dark {
  color: #fff;
  background-color: #000;
}

.issue a.respec-label-light {
  color: #000;
  background-color: #fff;
}
</style><script src="//localhost:35729/livereload.js?snipver=1" async="" defer=""></script>



    
    <title>Open Booking API 1.0</title>

    

    <style id="respec-mainstyle">/*****************************************************************
 * ReSpec 3 CSS
 * Robin Berjon - http://berjon.com/
 *****************************************************************/

/* Override code highlighter background */
.hljs {
  background: transparent !important;
}

/* --- INLINES --- */
h1 abbr,
h2 abbr,
h3 abbr,
h4 abbr,
h5 abbr,
h6 abbr,
a abbr {
  border: none;
}

dfn {
  font-weight: bold;
}

a.internalDFN {
  color: inherit;
  border-bottom: 1px solid #99c;
  text-decoration: none;
}

a.externalDFN {
  color: inherit;
  border-bottom: 1px dotted #ccc;
  text-decoration: none;
}

a.bibref {
  text-decoration: none;
}

#references :target {
  background: #eaf3ff;
}

cite .bibref {
  font-style: normal;
}

code {
  color: #c83500;
}

th code {
  color: inherit;
}

/* --- TOC --- */

.toc a,
.tof a {
  text-decoration: none;
}

a .secno,
a .figno {
  color: #000;
}

ul.tof,
ol.tof {
  list-style: none outside none;
}

.caption {
  margin-top: 0.5em;
  font-style: italic;
}

/* --- TABLE --- */

table.simple {
  border-spacing: 0;
  border-collapse: collapse;
  border-bottom: 3px solid #005a9c;
}

.simple th {
  background: #005a9c;
  color: #fff;
  padding: 3px 5px;
  text-align: left;
}

.simple th[scope="row"] {
  background: inherit;
  color: inherit;
  border-top: 1px solid #ddd;
}

.simple td {
  padding: 3px 10px;
  border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
  background: #f0f6ff;
}

/* --- DL --- */

.section dd>p:first-child {
  margin-top: 0;
}

.section dd>p:last-child {
  margin-bottom: 0;
}

.section dd {
  margin-bottom: 1em;
}

.section dl.attrs dd,
.section dl.eldef dd {
  margin-bottom: 0;
}

#issue-summary>ul,
.respec-dfn-list {
  column-count: 2;
}

#issue-summary li,
.respec-dfn-list li {
  list-style: none;
}

details.respec-tests-details {
  margin-left: 1em;
  display: inline-block;
  vertical-align: top;
}

details.respec-tests-details>* {
  padding-right: 2em;
}

details.respec-tests-details[open] {
  z-index: 999999;
  position: absolute;
  border: thin solid #cad3e2;
  border-radius: 0.3em;
  background-color: white;
  padding-bottom: 0.5em;
}

details.respec-tests-details[open]>summary {
  border-bottom: thin solid #cad3e2;
  padding-left: 1em;
  margin-bottom: 1em;
  line-height: 2em;
}

details.respec-tests-details>ul {
  width: 100%;
  margin-top: -0.3em;
}

details.respec-tests-details>li {
  padding-left: 1em;
}

a[href].self-link:hover {
  opacity: 1;
  text-decoration: none;
  background-color: transparent;
}

h2,
h3,
h4,
h5,
h6 {
  position: relative;
}

aside.example .marker > a.self-link {
  color: inherit;
}

h2>a.self-link,
h3>a.self-link,
h4>a.self-link,
h5>a.self-link,
h6>a.self-link {
  border: none;
  color: inherit;
  font-size: 83%;
  height: 2em;
  left: -1.6em;
  opacity: .5;
  position: absolute;
  text-align: center;
  text-decoration: none;
  top: 0;
  transition: opacity .2s;
  width: 2em;
}

h2>a.self-link::before,
h3>a.self-link::before,
h4>a.self-link::before,
h5>a.self-link::before,
h6>a.self-link::before {
  content: "§";
  display: block;
}

@media (max-width: 767px) {
  dd {
    margin-left: 0;
  }

  /* Don't position self-link in headings off-screen */
  h2>a.self-link,
  h3>a.self-link,
  h4>a.self-link,
  h5>a.self-link,
  h6>a.self-link {
    left: auto;
    top: auto;
  }
}

@media print {
  .removeOnSave {
    display: none;
  }
}
</style><style>/*

github.com style (c) Vasily Polovnyov <vast@whiteants.net>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #333;
  background: #f8f8f8;
}

.hljs-comment,
.hljs-quote {
  color: #998;
  font-style: italic;
}

.hljs-keyword,
.hljs-selector-tag,
.hljs-subst {
  color: #333;
  font-weight: bold;
}

.hljs-number,
.hljs-literal,
.hljs-variable,
.hljs-template-variable,
.hljs-tag .hljs-attr {
  color: #008080;
}

.hljs-string,
.hljs-doctag {
  color: #d14;
}

.hljs-title,
.hljs-section,
.hljs-selector-id {
  color: #900;
  font-weight: bold;
}

.hljs-subst {
  font-weight: normal;
}

.hljs-type,
.hljs-class .hljs-title {
  color: #458;
  font-weight: bold;
}

.hljs-tag,
.hljs-name,
.hljs-attribute {
  color: #000080;
  font-weight: normal;
}

.hljs-regexp,
.hljs-link {
  color: #009926;
}

.hljs-symbol,
.hljs-bullet {
  color: #990073;
}

.hljs-built_in,
.hljs-builtin-name {
  color: #0086b3;
}

.hljs-meta {
  color: #999;
  font-weight: bold;
}

.hljs-deletion {
  background: #fdd;
}

.hljs-addition {
  background: #dfd;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}
</style>

    <style>
        table {
            border-collapse: collapse;
            border: 1px solid #bec9d9
        }

        td,
        th {
            padding: 3px 0.5em;
            border-left: 1px solid black;
            border-right: 1px solid black;
            border-bottom: 1px solid #E2EDFE;
        }

        tr th[colspan] {
            color: #005A9C;
            background-color: #FEEDE2;
            text-align: center
        }

        th {
            color: #005A9C;
            background-color: #E2EDFE;
            font-weight: normal;
            border-bottom: 1px solid #BEC9D9;
        }

        tbody tr th {
            text-align: left;
        }

        td.nb {
            font-size: smaller;
        }

        .rec,
        .pr {
            color: #005A9C;
            background-color: #99EE99
        }

        .ext {
            background-color: #FFFFFF
        }

        .cr,
        .lcwd {
            color: #005A9C;
            background-color: #EEEE99
        }

        .wd {
            color: #005A9C;
            background-color: #EE9999
        }

        .ed,
        .fpwd {
            color: #005A9C;
            background-color: #FF7777
        }

        code {
            white-space: pre;
        }

        html {
            background-image: none !important;
        }

        body {
            background: white top left fixed no-repeat !important;
            background-size: 25px auto !important;
            background-image:
                url('https://www.openactive.io/assets/openactive-label-specification.png') !important;
        }

        h1 {
            font-family: 'Open Sans', sans-serif !important;
            font-weight: 300 !important;
            color: #69b9ff !important;
            font-size: 220%;
        }

        #toc {
            padding-top: 0px !important;
        }

        .remove {
            background-colour: yellow;
        }

        code {
            color: #C83500;
        }

        em.rfc2119 {
          text-transform:     lowercase;
          font-variant:       small-caps;
          font-style:         normal;
          color:              #900;
        }
    </style>

<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/cg-draft"><link rel="canonical" href="https://www.w3.org/TR/open-booking-api/"><script id="initialUserConfig" type="application/json">{
  "specStatus": "CG-DRAFT",
  "shortName": "open-booking-api",
  "edDraftURI": "https://openactive.io/open-booking-api/EditorsDraft/",
  "copyrightStart": 2018,
  "editors": [
    {
      "name": "Leigh Dodds",
      "url": "https://ldodds.com",
      "company": "Open Data Institute",
      "companyURL": "https://theodi.org",
      "w3cid": 55359
    },
    {
      "name": "Nick Evans",
      "url": "https://nickevans.me/",
      "company": "Open Data Institute",
      "companyURL": "https://theodi.org"
    },
    {
      "name": "Chris Thorpe",
      "url": "https://github.com/drchristhorpe"
    }
  ],
  "otherLinks": [
    {
      "key": "Repo",
      "value": "We are on Github",
      "href": "https://github.com/openactive/open-booking-api/",
      "class": "repo"
    },
    {
      "key": "Issues",
      "value": "Report an issue",
      "href": "https://github.com/openactive/open-booking-api/issues/"
    },
    {
      "key": "Version",
      "value": "1.0"
    }
  ],
  "logos": [
    {
      "src": "https://www.openactive.io/assets/openactive-logo-large.png",
      "href": "https://openactive.io",
      "alt": "openactive.io",
      "width": 255,
      "height": 43,
      "id": "logo"
    }
  ],
  "wg": "OpenActive Community Group",
  "wgURI": "https://www.w3.org/community/openactive/",
  "wgPublicList": "public-openactive",
  "maxTocLevel": 4,
  "preProcess": [],
  "noRecTrack": true,
  "issueBase": "https://github.com/openactive/open-booking-api/issues/",
  "format": "markdown",
  "localBiblio": {
    "JSON-LD": {
      "href": "https://www.w3.org/TR/json-ld/",
      "title": "JSON-LD 1.0",
      "status": "REC",
      "publisher": "W3C",
      "id": "json-ld"
    },
    "SCHEMA-ORG": {
      "href": "https://schema.org/",
      "title": "Schema.org"
    },
    "Modelling-Opportunity-Data": {
      "href": "https://openactive.io/modelling-opportunity-data/",
      "title": "Modelling Opportunity Data",
      "publisher": "OpenActive Community Group",
      "id": "modelling-opportunity-data"
    },
    "RPDE": {
      "href": "https://openactive.io/realtime-paged-data-exchange/",
      "title": "Realtime Paged Data Exchange",
      "publisher": "OpenActive Community Group",
      "id": "rpde"
    },
    "OpenActive-Vocabulary": {
      "href": "https://openactive.io/ns/",
      "title": "OpenActive Vocabulary",
      "publisher": "OpenActive Community Group",
      "id": "openactive-vocabulary"
    },
    "OAuth2": {
      "href": "https://oauth.net/2/",
      "title": "OAuth 2.0",
      "id": "oauth2"
    },
    "OpenIdConnect": {
      "href": "https://openid.net/connect/",
      "title": "OpenID Connect",
      "id": "openidconnect"
    }
  },
  "publishISODate": "2019-02-13T00:00:00.000Z",
  "generatedSubtitle": "Draft Community Group Report 13 February 2019"
}</script><meta name="description" content="This document specifies an HTTP API for placing bookings to participate in
physical activities, either by attending events or through the use of leisure
or sports facilities."></head>

<body class="h-entry"><div class="head">
      <a href="" class="logo"><img id="logo" alt="openactive.io" width="255" height="43" src="https://www.openactive.io/assets/openactive-logo-large.png"></a>
      <h1 class="title p-name" id="title">Open Booking API 1.0</h1>
      
      <h2>
        Draft Community Group Report
        <time class="dt-published" datetime="2019-02-13">13 February 2019</time>
      </h2>
      <dl>
        
        
        <dt>Latest editor's draft:</dt><dd><a href="https://openactive.io/open-booking-api/EditorsDraft/">https://openactive.io/open-booking-api/EditorsDraft/</a></dd>
        
        
        
        
        
        <dt>Editors:</dt>
        <dd class="p-author h-card vcard" data-editor-id="55359"><a class="u-url url p-name fn" href="https://ldodds.com">Leigh Dodds</a>
            (<a class="p-org org h-org h-card" href="https://theodi.org">Open Data Institute</a>)
          </dd><dd class="p-author h-card vcard"><a class="u-url url p-name fn" href="https://nickevans.me/">Nick Evans</a>
            (<a class="p-org org h-org h-card" href="https://theodi.org">Open Data Institute</a>)
          </dd><dd class="p-author h-card vcard"><a class="u-url url p-name fn" href="https://github.com/drchristhorpe">Chris Thorpe</a></dd>
        
        
        <dt class="repo">Repo:</dt><dd class="repo">
      <a href="https://github.com/openactive/open-booking-api/">We are on Github</a>
    </dd><dt>Issues:</dt><dd>
      <a href="https://github.com/openactive/open-booking-api/issues/">Report an issue</a>
    </dd><dt>Version:</dt><dd>
      
    </dd>
      </dl>
      
      <p class="copyright">
        <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
        ©
        2018-2019
        
        the Contributors to the Open Booking API 1.0 Specification, published by the
        <a href="https://www.w3.org/community/openactive/">OpenActive Community Group</a> under the
        <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>. A human-readable
              <a href="https://www.w3.org/community/about/agreements/cla-deed/">summary</a>
              is available.
            
      </p>
      <hr title="Separator for header">
    </div><style>
body {
    background-size: 25px auto !important;
}

body.toc-sidebar #toc {
    background-size: 25px auto !important;
    background-attachment: fixed !important;
}
</style><section id="abstract" class="introductory"><h2>Abstract</h2><p>This document specifies an HTTP API for placing bookings to participate in
physical activities, either by attending events or through the use of leisure
or sports facilities.</p></section><section id="sotd" class="introductory"><h2>Status of This Document</h2><p>
      This specification was published by the
      <a href="https://www.w3.org/community/openactive/">OpenActive Community Group</a>. It is not a W3C Standard nor is it
      on the W3C Standards Track.
      
            Please note that under the
            <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>
            there is a limited opt-out and other conditions apply.
          
      Learn more about
      <a href="https://www.w3.org/community/">W3C Community and Business Groups</a>.
    </p><p>Contributions to this document are not only welcomed but are actively solicited
and should be made via
<a href="https://github.com/openactive/open-booking-api/issues">GitHub Issues</a> and
pull requests. The source code is available
on <a href="https://github.com/openactive/open-booking-api">GitHub</a>.</p><div class="note" role="note" id="issue-container-generatedID"><div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>Note</span></div><div class=""><p>This document represents an early Editors Draft of the planned API design. It is
likely to change between now and its final version. These
early drafts are intended to help developers provide that feedback by developing
proof-of-concept implementations. We encourage developers to explore this API and
contribute to the development of the specification.</p>
</div></div><p>
            If you wish to make comments regarding this document, please send
            them to
            <a href="mailto:public-openactive@w3.org">public-openactive@w3.org</a>
            (<a href="mailto:public-openactive-request@w3.org?subject=subscribe">subscribe</a>,
            <a href="https://lists.w3.org/Archives/Public/public-openactive/">archives</a>).
          </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#introduction"><span class="secno">1. </span>Introduction</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#scope-and-requirements"><span class="secno">1.1 </span>Scope and requirements</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#functionality-that-is-out-of-scope"><span class="secno">1.1.1 </span>Functionality that is out of scope</a></li></ol></li><li class="tocline"><a class="tocxref" href="#audience"><span class="secno">1.2 </span>Audience</a></li></ol></li><li class="tocline"><a class="tocxref" href="#conformance"><span class="secno">2. </span>Conformance</a></li><li class="tocline"><a class="tocxref" href="#typographical-conventions"><span class="secno">3. </span>Typographical Conventions</a></li><li class="tocline"><a class="tocxref" href="#key-actors"><span class="secno">4. </span>Key Actors</a></li><li class="tocline"><a class="tocxref" href="#booking-flow"><span class="secno">5. </span>Booking Flow</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#user-journey"><span class="secno">5.1 </span>User Journey</a></li><li class="tocline"><a class="tocxref" href="#high-level-summary-of-the-api"><span class="secno">5.2 </span>High-level summary of the API</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#broker-contract-with-booking-system"><span class="secno">5.2.1 </span>Broker contract with Booking System</a></li><li class="tocline"><a class="tocxref" href="#booking-system-contract-with-the-broker"><span class="secno">5.2.2 </span>Booking System contract with the Broker</a></li><li class="tocline"><a class="tocxref" href="#leasing"><span class="secno">5.2.3 </span>Leasing</a></li></ol></li><li class="tocline"><a class="tocxref" href="#step-by-step-process-description"><span class="secno">5.3 </span>Step-by-step process description</a></li></ol></li><li class="tocline"><a class="tocxref" href="#broker-roles"><span class="secno">6. </span>Broker Roles</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#resellerbroker"><span class="secno">6.1 </span><code>ResellerBroker</code></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition"><span class="secno">6.1.1 </span>Definition</a></li><li class="tocline"><a class="tocxref" href="#contractual-relationships"><span class="secno">6.1.2 </span>Contractual Relationships</a></li><li class="tocline"><a class="tocxref" href="#taxation"><span class="secno">6.1.3 </span>Taxation</a></li><li class="tocline"><a class="tocxref" href="#scope-of-specification"><span class="secno">6.1.4 </span>Scope of Specification</a></li><li class="tocline"><a class="tocxref" href="#conformance-criteria"><span class="secno">6.1.5 </span>Conformance criteria</a></li></ol></li><li class="tocline"><a class="tocxref" href="#agentbroker"><span class="secno">6.2 </span><code>AgentBroker</code></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition-0"><span class="secno">6.2.1 </span>Definition</a></li><li class="tocline"><a class="tocxref" href="#contractual-relationships-0"><span class="secno">6.2.2 </span>Contractual Relationships</a></li><li class="tocline"><a class="tocxref" href="#taxation-0"><span class="secno">6.2.3 </span>Taxation</a></li><li class="tocline"><a class="tocxref" href="#scope-of-specification-0"><span class="secno">6.2.4 </span>Scope of Specification</a></li><li class="tocline"><a class="tocxref" href="#conformance-criteria-0"><span class="secno">6.2.5 </span>Conformance criteria</a></li></ol></li><li class="tocline"><a class="tocxref" href="#nobroker"><span class="secno">6.3 </span><code>NoBroker</code></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition-1"><span class="secno">6.3.1 </span>Definition</a></li><li class="tocline"><a class="tocxref" href="#contractual-relationships-1"><span class="secno">6.3.2 </span>Contractual Relationships</a></li><li class="tocline"><a class="tocxref" href="#taxation-1"><span class="secno">6.3.3 </span>Taxation</a></li><li class="tocline"><a class="tocxref" href="#scope-of-specification-1"><span class="secno">6.3.4 </span>Scope of Specification</a></li><li class="tocline"><a class="tocxref" href="#conformance-criteria-1"><span class="secno">6.3.5 </span>Conformance criteria</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#systems-of-record"><span class="secno">7. </span>Systems of Record</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#roles-and-responsibilities-overview"><span class="secno">7.1 </span>Roles and responsibilities overview</a></li><li class="tocline"><a class="tocxref" href="#invoices-and-tax-receipts"><span class="secno">7.2 </span>Invoices and Tax receipts</a></li><li class="tocline"><a class="tocxref" href="#payments-and-refunds"><span class="secno">7.3 </span>Payments and Refunds</a></li><li class="tocline"><a class="tocxref" href="#tax-calculation"><span class="secno">7.4 </span>Tax calculation</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#b2c-tax-calculation-by-booking-system-is-mandatory"><span class="secno">7.4.1 </span>B2C tax calculation by Booking System is mandatory</a></li><li class="tocline"><a class="tocxref" href="#b2b-tax-calculation-by-booking-system-is-optional"><span class="secno">7.4.2 </span>B2B tax calculation by Booking System is optional</a></li></ol></li><li class="tocline"><a class="tocxref" href="#tax-mode"><span class="secno">7.5 </span>Tax mode</a></li><li class="tocline"><a class="tocxref" href="#offer-overrides"><span class="secno">7.6 </span>Offer overrides</a></li></ol></li><li class="tocline"><a class="tocxref" href="#order-operations"><span class="secno">8. </span>Order Operations</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#amending-the-orderquote-before-b"><span class="secno">8.1 </span>Amending the OrderQuote before <strong>B</strong></a></li><li class="tocline"><a class="tocxref" href="#cancellation-after-b"><span class="secno">8.2 </span>Cancellation after <strong>B</strong></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#customer-requested-cancellation"><span class="secno">8.2.1 </span>Customer requested cancellation</a></li><li class="tocline"><a class="tocxref" href="#seller-requested-cancellation"><span class="secno">8.2.2 </span>Seller requested cancellation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#notifications-updates-and-refunds"><span class="secno">8.3 </span>Notifications, updates and refunds</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#booking-system-updating-rpde-orders"><span class="secno">8.3.1 </span>Booking System: Updating RPDE <code>Order</code>s</a></li><li class="tocline"><a class="tocxref" href="#broker-processing-rpde-orders"><span class="secno">8.3.2 </span>Broker: Processing RPDE <code>Order</code>s</a></li><li class="tocline"><a class="tocxref" href="#new-orders"><span class="secno">8.3.3 </span>New <code>Orders</code></a></li><li class="tocline"><a class="tocxref" href="#cancellation-refund-calculation-and-notification"><span class="secno">8.3.4 </span>Cancellation, refund calculation and notification</a></li></ol></li><li class="tocline"><a class="tocxref" href="#amending-the-order-after-b"><span class="secno">8.4 </span>Amending the Order after <strong>B</strong></a></li><li class="tocline"><a class="tocxref" href="#extension-points-for-including-payments"><span class="secno">8.5 </span>Extension points for including Payments</a></li></ol></li><li class="tocline"><a class="tocxref" href="#modelling"><span class="secno">9. </span>Modelling</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#order-and-orderquote"><span class="secno">9.1 </span><code>Order</code> and <code>OrderQuote</code></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#example"><span class="secno">9.1.1 </span>Example</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#common-requirements"><span class="secno">10. </span>Common Requirements</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#media-types"><span class="secno">10.1 </span>Media types</a></li><li class="tocline"><a class="tocxref" href="#response-formats"><span class="secno">10.2 </span>Response formats</a></li><li class="tocline"><a class="tocxref" href="#url-discovery"><span class="secno">10.3 </span>URL discovery</a></li><li class="tocline"><a class="tocxref" href="#error-handling"><span class="secno">10.4 </span>Error handling</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#order-creation-incomplete-customer-details"><span class="secno">10.4.1 </span>Order creation : Incomplete customer details</a></li><li class="tocline"><a class="tocxref" href="#order-creation-incomplete-broker-details"><span class="secno">10.4.2 </span>Order creation : Incomplete broker details</a></li><li class="tocline"><a class="tocxref" href="#order-creation-incomplete-offer-details"><span class="secno">10.4.3 </span>Order creation : Incomplete offer details</a></li><li class="tocline"><a class="tocxref" href="#order-creation-incomplete-opportunity-details"><span class="secno">10.4.4 </span>Order creation : Incomplete opportunity details</a></li><li class="tocline"><a class="tocxref" href="#order-creation-unavailable-offer"><span class="secno">10.4.5 </span>Order creation : Unavailable offer</a></li><li class="tocline"><a class="tocxref" href="#order-creation-unavailable-opportunity"><span class="secno">10.4.6 </span>Order creation : Unavailable opportunity</a></li><li class="tocline"><a class="tocxref" href="#order-creation-opportunity-full"><span class="secno">10.4.7 </span>Order creation : Opportunity full</a></li><li class="tocline"><a class="tocxref" href="#order-completion-incomplete-payment-details"><span class="secno">10.4.8 </span>Order completion : Incomplete payment details</a></li><li class="tocline"><a class="tocxref" href="#order-completion-anonymous-lease-expired"><span class="secno">10.4.9 </span>Order completion : Anonymous lease expired</a></li><li class="tocline"><a class="tocxref" href="#api-authentication-unauthenticated"><span class="secno">10.4.10 </span>API authentication : Unauthenticated</a></li><li class="tocline"><a class="tocxref" href="#api-authentication-no-api-token-provided"><span class="secno">10.4.11 </span>API authentication : No API token provided</a></li><li class="tocline"><a class="tocxref" href="#api-authentication-invalid-api-token-provided"><span class="secno">10.4.12 </span>API authentication : Invalid API token provided</a></li><li class="tocline"><a class="tocxref" href="#api-authentication-invalid-authorization-details-provided"><span class="secno">10.4.13 </span>API authentication : Invalid authorization details provided</a></li><li class="tocline"><a class="tocxref" href="#technical-errors-temporarily-unable-to-create-order"><span class="secno">10.4.14 </span>Technical errors : Temporarily unable to create order</a></li><li class="tocline"><a class="tocxref" href="#technical-errors-temporarily-unable-to-create-order-0"><span class="secno">10.4.15 </span>Technical errors : Temporarily unable to create order</a></li><li class="tocline"><a class="tocxref" href="#technical-errors-temporarily-unable-to-delete-order"><span class="secno">10.4.16 </span>Technical errors : Temporarily unable to delete order</a></li><li class="tocline"><a class="tocxref" href="#generic-errors-unknown-or-incorrect-offer"><span class="secno">10.4.17 </span>Generic errors : Unknown or incorrect offer</a></li><li class="tocline"><a class="tocxref" href="#generic-errors-unknown-or-incorrect-opportunity"><span class="secno">10.4.18 </span>Generic errors : Unknown or incorrect opportunity</a></li><li class="tocline"><a class="tocxref" href="#generic-errors-unknown-or-incorrect-order"><span class="secno">10.4.19 </span>Generic errors : Unknown or incorrect order</a></li><li class="tocline"><a class="tocxref" href="#generic-errors-unknown-or-incorrect-endpoint"><span class="secno">10.4.20 </span>Generic errors : Unknown or incorrect endpoint</a></li><li class="tocline"><a class="tocxref" href="#generic-errors-not-found"><span class="secno">10.4.21 </span>Generic errors : Not found</a></li><li class="tocline"><a class="tocxref" href="#generic-errors-method-not-allowed"><span class="secno">10.4.22 </span>Generic errors : Method not allowed</a></li><li class="tocline"><a class="tocxref" href="#generic-errors-gone"><span class="secno">10.4.23 </span>Generic errors : Gone</a></li></ol></li><li class="tocline"><a class="tocxref" href="#security"><span class="secno">10.5 </span>Security</a></li><li class="tocline"><a class="tocxref" href="#authentication"><span class="secno">10.6 </span>Authentication</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#api-level-authentication"><span class="secno">10.6.1 </span>API level authentication</a></li><li class="tocline"><a class="tocxref" href="#customer-level-authentication"><span class="secno">10.6.2 </span>Customer level authentication</a></li></ol></li><li class="tocline"><a class="tocxref" href="#delivery-of-terms-and-conditions-and-privacy-policy"><span class="secno">10.7 </span>Delivery of Terms and Conditions and Privacy Policy</a></li></ol></li><li class="tocline"><a class="tocxref" href="#operations"><span class="secno">11. </span>Operations</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#checking-availability-and-offers"><span class="secno">11.1 </span>Checking availability and offers</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition-of-a-bookable-event"><span class="secno">11.1.1 </span>Definition of a 'bookable' Event</a></li><li class="tocline"><a class="tocxref" href="#definition-of-a-bookable-slot-facility-use"><span class="secno">11.1.2 </span>Definition of a 'bookable' slot/facility use</a></li><li class="tocline"><a class="tocxref" href="#checking-availability-and-offers-for-an-event-or-facility-use-slot"><span class="secno">11.1.3 </span>Checking availability and offers for an event or facility use slot</a></li><li class="tocline"><a class="tocxref" href="#assembling-a-set-of-offers-and-presenting-them-to-a-customer"><span class="secno">11.1.4 </span>Assembling a set of offers and presenting them to a customer</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#collating-offers-for-an-event"><span class="secno">11.1.4.1 </span>Collating offers for an event</a></li><li class="tocline"><a class="tocxref" href="#collating-offers-for-the-use-of-a-facility"><span class="secno">11.1.4.2 </span>Collating offers for the use of a facility</a></li></ol></li><li class="tocline"><a class="tocxref" href="#obtaining-a-lease-on-a-space-within-an-opportunity"><span class="secno">11.1.5 </span>Obtaining a lease on a space within an opportunity</a></li></ol></li><li class="tocline"><a class="tocxref" href="#creating-and-updating-orders"><span class="secno">11.2 </span>Creating and updating orders</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#discovering-the-order-endpoint"><span class="secno">11.2.1 </span>Discovering the order endpoint</a></li><li class="tocline"><a class="tocxref" href="#pre-conditions-for-creating-an-order"><span class="secno">11.2.2 </span>Pre-conditions for creating an order</a></li><li class="tocline"><a class="tocxref" href="#creating-a-new-order-orders"><span class="secno">11.2.3 </span>Creating a new order (<code>/orders</code>)</a></li><li class="tocline"><a class="tocxref" href="#viewing-an-order-orders-orderid"><span class="secno">11.2.4 </span>Viewing an order (<code>/orders/{orderId}</code>)</a></li><li class="tocline"><a class="tocxref" href="#deleting-an-order-orders-orderid"><span class="secno">11.2.5 </span>Deleting an order (<code>/orders/{orderId}</code>)</a></li><li class="tocline"><a class="tocxref" href="#completing-an-order-orders-orderid"><span class="secno">11.2.6 </span>Completing an order (<code>/orders/{orderId}</code>)</a></li></ol></li><li class="tocline"><a class="tocxref" href="#ordering-a-place-at-a-free-event-ordering-a-free-slot"><span class="secno">11.3 </span>Ordering a place at a free event/ordering a free slot</a></li><li class="tocline"><a class="tocxref" href="#leases-and-the-orderleaseduration-property"><span class="secno">11.4 </span>Leases and the orderLeaseDuration property</a></li><li class="tocline"><a class="tocxref" href="#the-state-transitions-during-the-order-process"><span class="secno">11.5 </span>The state transitions during the order process</a></li><li class="tocline"><a class="tocxref" href="#actions-which-occur-after-order-completion-confirmations-and-refunds"><span class="secno">11.6 </span>Actions which occur after order completion: confirmations and refunds</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#supplying-a-confirmation-to-the-customer"><span class="secno">11.6.1 </span>Supplying a confirmation to the customer</a></li><li class="tocline"><a class="tocxref" href="#refunding-a-customer-and-cancelling-an-order"><span class="secno">11.6.2 </span>Refunding a customer and cancelling an order</a></li></ol></li><li class="tocline"><a class="tocxref" href="#customers"><span class="secno">11.7 </span>Customers</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#creation-of-customers-on-the-booking-system"><span class="secno">11.7.1 </span>Creation of customers on the booking system</a></li><li class="tocline"><a class="tocxref" href="#viewing-a-customer-s-previously-placed-orders"><span class="secno">11.7.2 </span>Viewing a customer's previously placed orders</a></li><li class="tocline"><a class="tocxref" href="#deletion-of-personal-data-of-the-customer-if-the-order-is-not-completed"><span class="secno">11.7.3 </span>Deletion of personal data of the customer if the order is not completed</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#future-versions-of-this-api"><span class="secno">12. </span>Future versions of this API</a></li><li class="tocline"><a class="tocxref" href="#new-open-active-models-defined-in-the-1-0-booking-api-specification"><span class="secno">13. </span>New Open Active models defined in the 1.0 Booking API specification</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#error"><span class="secno">13.1 </span>Error</a></li><li class="tocline"><a class="tocxref" href="#payment"><span class="secno">13.2 </span>Payment</a></li><li class="tocline"><a class="tocxref" href="#acknowledgements"><span class="secno">13.3 </span>Acknowledgements</a></li></ol></li><li class="tocline"><a class="tocxref" href="#references"><span class="secno">A. </span>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><span class="secno">A.1 </span>Normative references</a></li></ol></li></ol></nav><section class="informative" id="introduction"><!--OddPage--><h2 id="x1-introduction"><span class="secno">1. </span>Introduction<a class="self-link" aria-label="§" href="#introduction"></a></h2><p><em>This section is non-normative.</em></p><p>The document is an output of the
<a href="https://www.w3.org/community/openactive/">OpenActive Community Group</a>. As part
of the <a href="https://openactive.io">OpenActive</a> initiative, the community group is
developing standards that will promote the publication and use of open
<a href="https://openactive.io/modelling-opportunity-data/#categories-of-physical-activity-data">opportunity data</a>
in helping people to become more physically active.</p><p>The Community Group have already published specifications that define standard
data models ([<cite class="respec-offending-element" title="Normative references in informative sections are not allowed. Remove '!' from the start of the reference `[[!Modelling-Opportunity-Data]]`" id="respec-offender-normative-references-in-informative-sections-are-not-allowed-remove-from-the-start-of-the-reference-modelling-opportunity-data"><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>]) and support the publication and
harvesting of data in standard formats ([<cite><a class="bibref" href="#bib-rpde">RPDE</a></cite>]).</p><p>This existing work helps increase the discovery of opportunities for people to
be active. This specification builds on that work by defining an HTTP API that
can be implemented by booking systems that are publishing opportunity data. By
allowing third-party applications to place bookings in their systems, it becomes
possible for more people to participate in events or make use of leisure and
sporting facilities.</p><p>The specification defines the flow of HTTP requests and responses between the
booking system (server) and the third-party application (client). This includes
definitions of the overall application flow, detailed request and response
formats and the potential error conditions that applications may encounter.</p><section id="scope-and-requirements"><h3 id="x1-1-scope-and-requirements"><span class="secno">1.1 </span>Scope and requirements<a class="self-link" aria-label="§" href="#scope-and-requirements"></a></h3><p>The current scope of the specification should conform to a set of
<a href="https://docs.google.com/document/d/1fsCr071V12i_2g0DK818OAGlEAJFLWwkBp9bpgx4fo8/edit?usp=sharing">use cases and requirements</a>
that have previously been identified and discussed with the OpenActive
community.</p><p>The focus of the initial versions of this specification will be on the simplest
use cases that will support making bookings on behalf of users. This core
functionality includes:</p><ul>
<li><strong>Pricing and availability</strong> – checking the price and current availabilty of
an event or for the use of a facility</li>
<li><strong>Leasing</strong> – temporarily reserving spaces for a user to attend an event or
make use of a facility, whilst placing a booking</li>
<li><strong>Booking</strong> – placing and viewing bookings, and where necessary, confirming
receipt of payment from users</li>
<li><strong>Multiple order items</strong> - handling bookings for multiple events ("shopping carts") and for groups of users</li>
<li><strong>Child booking</strong> - booking on behalf of a child</li>
</ul><p>A number of additional requirements that relate to the booking of events and
facilities are currently out of scope:</p><ul>
<li>creating and managing accounts for users</li>
<li>more complex pricing options, e.g. membership based pricing</li>
<li>waiting lists for events</li>
</ul><p>It is possible that future versions of this specification may include support
for these or other features. Revisions will be driven by the needs of the
community.</p><section id="functionality-that-is-out-of-scope"><h4 id="x1-1-1-functionality-that-is-out-of-scope"><span class="secno">1.1.1 </span>Functionality that is out of scope<a class="self-link" aria-label="§" href="#functionality-that-is-out-of-scope"></a></h4><p>By design this specification will not define some types of functionality.</p><p>These have been declared as permanently out of scope because they are either
adequately covered by existing specifications, or will be covered by future
work of the OpenActive Community Group.</p><p>The functionality that is currently defined as out of scope includes:</p><ul>
<li><strong>API authentication and security</strong> – while the specification recommends some
best practices relating to authentication and security it does not mandate a
specific means of securing an API. Implementers are free to choose the system
that offers the best security for their platform and users</li>
<li><strong>Payment processing</strong> – the design assumes that all payment handling will
be carried out by the third-party application, in a separate payment flow.
Booking systems and application developers are able to use the payment and
reconciliation mechanisms that provide the best options for their customers</li>
<li><strong>API business models</strong> – the design is agnostic to any business models that
might govern the use of the API, e.g. revenue-sharing or transaction processing
fees</li>
<li><strong>Discovery</strong>  – finding, filtering and searching for opportunity data. This
specification assumes that the client and server applications have already
shared data about the relevant opportunities. Additional functionality in this
area will be addressed by future specifications from the Community Group</li>
</ul></section></section><section id="audience"><h3 id="x1-2-audience"><span class="secno">1.2 </span>Audience<a class="self-link" aria-label="§" href="#audience"></a></h3><p>The document is primarily intended for the following audiences:</p><ul>
<li>Software developers who want to implement the API, e.g. as part of a booking
system</li>
<li>Software developers building client libraries or applications that will use
the API</li>
</ul><p>The following sections introduce terminology, concepts and requirements that
underpin the design of the API. This content might also be useful for a wider
audience, e.g. business analysts or product managers looking for a high-level
overview of the API functionality.</p></section></section><section id="conformance"><!--OddPage--><h2 id="x2-conformance"><span class="secno">2. </span>Conformance<a class="self-link" aria-label="§" href="#conformance"></a></h2><p>
      As well as sections marked as non-normative, all authoring guidelines,
      diagrams, examples, and notes in this specification are non-normative.
      Everything else in this specification is normative.
    </p><p id="respecRFC2119">The key words  <em class="rfc2119">MAY</em>, <em class="rfc2119">MUST</em>, <em class="rfc2119">MUST NOT</em>, <em class="rfc2119">OPTIONAL</em>, <em class="rfc2119">RECOMMENDED</em>, <em class="rfc2119">REQUIRED</em>, <em class="rfc2119">SHOULD</em>, and <em class="rfc2119">SHOULD NOT</em> are to be interpreted as described in [<cite><a class="bibref" href="#bib-rfc2119">RFC2119</a></cite>].</p><p>This specification makes use of the compact IRI Syntax; please refer to the
<a href="https://www.w3.org/TR/json-ld/#compact-iris">Compact IRIs</a> from [<cite><a class="bibref" href="#bib-json-ld">JSON-LD</a></cite>].</p></section><section id="typographical-conventions"><!--OddPage--><h2 id="x3-typographical-conventions"><span class="secno">3. </span>Typographical Conventions<a class="self-link" aria-label="§" href="#typographical-conventions"></a></h2><p>The following typographic conventions are used in this specification:</p><dl class="typography">
<dt><code>markup</code></dt>
<dd>Markup (elements, attributes, properties), machine processable
values (string, characters, media types), property name, or a
file name is in a monospace font.</dd>
<dt><strong>definition</strong></dt>
<dd>A definition of a term, to be used elsewhere in this or other
specifications, is in bold and italics.</dd>
<dt><a href="">hyperlink</a></dt>
<dd>A hyperlink is underlined and in blue.</dd>
<dt>[<cite><a class="bibref" href="#bib-reference">reference</a></cite>]</dt>
<dd>A document reference (normative or informative) is enclosed in
square brackets and links to the references section.</dd>
</dl><div class="note" role="note" id="issue-container-generatedID-0"><div role="heading" class="note-title marker" id="h-note-0" aria-level="3"><span>Note</span></div><div class=""><p>Notes are in light green boxes with a green left border and with a "Note"
header in green. Notes are normative or informative depending on the whether
they are in a normative or informative section, respectively.</p>
</div></div><div class="example" id="example-1">
          <div class="marker">
      <a class="self-link" href="#example-1">Example 1</a>
    </div>
          <pre class="hljs javascript" aria-busy="false">Examples are <span class="hljs-keyword">in</span> light khaki boxes, <span class="hljs-keyword">with</span> khaki left border, and <span class="hljs-keyword">with</span> a
numbered <span class="hljs-string">"Example"</span> header <span class="hljs-keyword">in</span> khaki. Examples are always informative.
The content <span class="hljs-keyword">of</span> the example is <span class="hljs-keyword">in</span> monospace font and may be syntax colored.</pre>
        </div></section><section id="key-actors"><!--OddPage--><h2 id="x4-key-actors"><span class="secno">4. </span>Key Actors<a class="self-link" aria-label="§" href="#key-actors"></a></h2><p>Of all the organisations and systems involved in a transaction, the API defined
by this specification is scoped tightly to only specify interactions between the <strong>Broker</strong> and
<strong>Booking System</strong>, with high level prompts for interactions with a <strong>Payment Provider</strong>.</p><figure id="fig-illustration-of-actors-and-systems-involved-in-a-transaction-and-the-focus-of-this-specification-being-between-broker-and-booking-system"><img src="actors.png" alt="Actors in scope" height="314" width="696">
<figcaption>Figure <span class="figno">1</span> <span class="fig-title">Illustration of actors and systems involved in a transaction, and the focus
of this specification being between Broker and Booking System.</span></figcaption>
</figure><dl class="typography">
<dt><strong>Customer</strong></dt>
<dd>The user who places a booking using an application provided by
a <strong>Broker</strong>.</dd>
<dt><strong>Broker</strong></dt>
<dd>The organisation or developer providing an application that
allows <strong>Customer</strong>s to make bookings. Those applications will be
clients of the API defined in this specification</dd>
<dt><strong>Booking System</strong></dt>
<dd>The organisation or developer providing an application that
maintains bookable inventory on behalf of the <strong>Seller</strong>.
The platform or service that provides a server-side implementation
of this API.
</dd>
<dt><strong>Seller</strong></dt>
<dd>The organisation providing access to events or facilities
via a booking system. e.g. a leisure provider running yoga classes.</dd>
<dt><strong>Payment Provider</strong></dt>
<dd>The organisation providing payment processing between the
<strong>Customer</strong>, <strong>Broker</strong> and
            <strong>Seller</strong>.</dd>
</dl></section><section class="normative" id="booking-flow"><!--OddPage--><h2 id="x5-booking-flow"><span class="secno">5. </span>Booking Flow<a class="self-link" aria-label="§" href="#booking-flow"></a></h2><section id="user-journey"><h3 id="x5-1-user-journey"><span class="secno">5.1 </span>User Journey<a class="self-link" aria-label="§" href="#user-journey"></a></h3><p>The booking journey of a <strong>Customer</strong> is generalised into the following key steps:</p><ol>
<li><strong>Select</strong>: Customer selects an item</li>
<li><strong>Register / Login</strong>: Customer enters personal details</li>
<li><strong>Book and Pay</strong>: Customer enters payment details</li>
</ol><p>Note that some or all steps may not actually be visible to the user if details are already known (e.g. known registration or payment details, or booking via voice command).</p><figure id="fig-illustration-of-the-expected-user-journey"><img src="userjourney.png" alt="High level user journey" height="150" width="960">
<figcaption>Figure <span class="figno">2</span> <span class="fig-title">Illustration of the expected user journey.</span></figcaption>
</figure></section><section id="high-level-summary-of-the-api"><h3 id="x5-2-high-level-summary-of-the-api"><span class="secno">5.2 </span>High-level summary of the API<a class="self-link" aria-label="§" href="#high-level-summary-of-the-api"></a></h3><ul>
<li><p><strong>Broker</strong> generates session <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a> which it uses throughout the process.</p>
</li>
<li><p>After both "<strong>1. Select</strong>" and "<strong>2. Register / Login</strong>", the <strong>Broker</strong> calls the <strong>Booking System</strong> to confirm the price and availability of the selected items using an <code>OrderQuote</code>, and retrieve a total order price. These calls are illustrated as checkpoints <strong>C1</strong> and <strong>C2</strong> on the diagram below.</p>
</li>
<li><p>After "<strong>3. Book and Pay</strong>", the <strong>Broker</strong> first <em>authorizes</em> the payment for the total order price (if required by the payment provider), then confirms the booking with <strong>Booking System</strong> using an <code>Order</code> (<strong>B</strong> on the diagram below), and finally <em>captures</em> the payment.</p>
</li>
<li><p>The <strong>Booking System</strong> adds an <code>Order</code> to an RPDE feed specific to the <strong>Broker</strong>, which the <strong>Broker</strong> reads to update its internal state, generate Invoices, and deliver a notification to the Customer.</p>
</li>
</ul><figure id="fig-illustration-of-high-level-booking-flow"><img src="bookingflow.png" alt="High level booking flow" height="667" width="839">
<figcaption>Figure <span class="figno">3</span> <span class="fig-title">Illustration of high level booking flow.</span></figcaption>
</figure><section id="broker-contract-with-booking-system"><h4 id="x5-2-1-broker-contract-with-booking-system"><span class="secno">5.2.1 </span>Broker contract with Booking System<a class="self-link" aria-label="§" href="#broker-contract-with-booking-system"></a></h4><p>To complete a successful booking journey:</p><ul>
<li>The <strong>Broker</strong> <em class="rfc2119" title="SHOULD">SHOULD</em> call <strong>C1</strong> (without customer details)</li>
<li>The <strong>Broker</strong> <em class="rfc2119" title="MUST">MUST</em> call <strong>C2</strong> (with customer details), to retrieve the total order, with the exception of free orders where the order total is not required.</li>
<li>The <strong>Broker</strong> <em class="rfc2119" title="MUST">MUST</em> call <strong>B</strong> (with payment details)</li>
</ul><p>If <strong>B</strong> fails, the <strong>Broker</strong> <em class="rfc2119" title="MUST">MUST</em> cancel the payment without any consequence to the <strong>Customer</strong> or <strong>Seller</strong>.</p></section><section id="booking-system-contract-with-the-broker"><h4 id="x5-2-2-booking-system-contract-with-the-broker"><span class="secno">5.2.2 </span>Booking System contract with the Broker<a class="self-link" aria-label="§" href="#booking-system-contract-with-the-broker"></a></h4><ul>
<li>The <strong>Booking System</strong> <em class="rfc2119" title="MUST">MUST</em> respond to <strong>C1</strong> (without customer details) with an <code>OrderQuote</code> that includes an indicative total order price, or a relevant error.</li>
<li>The <strong>Booking System</strong> <em class="rfc2119" title="MUST">MUST</em> respond to <strong>C2</strong> (with customer details) with an <code>OrderQuote</code> that includes an exact total order price, or a relevant error.</li>
<li>The <strong>Booking System</strong> <em class="rfc2119" title="MUST">MUST</em> respond to <strong>B</strong> with a completed <code>Order</code>, or a relevant error. The whole booking succeeds or fails as one.</li>
</ul><p>With the exception of leasing, <strong>C1</strong> and <strong>C2</strong> <em class="rfc2119" title="MUST NOT">MUST NOT</em> have any side effects.</p></section><section id="leasing"><h4 id="x5-2-3-leasing"><span class="secno">5.2.3 </span>Leasing<a class="self-link" aria-label="§" href="#leasing"></a></h4><p>In order to ensure that items cannot be "stolen" from a <strong>Customer</strong>'s shopping basket by another <strong>Customer</strong>, the use of leases are <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em>, however they are not required to ensure a low barrier of entry for implementers of the specification.</p><p>Individually at <strong>C1</strong> and <strong>C2</strong>, the <strong>Booking System</strong> can opt to create (or extend) a lease for the <strong>Broker</strong>. Whether they opt to do so may depend on the <strong>Booking System</strong>'s capability to support leases, or on the <strong>Seller</strong>'s configuration of the <strong>Booking System</strong>. At <strong>C1</strong> the lease is anonymous, at <strong>C2</strong> customer details are provided.</p><p>If a lease is created at <strong>C1</strong> and/or <strong>C2</strong> it is used during <strong>B</strong>, if not or if it had expired the booking completes anyway provided sufficient inventory is available.</p><p>The specification is designed to allow for leasing to be implemented at a later stage by a <strong>Booking System</strong> without affecting the <strong>Broker</strong>'s implementation.</p></section></section><section id="step-by-step-process-description"><h3 id="x5-3-step-by-step-process-description"><span class="secno">5.3 </span>Step-by-step process description<a class="self-link" aria-label="§" href="#step-by-step-process-description"></a></h3><figure id="fig-sequence-diagram-showing-api-interactions"><img src="sequencediagram.png" alt="Sequence diagram" height="715" width="766">
<figcaption>Figure <span class="figno">4</span> <span class="fig-title">Sequence diagram showing API interactions</span></figcaption>
</figure><p>i) "<strong>1. Select</strong>" - User browses broker site anonymously and adds something to basket</p><ul>
<li><strong>Broker</strong> generates session UUID</li>
</ul><p>ii) <strong>C1</strong> - <strong>Broker</strong> call with <code>OrderQuote</code> including UUID without a Person object to check availability and that the combination of items requested can be purchased (call is idempotent)</p><ul>
<li><strong>Booking System</strong> creates anonymous lease for that UUID if it is supported, otherwise it provides a simple availability and totalPaymentDue confirmation. Response 200 indicates quote has been successfully produced (which implies all requested items are available). Response may include "orderLeaseExpiry" to indicate a lease has also been created against the UUID.</li>
<li><code>OrderQuote</code> includes total pricing confirmation in response for basket to be updated, as well as enumerated orderedItems with their respective details that can be rendered by the <strong>Broker</strong> to ensure accuracy (rather than relying on syncing with the open feed).</li>
</ul><p>iii) "<strong>2. Register / Login</strong>" - User clicks checkout and enters personal details</p><p>iv) <strong>C2</strong> - <strong>Broker</strong> call with <code>OrderQuote</code> including UUID with a Person object to check viability (call is idempotent)</p><ul>
<li>Booking system creates named lease for that UUID if it is supported, otherwise it provides a simple availability and totalPaymentDue confirmation. Works exactly as <strong>C1</strong>.</li>
</ul><p>v) "<strong>3. Book and Pay</strong>" - User enters payment details and clicks Book</p><p>vi) <strong>Authorise Payment</strong> - <strong>Broker</strong> pre-authorises totalPaymentDue from payment provider, using UUID as a reference</p><p>vii) <strong>B</strong> - <strong>Broker</strong> call with <code>Order</code> including UUID with a Person object to check viability and with a Payment object for the total amount pre-authed (call is idempotent, can be retried if 500 returned).</p><ul>
<li><p>If the total payment amount in the Payment object is different to the current totalPaymentDue (which might have changed since <strong>C2</strong>, e.g. if the headline price is changed in the booking system between these two steps), the booking fails but the lease is sustained so that the user can be prompted whether they want to continue with the new amount.</p>
</li>
<li><p>If some of the leases have expired, or if leases are not supported, then the booking system attempts to make the booking anyway. If there are no spaces available the booking fails.</p>
</li>
<li><p>If the booking succeeds only for some basket items, the whole transaction is rolled back and the entire booking fails.</p>
</li>
<li><p>If there's a failure, e.g. no response from server, then <strong>Broker</strong> can resubmit with same UUID. The Booking System will need to track UUID supplied by <strong>Broker</strong> against any successful orders, to ensure that it can update <strong>Broker</strong> on the order status if a previous request with that UUID was successful. <strong>Broker</strong> <em class="rfc2119" title="MUST NOT">MUST NOT</em> reuse UUIDs across multiple orders.</p>
</li>
<li><p>The booking is considered as complete and paid by the <strong>Booking System</strong> at this point</p>
</li>
</ul><p>viii) <strong>Capture Payment</strong> - <strong>Broker</strong> captures totalPaymentDue from payment provider, using UUID as a reference</p><ul>
<li><p>If an error occurs during capture (very unlikely but possible due to system failure), and this may only be noticed after the event due to server failure and observation of logs, the <strong>Broker</strong> must either:</p>
<ul>
<li>Initiate manual capture via e.g. the Stripe console. Note the pre-auth will typically last for 7 days, so manual capture is still possible after the event.</li>
<li>Capture the payment from the user manually (MLP's preferred method, if manual capture not possible).</li>
<li>Absorb the loss and make a new payment for the same amount with the same UUID in the payment provider (better for UX / customer service, if manual capture not possible).</li>
<li>Send a cancellation request to the booking system and notify the <strong>Customer</strong> of the error in good time before the event.</li>
</ul>
</li>
<li><p>It is the <strong>Broker</strong>'s responsibility to ensure that payment has been captured.</p>
</li>
</ul><p>ix) <strong>Invoice Generation</strong> and <strong>Customer Notification</strong> - <strong>Broker</strong> retrieves the <code>Order</code>(s) that are generated by the <strong>Booking System</strong> on the RPDE feed, generates invoices, and sends <strong>Customer</strong> notifications</p><ul>
<li>An secure RPDE feed of <code>Order</code>s <em class="rfc2119" title="MUST">MUST</em> be provided by the <strong>Booking System</strong>, with the contents of the feed specific to the authenticating <strong>Broker</strong>. This allows the <strong>Broker</strong> to maintain an updated state of all their bookings across a number of <strong>Booking System</strong>s, even when changes are made outside of the <strong>Broker</strong>. This also allows the <strong>Broker</strong> to handle refunds to cancellations, and process notifications to <strong>Customer</strong>s in a consistent way.</li>
<li>A single POST to <strong>B</strong> <em class="rfc2119" title="MAY">MAY</em> create multiple <code>Order</code>s on the RPDE feed, to accommodate the variety of internal <strong>Booking System</strong> models. The <strong>Booking System</strong> must ensure that the <code>Order</code>s in the RPDE feed represent the current state of <code>OrderItem</code>s within the system.</li>
<li>The <strong>Broker</strong> uses these <code>Order</code>s to generate invoices, and send notifications to the <strong>Customer</strong>.</li>
</ul></section></section><section class="normative" id="broker-roles"><!--OddPage--><h2 id="x6-broker-roles"><span class="secno">6. </span>Broker Roles<a class="self-link" aria-label="§" href="#broker-roles"></a></h2><p>A <strong>Broker</strong> is an actor that arranges transactions between a <strong>Seller</strong> and <strong>Customer</strong>, either directly or indirectly.</p><p>From a contractual and taxation perspective, there are two types of Broker, and agent (<code>AgentBroker</code>), and a reseller (<code>ResellerBroker</code>), as well direct purchase (<code>NoBroker</code>).</p><p>Note that this specification does not deal with contractual relationships, and simply provides a mechanism to record bookings.</p><section id="resellerbroker"><h3 id="x6-1-resellerbroker"><span class="secno">6.1 </span><code>ResellerBroker</code><a class="self-link" aria-label="§" href="#resellerbroker"></a></h3><section id="definition"><h4 id="x6-1-1-definition"><span class="secno">6.1.1 </span>Definition<a class="self-link" aria-label="§" href="#definition"></a></h4><p>A reseller is a company or individual that purchases goods or services with the intention of selling them rather than consuming or using them. This is usually done for profit (but could be resold at a loss).</p></section><section id="contractual-relationships"><h4 id="x6-1-2-contractual-relationships"><span class="secno">6.1.2 </span>Contractual Relationships<a class="self-link" aria-label="§" href="#contractual-relationships"></a></h4><p>In the context of OpenActive, a <code>ResellerBroker</code> contracts directly with the <strong>Seller</strong> as a business-to-business relationship to purchase access to the opportunity. It then, at a later point in time (which may only be milliseconds later), separately forms a contractual relationship with the <strong>Customer</strong>, who purchases access to the opportunity from the <code>ResellerBroker</code>.</p><figure id="fig-contractual-relationships-in-resellerbroker-mode"><img src="ResellerBroker.png" alt="ResellerBroker relationships" height="303" width="577">
<figcaption>Figure <span class="figno">5</span> <span class="fig-title">Contractual relationships in ResellerBroker mode</span></figcaption>
</figure></section><section id="taxation"><h4 id="x6-1-3-taxation"><span class="secno">6.1.3 </span>Taxation<a class="self-link" aria-label="§" href="#taxation"></a></h4><p>The <code>ResellerBroker</code>'s purchase from the <strong>Seller</strong> is business-to-business, which is subject to the appropriate taxation based on the <code>ResellerBroker</code> as the <strong>Customer</strong>.
The <strong>Customer</strong>'s purchase from the <code>ResellerBroker</code> is business-to-consumer, which is subject to the appropriate taxation based on the <code>ResellerBroker</code> as the <strong>Seller</strong>.</p><p>Hence any tax exception that the <strong>Customer</strong> may enjoy when purchasing directly from the <strong>Seller</strong> (e.g. if the <strong>Seller</strong> is an <a href="https://www.gov.uk/guidance/sport-supplies-that-are-vat-exempt-notice-70145">VAT exempt eligible body</a>) is not relevant here, as no direct contractual relationship is formed between <strong>Seller</strong> and <strong>Customer</strong>.</p></section><section id="scope-of-specification"><h4 id="x6-1-4-scope-of-specification"><span class="secno">6.1.4 </span>Scope of Specification<a class="self-link" aria-label="§" href="#scope-of-specification"></a></h4><p>This specification is designed to govern the interaction between the <code>ResellerBroker</code> and <strong>Seller</strong>. It does include provision for the interaction between the <code>ResellerBroker</code> and <strong>Customer</strong> explicitly, though it may be repurposed by the broker to perform this function by treating the Broker as a Booking system. This specification also does not include provision for the recording of the execution of the contractual relationship with any payment provider (e.g. for payment processing fees). Such relationships <em class="rfc2119" title="MUST">MUST</em> be handled separately.
When the brokerRole is set to <code>ResellerBroker</code>, this indicates that the payee for accounting and tax purposes is the "broker" specified in the Order.
Note that the <code>customer</code> may still optionally be included in the Order, for example to help front-of-house staff identify the <strong>Customer</strong>.</p></section><section id="conformance-criteria"><h4 id="x6-1-5-conformance-criteria"><span class="secno">6.1.5 </span>Conformance criteria<a class="self-link" aria-label="§" href="#conformance-criteria"></a></h4><p>When the booking system generates the Invoice in the response at B, the <code>Invoice.customer</code> property <em class="rfc2119" title="MUST">MUST</em> be equal to <code>Order.broker</code>, <code>Order.broker</code> <em class="rfc2119" title="MUST">MUST</em> be provided and <code>Order.customer</code> is optional.</p></section></section><section id="agentbroker"><h3 id="x6-2-agentbroker"><span class="secno">6.2 </span><code>AgentBroker</code><a class="self-link" aria-label="§" href="#agentbroker"></a></h3><section id="definition-0"><h4 id="x6-2-1-definition"><span class="secno">6.2.1 </span>Definition<a class="self-link" aria-label="§" href="#definition-0"></a></h4><p>An agent is authorized to act on behalf of another (the <strong>Seller</strong>, or "principle") to create legal relations with a third party (the <strong>Customer</strong>). Succinctly, it may be referred to as the equal relationship between a <strong>Seller</strong> and an agent whereby the principal, expressly or implicitly, authorizes the agent to work under his or her control and on his or her behalf. The agent is required to negotiate on behalf of the principal (<strong>Seller</strong>) and/or bring them and third parties (<strong>Customer</strong>s) into contractual relationship.</p></section><section id="contractual-relationships-0"><h4 id="x6-2-2-contractual-relationships"><span class="secno">6.2.2 </span>Contractual Relationships<a class="self-link" aria-label="§" href="#contractual-relationships-0"></a></h4><p>There are three separate types of contractual relationship involved:
<code>AgentBroker</code> with <strong>Seller</strong>, known as the principal-agent relationship or "internal" relationship;
<code>AgentBroker</code> with <strong>Customer</strong> with whom they deal on their <strong>Seller</strong>'s behalf ("external relationship"); and
<strong>Seller</strong> with <strong>Customer</strong> when arranged by an <code>AgentBroker</code>.</p><figure id="fig-contractual-relationships-in-agentbroker-mode"><img src="AgentBroker.png" alt="AgentBroker relationships" height="293" width="558">
<figcaption>Figure <span class="figno">6</span> <span class="fig-title">Contractual relationships in AgentBroker mode</span></figcaption>
</figure></section><section id="taxation-0"><h4 id="x6-2-3-taxation"><span class="secno">6.2.3 </span>Taxation<a class="self-link" aria-label="§" href="#taxation-0"></a></h4><p>While facilitated by the <code>AgentBroker</code>, the primary purchase is made by the <strong>Customer</strong> directly from the <strong>Seller</strong>, as would be the case if the <strong>Customer</strong> was to purchase from the <strong>Seller</strong> independently.
Hence any tax exception that the <strong>Customer</strong> may enjoy when purchasing directly from the <strong>Seller</strong> (e.g. if the <strong>Seller</strong> is an <a href="https://www.gov.uk/guidance/sport-supplies-that-are-vat-exempt-notice-70145">VAT exempt eligible body</a>) is relevant here.</p><p>The <strong>Customer</strong>'s relationship with <code>AgentBroker</code> is business-to-consumer. Hence any additional services (e.g. customer-facing booking fees) are subject to the appropriate taxation based on the <code>AgentBroker</code> as the <code>seller</code>.</p><p>The <code>AgentBroker</code>'s relationship with the <strong>Seller</strong> is business-to-business. Hence any additional services (e.g. booking commission) are subject to the appropriate taxation.</p></section><section id="scope-of-specification-0"><h4 id="x6-2-4-scope-of-specification"><span class="secno">6.2.4 </span>Scope of Specification<a class="self-link" aria-label="§" href="#scope-of-specification-0"></a></h4><p>This specification is designed to govern the recording of the execution of the contractual relationship between the <strong>Customer</strong> and <strong>Seller</strong>.
The scope of this specification does not include the contractual relationship between the <code>AgentBroker</code> and the <strong>Seller</strong> (e.g. for booking commission), between the <code>AgentBroker</code> and the <strong>Customer</strong> (e.g. for booking fees) or with any payment provider (e.g. for payment processing fees). Such relationships and the reconciliation of associated invoices <em class="rfc2119" title="MUST">MUST</em> be handled separately.
When the brokerRole is set to "AgentBroker", this indicates that the payee for accounting and tax purposes is the <code>customer</code> specified in the Order.</p></section><section id="conformance-criteria-0"><h4 id="x6-2-5-conformance-criteria"><span class="secno">6.2.5 </span>Conformance criteria<a class="self-link" aria-label="§" href="#conformance-criteria-0"></a></h4><p>When the booking system generates the Invoice, the <code>Invoice.customer</code> property <em class="rfc2119" title="MUST">MUST</em> be equal to <code>Order.customer</code>, <code>Order.broker</code> <em class="rfc2119" title="MUST">MUST</em> be provided and <code>Order.customer</code> <em class="rfc2119" title="MUST">MUST</em> be provided.</p></section></section><section id="nobroker"><h3 id="x6-3-nobroker"><span class="secno">6.3 </span><code>NoBroker</code><a class="self-link" aria-label="§" href="#nobroker"></a></h3><section id="definition-1"><h4 id="x6-3-1-definition"><span class="secno">6.3.1 </span>Definition<a class="self-link" aria-label="§" href="#definition-1"></a></h4><p>This specification supports direct purchase by a <strong>Customer</strong> (for example in the context of the <strong>Seller</strong>'s own website, or for businesses that purchase large volumes of FacilityUse slots to run leagues).</p></section><section id="contractual-relationships-1"><h4 id="x6-3-2-contractual-relationships"><span class="secno">6.3.2 </span>Contractual Relationships<a class="self-link" aria-label="§" href="#contractual-relationships-1"></a></h4><p>The contractual relationship is a simple one between the <strong>Seller</strong> and the <strong>Customer</strong>.</p><figure id="fig-contractual-relationships-in-nobroker-mode"><img src="NoBroker.png" alt="NoBroker relationships" height="132" width="564">
<figcaption>Figure <span class="figno">7</span> <span class="fig-title">Contractual relationships in NoBroker mode</span></figcaption>
</figure></section><section id="taxation-1"><h4 id="x6-3-3-taxation"><span class="secno">6.3.3 </span>Taxation<a class="self-link" aria-label="§" href="#taxation-1"></a></h4><p>The purchase is made by the <strong>Customer</strong> directly from the <strong>Seller</strong>, as would be the case if the <strong>Customer</strong> was to purchase from the <strong>Seller</strong> outside of this specification.
Hence any tax exception that the <strong>Customer</strong> may enjoy when purchasing directly from the <strong>Seller</strong> (e.g. if the <strong>Seller</strong> is an VAT exempt eligible body) is relevant here.</p></section><section id="scope-of-specification-1"><h4 id="x6-3-4-scope-of-specification"><span class="secno">6.3.4 </span>Scope of Specification<a class="self-link" aria-label="§" href="#scope-of-specification-1"></a></h4><p>This specification is designed to govern the recording of the execution of the contractual relationship between the <strong>Customer</strong> and <strong>Seller</strong>.
The scope of this specification does not include the contractual relationship with any payment provider (e.g. for payment processing fees). Such relationships <em class="rfc2119" title="MUST">MUST</em> be handled separately.</p><p>When the brokerRole is set to "NoBroker", this indicates that the payee for accounting and tax purposes is the <code>customer</code> specified in the Order.</p></section><section id="conformance-criteria-1"><h4 id="x6-3-5-conformance-criteria"><span class="secno">6.3.5 </span>Conformance criteria<a class="self-link" aria-label="§" href="#conformance-criteria-1"></a></h4><p>When the booking system generates the Invoice, the <code>Invoice.customer</code> property <em class="rfc2119" title="MUST">MUST</em> be equal to <code>Order.customer</code>, <code>Order.broker</code> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be provided and <code>Order.customer</code> <em class="rfc2119" title="MUST">MUST</em> be provided.</p></section></section></section><section class="normative" id="systems-of-record"><!--OddPage--><h2 id="x7-systems-of-record"><span class="secno">7. </span>Systems of Record<a class="self-link" aria-label="§" href="#systems-of-record"></a></h2><section id="roles-and-responsibilities-overview"><h3 id="x7-1-roles-and-responsibilities-overview"><span class="secno">7.1 </span>Roles and responsibilities overview<a class="self-link" aria-label="§" href="#roles-and-responsibilities-overview"></a></h3><p>For the purposes of this specification, the key components of a booking are: <code>Order</code>, <strong>Invoice</strong>, <strong>Payment</strong> and <strong>Refund</strong>.</p><p>The <strong>Broker</strong> has visibility of all components, while for simplicity of implementation the <strong>Booking System</strong> only has visibility of the <code>Order</code>, as shown below:</p><figure id="fig-roles-and-responsibilities"><img src="roles.png" alt="Roles and responsibilities" height="315" width="812">
<figcaption>Figure <span class="figno">8</span> <span class="fig-title">Roles and responsibilities</span></figcaption>
</figure><p><code>Order</code>s are the basis of the exchange between the <strong>Booking System</strong> and the <strong>Broker</strong>. This specification describes a detailed model and API to allow <strong>Broker</strong>s to manipulate <code>Order</code>s, and only high level functional requirements for the expected behaviour of <strong>Invoice</strong>s, <strong>Payment</strong>s, <strong>Receipt</strong>s.</p><table>
<thead>
<tr>
<th>Component</th>
<th>Description</th>
<th>Owner</th>
<th>Audit</th>
</tr>
</thead>
<tbody><tr>
<td><code>Order</code></td>
<td>A mutable object that encompasses the live state of the bookable <code>Event</code>s within the booking system. An <code>Order</code> has a <code>orderItem</code>s, a <code>totalPaymentDue</code>, and all tax details, but is not itself a legal representation of a purchase from the <strong>Seller</strong>. A single POST to <strong>B</strong> <em class="rfc2119" title="MAY">MAY</em> create multiple <code>Order</code>s, to accommodate the variety of internal <strong>Booking System</strong> models. All fragment <code>Order</code>s will share the same <code>Payment</code> <code>identifier</code> to allow them to be reconciled by the <strong>Broker</strong>.</td>
<td><strong>Booking System</strong></td>
<td>Mutable</td>
</tr>
<tr>
<td><strong>Invoice</strong></td>
<td>An immutable object that is a legal representation of the purchase, which <em class="rfc2119" title="MUST">MUST</em> be rendered to the <strong>Customer</strong> as a legally permissible tax receipt, and exist as a tax point. A new <strong>Invoice</strong> <em class="rfc2119" title="MUST">MUST</em> be generated for the <code>Order</code> to replace the previous <strong>Invoice</strong> each occasion that an <code>orderItem</code> within an <code>Order</code> is cancelled.</td>
<td><strong>Broker</strong></td>
<td>Immutable</td>
</tr>
<tr>
<td><strong>Payment</strong></td>
<td>A immutable object that represents the original payment to the <strong>Seller</strong> for the initial <code>Order</code>. Although modelling the <strong>Payment</strong> is outside the scope of this specification, it is recommended that one payment exists for each <code>Order</code>.</td>
<td><strong>Payment Provider</strong></td>
<td>Immutable</td>
</tr>
<tr>
<td><strong>Refund</strong></td>
<td>An immutable object that represents each refund made against the <strong>Payment</strong>, up to the <strong>Payment</strong>'s total amount</td>
<td><strong>Payment Provider</strong></td>
<td>Immutable</td>
</tr>
</tbody></table></section><section id="invoices-and-tax-receipts"><h3 id="x7-2-invoices-and-tax-receipts"><span class="secno">7.2 </span>Invoices and Tax receipts<a class="self-link" aria-label="§" href="#invoices-and-tax-receipts"></a></h3><p>Due to the variety of business models in use in OpenActive, the <strong>Booking System</strong> <em class="rfc2119" title="MUST NOT">MUST NOT</em> send receipts directly to the <strong>Customer</strong> for <code>AgentBroker</code> and <code>ResellerBroker</code> bookings.</p><p>For each successful <code>Order</code> operation, the <strong>Broker</strong> <em class="rfc2119" title="MUST">MUST</em> generate a new <strong>Invoice</strong> in the form of a tax receipt, on the basis of the <code>Order</code> RPDE feed contents. In order to ensure that the <strong>Customer</strong> is provided with the correct tax receipt, if <code>totalPaymentTaxSpecification</code> is provided in the <code>Order</code> upon completion of any operation, the <strong>Broker</strong> <em class="rfc2119" title="MUST">MUST</em> generate a new or updated <strong>Invoice</strong> and either (a) send a tax receipt representation of the <strong>Invoice</strong> to the <strong>Customer</strong> and/or (b) offer a means to allow the <strong>Customer</strong> to easily retrieve a full tax receipt representation of the specific version of the  <strong>Invoice</strong> at any future date for any previous booking made. As it is ultimately the <strong>Seller</strong>'s responsibility to send tax receipts, they need to be confident that the <strong>Broker</strong> is making tax information available to its customers in an accurate and timely manner.</p><p>The tax receipt sent by the <strong>Broker</strong> <em class="rfc2119" title="MUST">MUST</em> comply with any legal requirements of the jurisdiction of operation.</p><p>Note by following specification, for all broker modes where a <strong>Seller</strong> may need to issue a tax receipt manually for any reason, the <strong>Seller</strong> will have the details of the <strong>Customer</strong> and the transaction enough to generate the most recent tax receipt.</p></section><section id="payments-and-refunds"><h3 id="x7-3-payments-and-refunds"><span class="secno">7.3 </span>Payments and Refunds<a class="self-link" aria-label="§" href="#payments-and-refunds"></a></h3><p>Although the details of <strong>Payment</strong>s and <strong>Refund</strong>s are not in the scope of this specification, a single <strong>Payment</strong> <em class="rfc2119" title="MUST">MUST</em> be related to each <code>Order</code>, and a unique reference to this Payment <em class="rfc2119" title="MUST">MUST</em> be included in the <code>Payment</code>
<code>identifier</code> of the <code>Order</code> sent to the <strong>Booking System</strong>. Note that this <strong>Payment</strong> is permitted to represent a virtual <strong>Payment</strong> consolidating a number of actual <strong>Payments</strong> to allow for a wide variety of <strong>Payment</strong> methods used, however it must still be uniquely resolvable.</p></section><section id="tax-calculation"><h3 id="x7-4-tax-calculation"><span class="secno">7.4 </span>Tax calculation<a class="self-link" aria-label="§" href="#tax-calculation"></a></h3><section id="b2c-tax-calculation-by-booking-system-is-mandatory"><h4 id="x7-4-1-b2c-tax-calculation-by-booking-system-is-mandatory"><span class="secno">7.4.1 </span>B2C tax calculation by Booking System is mandatory<a class="self-link" aria-label="§" href="#b2c-tax-calculation-by-booking-system-is-mandatory"></a></h4><p>For <code>AgentBroker</code> and <code>NoBroker</code> modes, where the customer is of type <code>Person</code> and a tax receipt is usually generated by the <strong>Booking System</strong>, the tax calculation and associated properties this specification <em class="rfc2119" title="MUST">MUST</em> be implemented by the <strong>Booking System</strong> (even if the resulting tax amount is zero).</p></section><section id="b2b-tax-calculation-by-booking-system-is-optional"><h4 id="x7-4-2-b2b-tax-calculation-by-booking-system-is-optional"><span class="secno">7.4.2 </span>B2B tax calculation by Booking System is optional<a class="self-link" aria-label="§" href="#b2b-tax-calculation-by-booking-system-is-optional"></a></h4><p>Tax calculation at the <strong>Booking System</strong> is <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> when the <code>brokerRole</code> of <code>ResellerBroker</code> is specified, or when a customer of type <code>Organization</code> is specified. If tax calculation is not supported for a <code>ResellerBroker</code>, <code>unitTaxSpecification</code> and <code>totalPaymentTaxSpecification</code> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be included, and <code>acceptedOffer</code> must be set to use “net” VAT scheme (i.e. explicitly not including tax calculation). This applies to both <code>OrderQuote</code> and to the final <code>Order</code>.</p><p>This allows tax to be calculated by the <code>ResellerBroker</code> or business <strong>Customer</strong> and reconciled outside of this specification.</p></section></section><section id="tax-mode"><h3 id="x7-5-tax-mode"><span class="secno">7.5 </span>Tax mode<a class="self-link" aria-label="§" href="#tax-mode"></a></h3><p>The <code>taxMode</code> (<code>https://openactive/TaxNet</code> or <code>https://openactive/TaxGross</code>) is specified at the <strong>Seller</strong> level, and must be consistent for all <code>Order</code>s originating from that <strong>Seller</strong>.</p></section><section id="offer-overrides"><h3 id="x7-6-offer-overrides"><span class="secno">7.6 </span>Offer overrides<a class="self-link" aria-label="§" href="#offer-overrides"></a></h3><p>The unit price of an OrderItem may be overridden to allow for business models with dynamic or variable pricing.</p><p>An <code>OfferOverride</code> type may be supplied to the <code>acceptedOffer</code> property at <strong>C1</strong>, <strong>C2</strong> and <strong>B</strong>. When an <code>OfferOverride</code> is used, it must be used consistently between <strong>C2</strong> and <strong>B</strong> to OrderQuote, it must be used by the booking system instead of acceptedOffer to calculate the tax and totals.</p><p>The <code>unitTaxSpecification</code> is calculated by the booking system exactly as it would be for an standard <code>Offer</code>. The <code>price</code> of the <code>OfferOverride</code> may be zero, and also may be higher or lower than the available <code>Offer</code>s that exist in the <strong>Booking System</strong>.</p><p><code>OfferOverride</code> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be used when <code>isAccessibleForFree</code> is <code>true</code>, as free events cannot be overridden. Note that booking systems that only offer free opportunities <em class="rfc2119" title="MUST NOT">MUST NOT</em> implement <code>OfferOverride</code> support, and must always throw an error when it is used.</p><div class="example" id="example-2-example-of-offeroverride">
          <div class="marker">
      <a class="self-link" href="#example-2-example-of-offeroverride">Example 2</a><span class="example-title">: Example of OfferOverride</span>
    </div>
          <pre class="hljs javascript" aria-busy="false"><span class="hljs-string">"acceptedOffer"</span>: {
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"OfferOverride"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
  <span class="hljs-string">"price"</span>: <span class="hljs-number">10.00</span>,
  <span class="hljs-string">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
}</pre>
        </div></section></section><section class="normative" id="order-operations"><!--OddPage--><h2 id="x8-order-operations"><span class="secno">8. </span>Order Operations<a class="self-link" aria-label="§" href="#order-operations"></a></h2><section id="amending-the-orderquote-before-b"><h3 id="x8-1-amending-the-orderquote-before-b"><span class="secno">8.1 </span>Amending the OrderQuote before <strong>B</strong><a class="self-link" aria-label="§" href="#amending-the-orderquote-before-b"></a></h3><p>The <strong>Broker</strong> <em class="rfc2119" title="MAY">MAY</em> call <strong>C1</strong> and <em class="rfc2119" title="MUST">MUST</em> call <strong>C2</strong> when the <strong>Customer</strong> updates their basket to add and remove items.</p><p>When repeated calls to <strong>C1</strong> or <strong>C2</strong> are made with the same UUID, the <strong>Booking System</strong> <em class="rfc2119" title="MUST">MUST</em> expire the leases of items that have been removed from the basket.</p><p>All leases may be cancelled by submitting an <code>OrderQuote</code> with the same UUID but without any <code>orderItem</code>s as either <strong>C1</strong> or <strong>C2</strong>. The <strong>Broker</strong> <em class="rfc2119" title="SHOULD">SHOULD</em> make a reasonable attempt to cancel all leases when it is aware that a <strong>Customer</strong> has abandoned their journey. For <strong>Booking Systems</strong> that have not implemented leasing, an <code>OrderQuote</code> without any <code>orderItem</code>s can simply be ignored.</p></section><section id="cancellation-after-b"><h3 id="x8-2-cancellation-after-b"><span class="secno">8.2 </span>Cancellation after <strong>B</strong><a class="self-link" aria-label="§" href="#cancellation-after-b"></a></h3><p>Either the whole <code>Order</code> or individual <code>OrderItem</code>s within the <code>Order</code> may be cancelled after <strong>B</strong>, however <code>OrderItem</code>s cannot be replaced or added to an existing <code>Order</code> within this version of the specification.</p><p>The cancellation may be requested by either the <strong>Customer</strong> or the <strong>Seller</strong>, and results in an updated <code>Order</code> item on the RPDE feed. Once a cancellation status is placed on an <code>OrderItem</code> within an <code>Order</code> in the RPDE feed it is assumed by the <strong>Booking System</strong> to have been processed, and it <em class="rfc2119" title="MUST NOT">MUST NOT</em> be reversed. A new <code>Order</code> will need to created to reinstate the booking.</p><section id="customer-requested-cancellation"><h4 id="x8-2-1-customer-requested-cancellation"><span class="secno">8.2.1 </span>Customer requested cancellation<a class="self-link" aria-label="§" href="#customer-requested-cancellation"></a></h4><figure id="fig-customer-requested-cancellation"><img src="customercancelled.png" alt="Customer requested cancellation" height="533" width="765">
<figcaption>Figure <span class="figno">9</span> <span class="fig-title">Customer requested cancellation</span></figcaption>
</figure><p>To cancel an existing OrderItem, the <strong>Broker</strong> <em class="rfc2119" title="MUST">MUST</em>:</p><ol>
<li><p>Use the latest state of the <code>Order</code> from the RPDE feed to determine which <code>OrderItem</code>s may be cancelled. If <code>allowSimpleCancellation</code> is <code>true</code>, a DELETE against the <code>OrderItem</code>
<code>id</code> <em class="rfc2119" title="MUST">MUST</em> succeed. The value of the refund for each <code>OrderItem</code> <em class="rfc2119" title="MUST">MUST</em> be equal to the sum of the <code>price</code> in the <code>acceptedOffer</code> and the price in the <code>unitTaxSpecification</code>, which allows the <strong>Customer</strong> to be informed of the expected refund before they commit to cancellation.</p>
</li>
<li><p>For each <code>OrderItem</code> to be cancelled, a DELETE must be submitted using the URI <code>id</code> of the <code>OrderItem</code> from the feed. On success, a 204 response will be received, without any body. On failure a 5xx response will be received with an error message.</p>
</li>
<li><p>Process any refunds based on the resulting updates to the RPDE feed. Successfully cancelled <code>OrderItems</code> will have <code>orderItemStatus</code> set to <code>https://openactive.io/CustomerCancelled</code>. Note refunds <em class="rfc2119" title="MUST NOT">MUST NOT</em> be processed except in response to updates in the RPDE feed.</p>
</li>
</ol><p>To cancel an entire <code>Order</code>, a DELETE request must be made to each <code>OrderItem</code> within it individually. To minimise the number of updates in the RPDE feed, it is recommended that multiple DELETEs are sent in quick succession.</p></section><section id="seller-requested-cancellation"><h4 id="x8-2-2-seller-requested-cancellation"><span class="secno">8.2.2 </span>Seller requested cancellation<a class="self-link" aria-label="§" href="#seller-requested-cancellation"></a></h4><figure id="fig-seller-requested-cancellation"><img src="sellercancelled.png" alt="Seller requested cancellation" height="316" width="763">
<figcaption>Figure <span class="figno">10</span> <span class="fig-title">Seller requested cancellation</span></figcaption>
</figure><p><code>OrderItems</code> cancelled by the Seller will have <code>orderItemStatus</code> set to <code>https://openactive.io/SellerCancelled</code> in the RPDE feed, and refunds <em class="rfc2119" title="MUST">MUST</em> be processed in response to the RPDE updates.</p></section></section><section id="notifications-updates-and-refunds"><h3 id="x8-3-notifications-updates-and-refunds"><span class="secno">8.3 </span>Notifications, updates and refunds<a class="self-link" aria-label="§" href="#notifications-updates-and-refunds"></a></h3><p>An secure RPDE feed of <code>Order</code>s <em class="rfc2119" title="MUST">MUST</em> be provided by the <strong>Booking System</strong>, with the contents of the feed specific to the authenticating <strong>Broker</strong>. This allows the <strong>Broker</strong> to maintain an updated state of all their bookings across a number of <strong>Booking System</strong>s, even when changes are made outside of the <strong>Broker</strong>.</p><p>This also allows the <strong>Broker</strong> to handle refunds to cancellations, and process notifications to <strong>Customer</strong>s in a consistent way.</p><section id="booking-system-updating-rpde-orders"><h4 id="x8-3-1-booking-system-updating-rpde-orders"><span class="secno">8.3.1 </span>Booking System: Updating RPDE <code>Order</code>s<a class="self-link" aria-label="§" href="#booking-system-updating-rpde-orders"></a></h4><p>A single POST to <strong>B</strong> <em class="rfc2119" title="MAY">MAY</em> create multiple <code>Order</code>s on the RPDE feed, to accommodate the variety of internal <strong>Booking System</strong> models. The <strong>Booking System</strong> must ensure that the <code>Order</code>s in the RPDE feed represent the current state of <code>OrderItem</code>s within the system. Note that although multiple <code>Order</code>s may be created in the RPDE feed which are different to the <code>Order</code> returned by <strong>B</strong>, the individual <code>OrderItem</code>s within the <code>Order</code>s must be the same in <strong>B</strong> as in the RPDE <code>Order</code>s.
</p><p>In order to allow a natural batching of updates in the RPDE feed, where multiple cancellations may be made across multiple <code>Order</code>s for the same <strong>Customer</strong>, cancellation updates made to <code>Order</code>s in the feed by the <strong>Booking System</strong> <em class="rfc2119" title="MUST">MUST</em> be posted with a modified date 30 seconds into the future. The following query will easily exclude such updates while still meeting the RPDE specification:</p><div class="example" id="example-3-example-of-rpde-query-with-natural-batching">
          <div class="marker">
      <a class="self-link" href="#example-3-example-of-rpde-query-with-natural-batching">Example 3</a><span class="example-title">: Example of RPDE query with natural batching</span>
    </div>
          <pre class="sql hljs" aria-busy="false">--include first part of WHERE clause only if @afterTimestamp and @afterId provided
   WHERE (
        (modified = @afterTimestamp
              AND id &gt; @afterId)
        OR (modified &gt; @afterTimestamp)
      )
      AND modified &lt;= GETDATE()
ORDER BY modified,
         id</pre>
        </div></section><section id="broker-processing-rpde-orders"><h4 id="x8-3-2-broker-processing-rpde-orders"><span class="secno">8.3.2 </span>Broker: Processing RPDE <code>Order</code>s<a class="self-link" aria-label="§" href="#broker-processing-rpde-orders"></a></h4><p>The <strong>Broker</strong> <em class="rfc2119" title="MUST">MUST</em> maintain an up-to-date store of <code>Order</code>s received from the <strong>Booking System</strong>. Each <code>Order</code> received is compared to the last <code>Order</code> stored, and any differences between the old and new content trigger notifications and refunds to the <strong>Customer</strong>, as well as updating the <strong>Broker</strong>'s store.</p><p>Hence it is important for the <strong>Broker</strong> to consider their store of <code>Order</code>s as durable, and not simply a cache, to ensure their customers always get relevant notifications.</p><p>A single POST to <strong>B</strong> <em class="rfc2119" title="MAY">MAY</em> create multiple <code>Order</code>s on the RPDE feed, to accommodate the variety of internal <strong>Booking System</strong> models, and hence only RPDE feed <code>Order</code>s are intended to be stored by the <strong>Broker</strong>. When the <strong>Booking System</strong> chooses to split an <code>Order</code> in the feed, all fragment <code>Order</code>s will share the same <code>Payment</code>
<code>identifier</code> to allow them to be reconciled by the <strong>Broker</strong>.</p></section><section id="new-orders"><h4 id="x8-3-3-new-orders"><span class="secno">8.3.3 </span>New <code>Orders</code><a class="self-link" aria-label="§" href="#new-orders"></a></h4><p>New (unrecognised) <code>Order</code> items in the RPDE feed may be used to notify the <strong>Customer</strong> with a VAT receipt, but <em class="rfc2119" title="MUST">MUST</em> be stored by the <strong>Broker</strong>.</p></section><section id="cancellation-refund-calculation-and-notification"><h4 id="x8-3-4-cancellation-refund-calculation-and-notification"><span class="secno">8.3.4 </span>Cancellation, refund calculation and notification<a class="self-link" aria-label="§" href="#cancellation-refund-calculation-and-notification"></a></h4><p>Regardless of the source of the cancellation, the process for refunding and notifying the <strong>Customer</strong> and updating the <strong>Broker</strong>'s records is exactly the same.</p><p>The <strong>Broker</strong> <em class="rfc2119" title="MUST">MUST</em> process refunds for each new cancellation found in the feed, and it is the <strong>Broker</strong>'s responsibility to continually retry failed refund processing and escalate issues to the <strong>Customer</strong> accordingly. Note that the RPDE feed is "fire and forget" for the <strong>Booking System</strong>: once an <code>OrderItem</code> is updated with a cancellation status in the RPDE feed, the status <em class="rfc2119" title="MUST">MUST</em> not be reversed, and is assumed by the <strong>Booking System</strong> to be processed.</p><p>For items found with <code>OrderItem</code>s that contain <code>orderItemStatus</code> with new <code>https://openactive.io/CustomerCancelled</code> or <code>https://openactive.io/SellerCancelled</code> values, the new <code>totalPaymentDue</code> value of the <code>Order</code> must be made to equal the value of the associated <strong>Payment</strong> less any <strong>Refund</strong>s, by creating an additional <strong>Refund</strong>s if necessary. Cancellation fees may be added to the <code>Order</code> for each cancellation, so the refund may not be equal to the original amount.</p><p>The <strong>Customer</strong> <em class="rfc2119" title="MUST">MUST</em> be notified after a refund is successfully processed, using the <code>orderItemStatus</code> to indicate the source of the cancellation.</p><p>If refund processing takes longer than 15 minutes, and a new status of <code>https://openactive.io/SellerCancelled</code> was detected by the <strong>Broker</strong>, then the <strong>Customer</strong> must be notified immediately of a cancellation ahead of the notification of the completed refund. This ensures the <strong>Seller</strong> can rely on the <strong>Broker</strong> as a notification channel in the event of cancellation.</p><p>Note that the <strong>Customer</strong> <em class="rfc2119" title="MUST">MUST</em> be notified in the event of all cancellations, even if no refund is due.</p><pre aria-busy="false" class="hljs javascript">{
 <span class="hljs-string">"next"</span>: <span class="hljs-string">"https://www.example.com/api/rpde/orders?afterTimestamp=1521565719&amp;afterId=C5EE1E55-2DE6-44F7-A865-42F268A82C63"</span>,
 <span class="hljs-string">"items"</span>: [
   {
     <span class="hljs-string">"state"</span>: <span class="hljs-string">"updated"</span>,
     <span class="hljs-string">"kind"</span>: <span class="hljs-string">"Order"</span>,
     <span class="hljs-string">"id"</span>: <span class="hljs-string">"123e4567-e89b-12d3-a456-426655440000"</span>,
     <span class="hljs-string">"modified"</span>: <span class="hljs-number">1521565719</span>,
     <span class="hljs-string">"data"</span>: {
       <span class="hljs-string">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
       <span class="hljs-string">"type"</span>: <span class="hljs-string">"Order"</span>,
       <span class="hljs-string">"id"</span>: <span class="hljs-string">"https://example.com/orders/123e4567-e89b-12d3-a456-426655440000"</span>
       <span class="hljs-string">"orderNumber"</span>: <span class="hljs-string">"12d3-a456-426655440000"</span>,
       <span class="hljs-string">"orderStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderComplete"</span>,
       <span class="hljs-string">"seller"</span>: {
         <span class="hljs-string">"type"</span>: <span class="hljs-string">"Organization"</span>,
         <span class="hljs-string">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
         <span class="hljs-string">"name"</span>: <span class="hljs-string">"Better"</span>,
         <span class="hljs-string">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>
       },
       <span class="hljs-string">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/BrokerAgent"</span>,
       <span class="hljs-string">"broker"</span>: {
         <span class="hljs-string">"type"</span>: <span class="hljs-string">"Organization"</span>,
         <span class="hljs-string">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
         <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
         <span class="hljs-string">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
         <span class="hljs-string">"logo"</span>: {
           <span class="hljs-string">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
           <span class="hljs-string">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
         }
       },
       <span class="hljs-string">"orderedItem"</span>: [
         {
           <span class="hljs-string">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
           <span class="hljs-string">"id"</span>: <span class="hljs-string">"https://example.com/orders/452/order-items/132"</span>,
           <span class="hljs-string">"allowSimpleCancellation"</span>: <span class="hljs-literal">true</span>,
           <span class="hljs-string">"unitTaxSpecification"</span>: [
             {
               <span class="hljs-string">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
               <span class="hljs-string">"name"</span>: <span class="hljs-string">"VAT at 0% for EU transactions"</span>,
               <span class="hljs-string">"price"</span>: <span class="hljs-number">1.00</span>,
               <span class="hljs-string">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
               <span class="hljs-string">"rate"</span>: <span class="hljs-number">0.2</span>
             }
           ],
           <span class="hljs-string">"acceptedOffer"</span>: {
             <span class="hljs-string">"type"</span>: <span class="hljs-string">"Offer"</span>, <span class="hljs-comment">//expanded by booking system</span>
             <span class="hljs-string">"id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>, <span class="hljs-comment">// broker</span>
             <span class="hljs-string">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
             <span class="hljs-string">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
             <span class="hljs-string">"price"</span>: <span class="hljs-number">10.00</span>,
             <span class="hljs-string">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
             <span class="hljs-string">"isCancellable"</span>: <span class="hljs-literal">true</span>,
             <span class="hljs-string">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
             <span class="hljs-string">"cancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
           },
           <span class="hljs-string">"orderedItem"</span>: {
             <span class="hljs-string">"type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
             <span class="hljs-string">"identifier"</span>: <span class="hljs-number">123</span>, <span class="hljs-comment">//expanded by booking system</span>
             <span class="hljs-string">"id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
             <span class="hljs-string">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
             <span class="hljs-string">"maximumAttendeeCapacity"</span>: <span class="hljs-number">30</span>,
             <span class="hljs-string">"remainingAttendeeCapacity"</span>: <span class="hljs-number">20</span>,
             <span class="hljs-string">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
             <span class="hljs-string">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
             <span class="hljs-string">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
             <span class="hljs-string">"superEvent"</span>: {
               <span class="hljs-string">"type"</span>: <span class="hljs-string">"SessionSeries"</span>,
               <span class="hljs-string">"id"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
               <span class="hljs-string">"name"</span>: <span class="hljs-string">"Speedball"</span>,
               <span class="hljs-string">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
               <span class="hljs-string">"organizer"</span>: {
                 <span class="hljs-string">"type"</span>: <span class="hljs-string">"Organization"</span>,
                 <span class="hljs-string">"name"</span>: <span class="hljs-string">"Central Speedball Association"</span>,
                 <span class="hljs-string">"url"</span>: <span class="hljs-string">"http://www.speedball-world.com"</span>,
                 <span class="hljs-string">"termsOfService"</span>: {
                   <span class="hljs-string">"type"</span>: <span class="hljs-string">"TermsOfService"</span>,
                   <span class="hljs-string">"url"</span>: <span class="hljs-string">"url"</span>
                 }
               },
               <span class="hljs-string">"location"</span>: {}
             }
           }
         }
       ],
       <span class="hljs-string">"totalPaymentDue"</span>: {
         <span class="hljs-string">"type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
         <span class="hljs-string">"price"</span>: <span class="hljs-number">5.00</span>,
         <span class="hljs-string">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
         <span class="hljs-string">"valueAddedTaxIncluded"</span>: <span class="hljs-literal">true</span>
       },
       <span class="hljs-string">"totalTaxSpecification"</span>: [
         {
           <span class="hljs-string">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
           <span class="hljs-string">"name"</span>: <span class="hljs-string">"VAT at 0% for EU transactions"</span>,
           <span class="hljs-string">"price"</span>: <span class="hljs-number">1.00</span>,
           <span class="hljs-string">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
           <span class="hljs-string">"rate"</span>: <span class="hljs-number">0.2</span>
         }
       ],
       <span class="hljs-string">"payment"</span>: { <span class="hljs-comment">// broker (&amp; booking system for amends)</span>
         <span class="hljs-string">"type"</span>: <span class="hljs-string">"Payment"</span>,
         <span class="hljs-string">"name"</span>: <span class="hljs-string">"AcmeBroker Points"</span>, <span class="hljs-comment">// optional free text description of payment method for booking system, to help the Seller in discussions with the Customer (e.g. "AcmeBroker Points" or "AcmeBroker via Credit Card")</span>
         <span class="hljs-string">"identifier"</span>: <span class="hljs-string">"1234567890npduy2f"</span>
       }
     }
   }
 ]
}</pre></section></section><section id="amending-the-order-after-b"><h3 id="x8-4-amending-the-order-after-b"><span class="secno">8.4 </span>Amending the Order after <strong>B</strong><a class="self-link" aria-label="§" href="#amending-the-order-after-b"></a></h3><p><code>OrderItem</code>s cannot be replaced or added to an existing <code>Order</code> within this version of the specification. A new <code>Order</code> must be created, and the old <code>Order</code> cancelled.</p><p>For the common case of rescheduling a <code>SessionSeries</code> or <code>FacilityUse</code> booking, the following steps are recommended for the <strong>Broker</strong>:</p><ol>
<li><p>Request an <code>OrderQuote</code> for the new <code>orderItem</code>s with a new UUID, using <strong>C2</strong>.</p>
</li>
<li><p>Check the latest stored state of <code>Order</code>s from the RPDE feed to ensure that old <code>orderItem</code>
<code>allowSimpleCancellation</code>.</p>
</li>
<li><p>Clearly display messaging to the <strong>Customer</strong> that explains that this transaction will involve a refund and new purchase, and so they will expect a refund for the old item and a new transaction for the new one. Information should be displayed to the <strong>Customer</strong> if any price difference exists between the two Orders, for the <strong>Customer</strong> to confirm.</p>
</li>
<li><p>Request new payment details from the <strong>Customer</strong> and Authorise the amount specified by <strong>C2</strong>, then DELETE the old <code>orderItem</code>, and if successful, complete <strong>B</strong> as normal.</p>
</li>
</ol><p>The new <code>Order</code> is completed as described in the new booking process, and the existing <code>Order</code> is cancelled with the refund processed as described in the next section.</p></section><section id="extension-points-for-including-payments"><h3 id="x8-5-extension-points-for-including-payments"><span class="secno">8.5 </span>Extension points for including Payments<a class="self-link" aria-label="§" href="#extension-points-for-including-payments"></a></h3><p>In some limited circumstances it might also be desirable for an Open Booking API to act as a facade over a Booking System, Payment Processor, and Invoicing systems. For these circumstances the specification allows the API defined here to be extended via additional <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> properties in the <code>Payment</code> type used in <code>B</code> in a custom namespace, to facilitate a full payment.</p><div class="example" id="example-4-example-of-payment-extension-point">
          <div class="marker">
      <a class="self-link" href="#example-4-example-of-payment-extension-point">Example 4</a><span class="example-title">: Example of Payment extension point</span>
    </div>
          <pre class="hljs javascript" aria-busy="false"><span class="hljs-string">"payment"</span>: {
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"Payment"</span>,
  <span class="hljs-string">"identifier"</span>: <span class="hljs-string">"12345678ABCD"</span>,
  <span class="hljs-string">"paymentMethod"</span>: <span class="hljs-string">"stripe:StripePayment"</span>,
  <span class="hljs-string">"stripe:token"</span>: <span class="hljs-string">"tok_KPte7942xySKBKyrBu11yEpf"</span>
},</pre>
        </div><p>Note that due to the variety of business models available in the OpenActive ecosystem, conformance to this specification requires that the use of any native payment functionality in the <strong>Booking System</strong> be optional, and the <strong>Booking System</strong> must always accept a lack of <code>paymentMethod</code> as indication of an external <strong>Payment Processor</strong> being used.</p></section></section><section class="normative" id="modelling"><!--OddPage--><h2 id="x9-modelling"><span class="secno">9. </span>Modelling<a class="self-link" aria-label="§" href="#modelling"></a></h2><section id="order-and-orderquote"><h3 id="x9-1-order-and-orderquote"><span class="secno">9.1 </span><code>Order</code> and <code>OrderQuote</code><a class="self-link" aria-label="§" href="#order-and-orderquote"></a></h3><p><code>OrderQuote</code> subclasses <code>Order</code>, and they both contain exactly the same properties. These are listed below.</p><section id="example"><h4 id="x9-1-1-example"><span class="secno">9.1.1 </span>Example<a class="self-link" aria-label="§" href="#example"></a></h4><pre aria-busy="false" class="hljs javascript">{
  <span class="hljs-string">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"OrderQuote"</span>,
  <span class="hljs-string">"orderNumber"</span>: <span class="hljs-string">""</span>, <span class="hljs-comment">//booking system generated</span>
  <span class="hljs-string">"seller"</span>: {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-string">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Better"</span>,
    <span class="hljs-string">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"A charitable social enterprise for all the community"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://www.better.org.uk"</span>,
    <span class="hljs-string">"logo"</span>: {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-string">"url"</span>: <span class="hljs-string">"http://data.better.org.uk/images/logo.png"</span>
    },
    <span class="hljs-string">"telephone"</span>: <span class="hljs-string">"020 3457 8700"</span>,
    <span class="hljs-string">"email"</span>: <span class="hljs-string">"customerservices@gll.org"</span>,
    <span class="hljs-string">"vatID"</span>: <span class="hljs-string">"GB 789 1234 56"</span>,
    <span class="hljs-string">"address"</span>: {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-string">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-string">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-string">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-string">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-string">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-string">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/BrokerAgent"</span>, <span class="hljs-comment">//broker</span>
  <span class="hljs-string">"broker"</span>: { <span class="hljs-comment">//broker</span>
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-string">"logo"</span>: {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-string">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-string">"address"</span>: {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-string">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-string">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-string">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-string">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-string">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-string">"customer"</span>: { <span class="hljs-comment">//broker</span>
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-string">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-string">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-string">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-string">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-string">"bookingService"</span>: { <span class="hljs-comment">//booking system</span>
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"BookingService"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Playwaze"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"http://www.playwaze.com"</span>,
    <span class="hljs-string">"termsOfService"</span>: {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"TermsOfService"</span>,
      <span class="hljs-string">"url"</span>: <span class="hljs-string">"url"</span>
    }
  },
  <span class="hljs-string">"requestLease"</span>: <span class="hljs-literal">true</span>, <span class="hljs-comment">// broker</span>
  <span class="hljs-string">"lease"</span>: { <span class="hljs-comment">// booking system</span>
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"Lease"</span>,
    <span class="hljs-string">"leaseExpiry"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>
  },
  <span class="hljs-string">"orderedItem"</span>: [ <span class="hljs-comment">//broker</span>
    {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-string">"unitTaxSpecification"</span>: [ <span class="hljs-comment">//broker if priceOverride is true, booking system otherwise</span>
        {
          <span class="hljs-string">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
          <span class="hljs-string">"name"</span>: <span class="hljs-string">"VAT at 0% for EU transactions"</span>,
          <span class="hljs-string">"price"</span>: <span class="hljs-number">1.00</span>,
          <span class="hljs-string">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
          <span class="hljs-string">"rate"</span>: <span class="hljs-number">0.2</span>
        }
      ],
      <span class="hljs-string">"acceptedOffer"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"Offer"</span>, <span class="hljs-comment">//expanded by booking system</span>
        <span class="hljs-string">"id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>, <span class="hljs-comment">// broker</span>
        <span class="hljs-string">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-string">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-string">"price"</span>: <span class="hljs-number">10.00</span>,
        <span class="hljs-string">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-string">"isCancellable"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-string">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
        <span class="hljs-string">"cancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
      },
      <span class="hljs-string">"orderedItem"</span>: {
        <span class="hljs-string">"type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-string">"identifier"</span>: <span class="hljs-number">123</span>, <span class="hljs-comment">//expanded by booking system</span>
        <span class="hljs-string">"id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
        <span class="hljs-string">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
        <span class="hljs-string">"maximumAttendeeCapacity"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-string">"remainingAttendeeCapacity"</span>: <span class="hljs-number">20</span>,
        <span class="hljs-string">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
        <span class="hljs-string">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
        <span class="hljs-string">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
        <span class="hljs-string">"superEvent"</span>: {
          <span class="hljs-string">"type"</span>: <span class="hljs-string">"SessionSeries"</span>,
          <span class="hljs-string">"id"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
          <span class="hljs-string">"name"</span>: <span class="hljs-string">"Speedball"</span>,
          <span class="hljs-string">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
          <span class="hljs-string">"organizer"</span>: {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"Organization"</span>,
            <span class="hljs-string">"name"</span>: <span class="hljs-string">"Central Speedball Association"</span>,
            <span class="hljs-string">"url"</span>: <span class="hljs-string">"http://www.speedball-world.com"</span>,
            <span class="hljs-string">"termsOfService"</span>: {
              <span class="hljs-string">"type"</span>: <span class="hljs-string">"TermsOfService"</span>,
              <span class="hljs-string">"url"</span>: <span class="hljs-string">"url"</span>
            }
          },
          <span class="hljs-string">"location"</span>: {}
        }
      }
    }
  ],
  <span class="hljs-string">"orderStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderComplete"</span>, <span class="hljs-comment">//broker</span>
  <span class="hljs-string">"totalPaymentDue"</span>: {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-string">"price"</span>: <span class="hljs-number">5.00</span>,
    <span class="hljs-string">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
    <span class="hljs-string">"valueAddedTaxIncluded"</span>: <span class="hljs-literal">true</span>
  },
  <span class="hljs-string">"totalTaxSpecification"</span>: [
    {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"VAT at 0% for EU transactions"</span>,
      <span class="hljs-string">"price"</span>: <span class="hljs-number">1.00</span>,
      <span class="hljs-string">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
      <span class="hljs-string">"rate"</span>: <span class="hljs-number">0.2</span>
    }
  ],
  <span class="hljs-string">"payment"</span>: { <span class="hljs-comment">// broker (&amp; booking system for amends)</span>
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"Payment"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"AcmeBroker Points"</span>, <span class="hljs-comment">// optional free text description of payment method for booking system, to help the Seller in discussions with the Customer (e.g. "AcmeBroker Points" or "AcmeBroker via Credit Card")</span>
    <span class="hljs-string">"identifier"</span>: <span class="hljs-string">"1234567890npduy2f"</span>
  }
}</pre></section></section></section><section class="normative" id="common-requirements"><!--OddPage--><h2 id="x10-common-requirements"><span class="secno">10. </span>Common Requirements<a class="self-link" aria-label="§" href="#common-requirements"></a></h2><p>This section defines some common functionality that applies to the design of the
whole API.</p><section id="media-types"><h3 id="x10-1-media-types"><span class="secno">10.1 </span>Media types<a class="self-link" aria-label="§" href="#media-types"></a></h3><p>Custom media types are used in this API to allow clients to choose the format
of the data they receive.</p><p><strong>Booking platforms</strong> <em class="rfc2119" title="MAY">MAY</em> choose to support additional media types but <em class="rfc2119" title="MUST">MUST</em> support the
media type(s) defined by this specification.</p><p>Media types will conform to the following pattern:</p><pre aria-busy="false" class="hljs">application/vnd.openactive[.version]+json</pre><p>The current media type is:</p><pre aria-busy="false" class="hljs">application/vnd.openactive.1.0+json</pre><p><strong>Brokers</strong> specifying a media type without a version, such as:</p><pre aria-busy="false" class="hljs">application/vnd.openactive+json</pre><p>will recieve data in in the most current format which is 1.0.</p><p>If you are building an application as a <strong>broker</strong> and care about the stability
of the response, or have a client application which is tied to a specific
version you should always try to use a media type containing the version number.</p><p><strong>Booking systems</strong> are not obliged to support previous versions of the
specification, and so may not support a specific version number. We anticipate
that when the Booking API reaches the stability of a 1.0 version that this
advice may change.</p></section><section id="response-formats"><h3 id="x10-2-response-formats"><span class="secno">10.2 </span>Response formats<a class="self-link" aria-label="§" href="#response-formats"></a></h3><p>Requests and response documents exchanged via this API will all be valid
[<cite><a class="bibref" href="#bib-json-ld">JSON-LD</a></cite>] documents.</p><p>The documents <em class="rfc2119" title="MUST">MUST</em> include a [<cite><a class="bibref" href="#bib-json-ld">JSON-LD</a></cite>] <code>context</code> that refers to the
[<cite><a class="bibref" href="#bib-openactive-vocabulary">OpenActive-Vocabulary</a></cite>] as follows:</p><div class="example" id="example-5-minimal-json-ld-document">
          <div class="marker">
      <a class="self-link" href="#example-5-minimal-json-ld-document">Example 5</a><span class="example-title">: minimal JSON-LD document</span>
    </div>
          <pre class="hljs json" aria-busy="false">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/ns/oa.jsonld"</span>
}</pre>
        </div><p>Unless otherwise specified the request and response documents <em class="rfc2119" title="MUST">MUST</em> conform to
the [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>] data model.</p></section><section id="url-discovery"><h3 id="x10-3-url-discovery"><span class="secno">10.3 </span>URL discovery<a class="self-link" aria-label="§" href="#url-discovery"></a></h3><p>The Booking API has been defined around the concept of URL discovery. This
allows <strong>booking systems</strong> to create resource URLs which match their own
terms for naming specific objects such as <strong>events</strong> and <strong>orders</strong>.</p><p>The URL for a specific action, such as for example providing <strong>payment</strong> details,
may be discovered by parsing the actions defined in the <code>potentialAction</code>
property of an object and constructing the appropriate URL from the
<code>urlTemplate</code> property of the <code>schema:EntryPoint</code> object contained within the <code>target</code>
property of the <code>potentialAction</code> required.</p><p>An example is below:</p><div class="example" id="example-6-example-of-a-potentialaction">
          <div class="marker">
      <a class="self-link" href="#example-6-example-of-a-potentialaction">Example 6</a><span class="example-title">: Example of a potentialAction</span>
    </div>
          <pre class="hljs javascript" aria-busy="false"><span class="hljs-string">"potentialAction"</span>: [
        {
          <span class="hljs-string">"type"</span>: <span class="hljs-string">"PayAction"</span>,
          <span class="hljs-string">"name"</span>: <span class="hljs-string">"Payment"</span>,
          <span class="hljs-string">"target"</span>: {
            <span class="hljs-string">"type"</span>: <span class="hljs-string">"EntryPoint"</span>,
            <span class="hljs-string">"urlTemplate"</span>: <span class="hljs-string">"https://example.com/orders"</span>,
            <span class="hljs-string">"encodingType"</span>: <span class="hljs-string">"application/vnd.openactive.v1.0+json"</span>,
            <span class="hljs-string">"httpMethod"</span>: <span class="hljs-string">"PATCH"</span>
          }
        }
      ]</pre>
        </div><p>Since discovery of URLs is an implicit part of the specification, <strong>brokers</strong>
<em class="rfc2119" title="SHOULD">SHOULD</em> avoid hard-coding URLs for specific actions into their applications and
client libraries. <strong>Brokers</strong>  <em class="rfc2119" title="SHOULD">SHOULD</em> use most applicable URL discovered at the
point in the workflow they are currently in - e.g. not use a cached URL that has
been previously successfully used. They should also not attempt to create URLs
for a specific action based on patterns within previously used URLs.</p><p>It is the responsibility of <strong>booking platforms</strong> to advertise the URL for
further activity in the booking workflow at the point of need. For example they
<em class="rfc2119" title="MUST">MUST</em> advertise the URL for <code>Order</code> creation when a <strong>broker</strong> requests
a specific <strong>opportunity</strong> resource and <em class="rfc2119" title="SHOULD">SHOULD</em> advertise it in their RDPE feeds
since both of these points within the booking workflow are places where a <br><strong>customer</strong> may wish to check availability.</p></section><section id="error-handling"><h3 id="x10-4-error-handling"><span class="secno">10.4 </span>Error handling<a class="self-link" aria-label="§" href="#error-handling"></a></h3><p>Error responses <em class="rfc2119" title="MUST">MUST</em> be served using an appropriate HTTP 4XX status code or HTTP
5XX status code.</p><p>All error responses from this API <em class="rfc2119" title="MUST">MUST</em> be returned in a JSON-LD format using a
content type of <code>application/vnd.openactive.v1.0+json</code> and include at least one
Error object. The error handling has in the Booking API has been modelled
closely on [<cite><a class="bibref" href="#bib-rfc7807">RFC7807</a></cite>].</p><div class="example" id="example-7-error-response-format">
          <div class="marker">
      <a class="self-link" href="#example-7-error-response-format">Example 7</a><span class="example-title">: Error response format</span>
    </div>
          <pre class="hljs json" aria-busy="false">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/ns/oa.jsonld"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Error"</span>,
  <span class="hljs-attr">"errorType"</span>: <span class="hljs-string">"https://openactive.io/errors/incomplete_customer_details"</span>,
  <span class="hljs-attr">"title"</span>: <span class="hljs-string">"Incomplete customer details"</span>,
  <span class="hljs-attr">"details"</span>: <span class="hljs-string">"No customer details supplied"</span>,
  <span class="hljs-attr">"status"</span>: <span class="hljs-number">400</span>,
  <span class="hljs-attr">"instance"</span>: <span class="hljs-string">"/orders"</span>,
  <span class="hljs-attr">"method"</span>: <span class="hljs-string">"POST"</span>
}</pre>
        </div><ul>
<li><code>errorType</code> – a URI reference [<cite><a class="bibref" href="#bib-rfc3986">RFC3986</a></cite>] that identifies the problem type. This
specification encourages that, when dereferenced, it provide human-readable
documentation for the problem type.
When this member is not present, its value is assumed to be "about:blank".</li>
<li><code>title</code> – a short, human-readable summary of the problem type. It
<em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> change from occurrence to occurrence of the problem, except for
purposes of localization.</li>
<li><code>description</code> – a slightly longer, human-readable summary of the problem type.
It largely <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> change from occurrence to occurrence of the problem,
except for purposes of localization or to provide specific information about why
the error occurred in that particular case.</li>
<li><code>status</code>  – the HTTP status code ([<cite><a class="bibref" href="#bib-rfc7231">RFC7231</a></cite>], Section 6) generated by the
origin server for this occurrence of the problem.</li>
<li><code>instance</code>  – a URI reference that identifies the specific occurrence of
the problem. It may or may not yield further information if dereferenced.</li>
<li><code>requestId</code>  – used by technical support for diagnostics purposes.</li>
</ul><section id="order-creation-incomplete-customer-details"><h4 id="x10-4-1-order-creation-incomplete-customer-details"><span class="secno">10.4.1 </span>Order creation : Incomplete customer details<a class="self-link" aria-label="§" href="#order-creation-incomplete-customer-details"></a></h4><p>Use cases:</p><ul>
<li><p>if the <code>email</code> address of the customer is not supplied within a schema:Person
object.</p>
</li>
<li><p>if the <code>customer</code> property supplied is not a valid schema:Person object.</p>
</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/incomplete_customer_details">https://openactive.io/errors/incomplete_customer_details</a></li>
</ul><p>Status code: 400</p></section><section id="order-creation-incomplete-broker-details"><h4 id="x10-4-2-order-creation-incomplete-broker-details"><span class="secno">10.4.2 </span>Order creation : Incomplete broker details<a class="self-link" aria-label="§" href="#order-creation-incomplete-broker-details"></a></h4><p>Use cases:</p><ul>
<li><p>if there is insuffficient detail in the schema:Organisation object describing
the <strong>broker</strong></p>
</li>
<li><p>if the <code>broker</code> property supplied is not a valid schema:Organisation object.</p>
</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/incomplete_broker_details">https://openactive.io/errors/incomplete_broker_details</a></li>
</ul><p>Status code: 400</p></section><section id="order-creation-incomplete-offer-details"><h4 id="x10-4-3-order-creation-incomplete-offer-details"><span class="secno">10.4.3 </span>Order creation : Incomplete offer details<a class="self-link" aria-label="§" href="#order-creation-incomplete-offer-details"></a></h4><p>Use cases:</p><ul>
<li><p>if there is no <code>acceptedOffer</code> property on the schema:OrderItem</p>
</li>
<li><p>if the <code>acceptedOffer</code> is not a URL which corresponds to an <strong>offer</strong> on the</p>
</li>
<li><p><em>booking system*</em></p>
</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/incomplete_offer_details">https://openactive.io/errors/incomplete_offer_details</a></li>
</ul><p>Status code: 400</p></section><section id="order-creation-incomplete-opportunity-details"><h4 id="x10-4-4-order-creation-incomplete-opportunity-details"><span class="secno">10.4.4 </span>Order creation : Incomplete opportunity details<a class="self-link" aria-label="§" href="#order-creation-incomplete-opportunity-details"></a></h4><p>Use cases:</p><ul>
<li><p>if there is no <code>orderedItem</code> property on the schema:OrderItem</p>
</li>
<li><p>if the <code>orderedItem</code> is not a URL which corresponds to an <strong>opportunity</strong> on
the <strong>booking system</strong></p>
</li>
</ul><p>errorType URIs:</p><ul>
<li><a href="https://openactive.io/errors/incomplete_event_details">https://openactive.io/errors/incomplete_event_details</a></li>
<li><a href="https://openactive.io/errors/incomplete_facilityuse_details">https://openactive.io/errors/incomplete_facilityuse_details</a></li>
<li><a href="https://openactive.io/errors/incomplete_slot_details">https://openactive.io/errors/incomplete_slot_details</a></li>
<li><a href="https://openactive.io/errors/incomplete_opportunity_details">https://openactive.io/errors/incomplete_opportunity_details</a></li>
</ul><p>Status code: 400</p></section><section id="order-creation-unavailable-offer"><h4 id="x10-4-5-order-creation-unavailable-offer"><span class="secno">10.4.5 </span>Order creation : Unavailable offer<a class="self-link" aria-label="§" href="#order-creation-unavailable-offer"></a></h4><p>Use cases:</p><ul>
<li>if the <strong>offer</strong> contained in the <code>acceptedOffer</code> property is not bookable</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/unavailable_offer">https://openactive.io/errors/unavailable_offer</a></li>
</ul><p>Status code: 400</p></section><section id="order-creation-unavailable-opportunity"><h4 id="x10-4-6-order-creation-unavailable-opportunity"><span class="secno">10.4.6 </span>Order creation : Unavailable opportunity<a class="self-link" aria-label="§" href="#order-creation-unavailable-opportunity"></a></h4><p>Use cases:</p><ul>
<li>if the <strong>opportunity</strong> contained in the <code>orderedItem</code> property is not bookable</li>
</ul><p>errorType URIs:</p><ul>
<li><a href="https://openactive.io/errors/unavailable_event">https://openactive.io/errors/unavailable_event</a></li>
<li><a href="https://openactive.io/errors/unavailable_facilityuse">https://openactive.io/errors/unavailable_facilityuse</a></li>
<li><a href="https://openactive.io/errors/unavailable_slot">https://openactive.io/errors/unavailable_slot</a></li>
<li><a href="https://openactive.io/errors/unavailable_opportunity">https://openactive.io/errors/unavailable_opportunity</a></li>
</ul><p>Status code: 400</p></section><section id="order-creation-opportunity-full"><h4 id="x10-4-7-order-creation-opportunity-full"><span class="secno">10.4.7 </span>Order creation : Opportunity full<a class="self-link" aria-label="§" href="#order-creation-opportunity-full"></a></h4><p>Use cases:</p><ul>
<li>if there are no available spaces for the <strong>opportunity</strong> contained in the
<code>orderedItem</code> property</li>
</ul><p>errorType URIs:</p><ul>
<li><a href="https://openactive.io/errors/event_is_full">https://openactive.io/errors/event_is_full</a></li>
<li><a href="https://openactive.io/errors/slot_is_full">https://openactive.io/errors/slot_is_full</a></li>
<li><a href="https://openactive.io/errors/opportunity_is_full">https://openactive.io/errors/opportunity_is_full</a></li>
</ul><p>Status code: 400</p></section><section id="order-completion-incomplete-payment-details"><h4 id="x10-4-8-order-completion-incomplete-payment-details"><span class="secno">10.4.8 </span>Order completion : Incomplete payment details<a class="self-link" aria-label="§" href="#order-completion-incomplete-payment-details"></a></h4><p>Use cases:</p><ul>
<li>if the <code>paymentMethod</code> or <code>paymentMethodId</code> properties are missing or
incorrect</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/incomplete_payment_details">https://openactive.io/errors/incomplete_payment_details</a></li>
</ul><p>Status code: 400</p></section><section id="order-completion-anonymous-lease-expired"><h4 id="x10-4-9-order-completion-anonymous-lease-expired"><span class="secno">10.4.9 </span>Order completion : Anonymous lease expired<a class="self-link" aria-label="§" href="#order-completion-anonymous-lease-expired"></a></h4><p>Use cases:</p><ul>
<li>if <strong>broker</strong> did not supply <strong>payment</strong> details between the creation of the
<code>Order</code> and the expiration of the lease.</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/anonymous_lease_expired">https://openactive.io/errors/anonymous_lease_expired</a></li>
</ul><p>Status code: 410</p></section><section id="api-authentication-unauthenticated"><h4 id="x10-4-10-api-authentication-unauthenticated"><span class="secno">10.4.10 </span>API authentication : Unauthenticated<a class="self-link" aria-label="§" href="#api-authentication-unauthenticated"></a></h4><p>Use cases:</p><ul>
<li>if <strong>broker</strong> did not supply any form of authentication</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/unauthenticated">https://openactive.io/errors/unauthenticated</a></li>
</ul><p>Status code: 403</p></section><section id="api-authentication-no-api-token-provided"><h4 id="x10-4-11-api-authentication-no-api-token-provided"><span class="secno">10.4.11 </span>API authentication : No API token provided<a class="self-link" aria-label="§" href="#api-authentication-no-api-token-provided"></a></h4><p>Use cases:</p><ul>
<li>if <strong>broker</strong> did not supply an API key</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/no_api_token_provided">https://openactive.io/errors/no_api_token_provided</a></li>
</ul><p>Status code: 403</p></section><section id="api-authentication-invalid-api-token-provided"><h4 id="x10-4-12-api-authentication-invalid-api-token-provided"><span class="secno">10.4.12 </span>API authentication : Invalid API token provided<a class="self-link" aria-label="§" href="#api-authentication-invalid-api-token-provided"></a></h4><p>Use cases:</p><ul>
<li>if <strong>broker</strong> supplied an invalid API key, either malformed or expired</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/invalid_api_token_provided">https://openactive.io/errors/invalid_api_token_provided</a></li>
</ul><p>Status code: 401</p></section><section id="api-authentication-invalid-authorization-details-provided"><h4 id="x10-4-13-api-authentication-invalid-authorization-details-provided"><span class="secno">10.4.13 </span>API authentication : Invalid authorization details provided<a class="self-link" aria-label="§" href="#api-authentication-invalid-authorization-details-provided"></a></h4><p>Use cases:</p><ul>
<li>if <strong>broker</strong> supplied an invalid set of authorization details, either
malformed or expired</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/invalid_authorization_details">https://openactive.io/errors/invalid_authorization_details</a></li>
</ul><p>Status code: 401</p></section><section id="technical-errors-temporarily-unable-to-create-order"><h4 id="x10-4-14-technical-errors-temporarily-unable-to-create-order"><span class="secno">10.4.14 </span>Technical errors : Temporarily unable to create order<a class="self-link" aria-label="§" href="#technical-errors-temporarily-unable-to-create-order"></a></h4><p>Use cases:</p><ul>
<li>if <strong>booking platform</strong> is unable for technical reasons to create an <code>Order</code>
where the data provided to it is sufficient to allow it to do so</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/temporarily_unable_to_create_order">https://openactive.io/errors/temporarily_unable_to_create_order</a></li>
</ul><p>Status code: 500</p></section><section id="technical-errors-temporarily-unable-to-create-order-0"><h4 id="x10-4-15-technical-errors-temporarily-unable-to-create-order"><span class="secno">10.4.15 </span>Technical errors : Temporarily unable to create order<a class="self-link" aria-label="§" href="#technical-errors-temporarily-unable-to-create-order-0"></a></h4><p>Use cases:</p><ul>
<li>if <strong>booking platform</strong> is unable for technical reasons to update an <code>Order</code>
where the data provided to it is sufficient to allow it to do so</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/temporarily_unable_to_update_order">https://openactive.io/errors/temporarily_unable_to_update_order</a></li>
</ul><p>Status code: 500</p></section><section id="technical-errors-temporarily-unable-to-delete-order"><h4 id="x10-4-16-technical-errors-temporarily-unable-to-delete-order"><span class="secno">10.4.16 </span>Technical errors : Temporarily unable to delete order<a class="self-link" aria-label="§" href="#technical-errors-temporarily-unable-to-delete-order"></a></h4><p>Use cases:</p><ul>
<li>if <strong>booking platform</strong> is unable for technical reasons to delete an <code>Order</code>
where the data provided to it is sufficient to allow it to do so</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/temporarily_unable_to_delete_order">https://openactive.io/errors/temporarily_unable_to_delete_order</a></li>
</ul><p>Status code: 500</p></section><section id="generic-errors-unknown-or-incorrect-offer"><h4 id="x10-4-17-generic-errors-unknown-or-incorrect-offer"><span class="secno">10.4.17 </span>Generic errors : Unknown or incorrect offer<a class="self-link" aria-label="§" href="#generic-errors-unknown-or-incorrect-offer"></a></h4><p>Use cases:</p><ul>
<li>where a <strong>booking platform</strong> has no <strong>offer</strong> matching the one requested</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/unknown_or_incorrect_offer">https://openactive.io/errors/unknown_or_incorrect_offer</a></li>
</ul><p>Status code: 404</p></section><section id="generic-errors-unknown-or-incorrect-opportunity"><h4 id="x10-4-18-generic-errors-unknown-or-incorrect-opportunity"><span class="secno">10.4.18 </span>Generic errors : Unknown or incorrect opportunity<a class="self-link" aria-label="§" href="#generic-errors-unknown-or-incorrect-opportunity"></a></h4><p>Use cases:</p><ul>
<li>where a <strong>booking platform</strong> has no <strong>opportunity</strong> matching the one requested</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/unknown_or_incorrect_opportunity">https://openactive.io/errors/unknown_or_incorrect_opportunity</a></li>
<li><a href="https://openactive.io/errors/unknown_or_incorrect_event">https://openactive.io/errors/unknown_or_incorrect_event</a></li>
<li><a href="https://openactive.io/errors/unknown_or_incorrect_facilityuse">https://openactive.io/errors/unknown_or_incorrect_facilityuse</a></li>
<li><a href="https://openactive.io/errors/unknown_or_incorrect_slot">https://openactive.io/errors/unknown_or_incorrect_slot</a></li>
</ul><p>Status code: 404</p></section><section id="generic-errors-unknown-or-incorrect-order"><h4 id="x10-4-19-generic-errors-unknown-or-incorrect-order"><span class="secno">10.4.19 </span>Generic errors : Unknown or incorrect order<a class="self-link" aria-label="§" href="#generic-errors-unknown-or-incorrect-order"></a></h4><p>Use cases:</p><ul>
<li>where a <strong>booking platform</strong> has no <code>Order</code> matching the one requested</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/unknown_or_incorrect_order">https://openactive.io/errors/unknown_or_incorrect_order</a></li>
</ul><p>Status code: 404</p></section><section id="generic-errors-unknown-or-incorrect-endpoint"><h4 id="x10-4-20-generic-errors-unknown-or-incorrect-endpoint"><span class="secno">10.4.20 </span>Generic errors : Unknown or incorrect endpoint<a class="self-link" aria-label="§" href="#generic-errors-unknown-or-incorrect-endpoint"></a></h4><p>Use cases:</p><ul>
<li>where a <strong>booking platform</strong> has no endpoint matching the one requested</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/unknown_or_incorrect_endpoint">https://openactive.io/errors/unknown_or_incorrect_endpoint</a></li>
</ul><p>Status code: 404</p></section><section id="generic-errors-not-found"><h4 id="x10-4-21-generic-errors-not-found"><span class="secno">10.4.21 </span>Generic errors : Not found<a class="self-link" aria-label="§" href="#generic-errors-not-found"></a></h4><p>Use cases:</p><ul>
<li>where a <strong>booking platform</strong> does not have the generic resource specified</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/not_found">https://openactive.io/errors/not_found</a></li>
</ul><p>Status code: 404</p></section><section id="generic-errors-method-not-allowed"><h4 id="x10-4-22-generic-errors-method-not-allowed"><span class="secno">10.4.22 </span>Generic errors : Method not allowed<a class="self-link" aria-label="§" href="#generic-errors-method-not-allowed"></a></h4><p>Use cases:</p><ul>
<li>where a <strong>booking platform</strong> does not a speficic HTTP method for the endpoint
requested with that specific HTTP verb</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/method_not_allowed">https://openactive.io/errors/method_not_allowed</a></li>
</ul><p>Status code: 405</p></section><section id="generic-errors-gone"><h4 id="x10-4-23-generic-errors-gone"><span class="secno">10.4.23 </span>Generic errors : Gone<a class="self-link" aria-label="§" href="#generic-errors-gone"></a></h4><p>Use cases:</p><ul>
<li>where an <code>Order</code> has been cancelled and the underlying resources are marked
for deletion</li>
</ul><p>errorType URI:</p><ul>
<li><a href="https://openactive.io/errors/gone">https://openactive.io/errors/gone</a></li>
</ul><p>Status code: 410</p></section></section><section id="security"><h3 id="x10-5-security"><span class="secno">10.5 </span>Security<a class="self-link" aria-label="§" href="#security"></a></h3><p>All HTTP requests and responses <em class="rfc2119" title="SHOULD">SHOULD</em> be secured using SSL.</p></section><section id="authentication"><h3 id="x10-6-authentication"><span class="secno">10.6 </span>Authentication<a class="self-link" aria-label="§" href="#authentication"></a></h3><section id="api-level-authentication"><h4 id="x10-6-1-api-level-authentication"><span class="secno">10.6.1 </span>API level authentication<a class="self-link" aria-label="§" href="#api-level-authentication"></a></h4><p>All of the API transactions described in this document <em class="rfc2119" title="SHOULD">SHOULD</em> require
authentication.</p><p>This standard does not mandate a particular authentication method, but
recommendation is that implementers <em class="rfc2119" title="SHOULD">SHOULD</em> consider using [<cite><a class="bibref" href="#bib-oauth2">OAuth2</a></cite>] as it is
well-defined, widely supported and can be used in a variety of different
application flows (e.g. via a Javascript web application or between servers).</p><p>Other server to server authentication mechanisms such as basic authentication,
API key or bearer tokern based mechanisms are also appropriate.</p><p>One principle relating to authentication and the Booking API is that <strong>orders</strong>
created by a specific <strong>broker</strong> <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> be able to be changed by any other
<strong>broker</strong>. It is the responsibility of the <strong>booking system</strong> to ensure that
subsequent requests to an <code>Order</code> should only be initiated by the <strong>broker</strong>
which created the <code>Order</code>.</p></section><section id="customer-level-authentication"><h4 id="x10-6-2-customer-level-authentication"><span class="secno">10.6.2 </span>Customer level authentication<a class="self-link" aria-label="§" href="#customer-level-authentication"></a></h4><p>Where necessary, OpenID Connect ([<cite><a class="bibref" href="#bib-openidconnect">OpenIdConnect</a></cite>]) provides a standard
way of verifying the identity of customer. It is a thin layer that sits
atop OAuth2.</p><p>One principle relating to authentication and the Booking API is that <strong>orders</strong>
created by a specific <strong>customer</strong> <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> be able to be changed by any other
<strong>customer</strong>. It is the responsibility of the <strong>booking system</strong> to ensure that
subsequent requests to an <code>Order</code> should only be initiated by the <strong>customer</strong>
which created the <code>Order</code>.</p></section></section><section id="delivery-of-terms-and-conditions-and-privacy-policy"><h3 id="x10-7-delivery-of-terms-and-conditions-and-privacy-policy"><span class="secno">10.7 </span>Delivery of Terms and Conditions and Privacy Policy<a class="self-link" aria-label="§" href="#delivery-of-terms-and-conditions-and-privacy-policy"></a></h3><p>The <strong>broker</strong> should make the <strong>customer</strong> aware of and assent to any specific
Terms and Conditions and Privacy Policy for using their service at the point of
a <strong>customer</strong> signing up to the service and/or providing their contact details.</p><p>Since, during <strong>booking</strong>, the details of the <strong>customer</strong> are provided to the
<strong>booking system</strong> and the <strong>seller</strong>, the <strong>broker</strong> should inform the
<strong>customer</strong> of this any implications with resepct to GDPR and any other
data protection legislation.</p><p>Specific Terms and Conditions/Privacy Policy for the <strong>booking service</strong>/<strong>seller</strong>
and/or the <strong>opportynity</strong>/<strong>offer</strong> being taken <em class="rfc2119" title="MUST">MUST</em> be made available using the
<code>privacyPolicy</code> and <code>termsAndConditions</code> properties described in the example at
the most appropriate level. If the properties are present at the <strong>opportunity</strong>
level, they apply to all included <strong>opportunities</strong> and <strong>offers</strong> unless the
properties are present at a lower level.</p><div class="example" id="example-8-properties-for-terms-and-conditions-and-privacy-policy">
          <div class="marker">
      <a class="self-link" href="#example-8-properties-for-terms-and-conditions-and-privacy-policy">Example 8</a><span class="example-title">: Properties for Terms and Conditions and Privacy Policy</span>
    </div>
          <pre class="hljs javascript" aria-busy="false"> <span class="hljs-string">"privacyPolicy"</span>: {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"Terms"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>
},
<span class="hljs-string">"termsAndConditions"</span>: {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"Terms"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>
}</pre>
        </div><p>The URLs in the example are only illustrative.</p></section></section><section class="normative" id="operations"><!--OddPage--><h2 id="x11-operations"><span class="secno">11. </span>Operations<a class="self-link" aria-label="§" href="#operations"></a></h2><section id="checking-availability-and-offers"><h3 id="x11-1-checking-availability-and-offers"><span class="secno">11.1 </span>Checking availability and offers<a class="self-link" aria-label="§" href="#checking-availability-and-offers"></a></h3><p>This specification assumes that a <em>broker</em> has already obtained opportunity
data from a <em>booking system</em> that includes descriptions of <strong>events</strong>,
<strong>facilities</strong>, <strong>slots</strong> etc. For example by harvesting data via an [<cite><a class="bibref" href="#bib-rpde">RPDE</a></cite>]
feed.</p><p>The availability of an <strong>event</strong>, or <code>subEvent</code>, or <strong>facility</strong> (either as a
<code>FacilityUse</code> or <code>Slot</code>) may change at any time.</p><p>The <strong>offers</strong> available to a customer might also change over time and the data
should be refreshed so that the most up-to-date representation of the live data
is presented to the <strong>purchaser</strong> before booking.</p><p>A <strong>booking system</strong>  <em class="rfc2119" title="MUST">MUST</em> allow a <strong>broker</strong> to check the current state of
<strong>events</strong> and/or <strong>facilities</strong> depending on what decide they expose from their
platform.</p><section id="definition-of-a-bookable-event"><h4 id="x11-1-1-definition-of-a-bookable-event"><span class="secno">11.1.1 </span>Definition of a 'bookable' Event<a class="self-link" aria-label="§" href="#definition-of-a-bookable-event"></a></h4><p>An <strong>event</strong> is deemed to be 'bookable' if:</p><ul>
<li><p>The <strong>event</strong> has not already occurred, i.e. the <code>startDate</code> (when expressed
as a timedatestamp) and the <code>endDate</code> of the <strong>event</strong> has not been exceeded</p>
</li>
<li><p>The <code>eventStatus</code> of the <strong>event</strong> does not indicate that it has been
cancelled or postponed</p>
</li>
<li><p>The <code>remainingAttendeeCapacity</code> of the <strong>event</strong> is greater than the number
of places required</p>
</li>
<li><p>The <code>potentialAction</code> of the <strong>event</strong> contains one or more appropriate
ReserveAction objects</p>
</li>
<li><p>There are one or more valid bookable <strong>offers</strong> for the <strong>event</strong></p>
</li>
<li><p>The temporary lease on the space in the <strong>event</strong> (defined in
<code>orderLeaseDuration</code>) has not expired before the <strong>payment</strong> is taken
by the <strong>broker</strong> and the <strong>seller</strong> is notified by the <strong>broker</strong> that payment
has taken place.</p>
</li>
</ul><p>The <strong>customer</strong> may be ineligible to attend a 'bookable' <strong>event</strong>, but may
book a space for someone else (e.g. a child) if:</p><ul>
<li><p>The gender of the <strong>customer</strong> taking up the opportunity is incompatible with
the <code>genderRestriction</code> of the <strong>event</strong> but the attendee is compatible</p>
</li>
<li><p>The age of the <strong>customer</strong> taking up the opportunity is incompatible with the
<code>ageRange</code> of the <strong>event</strong> but the attendee is compatible</p>
</li>
</ul><p>The <strong>event</strong> may also be deemed to be bookable if the <strong>event</strong> contains a deep
link to a URL where the user can book the <strong>event</strong> independently, however
this is out of scope for this API</p><p>The above set of restrictions are at the level of the <strong>event</strong> and the data
contained within the content of the API returns.</p><p>On a <strong>booking system</strong> level, an <strong>event</strong> is 'bookable', mediated by a
specific <strong>broker</strong>, if that <strong>broker</strong> has machine readable permission to
access the relevant instance of the Booking API provided by the <strong>booking</strong>
system via an API key or similar token.</p><p>For the purposes of this specification, the <strong>event</strong> is only bookable if the
data describing the the <strong>event</strong> is published via a <strong>booking system</strong> which
is compliant with and supports the Open Active Booking API.</p></section><section id="definition-of-a-bookable-slot-facility-use"><h4 id="x11-1-2-definition-of-a-bookable-slot-facility-use"><span class="secno">11.1.2 </span>Definition of a 'bookable' slot/facility use<a class="self-link" aria-label="§" href="#definition-of-a-bookable-slot-facility-use"></a></h4><p>A slot is essentially an event, and many of the above conditions apply, however
some of the properties for a slot are different and as a consequence there are
different criteria for it being bookable.</p><p>A <strong>slot</strong> is deemed to be 'bookable' if:</p><ul>
<li><p>The <strong>slot</strong> has not already occurred, i.e. the <code>startDate</code> (when expressed
as a timedatestamp) and <code>endDate</code> of the <strong>slot</strong> has not been exceeded</p>
</li>
<li><p>The <code>remainingUses</code> of the <strong>slot</strong> is greater than or equal to the number
of slots required. For example if an independently organised badminton league
requires four courts, the number of <code>remainingUses</code> should be 4 or higher.</p>
</li>
<li><p>There are one or more valid <strong>offers</strong> for the slot</p>
</li>
<li><p>The <code>potentialAction</code> of the <strong>slot</strong> contains one or more appropriate
ReserveAction objects</p>
</li>
</ul><p>There may be more restrictions placed by a <strong>seller</strong> on the booking of a
<strong>slot</strong> for use of a <strong>facility</strong>. For example, it may be that one of the party
must be over a certain age as a supervising adult if some of the party are
minors. It is the responsibility of the <strong>booking platform</strong> to make the terms
and conditions of <strong>booking</strong> available to the <strong>broker</strong> and it is the
responsibility of the <strong>broker</strong> to ensure that the <strong>customer</strong> is aware of
these conditions before entering the <code>Order</code> workflow.</p></section><section id="checking-availability-and-offers-for-an-event-or-facility-use-slot"><h4 id="x11-1-3-checking-availability-and-offers-for-an-event-or-facility-use-slot"><span class="secno">11.1.3 </span>Checking availability and offers for an event or facility use slot<a class="self-link" aria-label="§" href="#checking-availability-and-offers-for-an-event-or-facility-use-slot"></a></h4><p>To check the availability of an opportunity a <strong>broker</strong> will issue a GET
request to the URI specified in the <code>id</code> of the opportunity, having
discovered it from the RDPE feed.</p><p>It is the responsibility of <strong>brokers</strong> to ensure that spaces within the
opportunity are still available before proceeding with booking.</p><div class="example" id="example-9-viewing-event-availability">
          <div class="marker">
      <a class="self-link" href="#example-9-viewing-event-availability">Example 9</a><span class="example-title">: Viewing event availability</span>
    </div>
          <pre class="hljs http" aria-busy="false"><span class="hljs-keyword">GET</span> <span class="hljs-string">/events/452</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:50:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive.v1.0+json</pre>
        </div><div class="example" id="example-10-event-response">
          <div class="marker">
      <a class="self-link" href="#example-10-event-response">Example 10</a><span class="example-title">: Event response</span>
    </div>
          <pre class="hljs http" aria-busy="false">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:50:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive.v1.0+json
<span class="hljs-attribute">Content-Length</span>: ...

<span class="json">
{
    <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/ns/oa.jsonld"</span>,
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Event"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">452</span>,
    <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball"</span>,
    <span class="hljs-attr">"offers"</span>: [{
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"validThrough"</span>: <span class="hljs-string">"2018-10-29T11:00:00Z"</span>,
        <span class="hljs-attr">"validFrom"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/offers/1234"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10.00</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"isCancellable"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"cancellationValidUntil"</span>: <span class="hljs-string">"2018-10-28T11:00:00Z"</span>
    }],
    <span class="hljs-attr">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
    <span class="hljs-attr">"maximumAttendeeCapacity"</span>: <span class="hljs-number">30</span>,
    <span class="hljs-attr">"remainingAttendeeCapacity"</span>: <span class="hljs-number">20</span>,
    <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
    <span class="hljs-attr">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
    <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
    <span class="hljs-attr">"location"</span>: {},
    <span class="hljs-attr">"potentialAction"</span>: [{
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ReserveAction"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Book"</span>,
        <span class="hljs-attr">"target"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"EntryPoint"</span>,
            <span class="hljs-attr">"urlTemplate"</span>: <span class="hljs-string">"https://example.com/orders"</span>,
            <span class="hljs-attr">"encodingType"</span>: <span class="hljs-string">"application/vnd.openactive.v1.0+json"</span>,
            <span class="hljs-attr">"httpMethod"</span>: <span class="hljs-string">"POST"</span>
        }
    }],
    <span class="hljs-attr">"privacyPolicy"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>
    },
    <span class="hljs-attr">"termsAndConditions"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>
    }
}</span></pre>
        </div><p>The <strong>booking system</strong> <em class="rfc2119" title="MUST">MUST</em> ensure that the data presented to the <strong>broker</strong> in
the <code>remainingAttendeeCapacity</code> property of the <strong>event</strong> is up to date and includes a
combination of places already booked and places currently reserved by leases
from in-progress <strong>orders</strong>.</p><div class="example" id="example-11-viewing-slot-availability">
          <div class="marker">
      <a class="self-link" href="#example-11-viewing-slot-availability">Example 11</a><span class="example-title">: Viewing slot availability</span>
    </div>
          <pre class="hljs http" aria-busy="false"><span class="hljs-keyword">GET</span> <span class="hljs-string">/slots/324</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:51:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive.v1.0+json</pre>
        </div><div class="example" id="example-12-slot-response">
          <div class="marker">
      <a class="self-link" href="#example-12-slot-response">Example 12</a><span class="example-title">: Slot response</span>
    </div>
          <pre class="hljs http" aria-busy="false">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:51:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive.v1.0+json
<span class="hljs-attribute">Content-Length</span>: ...

<span class="json">
{
    <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/ns/oa.jsonld"</span>,
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Slot"</span>,
    <span class="hljs-attr">"id"</span>: <span class="hljs-string">"http://www.example.org/slots/324"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">324</span>,
    <span class="hljs-attr">"facilityUse"</span>: <span class="hljs-string">"http://www.example.org/facility-use/1"</span>,
    <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>,
    <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT30M"</span>,
    <span class="hljs-attr">"remainingUses"</span>: <span class="hljs-number">3</span>,
    <span class="hljs-attr">"maximumUses"</span>: <span class="hljs-number">4</span>,
    <span class="hljs-attr">"offers"</span>: [{
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"30 minute hire"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">15.00</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
    }],
  <span class="hljs-attr">"potentialAction"</span>: [{
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ReserveAction"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Book"</span>,
    <span class="hljs-attr">"target"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"EntryPoint"</span>,
      <span class="hljs-attr">"urlTemplate"</span>: <span class="hljs-string">"https://example.com/orders"</span>,
      <span class="hljs-attr">"encodingType"</span>: <span class="hljs-string">"application/vnd.openactive.v1.0+json"</span>,
      <span class="hljs-attr">"httpMethod"</span>: <span class="hljs-string">"POST"</span>
    }
  }]
}</span></pre>
        </div><p>The <strong>booking system</strong> <em class="rfc2119" title="MUST">MUST</em> ensure that the data presented to the <strong>broker</strong> in
the <code>remainingUses</code> property of the <strong>slot</strong> is up to date and includes a
combination of places already booked and places currently reserved by leases
from in-progress <strong>orders</strong>.</p><div class="example" id="example-13-viewing-slot-availability-via-a-facility-use">
          <div class="marker">
      <a class="self-link" href="#example-13-viewing-slot-availability-via-a-facility-use">Example 13</a><span class="example-title">: Viewing slot availability via a facility use</span>
    </div>
          <pre class="hljs http" aria-busy="false"><span class="hljs-keyword">GET</span> <span class="hljs-string">/facility-use/1</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:51:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive.v1.0+json</pre>
        </div><div class="example" id="example-14-facility-use-response">
          <div class="marker">
      <a class="self-link" href="#example-14-facility-use-response">Example 14</a><span class="example-title">: Facility use response</span>
    </div>
          <pre class="hljs http" aria-busy="false">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:51:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive.v1.0+json
<span class="hljs-attribute">Content-Length</span>: ...

<span class="json">{
    <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://www.openactive.io/ns/oa.jsonld"</span>,
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"FacilityUse"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.example.org/facility-use/1"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Example Leisure Centre Table Tennis"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Table tennis tables are available to hire for thirty minute slots"</span>,
    <span class="hljs-attr">"activity"</span>: <span class="hljs-string">"Table Tennis"</span>,
    <span class="hljs-attr">"location"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Place"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Example Leisure Centre"</span>,
        <span class="hljs-attr">"address"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
            <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"1 High Street"</span>,
            <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Bristol"</span>,
            <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"BS1 4SD"</span>
        }
    },
    <span class="hljs-attr">"offers"</span>: [{
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"30 minute hire"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10.00</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
    }],
  <span class="hljs-attr">"potentialAction"</span>: [{
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ReserveAction"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Book"</span>,
    <span class="hljs-attr">"target"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"EntryPoint"</span>,
      <span class="hljs-attr">"urlTemplate"</span>: <span class="hljs-string">"https://example.com/orders"</span>,
      <span class="hljs-attr">"encodingType"</span>: <span class="hljs-string">"application/vnd.openactive.v1.0+json"</span>,
      <span class="hljs-attr">"httpMethod"</span>: <span class="hljs-string">"POST"</span>
    }
  }],
    <span class="hljs-attr">"event"</span>: [{
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Slot"</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"http://www.example.org/slots/123"</span>,
            <span class="hljs-attr">"facilityUse"</span>: <span class="hljs-string">"http://www.example.org/facility-use/1"</span>,
            <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-03-01T10:00:00Z"</span>,
            <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT30M"</span>,
            <span class="hljs-attr">"remainingUses"</span>: <span class="hljs-number">0</span>,
            <span class="hljs-attr">"maximumUses"</span>: <span class="hljs-number">4</span>
        },
        {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Slot"</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"http://www.example.org/slots/234"</span>,
            <span class="hljs-attr">"facilityUse"</span>: <span class="hljs-string">"http://www.example.org/facility-use/1"</span>,
            <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-03-01T11:00:00Z"</span>,
            <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT30M"</span>,
            <span class="hljs-attr">"remainingUses"</span>: <span class="hljs-number">3</span>,
            <span class="hljs-attr">"maximumUses"</span>: <span class="hljs-number">4</span>,
            <span class="hljs-attr">"offers"</span>: [{
                <span class="hljs-attr">"name"</span>: <span class="hljs-string">"30 minute hire"</span>,
                <span class="hljs-attr">"price"</span>: <span class="hljs-number">15.00</span>,
                <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
            }]
        }
    ]
}</span></pre>
        </div></section><section id="assembling-a-set-of-offers-and-presenting-them-to-a-customer"><h4 id="x11-1-4-assembling-a-set-of-offers-and-presenting-them-to-a-customer"><span class="secno">11.1.4 </span>Assembling a set of offers and presenting them to a customer<a class="self-link" aria-label="§" href="#assembling-a-set-of-offers-and-presenting-them-to-a-customer"></a></h4><p>The <strong>broker</strong> <em class="rfc2119" title="MUST">MUST</em> assemble a set of all applicable <strong>offers</strong> for an
<strong>opportunity</strong> from the information supplied by the <strong>booking system</strong>.
An applicable <strong>offer</strong> is an <strong>offer</strong> which is available for an
<strong>opportunity</strong> which is bookable and for which the <strong>customer</strong> is eligible.</p><section id="collating-offers-for-an-event"><h5 id="x11-1-4-1-collating-offers-for-an-event"><span class="secno">11.1.4.1 </span>Collating offers for an event<a class="self-link" aria-label="§" href="#collating-offers-for-an-event"></a></h5><p>In the case of the <strong>event</strong> having no <code>subEvent</code> the set of all applicable
<strong>offers</strong> is simply the array of <strong>offers</strong> contained within the <code>offers</code>
property.</p><p>In the case of an <strong>event</strong> containing sub-events within the <code>subEvent</code> property
the set of all applicable offers should be compiled from the <strong>offers</strong> from the
sub-event selected by the customer, augmented with any additional different
offers contained in the parent super-event.</p><p>If the sub-event selected by the <strong>customer</strong> has no <strong>offers</strong> the set of all
applicable offers will be compiled from the <strong>offers</strong> contained withinin the
super-event.</p><p>The <strong>broker</strong> should then filter this set to provide a set of current <strong>offers</strong>
which apply to the <strong>customer</strong>. This specification provides no guidance as to
how the filtering should be performed.</p><p>The <strong>broker</strong> <em class="rfc2119" title="SHOULD">SHOULD</em> however show all applicable <strong>offers</strong> to a customer,
including information on pricing restrictions, unless the <strong>customer</strong> has only
requested a subset in some form of preferences (e.g. only show adult classes
and offers).</p><p>The <strong>customer</strong> selects one of these <strong>offers</strong> and when all pre-conditions
have been met, the <strong>broker</strong> enters the <code>Order</code> creation workflow on behalf
of the customer.</p></section><section id="collating-offers-for-the-use-of-a-facility"><h5 id="x11-1-4-2-collating-offers-for-the-use-of-a-facility"><span class="secno">11.1.4.2 </span>Collating offers for the use of a facility<a class="self-link" aria-label="§" href="#collating-offers-for-the-use-of-a-facility"></a></h5><p>The process for building a set of all applicable offers is similar for
<strong>facilities</strong> with the <strong>offers</strong> which are part of a specific <strong>slot</strong> having
primacy over the more generic <strong>offers</strong> contained within a<code>FacilityUse</code>.</p><p>The <strong>booking system</strong> <em class="rfc2119" title="MUST">MUST</em> ensure that the data presented to the <strong>broker</strong> in
the <code>remainingUses</code> property  in the <strong>slot</strong> is up to date and includes a
combination of places already booked and places currently reserved by leases
from in-progress <strong>orders</strong>. The <strong>booking system</strong> <em class="rfc2119" title="MUST">MUST</em> also ensure that
the <code>hoursAvailable</code> property on the <code>FacilityUse</code> is kept updated.</p></section></section><section id="obtaining-a-lease-on-a-space-within-an-opportunity"><h4 id="x11-1-5-obtaining-a-lease-on-a-space-within-an-opportunity"><span class="secno">11.1.5 </span>Obtaining a lease on a space within an opportunity<a class="self-link" aria-label="§" href="#obtaining-a-lease-on-a-space-within-an-opportunity"></a></h4><p><strong>Orders</strong> <em class="rfc2119" title="SHOULD">SHOULD</em> contain a <code>orderLeaseDuration</code> property. This
property <em class="rfc2119" title="MUST">MUST</em> contain an ISO 8601 formatted duration for the lease. The lease
duration may also be advertised somewhere else to make it clear in advance,
e.g. in docs/setup config, or as part of a <code>potentialAction</code> property.</p><p>(Note: In previous iterations of the Booking API specification, the lease was
a property of an event. This has now been deprecated.)</p><p>The <code>orderLeaseDuration</code> property notifies the <strong>broker</strong> about the
length of time for which a space will be reserved by the <strong>booking system</strong>
whilst payment for the <strong>event</strong> is taken by the third-party payment system.</p><p>The default suggested lease duration is 15 minutes, but it is up to each
<strong>booking plaftorm</strong> to define and advertise their own lease duration.</p><p>This lease is NOT designed as a pause for a shopping cart system (in addition
shopping cart functionality is out of scope for v1.0 of this specification).</p><p>The <strong>broker</strong> <em class="rfc2119" title="MUST">MUST</em> ensure that it has obtained all of the relevant details
about a <strong>customer</strong> before getting to the point where it attempts to place an
<code>Order</code>. The lease is not designed as a pause in the process whilst a
<strong>customer</strong> is registered by a <strong>broker</strong>.</p><p>The client may then present the updated availability and suitable <strong>offers</strong> to
the customer.</p></section></section><section id="creating-and-updating-orders"><h3 id="x11-2-creating-and-updating-orders"><span class="secno">11.2 </span>Creating and updating orders<a class="self-link" aria-label="§" href="#creating-and-updating-orders"></a></h3><p><strong>Booking systems</strong> <em class="rfc2119" title="MUST">MUST</em> expose an <strong>orders</strong> endpoint, e.g. <code>/orders</code> to allow
<strong>brokers</strong> to initiate the <strong>booking</strong> workflow.</p><p><strong>Orders</strong> initiated by a specific <strong>broker</strong> <em class="rfc2119" title="SHOULD">SHOULD</em> only be able to be updated
by the same <strong>broker</strong>. For the purpose of creating and updating an <code>Order</code>
the only reliable mechanism for ensuring that the <strong>broker</strong> is the same across
requests is via authentication/identification by API keys or Authoriztion
headers. The <strong>broker</strong> property within the <code>Order</code> is for information only.</p><p>It is the responsibility of the <strong>booking system</strong> to ensure that only the
<strong>broker</strong> which created the <code>Order</code> can update, complete and cancel an
order.</p><section id="discovering-the-order-endpoint"><h4 id="x11-2-1-discovering-the-order-endpoint"><span class="secno">11.2.1 </span>Discovering the order endpoint<a class="self-link" aria-label="§" href="#discovering-the-order-endpoint"></a></h4><p><strong>Booking systems</strong> <em class="rfc2119" title="MUST">MUST</em> expose an orders endpoint, e.g. /orders to allow
<strong>brokers</strong> to initiate and enter the <strong>booking</strong> workflow.</p><p>To initiate the <strong>booking workflow</strong>, the <strong>booking system</strong> must include a
<code>potentialAction</code> field within each <strong>bookable</strong>
<strong>opportunity</strong>. The
<code>potentialAction</code> field <em class="rfc2119" title="MUST">MUST</em> contain one or more objects of type ReserveAction.</p><p>These ReserveAction objects must contain a <code>target</code> field containing an
EntryPoint object.</p><p>The EntryPoint object <em class="rfc2119" title="MUST">MUST</em> state the <code>url</code> of the orders endpoint, and <em class="rfc2119" title="SHOULD">SHOULD</em>
contain the <code>encodingType</code> and the <code>httpMethod</code> which must be POST as a new
<code>Order</code> object will be created on successful invocation.</p><p>If the <strong>offer</strong> relates to a <strong>slot</strong> within a <code>FacilityUse</code>, the closest
<code>potentialAction</code> property matching the type <code>ReserveAction</code> should be used.</p><p>An example is below:</p><div class="example" id="example-15-example-of-a-reserveaction">
          <div class="marker">
      <a class="self-link" href="#example-15-example-of-a-reserveaction">Example 15</a><span class="example-title">: Example of a ReserveAction</span>
    </div>
          <pre class="hljs javascript" aria-busy="false"><span class="hljs-string">"potentialAction"</span>: [
  {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"ReserveAction"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Book"</span>,
    <span class="hljs-string">"target"</span>: {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"EntryPoint"</span>,
      <span class="hljs-string">"urlTemplate"</span>: <span class="hljs-string">"https://example.com/orders"</span>,
      <span class="hljs-string">"encodingType"</span>: <span class="hljs-string">"application/vnd.openactive.v1.0+json"</span>,
      <span class="hljs-string">"httpMethod"</span>: <span class="hljs-string">"POST"</span>
    }
  }
]</pre>
        </div></section><section id="pre-conditions-for-creating-an-order"><h4 id="x11-2-2-pre-conditions-for-creating-an-order"><span class="secno">11.2.2 </span>Pre-conditions for creating an order<a class="self-link" aria-label="§" href="#pre-conditions-for-creating-an-order"></a></h4><p>Before creating an <code>Order</code> the <strong>broker</strong> <em class="rfc2119" title="MUST">MUST</em>:</p><ul>
<li>have obtained <strong>customer</strong> information</li>
<li>have determined that the <strong>opportunity</strong> is bookable (see sections on the
definition of bookable for events and slots/facility uses)</li>
<li>have identified the selected <strong>offer</strong></li>
<li>have prompted <strong>customer</strong> that they will enter a <strong>payment</strong> flow
(no pre-emptive leasing)</li>
<li>have indicates that the <strong>customer's</strong> personal information is being submitted
to third-party (the <strong>booking system</strong> and the <strong>seller</strong>) and made the customer
aware of and assent to any legitimate privacy policy and terms and conditions</li>
<li>have already obtained permission to use API</li>
</ul><p>Before creating an <code>Order</code> the <strong>broker</strong> <em class="rfc2119" title="SHOULD">SHOULD</em>:</p><ul>
<li>have registered the <strong>customer</strong> (or have the <strong>customer's</strong> details to hand)</li>
<li>have identified the <strong>customer's</strong> preferred payment options</li>
</ul></section><section id="creating-a-new-order-orders"><h4 id="x11-2-3-creating-a-new-order-orders"><span class="secno">11.2.3 </span>Creating a new order (<code>/orders</code>)<a class="self-link" aria-label="§" href="#creating-a-new-order-orders"></a></h4><p>A POST request to the <code>/orders</code> endpoint of the <strong>booking system</strong> will result
in server creating an new <code>Order</code>. A time limited lease will be created for
spaces in the <strong>event</strong> referenced in the <code>Order</code>.</p><p>The <code>broker</code> property in the request body is to help the <strong>booking platform</strong> to
clarify who is making request and to help them in situations such as queries
to allow reconciliation of payments. It is not designed as any part of an
authentication which should be performed outside of the JSON body of the
request. No authentication tokens should be present within the <code>broker</code> property
of the submitted JSON.</p><p>The <code>broker</code> property should be a well formed schema:Organisation object.</p><p>In the situation where a middleware to be used to handle access control for
various <strong>brokers</strong>, independently of API key provisioning at the
<strong>booking system</strong> level (which in some systems is a lengthly and time-consuming
process), the <code>broker</code> property should contain the details of the end-user
<strong>broker</strong> rather than the middleware.</p><p>To acheive compliance with Apple Pay, Google Pay and Google Reserve, the
customer's telephone number, an optional field, should be supplied.</p><div class="example" id="example-16-creating-an-order-request">
          <div class="marker">
      <a class="self-link" href="#example-16-creating-an-order-request">Example 16</a><span class="example-title">: Creating an order - request</span>
    </div>
          <pre class="hljs http" aria-busy="false"><span class="hljs-keyword">POST</span> <span class="hljs-string">/orders</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive.v1.0+json

<span class="json">{
    <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/ns/oa.jsonld"</span>,
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Order"</span>,
    <span class="hljs-attr">"broker"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>
    },
    <span class="hljs-attr">"customer"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Person"</span>,
        <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
        <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
        <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
        <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
    },
    <span class="hljs-attr">"acceptedOffer"</span>: [{
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"validThrough"</span>: <span class="hljs-string">"2018-10-29T11:00:00Z"</span>,
        <span class="hljs-attr">"validFrom"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/offers/1234"</span>,
        <span class="hljs-attr">"itemOffered"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Event"</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/123"</span>
        },
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10.00</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"isCancellable"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"cancellationValidUntil"</span>: <span class="hljs-string">"2018-10-28T11:00:00Z"</span>
    }],
    <span class="hljs-attr">"orderedItem"</span>: [{
        <span class="hljs-attr">"orderQuantity"</span>: <span class="hljs-string">"1"</span>,
        <span class="hljs-attr">"orderedItem"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Event"</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/123"</span>
        }
    }]
}</span></pre>
        </div><p>If successful the server will response with the location of a newly created
<code>Order</code> resource:</p><div class="example" id="example-17-creating-an-order-response">
          <div class="marker">
      <a class="self-link" href="#example-17-creating-an-order-response">Example 17</a><span class="example-title">: Creating an order - response</span>
    </div>
          <pre class="hljs http" aria-busy="false">HTTP/1.1 <span class="hljs-number">201</span> Created
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive.v1.0+json
<span class="hljs-attribute">Location</span>: /orders/890

<span class="json">
{
    <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/ns/oa.jsonld"</span>,
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Order"</span>,
    <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/orders/890"</span>,
    <span class="hljs-attr">"acceptedOffer"</span>: [{
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"validThrough"</span>: <span class="hljs-string">"2018-10-29T11:00:00Z"</span>,
        <span class="hljs-attr">"validFrom"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/offers/1234"</span>,
        <span class="hljs-attr">"itemOffered"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Event"</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/123"</span>
        },
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10.00</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"isCancellable"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"cancellationValidUntil"</span>: <span class="hljs-string">"2018-10-28T11:00:00Z"</span>
    }],
    <span class="hljs-attr">"broker"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>
    },
    <span class="hljs-attr">"customer"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Person"</span>,
        <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
        <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
        <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
        <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
    },
    <span class="hljs-attr">"orderDate"</span>: <span class="hljs-string">"2018-10-08T20:52:36Z"</span>,
    <span class="hljs-attr">"orderedItem"</span>: [{
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
        <span class="hljs-attr">"orderQuantity"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://schema.org/OrderPaymentDue"</span>,
        <span class="hljs-attr">"orderedItem"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Event"</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/123"</span>
        }
    }],
    <span class="hljs-attr">"orderLeaseDuration"</span>: <span class="hljs-string">"PT15M"</span>,
    <span class="hljs-attr">"orderStatus"</span>: <span class="hljs-string">"https://schema.org/OrderPaymentDue"</span>,
    <span class="hljs-attr">"partOfInvoice"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Invoice"</span>,
        <span class="hljs-attr">"paymentStatus"</span>: <span class="hljs-string">"PaymentDue"</span>,
        <span class="hljs-attr">"totalPaymentDue"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"MonetaryAmount"</span>,
            <span class="hljs-attr">"value"</span>: <span class="hljs-number">10.00</span>,
            <span class="hljs-attr">"currency"</span>: <span class="hljs-string">"GBP"</span>
        }
    },
    <span class="hljs-attr">"paymentDueDate"</span>: <span class="hljs-string">"2018-10-08T21:07:36Z"</span>,
    <span class="hljs-attr">"potentialAction"</span>: [{
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PayAction"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Pay"</span>,
        <span class="hljs-attr">"target"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"EntryPoint"</span>,
            <span class="hljs-attr">"urlTemplate"</span>: <span class="hljs-string">"https://example.com/orders/{order_id}"</span>,
            <span class="hljs-attr">"encodingType"</span>: <span class="hljs-string">"application/vnd.openactive.v1.0+json"</span>,
            <span class="hljs-attr">"httpMethod"</span>: <span class="hljs-string">"PATCH"</span>
        }
    }]
}</span></pre>
        </div></section><section id="viewing-an-order-orders-orderid"><h4 id="x11-2-4-viewing-an-order-orders-orderid"><span class="secno">11.2.4 </span>Viewing an order (<code>/orders/{orderId}</code>)<a class="self-link" aria-label="§" href="#viewing-an-order-orders-orderid"></a></h4><p>To get the latest state of an order, perform a GET request on its URI.</p><div class="example" id="example-18-viewing-an-order-request">
          <div class="marker">
      <a class="self-link" href="#example-18-viewing-an-order-request">Example 18</a><span class="example-title">: Viewing an order - request</span>
    </div>
          <pre class="hljs http" aria-busy="false"><span class="hljs-keyword">GET</span> <span class="hljs-string">/orders/890</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:53:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive.v1.0+json</pre>
        </div><div class="example" id="example-19-viewing-an-order-response">
          <div class="marker">
      <a class="self-link" href="#example-19-viewing-an-order-response">Example 19</a><span class="example-title">: Viewing an order - response</span>
    </div>
          <pre class="hljs http" aria-busy="false">HTTP/1.1 <span class="hljs-number">200</span> Created
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:53:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive.v1.0+json
<span class="hljs-attribute">Content-Length</span>: ...

<span class="json">{
    <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/ns/oa.jsonld"</span>,
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Order"</span>,
    <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/orders/890"</span>,
    <span class="hljs-attr">"acceptedOffer"</span>: [{
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"validThrough"</span>: <span class="hljs-string">"2018-10-29T11:00:00Z"</span>,
        <span class="hljs-attr">"validFrom"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/offers/1234"</span>,
        <span class="hljs-attr">"itemOffered"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Event"</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/123"</span>
        },
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10.00</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"isCancellable"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"cancellationValidUntil"</span>: <span class="hljs-string">"2018-10-28T11:00:00Z"</span>
    }],
    <span class="hljs-attr">"broker"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>
    },
    <span class="hljs-attr">"customer"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Person"</span>,
        <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
        <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
        <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
        <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
    },
    <span class="hljs-attr">"orderDate"</span>: <span class="hljs-string">"2018-10-08T20:52:36Z"</span>,
    <span class="hljs-attr">"orderedItem"</span>: [{
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
        <span class="hljs-attr">"orderQuantity"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://schema.org/OrderPaymentDue"</span>,
        <span class="hljs-attr">"orderedItem"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Event"</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/123"</span>
        }
    }],
    <span class="hljs-attr">"orderLeaseDuration"</span>: <span class="hljs-string">"PT15M"</span>,
    <span class="hljs-attr">"orderStatus"</span>: <span class="hljs-string">"https://schema.org/OrderPaymentDue"</span>,
    <span class="hljs-attr">"partOfInvoice"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Invoice"</span>,
        <span class="hljs-attr">"paymentStatus"</span>: <span class="hljs-string">"PaymentDue"</span>,
        <span class="hljs-attr">"totalPaymentDue"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"MonetaryAmount"</span>,
            <span class="hljs-attr">"value"</span>: <span class="hljs-number">10.00</span>,
            <span class="hljs-attr">"currency"</span>: <span class="hljs-string">"GBP"</span>
        }
    },
    <span class="hljs-attr">"paymentDueDate"</span>: <span class="hljs-string">"2018-10-08T21:07:36Z"</span>,
    <span class="hljs-attr">"potentialAction"</span>: [{
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PayAction"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Pay"</span>,
            <span class="hljs-attr">"target"</span>: {
                <span class="hljs-attr">"type"</span>: <span class="hljs-string">"EntryPoint"</span>,
                <span class="hljs-attr">"urlTemplate"</span>: <span class="hljs-string">"https://example.com/orders/{order_id}"</span>,
                <span class="hljs-attr">"encodingType"</span>: <span class="hljs-string">"application/vnd.openactive.v1.0+json"</span>,
                <span class="hljs-attr">"httpMethod"</span>: <span class="hljs-string">"PATCH"</span>
            }
        }
    ]
}</span></pre>
        </div><p>Note: The <code>paymentDueDate</code> is set by the date and time of the <code>Order</code> and the
<code>orderLeaseDuration</code>.</p></section><section id="deleting-an-order-orders-orderid"><h4 id="x11-2-5-deleting-an-order-orders-orderid"><span class="secno">11.2.5 </span>Deleting an order (<code>/orders/{orderId}</code>)<a class="self-link" aria-label="§" href="#deleting-an-order-orders-orderid"></a></h4><p>A <code>DELETE</code> request to an <code>Order</code> URI will delete the order. Deletion may only
be used in the specific case for cancelling an <code>Order</code> and the associated
lease on a space in an <strong>event</strong> if the <strong>customer</strong> no longer wishes to take
up the opportunity.</p><p>A <code>DELETE</code> request <em class="rfc2119" title="MUST NOT">MUST NOT</em> be used to cancel an existing completed <code>Order</code>
as part of a refund/cancellation workflow. An appropriate approach for that is
defined elsewhere.</p></section><section id="completing-an-order-orders-orderid"><h4 id="x11-2-6-completing-an-order-orders-orderid"><span class="secno">11.2.6 </span>Completing an order (<code>/orders/{orderId}</code>)<a class="self-link" aria-label="§" href="#completing-an-order-orders-orderid"></a></h4><p>An <code>Order</code> is completed by the <strong>broker</strong> submitting notification that the
<strong>customer</strong> has made a payment via a third-party payment gateway.</p><p>An <code>Order</code> is not considered complete until payment has occurred.</p><p><strong>Brokers</strong> <em class="rfc2119" title="MUST">MUST</em> update the <strong>booking system</strong> to indicate that <strong>payment</strong> has
been taken.</p><p>Once the <strong>booking system</strong> is content with the payments, it then sets the
<code>orderStatus</code> property of the <code>Order</code> to <a href="https://schema.org/OrderDelivered">https://schema.org/OrderDelivered</a> and
returns a representation of the completed <code>Order</code> with a 200 status code.</p><div class="example" id="example-20-completing-an-order-request">
          <div class="marker">
      <a class="self-link" href="#example-20-completing-an-order-request">Example 20</a><span class="example-title">: Completing an order - request</span>
    </div>
          <pre class="hljs http" aria-busy="false"><span class="hljs-keyword">PATCH</span> <span class="hljs-string">/orders/123</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:56:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive.v1.0+json

<span class="json">{
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Order"</span>,
    <span class="hljs-attr">"payments"</span>: [{
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Payment"</span>,
        <span class="hljs-attr">"paymentMethod"</span>: <span class="hljs-string">"https://purl.org/goodrelations/v1#PaymentMethodCreditCard"</span>,
        <span class="hljs-attr">"paymentMethodId"</span>: <span class="hljs-string">"3204"</span>,
        <span class="hljs-attr">"totalPaidToProvider"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"MonetaryAmount"</span>,
            <span class="hljs-attr">"value"</span>: <span class="hljs-number">10.00</span>,
            <span class="hljs-attr">"currency"</span>: <span class="hljs-string">"GBP"</span>
        }
    }]
}</span></pre>
        </div><div class="example" id="example-21-completing-an-order-response">
          <div class="marker">
      <a class="self-link" href="#example-21-completing-an-order-response">Example 21</a><span class="example-title">: Completing an order - response</span>
    </div>
          <pre class="hljs http" aria-busy="false">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:56:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive.v1.0+json
<span class="hljs-attribute">Content-Length</span>: ...

<span class="json">
{
    <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/ns/oa.jsonld"</span>,
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Order"</span>,
    <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/orders/890"</span>,
    <span class="hljs-attr">"acceptedOffer"</span>: [{
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"validThrough"</span>: <span class="hljs-string">"2018-10-29T11:00:00Z"</span>,
        <span class="hljs-attr">"validFrom"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/offers/1234"</span>,
        <span class="hljs-attr">"itemOffered"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Event"</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/123"</span>
        },
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10.00</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"isCancellable"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"cancellationValidUntil"</span>: <span class="hljs-string">"2018-10-28T11:00:00Z"</span>
    }],
    <span class="hljs-attr">"broker"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>
    },
    <span class="hljs-attr">"customer"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Person"</span>,
        <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
        <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
        <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
        <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
    },
    <span class="hljs-attr">"orderDate"</span>: <span class="hljs-string">"2018-10-08T20:52:36Z"</span>,
    <span class="hljs-attr">"orderedItem"</span>: [{
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
        <span class="hljs-attr">"orderQuantity"</span>: <span class="hljs-number">1</span>,
        <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://schema.org/OrderDelivered"</span>,
        <span class="hljs-attr">"orderedItem"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Event"</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/123"</span>
        }
    }],
    <span class="hljs-attr">"orderStatus"</span>: <span class="hljs-string">"https://schema.org/OrderDelivered"</span>,
    <span class="hljs-attr">"partOfInvoice"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Invoice"</span>,
        <span class="hljs-attr">"paymentStatus"</span>: <span class="hljs-string">"PaymentComplete"</span>,
        <span class="hljs-attr">"totalPaymentDue"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"MonetaryAmount"</span>,
            <span class="hljs-attr">"value"</span>: <span class="hljs-number">10.00</span>,
            <span class="hljs-attr">"currency"</span>: <span class="hljs-string">"GBP"</span>
        }
    },
    <span class="hljs-attr">"payments"</span>: [{
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Payment"</span>,
        <span class="hljs-attr">"paymentMethod"</span>: <span class="hljs-string">"https://purl.org/goodrelations/v1#PaymentMethodCreditCard"</span>,
        <span class="hljs-attr">"paymentMethodId"</span>: <span class="hljs-string">"3204"</span>,
        <span class="hljs-attr">"totalPaidToProvider"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"MonetaryAmount"</span>,
            <span class="hljs-attr">"value"</span>: <span class="hljs-number">10.00</span>,
            <span class="hljs-attr">"currency"</span>: <span class="hljs-string">"GBP"</span>
        },
        <span class="hljs-attr">"paymentDate"</span>: <span class="hljs-string">"2018-10-08T20:56:36Z"</span>
    }],
    <span class="hljs-attr">"potentialAction"</span>: [{
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CancelAction"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Cancel"</span>,
        <span class="hljs-attr">"target"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"EntryPoint"</span>,
            <span class="hljs-attr">"urlTemplate"</span>: <span class="hljs-string">"https://example.com/orders/{order_id}"</span>,
            <span class="hljs-attr">"encodingType"</span>: <span class="hljs-string">"application/vnd.openactive.v1.0+json"</span>,
            <span class="hljs-attr">"httpMethod"</span>: <span class="hljs-string">"PATCH"</span>
        }
    }]
}</span></pre>
        </div><p>Note: If the record had been retrieved after the expiry of the cancellation window,
the <code>CancelAction</code> would be omitted.</p></section></section><section id="ordering-a-place-at-a-free-event-ordering-a-free-slot"><h3 id="x11-3-ordering-a-place-at-a-free-event-ordering-a-free-slot"><span class="secno">11.3 </span>Ordering a place at a free event/ordering a free slot<a class="self-link" aria-label="§" href="#ordering-a-place-at-a-free-event-ordering-a-free-slot"></a></h3><p>Free <strong>opportunities</strong> <em class="rfc2119" title="MUST">MUST</em> follow the same workflow as paid <strong>opportunities</strong>.
A free <strong>event</strong> or <strong>slot</strong> is technically a free <strong>offer</strong> on a space for an
opportunity. There <em class="rfc2119" title="MUST">MUST</em> be at least one offer with a price property of <code>0.00</code>.
For free Offers publishers <em class="rfc2119" title="MAY">MAY</em> leave out the priceCurrency. If a priceCurrency
is not available then brokers <em class="rfc2119" title="SHOULD">SHOULD</em> display a suitable default currency when
displaying a zero price.</p><p>The <code>Order</code> workflow <em class="rfc2119" title="MUST">MUST</em> be followed as described for <strong>offers</strong> with a
payment. The PATCH to the URL defined in <code>PayAction</code> should follow the example
shown below.</p><p><strong>Orders</strong> for a free place at an <strong>opportunity</strong> are the only current scenario
in the Booking API specification where a <code>Payment</code> object has <code>paymentMethod</code>
and <code>paymentMethodId</code> as optional properties.</p><div class="example" id="example-22-completing-an-free-order-with-a-payment-of-0-00-request">
          <div class="marker">
      <a class="self-link" href="#example-22-completing-an-free-order-with-a-payment-of-0-00-request">Example 22</a><span class="example-title">: Completing an free order with a payment of 0.00 - request</span>
    </div>
          <pre class="hljs http" aria-busy="false"><span class="hljs-keyword">PATCH</span> <span class="hljs-string">/orders/123</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:51:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive.v1.0+json

<span class="json">{
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Order"</span>,
  <span class="hljs-attr">"payments"</span>: [{
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Payment"</span>,
    <span class="hljs-attr">"totalPaidToProvider"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"MonetaryAmount"</span>,
      <span class="hljs-attr">"value"</span>: <span class="hljs-number">0.00</span>,
      <span class="hljs-attr">"currency"</span>: <span class="hljs-string">"GBP"</span>
    }
  }]
}</span></pre>
        </div></section><section id="leases-and-the-orderleaseduration-property"><h3 id="x11-4-leases-and-the-orderleaseduration-property"><span class="secno">11.4 </span>Leases and the orderLeaseDuration property<a class="self-link" aria-label="§" href="#leases-and-the-orderleaseduration-property"></a></h3><p>If the lease expires during <strong>payment</strong>, the <strong>broker</strong> <em class="rfc2119" title="MAY">MAY</em> delete the <code>Order</code>
(if the <strong>booking system</strong> has not already done so, returning a response with a
<code>410</code> status code).</p><p>The <strong>broker</strong> should then create a new <code>Order</code> for the
<strong>customer</strong> in order to generate a new lease.</p><p>Before creating a new order, the <strong>broker</strong> <em class="rfc2119" title="MUST">MUST</em> check the <strong>opportunity</strong> and
<strong>offers</strong> to ensure that a space still exists within the <strong>opportunity</strong>
and that the <strong>offer</strong> selected by the <strong>customer</strong> is still valid.</p><p>If no space exists or the <strong>offer</strong> is now invalid, the <strong>customer</strong>
should be refunded if payment has been taken.</p></section><section id="the-state-transitions-during-the-order-process"><h3 id="x11-5-the-state-transitions-during-the-order-process"><span class="secno">11.5 </span>The state transitions during the order process<a class="self-link" aria-label="§" href="#the-state-transitions-during-the-order-process"></a></h3><ol>
<li>An <code>Order</code> object is created by a <strong>broker</strong> invoking the orders endpoint
with a POST request containing details of the <strong>broker</strong> (represented as a
schema:Organisation), <strong>customer</strong> (represented as a schema:Person) and details
of the selected <strong>event</strong> and <strong>offer</strong> as components of a schema:OrderItem
object.
The <strong>booking system</strong> returns a representation of the <code>Order</code> object to the</li>
</ol><p><strong>broker</strong> in a response with a 201 status and the URL for the object in the
<code>Location</code> header. The <code>orderStatus</code> of the <code>Order</code> at this point in the flow
should be <a href="https://schema.org/OrderPaymentDue">https://schema.org/OrderPaymentDue</a></p><ol start="2">
<li>Concurrently the <strong>booking system</strong> also creates a lease for a space in the</li>
</ol><p><strong>event</strong> for the <strong>customer</strong> for the duration specified in the
<code>orderLeaseDuration</code> property of the <strong>event</strong>.</p><ol start="3">
<li>The <strong>broker</strong> directs the customer into the flow of the third-party</li>
</ol><p><strong>payment</strong> provider.</p><ol start="4">
<li>If the <strong>customer</strong> successfully completes the payment within the duration
of the lease, the <strong>broker</strong> sends notification of the payment with a PATCH
request to the specific order end point (/orders/123 in the examples) with
details of the <strong>payment</strong> in the <code>paymentMethod</code> and <code>paymentMethodId</code>
properties. At this point the <code>Order</code> is deemed to be completed. The
<code>orderStatus</code> property should be currently set to
<code>https://schema.org/OrderDelivered</code> and the <code>confirmationNumber</code>
property set to an appropriate unique value by the <strong>booking system</strong>. At this
point in the flow, the <code>Order</code> is deemed to be complete.</li>
</ol><p>If the lease expires before the payment is made, the <code>Order</code> should either be
deleted by the <strong>broker</strong> or be deleted by the <strong>booking system</strong> at some point
after expiry. The <code>orderStatus</code> property should be set to
<a href="https://schema.org/OrderCancelled">https://schema.org/OrderCancelled</a> to indicate that the <code>Order</code> cannot proceed
to completion.</p></section><section id="actions-which-occur-after-order-completion-confirmations-and-refunds"><h3 id="x11-6-actions-which-occur-after-order-completion-confirmations-and-refunds"><span class="secno">11.6 </span>Actions which occur after order completion: confirmations and refunds<a class="self-link" aria-label="§" href="#actions-which-occur-after-order-completion-confirmations-and-refunds"></a></h3><p>Both the <strong>broker</strong> and <strong>booking system</strong> may need to take further actions after
completing an order. This section describes some potential interactions.</p><section id="supplying-a-confirmation-to-the-customer"><h4 id="x11-6-1-supplying-a-confirmation-to-the-customer"><span class="secno">11.6.1 </span>Supplying a confirmation to the customer<a class="self-link" aria-label="§" href="#supplying-a-confirmation-to-the-customer"></a></h4><p>The <strong>broker</strong> <em class="rfc2119" title="SHOULD">SHOULD</em> provide the <strong>customer</strong> with confirmation of a successful
payment having been made through the third-party system and that the <code>Order</code>
has been completed successfully. The <strong>broker</strong> will have access to a completed
<code>Order</code> which will contain a <code>confirmationCode</code> property.</p><p>The <strong>booking system</strong> may also provide the <strong>customer</strong> with a confirmation that
the space at the <strong>opportunity</strong> has been booked on their behalf.</p></section><section id="refunding-a-customer-and-cancelling-an-order"><h4 id="x11-6-2-refunding-a-customer-and-cancelling-an-order"><span class="secno">11.6.2 </span>Refunding a customer and cancelling an order<a class="self-link" aria-label="§" href="#refunding-a-customer-and-cancelling-an-order"></a></h4><p>Refunds and cancellations are a responsibility of the <strong>broker</strong> who is the
party in the system in a position to process a refund for the <strong>customer</strong> with
the third-party payments system.</p><p>The <strong>broker</strong> should initiate a refund with the third-party payment provider.
The refund process should be considered to be asynchronous for the purposes of
this specification.</p><p>After initiating a refund, the <strong>broker</strong> should cancel the
<code>Order</code> by submitting a PATCH request to the URL defined in the <code>CancelAction</code>
prescribed in the <code>potentialAction</code> property of the <code>Order</code> response.</p><p>The process of cancellation is documented in Section 5.6</p></section></section><section id="customers"><h3 id="x11-7-customers"><span class="secno">11.7 </span>Customers<a class="self-link" aria-label="§" href="#customers"></a></h3><section id="creation-of-customers-on-the-booking-system"><h4 id="x11-7-1-creation-of-customers-on-the-booking-system"><span class="secno">11.7.1 </span>Creation of customers on the booking system<a class="self-link" aria-label="§" href="#creation-of-customers-on-the-booking-system"></a></h4><p>In this current iteration of the Booking API specification, the programmatic
creation of <strong>customers</strong> on the <strong>booking system</strong> by the <strong>broker</strong> is
considered to be out of scope.</p></section><section id="viewing-a-customer-s-previously-placed-orders"><h4 id="x11-7-2-viewing-a-customer-s-previously-placed-orders"><span class="secno">11.7.2 </span>Viewing a customer's previously placed orders<a class="self-link" aria-label="§" href="#viewing-a-customer-s-previously-placed-orders"></a></h4><p>A server <em class="rfc2119" title="MUST">MUST</em> provide endpoints to allow <strong>brokers</strong> to retrieve information
about previously placed <strong>orders</strong>. In future versions of the specification,
endpoints may be provided which permit a <strong>broker</strong> to see all <strong>orders</strong>
created by a <strong>customer</strong>. In this current implementation, if the <strong>broker</strong>
wishes to present a view of all <strong>orders</strong> for a <strong>customer</strong>, it should keep
an internal record.</p></section><section id="deletion-of-personal-data-of-the-customer-if-the-order-is-not-completed"><h4 id="x11-7-3-deletion-of-personal-data-of-the-customer-if-the-order-is-not-completed"><span class="secno">11.7.3 </span>Deletion of personal data of the customer if the order is not completed<a class="self-link" aria-label="§" href="#deletion-of-personal-data-of-the-customer-if-the-order-is-not-completed"></a></h4><p>If an <code>Order</code> is not completed, the <strong>booking system</strong> <em class="rfc2119" title="SHOULD">SHOULD</em> delete all
personal information of the <strong>customer</strong> provided to it as part of the <code>Order</code>
creation process.</p></section></section></section><section class="normative" id="future-versions-of-this-api"><!--OddPage--><h2 id="x12-future-versions-of-this-api"><span class="secno">12. </span>Future versions of this API<a class="self-link" aria-label="§" href="#future-versions-of-this-api"></a></h2><p>Some of the patterns within version 1.0, for example the PATCHing of an order
resource to provide a payment and using PATCH to change the status of an <code>orderItem</code> to
cancel an order provide the groundwork for known requirements such as multiple
order items (shopping carts), cancellation of individual order items and also
multipart payments.</p><p>Both <code>orderItems</code> and <code>payments</code> are modelled as collections to support
extension of the version 1.0 specification towards multipart orders and
payments without breaking changes in the Order model for subsequent versions.</p><p>The new models for Payment and for Error enhance the Open Active model
specification to make it more transactional when used as part of the Booking
API.</p><p>The currently known requirements not satisfied in version 1.0 are:</p><ul>
<li>multiple part orders</li>
<li>supporting multiple payments</li>
<li>customer creation</li>
<li>managing of reservations</li>
<li>support for member lookups</li>
</ul><p>We have not yet decided what the priorities are, or whether all of these
requirements are in scope for version 1.0 and would encourage people to shape
future iterations of the specification by becoming involved in the communities
associated with Open Active and the open specification.</p><p>In a future version, it is imagined that an API method describing the service,
and including such things as the links to Privacy Policy, Terms and Conditions
and the target for a ReserveAction could be used to reduce data duplication.</p><p>At the moment there is no provision for a <strong>customer</strong> to cancel an <code>Order</code>
after the cancellation window, yet they may wish to do this out of politeness,
even though no refund is possible, with the benefit that their place may be
taken by another participant.</p></section><section class="normative" id="new-open-active-models-defined-in-the-1-0-booking-api-specification"><!--OddPage--><h2 id="x13-new-open-active-models-defined-in-the-1-0-booking-api-specification"><span class="secno">13. </span>New Open Active models defined in the 1.0 Booking API specification<a class="self-link" aria-label="§" href="#new-open-active-models-defined-in-the-1-0-booking-api-specification"></a></h2><p>These models are not yet reflected in the current version (2.0) of the Open
Active Modelling Specification.</p><section id="error"><h3 id="x13-1-error"><span class="secno">13.1 </span>Error<a class="self-link" aria-label="§" href="#error"></a></h3><table>
<thead>
<tr><th>Property</th>
<th>Status</th>
<th>Notes</th>
</tr></thead>
<tbody>
<tr>
<td><code>errorType</code></td>
<td><em class="rfc2119"><em class="rfc2119" title="REQUIRED"><em class="rfc2119" title="REQUIRED">REQUIRED</em></em></em></td>
<td>A URI providing an enumeration value for the type of error.</td>
</tr>
<tr>
<td><code>title</code></td>
<td><em class="rfc2119"><em class="rfc2119" title="REQUIRED"><em class="rfc2119" title="REQUIRED">REQUIRED</em></em></em></td>
<td>A human readable reason for the error.</td>
</tr>
<tr>
<td><code>detail</code></td>
<td><em class="rfc2119"><em class="rfc2119" title="RECOMMENDED"><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></em></em></td>
<td>A human readable description of the error.</td>
</tr>
<tr>
<td><code>instance</code></td>
<td><em class="rfc2119"><em class="rfc2119" title="REQUIRED"><em class="rfc2119" title="REQUIRED">REQUIRED</em></em></em></td>
<td>The requested URL.</td>
</tr>
<tr>
<td><code>method</code></td>
<td><em class="rfc2119"><em class="rfc2119" title="RECOMMENDED"><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></em></em></td>
<td>The method of the request (e.g. GET).</td>
</tr>
<tr>
<td><code>status</code></td>
<td><em class="rfc2119"><em class="rfc2119" title="OPTIONAL"><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></em></em></td>
<td>An integer representing the HTTP status code.</td>
</tr>
<tr>
<td><code>invalid-params</code></td>
<td><em class="rfc2119"><em class="rfc2119" title="OPTIONAL"><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></em></em></td>
<td>An array of invalid parameters, if appropriate.</td>
</tr>
<tr>
<td><code>requestId</code></td>
<td><em class="rfc2119"><em class="rfc2119" title="OPTIONAL"><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></em></em></td>
<td>Used by technical support for diagnostics purposes.</td>
</tr>
</tbody>
</table></section><section id="payment"><h3 id="x13-2-payment"><span class="secno">13.2 </span>Payment<a class="self-link" aria-label="§" href="#payment"></a></h3><table></table><table>
  <thead>
    <tr>
      <th>Property</th>
      <th>Status</th>
      <th>Notes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>paymentMethod</code></td>
      <td><em class="rfc2119"><em class="rfc2119" title="REQUIRED"><em class="rfc2119" title="REQUIRED">REQUIRED</em></em></em></td>
      <td>A URI providing an enumeration value for the type of payment method used.</td>
    </tr>
    <tr>
      <td><code>paymentMethodId</code></td>
      <td><em class="rfc2119"><em class="rfc2119" title="REQUIRED"><em class="rfc2119" title="REQUIRED">REQUIRED</em></em></em></td>
      <td>A string identifier for the method of payment used (e.g. the last 4 digits of the credit card).</td>
    </tr>
    <tr>
      <td><code>totalPaidToProvider</code></td>
      <td><em class="rfc2119"><em class="rfc2119" title="REQUIRED"><em class="rfc2119" title="REQUIRED">REQUIRED</em></em></em></td>
      <td>A schema:MonetaryAmount object deining the total amount paid.</td>
    </tr>
    <tr>
      <td><code>confirmationNumber</code></td>
      <td><em class="rfc2119"><em class="rfc2119" title="REQUIRED"><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></em></em></td>
      <td>A string identifier to confirm that a payment has been recorded by the booking system.</td>
    </tr>
    <tr>
      <td><code>paymentDate</code></td>
      <td><em class="rfc2119"><em class="rfc2119" title="REQUIRED"><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></em></em></td>
      <td>The date and time that payment has been recorded by the booking system, expressed as an ISO 8601 DateTime.</td>
    </tr>
  </tbody>
</table></section><section class="appendix informative" id="acknowledgements"><h3 id="x13-3-acknowledgements"><span class="secno">13.3 </span>Acknowledgements<a class="self-link" aria-label="§" href="#acknowledgements"></a></h3><p><em>This section is non-normative.</em></p><p>The editors thank
<a href="https://www.w3.org/community/openactive/participants">all members</a> of the
OpenActive Community Group for their contributions.</p></section><table>












</table></section><section id="references" class="appendix">
      <!--OddPage--><h2 id="a-references"><span class="secno">A. </span>References<a class="self-link" aria-label="§" href="#references"></a></h2>
      
    <section id="normative-references">
        <h3 id="a-1-normative-references"><span class="secno">A.1 </span>Normative references<a class="self-link" aria-label="§" href="#normative-references"></a></h3>
      <dl class="bibliography">
        <dt id="bib-json-ld">[JSON-LD]</dt><dd><a href="https://www.w3.org/TR/json-ld/"><cite>JSON-LD 1.0</cite></a>.  W3C. W3C Recommendation. URL: <a href="https://www.w3.org/TR/json-ld/">https://www.w3.org/TR/json-ld/</a></dd><dt id="bib-modelling-opportunity-data">[Modelling-Opportunity-Data]</dt><dd><a href="https://openactive.io/modelling-opportunity-data/"><cite>Modelling Opportunity Data</cite></a>.  OpenActive Community Group. URL: <a href="https://openactive.io/modelling-opportunity-data/">https://openactive.io/modelling-opportunity-data/</a></dd><dt id="bib-oauth2">[OAuth2]</dt><dd><a href="https://oauth.net/2/"><cite>OAuth 2.0</cite></a>. URL: <a href="https://oauth.net/2/">https://oauth.net/2/</a></dd><dt id="bib-openactive-vocabulary">[OpenActive-Vocabulary]</dt><dd><a href="https://openactive.io/ns/"><cite>OpenActive Vocabulary</cite></a>.  OpenActive Community Group. URL: <a href="https://openactive.io/ns/">https://openactive.io/ns/</a></dd><dt id="bib-openidconnect">[OpenIdConnect]</dt><dd><a href="https://openid.net/connect/"><cite>OpenID Connect</cite></a>. URL: <a href="https://openid.net/connect/">https://openid.net/connect/</a></dd><dt id="bib-reference">[reference]</dt><dd><em class="respec-offending-element">Reference not found.</em></dd><dt id="bib-rfc2119">[RFC2119]</dt><dd><a href="https://tools.ietf.org/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner. IETF. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a></dd><dt id="bib-rfc3986">[RFC3986]</dt><dd><a href="https://tools.ietf.org/html/rfc3986"><cite>Uniform Resource Identifier (URI): Generic Syntax</cite></a>. T. Berners-Lee; R. Fielding; L. Masinter. IETF. January 2005. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc3986">https://tools.ietf.org/html/rfc3986</a></dd><dt id="bib-rfc7231">[RFC7231]</dt><dd><a href="https://tools.ietf.org/html/rfc7231"><cite>Hypertext Transfer Protocol (HTTP/1.1): Semantics and Content</cite></a>. R. Fielding, Ed.; J. Reschke, Ed.. IETF. June 2014. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7231">https://tools.ietf.org/html/rfc7231</a></dd><dt id="bib-rfc7807">[RFC7807]</dt><dd><a href="https://tools.ietf.org/html/rfc7807"><cite>Problem Details for HTTP APIs</cite></a>. M. Nottingham; E. Wilde. IETF. March 2016. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7807">https://tools.ietf.org/html/rfc7807</a></dd><dt id="bib-rpde">[RPDE]</dt><dd><a href="https://openactive.io/realtime-paged-data-exchange/"><cite>Realtime Paged Data Exchange</cite></a>.  OpenActive Community Group. URL: <a href="https://openactive.io/realtime-paged-data-exchange/">https://openactive.io/realtime-paged-data-exchange/</a></dd>
      </dl></section></section><p role="navigation" id="back-to-top"><a href="#title"><abbr title="Back to Top">↑</abbr></a></p><script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script></body></html>