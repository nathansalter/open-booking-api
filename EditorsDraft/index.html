<!DOCTYPE html><html xmlns="https://www.w3.org/1999/xhtml" lang="en"><head><meta charset="utf-8"><meta name="generator" content="ReSpec 24.21.0"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><style>/* --- EXAMPLES --- */
span.example-title {
    text-transform: none;
}
aside.example, div.example, div.illegal-example {
    padding: 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
div.illegal-example { color: red }
div.illegal-example p { color: black }
aside.example, div.example {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
    border-color: #e0cb52;
    background: #fcfaee;
}

aside.example div.example {
    border-left-width: .1em;
    border-color: #999;
    background: #fff;
}
aside.example div.example span.example-title {
    color: #999;
}
</style><style>/* --- ISSUES/NOTES --- */
.issue-label {
    text-transform: initial;
}

.warning > p:first-child { margin-top: 0 }
.warning {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
}
span.warning { padding: .1em .5em .15em; }

.issue.closed span.issue-number {
    text-decoration: line-through;
}

.warning {
    border-color: #f11;
    border-width: .2em;
    border-style: solid;
    background: #fbe9e9;
}

.warning-title:before{
    content: "⚠"; /*U+26A0 WARNING SIGN*/
    font-size: 3em;
    float: left;
    height: 100%;
    padding-right: .3em;
    vertical-align: top;
    margin-top: -0.5em;
}

li.task-list-item {
    list-style: none;
}

input.task-list-item-checkbox {
    margin: 0 0.35em 0.25em -1.6em;
    vertical-align: middle;
}

.issue a.respec-gh-label {
  padding: 5px;
  margin: 0 2px 0 2px;
  font-size: 10px;
  text-transform: none;
  text-decoration: none;
  font-weight: bold;
  border-radius: 4px;
  position: relative;
  bottom: 2px;
  border: none;
}

.issue a.respec-label-dark {
  color: #fff;
  background-color: #000;
}

.issue a.respec-label-light {
  color: #000;
  background-color: #fff;
}
</style><script src="//localhost:35729/livereload.js?snipver=1" async="" defer=""></script>



    
    <title>Open Booking API 1.0</title>

    

    

    <style id="respec-mainstyle">/*****************************************************************
 * ReSpec 3 CSS
 * Robin Berjon - http://berjon.com/
 *****************************************************************/

@keyframes pop {
  0% {
    transform: scale(1, 1);
  }
  25% {
    transform: scale(1.25, 1.25);
    opacity: 0.75;
  }
  100% {
    transform: scale(1, 1);
  }
}

/* Override code highlighter background */
.hljs {
  background: transparent !important;
}

/* --- INLINES --- */
h1 abbr,
h2 abbr,
h3 abbr,
h4 abbr,
h5 abbr,
h6 abbr,
a abbr {
  border: none;
}

dfn {
  font-weight: bold;
}

a.internalDFN {
  color: inherit;
  border-bottom: 1px solid #99c;
  text-decoration: none;
}

a.externalDFN {
  color: inherit;
  border-bottom: 1px dotted #ccc;
  text-decoration: none;
}

a.bibref {
  text-decoration: none;
}

.respec-offending-element:target {
  animation: pop 0.25s ease-in-out 0s 1;
}

/* TODO: Remove once https://github.com/w3c/tr-design/pull/176 is merged. */
.respec-offending-element a[href] {
  margin: 0;
}

.respec-offending-element {
  display: inline-block;
  position: relative;
  /* Red squiggly line */
  background: url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=)
    bottom repeat-x;
}
@supports (text-decoration-style: wavy) {
  .respec-offending-element {
    background: none;
    text-decoration-line: underline;
    text-decoration-style: wavy;
    text-decoration-color: red;
  }
}

#references :target {
  background: #eaf3ff;
  animation: pop 0.4s ease-in-out 0s 1;
}

cite .bibref {
  font-style: normal;
}

code {
  color: #c83500;
}

th code {
  color: inherit;
}

a[href].orcid {
    padding-left: 4px;
    padding-right: 4px;
}

a[href].orcid > svg {
    margin-bottom: -2px;
}

/* --- TOC --- */

.toc a,
.tof a {
  text-decoration: none;
}

a .secno,
a .figno {
  color: #000;
}

ul.tof,
ol.tof {
  list-style: none outside none;
}

.caption {
  margin-top: 0.5em;
  font-style: italic;
}

/* --- TABLE --- */

table.simple {
  border-spacing: 0;
  border-collapse: collapse;
  border-bottom: 3px solid #005a9c;
}

.simple th {
  background: #005a9c;
  color: #fff;
  padding: 3px 5px;
  text-align: left;
}

.simple th[scope="row"] {
  background: inherit;
  color: inherit;
  border-top: 1px solid #ddd;
}

.simple td {
  padding: 3px 10px;
  border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
  background: #f0f6ff;
}

/* --- DL --- */

.section dd > p:first-child {
  margin-top: 0;
}

.section dd > p:last-child {
  margin-bottom: 0;
}

.section dd {
  margin-bottom: 1em;
}

.section dl.attrs dd,
.section dl.eldef dd {
  margin-bottom: 0;
}

#issue-summary > ul,
.respec-dfn-list {
  column-count: 2;
}

#issue-summary li,
.respec-dfn-list li {
  list-style: none;
}

details.respec-tests-details {
  margin-left: 1em;
  display: inline-block;
  vertical-align: top;
}

details.respec-tests-details > * {
  padding-right: 2em;
}

details.respec-tests-details[open] {
  z-index: 999999;
  position: absolute;
  border: thin solid #cad3e2;
  border-radius: 0.3em;
  background-color: white;
  padding-bottom: 0.5em;
}

details.respec-tests-details[open] > summary {
  border-bottom: thin solid #cad3e2;
  padding-left: 1em;
  margin-bottom: 1em;
  line-height: 2em;
}

details.respec-tests-details > ul {
  width: 100%;
  margin-top: -0.3em;
}

details.respec-tests-details > li {
  padding-left: 1em;
}

a[href].self-link:hover {
  opacity: 1;
  text-decoration: none;
  background-color: transparent;
}

h2,
h3,
h4,
h5,
h6 {
  position: relative;
}

aside.example .marker > a.self-link {
  color: inherit;
}

h2 > a.self-link,
h3 > a.self-link,
h4 > a.self-link,
h5 > a.self-link,
h6 > a.self-link {
  border: none;
  color: inherit;
  font-size: 83%;
  height: 2em;
  left: -1.6em;
  opacity: 0.5;
  position: absolute;
  text-align: center;
  text-decoration: none;
  top: 0;
  transition: opacity 0.2s;
  width: 2em;
}

h2 > a.self-link::before,
h3 > a.self-link::before,
h4 > a.self-link::before,
h5 > a.self-link::before,
h6 > a.self-link::before {
  content: "§";
  display: block;
}

@media (max-width: 767px) {
  dd {
    margin-left: 0;
  }

  /* Don't position self-link in headings off-screen */
  h2 > a.self-link,
  h3 > a.self-link,
  h4 > a.self-link,
  h5 > a.self-link,
  h6 > a.self-link {
    left: auto;
    top: auto;
  }
}

@media print {
  .removeOnSave {
    display: none;
  }
}
</style>

    <style>
        table {
            border-collapse: collapse;
            border: 1px solid #bec9d9
        }

        td,
        th {
            padding: 3px 0.5em;
            border-left: 1px solid black;
            border-right: 1px solid black;
            border-bottom: 1px solid #E2EDFE;
        }

        tr th[colspan] {
            color: #005A9C;
            background-color: #FEEDE2;
            text-align: center
        }

        th {
            color: #005A9C;
            background-color: #E2EDFE;
            font-weight: normal;
            border-bottom: 1px solid #BEC9D9;
        }

        tbody tr th {
            text-align: left;
        }

        td.nb {
            font-size: smaller;
        }

        .rec,
        .pr {
            color: #005A9C;
            background-color: #99EE99
        }

        .ext {
            background-color: #FFFFFF
        }

        .cr,
        .lcwd {
            color: #005A9C;
            background-color: #EEEE99
        }

        .wd {
            color: #005A9C;
            background-color: #EE9999
        }

        .ed,
        .fpwd {
            color: #005A9C;
            background-color: #FF7777
        }

        code {
            white-space: pre;
        }

        html {
            background-image: none !important;
        }

        body {
            background: white top left fixed no-repeat !important;
            background-size: 25px auto !important;
            background-image:
                url('https://www.openactive.io/assets/openactive-label-specification.png') !important;
        }

        h1 {
            font-family: 'Open Sans', sans-serif !important;
            font-weight: 300 !important;
            color: #3B3089 !important
            font-size: 220%;
        }

        #toc {
            padding-top: 0px !important;
        }

        .remove {
            background-colour: yellow;
        }

        code {
            color: #C83500;
        }

        em.rfc2119 {
          text-transform:     lowercase;
          font-variant:       small-caps;
          font-style:         normal;
          color:              #900;
        }

        a.internalDFN[href] {
          color: #000;
          font-weight: 500;
        }
    </style>

<link rel="canonical" href="https://www.w3.org/TR/open-booking-api/"><style>/*

github.com style (c) Vasily Polovnyov <vast@whiteants.net>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #333;
  background: #f8f8f8;
}

.hljs-comment,
.hljs-quote {
  color: #998;
  font-style: italic;
}

.hljs-keyword,
.hljs-selector-tag,
.hljs-subst {
  color: #333;
  font-weight: bold;
}

.hljs-number,
.hljs-literal,
.hljs-variable,
.hljs-template-variable,
.hljs-tag .hljs-attr {
  color: #008080;
}

.hljs-string,
.hljs-doctag {
  color: #d14;
}

.hljs-title,
.hljs-section,
.hljs-selector-id {
  color: #900;
  font-weight: bold;
}

.hljs-subst {
  font-weight: normal;
}

.hljs-type,
.hljs-class .hljs-title {
  color: #458;
  font-weight: bold;
}

.hljs-tag,
.hljs-name,
.hljs-attribute {
  color: #000080;
  font-weight: normal;
}

.hljs-regexp,
.hljs-link {
  color: #009926;
}

.hljs-symbol,
.hljs-bullet {
  color: #990073;
}

.hljs-built_in,
.hljs-builtin-name {
  color: #0086b3;
}

.hljs-meta {
  color: #999;
  font-weight: bold;
}

.hljs-deletion {
  background: #fdd;
}

.hljs-addition {
  background: #dfd;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}
</style><style>var {
  position: relative;
  cursor: pointer;
  display: inline-block;
}

var[data-type]::before,
var[data-type]::after {
  position: absolute;
  left: 50%;
  top: -6px;
  opacity: 0;
  transition: opacity 0.4s;
  pointer-events: none;
}

/* the triangle or arrow or caret or whatever */
var[data-type]::before {
  content: "";
  transform: translateX(-50%);
  border-width: 4px 6px 0 6px;
  border-style: solid;
  border-color: transparent;
  border-top-color: #000;
}

/* actual text */
var[data-type]::after {
  content: attr(data-type);
  transform: translateX(-50%) translateY(-100%);
  background: #000;
  text-align: center;
  /* additional styling */
  font-family: "Dank Mono", "Fira Code", monospace;
  font-style: normal;
  padding: 6px;
  border-radius: 3px;
  color: #daca88;
}

var[data-type]:hover::after,
var[data-type]:hover::before {
  opacity: 1;
}
</style><script id="initialUserConfig" type="application/json">{
  "specStatus": "CG-DRAFT",
  "shortName": "open-booking-api",
  "edDraftURI": "https://openactive.io/open-booking-api/EditorsDraft/",
  "copyrightStart": 2018,
  "editors": [
    {
      "name": "Leigh Dodds",
      "url": "https://ldodds.com",
      "company": "Open Data Institute",
      "companyURL": "https://theodi.org",
      "w3cid": 55359
    },
    {
      "name": "Nick Evans",
      "url": "https://nickevans.me/",
      "company": "Open Data Institute",
      "companyURL": "https://theodi.org"
    },
    {
      "name": "Chris Thorpe",
      "url": "https://github.com/drchristhorpe"
    }
  ],
  "otherLinks": [
    {
      "key": "Participate",
      "data": [
        {
          "value": "GitHub openactive/open-booking-api",
          "href": {}
        },
        {
          "value": "File a bug",
          "href": "https://github.com/openactive/open-booking-api/issues/"
        },
        {
          "value": "Commit history",
          "href": "https://github.com/openactive/open-booking-api/commits/gh-pages"
        },
        {
          "value": "Pull requests",
          "href": "https://github.com/openactive/open-booking-api/pulls/"
        }
      ]
    },
    {
      "key": "Version",
      "value": "1.0",
      "href": "https://github.com/openactive/open-booking-api/issues/"
    }
  ],
  "logos": [
    {
      "src": "https://www.openactive.io/assets/openactive-logo-large.png",
      "href": "https://www.openactive.io",
      "alt": "openactive.io",
      "width": 255,
      "height": 43,
      "id": "logo"
    }
  ],
  "wg": "OpenActive Community Group",
  "wgURI": "https://www.w3.org/community/openactive/",
  "wgPublicList": "public-openactive",
  "maxTocLevel": 4,
  "preProcess": [],
  "noRecTrack": true,
  "github": "https://github.com/openactive/open-booking-api/",
  "format": "markdown",
  "localBiblio": {
    "JSON-LD": {
      "href": "https://www.w3.org/TR/json-ld/",
      "title": "JSON-LD 1.0",
      "status": "REC",
      "publisher": "W3C",
      "id": "json-ld"
    },
    "SCHEMA-ORG": {
      "href": "https://schema.org/",
      "title": "Schema.org"
    },
    "Modelling-Opportunity-Data": {
      "href": "https://www.openactive.io/modelling-opportunity-data/",
      "title": "Modelling Opportunity Data",
      "publisher": "OpenActive Community Group",
      "id": "modelling-opportunity-data"
    },
    "Dataset-API-Discovery": {
      "href": "https://www.openactive.io/dataset-api-discovery/EditorsDraft/",
      "title": "Dataset API Discovery",
      "publisher": "OpenActive Community Group",
      "id": "dataset-api-discovery"
    },
    "RPDE": {
      "href": "https://www.openactive.io/realtime-paged-data-exchange/",
      "title": "Realtime Paged Data Exchange",
      "publisher": "OpenActive Community Group",
      "id": "rpde"
    },
    "OpenActive-Vocabulary": {
      "href": "https://www.openactive.io/ns/",
      "title": "OpenActive Vocabulary",
      "publisher": "OpenActive Community Group",
      "id": "openactive-vocabulary"
    },
    "OAuth2": {
      "href": "https://oauth.net/2/",
      "title": "OAuth 2.0",
      "id": "oauth2"
    },
    "OpenIdConnect": {
      "href": "https://openid.net/connect/",
      "title": "OpenID Connect",
      "id": "openidconnect"
    }
  },
  "publishISODate": "2019-04-26T00:00:00.000Z",
  "generatedSubtitle": "Draft Community Group Report 26 April 2019"
}</script><meta name="description" content="This document specifies an HTTP API for placing bookings to participate in
physical activities, either by attending events or through the use of leisure
or sports facilities."><link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/cg-draft"></head>

<body class="h-entry"><div class="head">
      <a class="logo"><img id="logo" alt="openactive.io" width="255" height="43" src="https://www.openactive.io/assets/openactive-logo-large.png"></a>
      <h1 class="title p-name" id="title">Open Booking API 1.0</h1>
      
      <h2>
        Draft Community Group Report
        <time class="dt-published" datetime="2019-04-26">26 April 2019</time>
      </h2>
      <dl>
        
        
        <dt>Latest editor's draft:</dt><dd><a href="https://openactive.io/open-booking-api/EditorsDraft/">https://openactive.io/open-booking-api/EditorsDraft/</a></dd>
        
        
        
        
        
        <dt>Editors:</dt>
        <dd class="p-author h-card vcard" data-editor-id="55359"><a class="u-url url p-name fn" href="https://ldodds.com">Leigh Dodds</a>
            (<a class="p-org org h-org h-card" href="https://theodi.org">Open Data Institute</a>)
          </dd><dd class="p-author h-card vcard"><a class="u-url url p-name fn" href="https://nickevans.me/">Nick Evans</a>
            (<a class="p-org org h-org h-card" href="https://theodi.org">Open Data Institute</a>)
          </dd><dd class="p-author h-card vcard"><a class="u-url url p-name fn" href="https://github.com/drchristhorpe">Chris Thorpe</a></dd>
        
        
        <dt>Participate:</dt><dd>
      <a href="https://github.com/openactive/open-booking-api/">GitHub openactive/open-booking-api</a>
    </dd><dd>
      <a href="https://github.com/openactive/open-booking-api/issues/">File a bug</a>
    </dd><dd>
      <a href="https://github.com/openactive/open-booking-api/commits/gh-pages">Commit history</a>
    </dd><dd>
      <a href="https://github.com/openactive/open-booking-api/pulls/">Pull requests</a>
    </dd><dt>Version:</dt><dd>
      <a href="https://github.com/openactive/open-booking-api/issues/">1.0</a>
    </dd>
      </dl>
      
      <p class="copyright">
        <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
        ©
        2018-2019
        
        the Contributors to the Open Booking API 1.0 Specification, published by the
        <a href="https://www.w3.org/community/openactive/">OpenActive Community Group</a> under the
        <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>. A human-readable
              <a href="https://www.w3.org/community/about/agreements/cla-deed/">summary</a>
              is available.
            
      </p>
      <hr title="Separator for header">
    </div><style>
body {
    background-size: 25px auto !important;
}

body.toc-sidebar #toc {
    background-size: 25px auto !important;
    background-attachment: fixed !important;
}
</style><section id="abstract" class="introductory"><h2>Abstract</h2><p>This document specifies an HTTP API for placing bookings to participate in
physical activities, either by attending events or through the use of leisure
or sports facilities.</p></section><section id="sotd" class="introductory"><h2>Status of This Document</h2><p>
      This specification was published by the
      <a href="https://www.w3.org/community/openactive/">OpenActive Community Group</a>. It is not a W3C Standard nor is it
      on the W3C Standards Track.
      
            Please note that under the
            <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>
            there is a limited opt-out and other conditions apply.
          
      Learn more about
      <a href="https://www.w3.org/community/">W3C Community and Business Groups</a>.
    </p><p>Contributions to this document are not only welcomed but are actively solicited
and should be made via
<a href="https://github.com/openactive/open-booking-api/issues">GitHub Issues</a> and
pull requests. The source code is available
on <a href="https://github.com/openactive/open-booking-api">GitHub</a>.</p><div class="note" role="note" id="issue-container-generatedID"><div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>Note</span></div><div class=""><p>This document represents a complete Editors Draft. It is currently in the final stages of community review and we hope that it is nearing stability. The draft is intended to allow developers to provide feedback by developing proof-of-concept implementations. We encourage developers to explore this API and
contribute to the development of the specification.</p>
</div></div><p>
            If you wish to make comments regarding this document, please send
            them to
            <a href="mailto:public-openactive@w3.org">public-openactive@w3.org</a>
            (<a href="mailto:public-openactive-request@w3.org?subject=subscribe">subscribe</a>,
            <a href="https://lists.w3.org/Archives/Public/public-openactive/">archives</a>).
          </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#introduction"><span class="secno">1. </span>Introduction</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#scope-and-requirements"><span class="secno">1.1 </span>Scope and requirements</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#out-of-scope-in-this-version"><span class="secno">1.1.1 </span>Out of Scope in this version</a></li><li class="tocline"><a class="tocxref" href="#out-of-scope-by-design"><span class="secno">1.1.2 </span>Out of Scope by design</a></li></ol></li><li class="tocline"><a class="tocxref" href="#specification-dependencies"><span class="secno">1.2 </span>Specification dependencies</a></li><li class="tocline"><a class="tocxref" href="#audience"><span class="secno">1.3 </span>Audience</a></li></ol></li><li class="tocline"><a class="tocxref" href="#conformance"><span class="secno">2. </span>Conformance</a></li><li class="tocline"><a class="tocxref" href="#typographical-conventions"><span class="secno">3. </span>Typographical Conventions</a></li><li class="tocline"><a class="tocxref" href="#key-actors"><span class="secno">4. </span>Key Actors</a></li><li class="tocline"><a class="tocxref" href="#booking-flows"><span class="secno">5. </span>Booking Flows</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#booking-pre-conditions"><span class="secno">5.1 </span>Booking pre-conditions</a></li><li class="tocline"><a class="tocxref" href="#simple-booking-flow"><span class="secno">5.2 </span>Simple Booking Flow</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#customer-journey"><span class="secno">5.2.1 </span>Customer Journey</a></li><li class="tocline"><a class="tocxref" href="#high-level-api-flow"><span class="secno">5.2.2 </span>High-level API flow</a></li><li class="tocline"><a class="tocxref" href="#leasing"><span class="secno">5.2.3 </span>Leasing</a></li><li class="tocline"><a class="tocxref" href="#high-level-type-flow"><span class="secno">5.2.4 </span>High-level type flow</a></li><li class="tocline"><a class="tocxref" href="#order-statuses"><span class="secno">5.2.5 </span>Order statuses</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#order-statuses-in-the-booking-system"><span class="secno">5.2.5.1 </span>Order statuses in the Booking System</a></li><li class="tocline"><a class="tocxref" href="#order-statuses-in-the-broker"><span class="secno">5.2.5.2 </span>Order statuses in the Broker</a></li></ol></li><li class="tocline"><a class="tocxref" href="#step-by-step-process-description"><span class="secno">5.2.6 </span>Step-by-step process description</a></li><li class="tocline"><a class="tocxref" href="#booking-flow-rollback"><span class="secno">5.2.7 </span>Booking Flow Rollback</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#booking-halted-at-ordercreationpaymentcaptured"><span class="secno">5.2.7.1 </span>Booking halted at OrderCreationPaymentCaptured</a></li><li class="tocline"><a class="tocxref" href="#booking-halted-at-ordercreationpaymentdue"><span class="secno">5.2.7.2 </span>Booking halted at OrderCreationPaymentDue</a></li><li class="tocline"><a class="tocxref" href="#booking-halted-at-ordercreationpaymentauthorized"><span class="secno">5.2.7.3 </span>Booking halted at OrderCreationPaymentAuthorized</a></li></ol></li><li class="tocline"><a class="tocxref" href="#contracts"><span class="secno">5.2.8 </span>Contracts</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#broker-contract-with-booking-system"><span class="secno">5.2.8.1 </span>Broker contract with Booking System</a></li><li class="tocline"><a class="tocxref" href="#booking-system-contract-with-the-broker"><span class="secno">5.2.8.2 </span>Booking System contract with the Broker</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#booking-flow-with-approval"><span class="secno">5.3 </span>Booking Flow with Approval</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#customer-journey-0"><span class="secno">5.3.1 </span>Customer Journey</a></li><li class="tocline"><a class="tocxref" href="#high-level-api-flow-0"><span class="secno">5.3.2 </span>High-level API flow</a></li><li class="tocline"><a class="tocxref" href="#leasing-0"><span class="secno">5.3.3 </span>Leasing</a></li><li class="tocline"><a class="tocxref" href="#high-level-type-flow-0"><span class="secno">5.3.4 </span>High-level type flow</a></li><li class="tocline"><a class="tocxref" href="#orderproposal-statuses"><span class="secno">5.3.5 </span>OrderProposal statuses</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#minimal-implementation"><span class="secno">5.3.5.1 </span>Minimal Implementation</a><ol class="toc"></ol></li><li class="tocline"><a class="tocxref" href="#proposal-amendment"><span class="secno">5.3.5.2 </span>Proposal Amendment</a></li><li class="tocline"><a class="tocxref" href="#message-exchange"><span class="secno">5.3.5.3 </span>Message Exchange</a></li></ol></li><li class="tocline"><a class="tocxref" href="#step-by-step-process-description-0"><span class="secno">5.3.6 </span>Step-by-step process description</a></li><li class="tocline"><a class="tocxref" href="#contract"><span class="secno">5.3.7 </span>Contract</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#broker-contract-with-booking-system-0"><span class="secno">5.3.7.1 </span>Broker contract with Booking System</a></li><li class="tocline"><a class="tocxref" href="#booking-system-contract-with-the-broker-0"><span class="secno">5.3.7.2 </span>Booking System contract with the Broker</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#customer-details-and-additional-details-capture"><span class="secno">5.4 </span>Customer Details and Additional Details capture</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#customer-details"><span class="secno">5.4.1 </span>Customer Details</a></li><li class="tocline"><a class="tocxref" href="#attendee-details"><span class="secno">5.4.2 </span>Attendee Details</a></li><li class="tocline"><a class="tocxref" href="#additional-details"><span class="secno">5.4.3 </span>Additional Details</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#broker-roles"><span class="secno">6. </span>Broker Roles</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#resellerbroker"><span class="secno">6.1 </span><code>ResellerBroker</code></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition"><span class="secno">6.1.1 </span>Definition</a></li><li class="tocline"><a class="tocxref" href="#contractual-relationships"><span class="secno">6.1.2 </span>Contractual Relationships</a></li><li class="tocline"><a class="tocxref" href="#taxation"><span class="secno">6.1.3 </span>Taxation</a></li><li class="tocline"><a class="tocxref" href="#scope-of-specification"><span class="secno">6.1.4 </span>Scope of Specification</a></li><li class="tocline"><a class="tocxref" href="#conformance-criteria"><span class="secno">6.1.5 </span>Conformance criteria</a></li></ol></li><li class="tocline"><a class="tocxref" href="#agentbroker"><span class="secno">6.2 </span><code>AgentBroker</code></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition-0"><span class="secno">6.2.1 </span>Definition</a></li><li class="tocline"><a class="tocxref" href="#contractual-relationships-0"><span class="secno">6.2.2 </span>Contractual Relationships</a></li><li class="tocline"><a class="tocxref" href="#taxation-0"><span class="secno">6.2.3 </span>Taxation</a></li><li class="tocline"><a class="tocxref" href="#scope-of-specification-0"><span class="secno">6.2.4 </span>Scope of Specification</a></li><li class="tocline"><a class="tocxref" href="#conformance-criteria-0"><span class="secno">6.2.5 </span>Conformance criteria</a></li><li class="tocline"><a class="tocxref" href="#informed-purchase"><span class="secno">6.2.6 </span>Informed purchase</a></li></ol></li><li class="tocline"><a class="tocxref" href="#nobroker"><span class="secno">6.3 </span><code>NoBroker</code></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition-1"><span class="secno">6.3.1 </span>Definition</a></li><li class="tocline"><a class="tocxref" href="#contractual-relationships-1"><span class="secno">6.3.2 </span>Contractual Relationships</a></li><li class="tocline"><a class="tocxref" href="#taxation-1"><span class="secno">6.3.3 </span>Taxation</a></li><li class="tocline"><a class="tocxref" href="#scope-of-specification-1"><span class="secno">6.3.4 </span>Scope of Specification</a></li><li class="tocline"><a class="tocxref" href="#conformance-criteria-1"><span class="secno">6.3.5 </span>Conformance criteria</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#systems-of-record"><span class="secno">7. </span>Systems of Record</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#roles-and-responsibilities-overview"><span class="secno">7.1 </span>Roles and responsibilities overview</a></li><li class="tocline"><a class="tocxref" href="#invoices-and-tax-receipts"><span class="secno">7.2 </span>Invoices and Tax receipts</a></li><li class="tocline"><a class="tocxref" href="#payments-and-refunds"><span class="secno">7.3 </span>Payments and Refunds</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#virtual-payments"><span class="secno">7.3.1 </span>Virtual payments</a></li><li class="tocline"><a class="tocxref" href="#basic-payment"><span class="secno">7.3.2 </span>Basic <code>Payment</code></a></li><li class="tocline"><a class="tocxref" href="#dynamicpayment"><span class="secno">7.3.3 </span><code>DynamicPayment</code></a></li><li class="tocline"><a class="tocxref" href="#payment-reconciliation"><span class="secno">7.3.4 </span>Payment reconciliation</a></li><li class="tocline"><a class="tocxref" href="#integrated-payments"><span class="secno">7.3.5 </span>Integrated Payments</a></li></ol></li><li class="tocline"><a class="tocxref" href="#tax-calculation"><span class="secno">7.4 </span>Tax calculation</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#business-to-consumer-tax-calculation-by-booking-system-is-mandatory"><span class="secno">7.4.1 </span>Business-to-consumer tax calculation by Booking System is mandatory</a></li><li class="tocline"><a class="tocxref" href="#business-to-business-tax-calculation-by-booking-system-is-optional"><span class="secno">7.4.2 </span>Business-to-business tax calculation by Booking System is optional</a></li></ol></li><li class="tocline"><a class="tocxref" href="#tax-mode"><span class="secno">7.5 </span>Tax mode</a></li><li class="tocline"><a class="tocxref" href="#free-opportunities"><span class="secno">7.6 </span>Free opportunities</a></li><li class="tocline"><a class="tocxref" href="#offer-overrides"><span class="secno">7.7 </span>Offer overrides</a></li></ol></li><li class="tocline"><a class="tocxref" href="#order-operations"><span class="secno">8. </span>Order Operations</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition-of-an-open-booking-bookable-opportunity-and-offer-pair"><span class="secno">8.1 </span>Definition of an Open Booking 'bookable' Opportunity and Offer pair</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#booking-restrictions"><span class="secno">8.1.1 </span>Booking restrictions</a></li></ol></li><li class="tocline"><a class="tocxref" href="#amending-the-orderquote-before-b"><span class="secno">8.2 </span>Amending the OrderQuote before <span class="formerLink" data-link-type="dfn"><b>B</b></span></a></li><li class="tocline"><a class="tocxref" href="#cancellation-after-b"><span class="secno">8.3 </span>Cancellation after <span class="formerLink" data-link-type="dfn"><b>B</b></span></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#refund-after-the-opportunity-has-occurred"><span class="secno">8.3.1 </span>Refund after the opportunity has occurred</a></li><li class="tocline"><a class="tocxref" href="#customer-requested-cancellation"><span class="secno">8.3.2 </span>Customer requested cancellation</a></li><li class="tocline"><a class="tocxref" href="#seller-requested-cancellation"><span class="secno">8.3.3 </span>Seller requested cancellation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#orders-feed-notifications-updates-and-refunds"><span class="secno">8.4 </span>Orders feed: Notifications, updates and refunds</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#orders-feed-inconsistencies"><span class="secno">8.4.1 </span>Orders Feed Inconsistencies</a></li><li class="tocline"><a class="tocxref" href="#order-stores-with-eventual-consistency"><span class="secno">8.4.2 </span>Order stores with eventual consistency</a></li><li class="tocline"><a class="tocxref" href="#booking-system-updating-the-orders-feed"><span class="secno">8.4.3 </span>Booking System: Updating the Orders feed</a></li><li class="tocline"><a class="tocxref" href="#broker-processing-the-orders-feed"><span class="secno">8.4.4 </span>Broker: Processing the Orders feed</a></li><li class="tocline"><a class="tocxref" href="#new-orders-and-orderproposals"><span class="secno">8.4.5 </span>New <code>Order</code>s and <code>OrderProposal</code>s</a></li><li class="tocline"><a class="tocxref" href="#cancellation-refund-calculation-and-notification"><span class="secno">8.4.6 </span>Cancellation, refund calculation and notification</a></li><li class="tocline"><a class="tocxref" href="#partial-refunds-and-out-of-band-arrangements"><span class="secno">8.4.7 </span>Partial Refunds and out-of-band arrangements</a></li><li class="tocline"><a class="tocxref" href="#change-of-logistics-notifications"><span class="secno">8.4.8 </span>Change of logistics notifications</a></li></ol></li><li class="tocline"><a class="tocxref" href="#amending-the-order-after-b"><span class="secno">8.5 </span>Amending the Order after <span class="formerLink" data-link-type="dfn"><b>B</b></span></a></li><li class="tocline"><a class="tocxref" href="#delivery-of-terms-and-conditions-and-privacy-policy"><span class="secno">8.6 </span>Delivery of Terms and Conditions and Privacy Policy</a></li><li class="tocline"><a class="tocxref" href="#access-control"><span class="secno">8.7 </span>Access control</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#text-based-access-control"><span class="secno">8.7.1 </span>Text-based access control</a></li><li class="tocline"><a class="tocxref" href="#image-based-access-control"><span class="secno">8.7.2 </span>Image-based access control</a></li><li class="tocline"><a class="tocxref" href="#extension-point-for-barcode-based-access-control"><span class="secno">8.7.3 </span>Extension point for barcode-based access control</a></li></ol></li><li class="tocline"><a class="tocxref" href="#general-extension-mechanism"><span class="secno">8.8 </span>General extension mechanism</a></li></ol></li><li class="tocline"><a class="tocxref" href="#endpoints"><span class="secno">9. </span>Endpoints</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#paths-and-verbs"><span class="secno">9.1 </span>Paths and Verbs</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#order-endpoint-restful-semantics"><span class="secno">9.1.1 </span>Order Endpoint RESTful Semantics</a></li></ol></li><li class="tocline"><a class="tocxref" href="#request-and-response"><span class="secno">9.2 </span>Request and Response</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#orderquote-creation-c1"><span class="secno">9.2.1 </span>OrderQuote Creation C1</a></li><li class="tocline"><a class="tocxref" href="#orderquote-creation-c2"><span class="secno">9.2.2 </span>OrderQuote Creation C2</a></li><li class="tocline"><a class="tocxref" href="#orderquote-deletion"><span class="secno">9.2.3 </span>OrderQuote Deletion</a></li><li class="tocline"><a class="tocxref" href="#orderproposal-creation-p"><span class="secno">9.2.4 </span>OrderProposal Creation P</a></li><li class="tocline"><a class="tocxref" href="#orderproposal-update"><span class="secno">9.2.5 </span>OrderProposal Update</a></li><li class="tocline"><a class="tocxref" href="#order-creation-b"><span class="secno">9.2.6 </span>Order Creation B</a></li><li class="tocline"><a class="tocxref" href="#order-deletion"><span class="secno">9.2.7 </span>Order Deletion</a></li><li class="tocline"><a class="tocxref" href="#order-cancellation"><span class="secno">9.2.8 </span>Order Cancellation</a></li><li class="tocline"><a class="tocxref" href="#orders-rpde-feed"><span class="secno">9.2.9 </span>Orders RPDE feed</a></li><li class="tocline"><a class="tocxref" href="#order-status"><span class="secno">9.2.10 </span>Order Status</a></li><li class="tocline"><a class="tocxref" href="#url-discovery"><span class="secno">9.2.11 </span>URL discovery</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#model"><span class="secno">10. </span>Model</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#order-model"><span class="secno">10.1 </span>Order Model</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#schema-order"><span class="secno">10.1.1 </span><code>schema:Order</code></a></li><li class="tocline"><a class="tocxref" href="#oa-orderquote"><span class="secno">10.1.2 </span><code>oa:OrderQuote</code></a></li><li class="tocline"><a class="tocxref" href="#oa-orderproposal"><span class="secno">10.1.3 </span><code>oa:OrderProposal</code></a></li><li class="tocline"><a class="tocxref" href="#schema-organization-for-seller"><span class="secno">10.1.4 </span><code>schema:Organization</code> for <code>seller</code></a></li><li class="tocline"><a class="tocxref" href="#schema-organization-for-broker"><span class="secno">10.1.5 </span><code>schema:Organization</code> for <code>broker</code></a></li><li class="tocline"><a class="tocxref" href="#schema-orderitem"><span class="secno">10.1.6 </span><code>schema:OrderItem</code></a></li><li class="tocline"><a class="tocxref" href="#schema-offer"><span class="secno">10.1.7 </span><code>schema:Offer</code></a></li><li class="tocline"><a class="tocxref" href="#schema-offeroverride"><span class="secno">10.1.8 </span><code>schema:OfferOverride</code></a></li><li class="tocline"><a class="tocxref" href="#schema-person"><span class="secno">10.1.9 </span><code>schema:Person</code></a></li><li class="tocline"><a class="tocxref" href="#schema-organization-for-customer"><span class="secno">10.1.10 </span><code>schema:Organization</code> for <code>customer</code></a></li><li class="tocline"><a class="tocxref" href="#schema-postaladdress"><span class="secno">10.1.11 </span><code>schema:PostalAddress</code></a></li><li class="tocline"><a class="tocxref" href="#oa-lease"><span class="secno">10.1.12 </span><code>oa:Lease</code></a></li><li class="tocline"><a class="tocxref" href="#schema-pricespecification"><span class="secno">10.1.13 </span><code>schema:PriceSpecification</code></a></li><li class="tocline"><a class="tocxref" href="#oa-taxchargespecification"><span class="secno">10.1.14 </span><code>oa:TaxChargeSpecification</code></a></li><li class="tocline"><a class="tocxref" href="#oa-payment"><span class="secno">10.1.15 </span><code>oa:Payment</code></a></li><li class="tocline"><a class="tocxref" href="#oa-dynamicpayment"><span class="secno">10.1.16 </span><code>oa:DynamicPayment</code></a></li><li class="tocline"><a class="tocxref" href="#oa-bookingservice"><span class="secno">10.1.17 </span><code>oa:BookingService</code></a></li><li class="tocline"><a class="tocxref" href="#oa-terms"><span class="secno">10.1.18 </span><code>oa:Terms</code></a></li><li class="tocline"><a class="tocxref" href="#oa-privacypolicy"><span class="secno">10.1.19 </span><code>oa:PrivacyPolicy</code></a></li><li class="tocline"><a class="tocxref" href="#oa-termsofuse"><span class="secno">10.1.20 </span><code>oa:TermsOfUse</code></a></li></ol></li><li class="tocline"><a class="tocxref" href="#error-model"><span class="secno">10.2 </span>Error Model</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#oa-openbookingerror"><span class="secno">10.2.1 </span><code>oa:OpenBookingError</code></a></li><li class="tocline"><a class="tocxref" href="#oa-openbookingerror-subclasses"><span class="secno">10.2.2 </span><code>oa:OpenBookingError</code> subclasses</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#order-creation-orderquote-and-order-error-responses"><span class="secno">10.2.2.1 </span>Order Creation - <code>OrderQuote</code> and <code>Order</code> error responses</a></li><li class="tocline"><a class="tocxref" href="#order-cancellation-orderquote-and-order-error-responses"><span class="secno">10.2.2.2 </span>Order Cancellation - <code>OrderQuote</code> and <code>Order</code> error responses</a></li><li class="tocline"><a class="tocxref" href="#order-creation-orderitem-errors"><span class="secno">10.2.2.3 </span>Order Creation - <code>OrderItem</code> errors</a></li><li class="tocline"><a class="tocxref" href="#api-authentication"><span class="secno">10.2.2.4 </span>API authentication</a></li><li class="tocline"><a class="tocxref" href="#technical-errors"><span class="secno">10.2.2.5 </span>Technical errors</a></li><li class="tocline"><a class="tocxref" href="#generic-errors"><span class="secno">10.2.2.6 </span>Generic errors</a></li></ol></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#common-requirements"><span class="secno">11. </span>Common Requirements</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#media-types"><span class="secno">11.1 </span>Media types</a></li><li class="tocline"><a class="tocxref" href="#response-formats"><span class="secno">11.2 </span>Response formats</a></li><li class="tocline"><a class="tocxref" href="#errors"><span class="secno">11.3 </span>Errors</a></li><li class="tocline"><a class="tocxref" href="#rate-limiting"><span class="secno">11.4 </span>Rate Limiting</a></li><li class="tocline"><a class="tocxref" href="#security"><span class="secno">11.5 </span>Security</a></li><li class="tocline"><a class="tocxref" href="#authentication"><span class="secno">11.6 </span>Authentication</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#api-level-authentication-and-data-security"><span class="secno">11.6.1 </span>API level authentication and data security</a></li><li class="tocline"><a class="tocxref" href="#broker-and-authenticating-party"><span class="secno">11.6.2 </span>Broker and Authenticating Party</a></li><li class="tocline"><a class="tocxref" href="#customer-level-authentication"><span class="secno">11.6.3 </span><span class="formerLink" data-link-type="dfn">Customer</span> level authentication</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#future-versions-of-this-api"><span class="secno">12. </span>Future versions of this API</a></li><li class="tocline"><a class="tocxref" href="#acknowledgements"><span class="secno">A. </span>Acknowledgements</a></li><li class="tocline"><a class="tocxref" href="#references"><span class="secno">B. </span>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><span class="secno">B.1 </span>Normative references</a></li></ol></li></ol></nav><section class="informative" id="introduction"><!--OddPage--><h2 id="x1-introduction"><span class="secno">1. </span>Introduction<a class="self-link" aria-label="§" href="#introduction"></a></h2><p><em>This section is non-normative.</em></p><p>The document is an output of the
<a href="https://www.w3.org/community/openactive/">OpenActive Community Group</a>. As part
of the <a href="https://openactive.io">OpenActive</a> initiative, the community group is
developing standards that will promote the publication and use of open
<a href="https://openactive.io/modelling-opportunity-data/#categories-of-physical-activity-data">opportunity data</a>
in helping people to become more physically active.</p><p>The Community Group have already published specifications that define standard
data models ([<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>]) and support the publication and
harvesting of data in standard formats ([<cite><a class="bibref" href="#bib-rpde">RPDE</a></cite>]). This existing work helps increase the discovery of opportunities for people to
be active.</p><p><dfn data-dfn-type="dfn" data-plurals="opportunity" id="dfn-opportunities">Opportunities</dfn> to be active (e.g. "Yoga Tuesday 14th 7pm"), which include <code>SessionSeries</code>, <code>FacilityUse</code> and <code>Slot</code> and their associated <code>Offer</code>s (e.g. "Junior (8-18) £9"), are both defined by this existing work.</p><p>This specification builds on that work by defining an HTTP API that
can be implemented by <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> that are publishing opportunity data. By
allowing third-party applications ("<a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a>"). to place bookings in their systems, it becomes
possible for more people to participate in events or make use of leisure and
sporting facilities.</p><p>The specification defines the flow of HTTP requests and responses between the
<a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> (server) and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> (client). This includes
definitions of the overall application flow, detailed request and response
formats and the potential error conditions that applications may encounter.</p><section id="scope-and-requirements"><h3 id="x1-1-scope-and-requirements"><span class="secno">1.1 </span>Scope and requirements<a class="self-link" aria-label="§" href="#scope-and-requirements"></a></h3><p>The current scope of the specification should conform to a set of
<a href="https://docs.google.com/document/d/1fsCr071V12i_2g0DK818OAGlEAJFLWwkBp9bpgx4fo8/edit?usp=sharing">use cases and requirements</a>
that have previously been identified and discussed with the OpenActive
community.</p><p>The focus of the initial versions of this specification will be on the simplest use cases that will support making bookings on behalf of users.</p><p>The core functionality includes:</p><ul>
<li><strong>Guest checkout</strong> – making a booking on behalf of a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> who is assumed to be unknown to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, and who does not expect a persistent account to be created for them with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</li>
<li><strong>Pricing and availability</strong> – checking the price and current availabilty of an event or for the use of a facility.</li>
<li><strong>Booking</strong> – recording bookings in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</li>
<li><strong>Tax</strong> – tax calculation by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> exposed to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</li>
<li><strong>Multiple order items</strong> - handling bookings for multiple events ("shopping carts") and for groups of users.</li>
<li><strong>Child booking</strong> - booking on behalf of a child.</li>
<li><strong>Dynamic pricing</strong> – allowing the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to vary pricing, where agreed with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</li>
<li><strong>Cancellation</strong> – <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> initiated cancellation .</li>
<li><strong>Access control</strong> - text, images and barcodes that can be used by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> to access the activity.</li>
</ul><p>Additional optional functionality includes:</p><ul>
<li><strong>Leasing</strong> – temporarily reserving spaces for a user to attend an event or
make use of a facility, whilst placing a booking.</li>
<li><strong>Booking approval</strong> – optional approval for <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> that support or require approval for bookings.</li>
</ul><section id="out-of-scope-in-this-version"><h4 id="x1-1-1-out-of-scope-in-this-version"><span class="secno">1.1.1 </span>Out of Scope in this version<a class="self-link" aria-label="§" href="#out-of-scope-in-this-version"></a></h4><p>A number of additional requirements that relate to the booking of events and facilities are currently out of scope:</p><ul>
<li>creating and managing accounts for <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a></li>
<li>more complex pricing options, e.g. membership-based pricing</li>
<li>waiting lists for events</li>
<li>collecting marketing preferences from the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a></li>
<li>business-to-business tax calculation</li>
<li>cancellation fees</li>
<li>"subscriptions" to allow a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> to participate ad-hoc in a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>'s activity, with such participation recorded for later reconciliation</li>
<li>refunds/cancellations after the opportunity has occurred
</li>
<li>back-office systems between <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, such as for payment reconciliation</li>
<li>fine-grained control of opportunity bookability in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a></li>
</ul><p>It is possible that future versions of this specification may include support
for these or other features. Revisions will be driven by the needs of the
community, please raise feature requests via <a href="https://github.com/openactive/open-booking-api">GitHub</a>.</p></section><section id="out-of-scope-by-design"><h4 id="x1-1-2-out-of-scope-by-design"><span class="secno">1.1.2 </span>Out of Scope by design<a class="self-link" aria-label="§" href="#out-of-scope-by-design"></a></h4><p>By design this specification will not define some types of functionality.</p><p>These have been declared as permanently out of scope because they are either
adequately covered by existing specifications, or will be covered by future
work of the OpenActive Community Group.</p><p>The functionality that is currently defined as out of scope includes:</p><ul>
<li><strong>API authentication and security</strong> – while the specification recommends some best practices relating to authentication and security it does not mandate a specific means of securing an API. Implementers are free to choose the system that offers the best security for their platform and users.</li>
<li><strong>Payment processing</strong> – the design assumes that all payment handling will be coordinated by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, in a separate payment flow. <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a> are able to use the payment and reconciliation mechanisms that provide the best options for their <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Sellers</a> and <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a>.</li>
<li><strong>API business models</strong> – the design is agnostic to any business models that might govern the use or provision of the API, e.g. revenue-sharing or transaction processing fees.</li>
<li><strong>Opportunity discovery</strong>  – finding, filtering and searching for opportunity data. This specification assumes that the client and server applications have already shared data about the relevant opportunities, e.g. via an [<cite><a class="bibref" href="#bib-rpde">RPDE</a></cite>] feed containing [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>] data.</li>
<li><strong>API endpoint discovery</strong>  – the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> finding and connecting to the API endpoints included in this specification are included in the [<cite><a class="bibref" href="#bib-dataset-api-discovery">Dataset-API-Discovery</a></cite>] specification.</li>
</ul></section></section><section id="specification-dependencies"><h3 id="x1-2-specification-dependencies"><span class="secno">1.2 </span>Specification dependencies<a class="self-link" aria-label="§" href="#specification-dependencies"></a></h3><p>Version 1.0 of the Open Booking specification depends on the following:</p><ul>
<li>[<cite><a class="bibref" href="#bib-rpde">RPDE</a></cite>] Version 1.x</li>
<li>[<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>] Version 2.x</li>
</ul><p>Note that the versions are constrained only to major version releases (breaking changes), and that the flexibility provided by supporting minor versions enables implementors to take advantage of additional features as the specifications evolve.</p><div class="issue" id="issue-container-number-105"><div role="heading" class="issue-title marker" id="h-issue" aria-level="4"><a href="https://github.com/openactive/open-booking-api/issues/105"><span class="issue-number">Issue 105</span></a><span class="issue-label" aria-label="This issue is labelled as Community Feedback Requested.">: Versioning across specifications <a class="respec-gh-label respec-label-light" href="https://github.com/openactive/open-booking-api/issues/?q=is%3Aissue+is%3Aopen+label%3A%22Community+Feedback+Requested%22" style="background-color: rgb(150, 224, 234);">Community Feedback Requested</a></span></div><p>There are a number of specifications that relate to each other, with versions that exist across each.</p>
<p>Should we have one unified version number or separate versions with dependencies?</p>
<h2 id="versions-for-conformance">Versions for conformance<a class="self-link" aria-label="§" href="#issue-container-number-105"></a></h2>
<p>There's an advantage in a common versioning pattern for specifications, similar to the .NET Standard it allows all actors to understand what version of a specification to request and support.</p>
<h2 id="version-for-interoperability">Version for interoperability<a class="self-link" aria-label="§" href="#issue-container-number-105"></a></h2>
<p>The goal of having a custom media type is to advertise the request/response formats (e.g. <code>vnd.openactive.booking+json; version=2</code>. Having a version number allows clients and servers to advertise what version they support (or are trying to use) and possibly negotiate on a preferred version if a server supported both.</p>
<h2 id="options-for-the-version-number">Options for the version number<a class="self-link" aria-label="§" href="#issue-container-number-105"></a></h2>
<h3 id="x1-versioned-dependencies">1. Versioned dependencies<a class="self-link" aria-label="§" href="#issue-container-number-105"></a></h3>
<p><em>The version number is the version of the specific specification (varies for each spec)</em></p>
<p>The Open Booking specification could normatively refer to a version of the Model spec (Booking 1.0 uses Model 2.x) and a version of the RDPE spec (Booking 1.0 requires an RPDE 1.x feed containing Orders which conforms to the Booking 1.x model).</p>
<p>For data publishing, RPDE doesn't normatively require a version of the model spec. It's a generic protocol that can carry different formats, so the data user would need to get that information from the feed, and couldn't request a different version of the model using media types, but would need to check each open feed URL for the version they were looking for.</p>
<p>So dependencies don't need to be advertised in the media type, as they can be inferred by the primary specification in the case of booking (Booking 1.0 with Model 3.0, and Booking 1.0 with RDPE 2.0 aren't valid choices) or from the feed in the case of data publishing.</p>
<p>This means that a server <em>could</em> offer an RPDE 2.0 feed in addition to a 1.0 feed.</p>
<h3 id="x2-single-platform-version">2. Single platform version<a class="self-link" aria-label="§" href="#issue-container-number-105"></a></h3>
<p><em>The version number is the version of the "platform" (one unified version number)</em></p>
<p>One overall media type (<code>vnd.openactive.booking+json; version=2</code>) with the version representing a single version for all of OpenActive specifications. This means that we lose some ability for separate evolution/updates (e.g. I can't ask you for an RPDE 2.0 feed on its own), but instead have a guarantee about what features are supported across all endpoints for a particular version.</p>
<p>So as a data user working with <code>vnd.openactive.rpde+json; version=2</code> you could be sure that at least a minimum set of fields would be included (as you could infer the minimum Model version supported), and the same for <code>vnd.openactive.booking+json; version=2</code>.</p>
<p>This makes validation of conformance easier as it limits the number of valid configurations. Experimentation could still be possible via <code>vnd.openactive.booking+json; version=next</code>, <code>vnd.openactive.booking+json; version=2.1CR</code> or similar</p></div></section><section id="audience"><h3 id="x1-3-audience"><span class="secno">1.3 </span>Audience<a class="self-link" aria-label="§" href="#audience"></a></h3><p>The document is primarily intended for the following audiences:</p><ul>
<li>Software developers who want to implement the API, e.g. as part of a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a></li>
<li>Software developers building client libraries or tools</li>
<li>Software developers writing applications that will use the API ("<a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a>")
</li>
</ul><p>The following sections introduce terminology, concepts and requirements that
underpin the design of the API. This content might also be useful for a wider
audience, e.g. business analysts or product managers looking for a high-level
overview of the API functionality.</p></section></section><section id="conformance"><!--OddPage--><h2 id="x2-conformance"><span class="secno">2. </span>Conformance<a class="self-link" aria-label="§" href="#conformance"></a></h2><p>
      As well as sections marked as non-normative, all authoring guidelines,
      diagrams, examples, and notes in this specification are non-normative.
      Everything else in this specification is normative.
    </p><p>
            The key words <em class="rfc2119">MAY</em>, <em class="rfc2119">MUST</em>, <em class="rfc2119">MUST NOT</em>, <em class="rfc2119">NOT RECOMMENDED</em>, <em class="rfc2119">NOT REQUIRED</em>, <em class="rfc2119">OPTIONAL</em>, <em class="rfc2119">RECOMMENDED</em>, <em class="rfc2119">REQUIRED</em>, <em class="rfc2119">SHOULD</em>, and <em class="rfc2119">SHOULD NOT</em>
            are to be interpreted as described in
            [<cite><a class="bibref" href="#bib-rfc2119">RFC2119</a></cite>].
          </p><p>This specification makes use of the compact IRI Syntax; please refer to the
<a href="https://www.w3.org/TR/json-ld/#compact-iris">Compact IRIs</a> section from [<cite><a class="bibref" href="#bib-json-ld">JSON-LD</a></cite>].</p></section><section id="typographical-conventions"><!--OddPage--><h2 id="x3-typographical-conventions"><span class="secno">3. </span>Typographical Conventions<a class="self-link" aria-label="§" href="#typographical-conventions"></a></h2><p>The following typographic conventions are used in this specification:</p><dl class="typography">
<dt><code>markup</code></dt>
<dd>Markup (elements, attributes, properties), machine processable
values (string, characters, media types), property name, or a
file name is in a monospace font.</dd>
<dt><a href="#" class="internalDFN respec-offending-element" title="Linter (local-refs-exist): Broken local reference found in document. Please fix the links mentioned. See developer console. Occured" id="respec-offender-linter-local-refs-exist-broken-local-reference-found-in-document-please-fix-the-links-mentioned-see-developer-console-occured">Definition</a></dt>
<dd>A definition of a term, to be used elsewhere in this or other
specifications, is underlined and in black.</dd>
<dt><a href="">hyperlink</a></dt>
<dd>A hyperlink is underlined and in blue.</dd>
<dt>[<a href="">reference</a>]</dt>
<dd>A document reference (normative or informative) is enclosed in
square brackets and links to the references section.</dd>
</dl><div class="note" role="note" id="issue-container-generatedID-0"><div role="heading" class="note-title marker" id="h-note-0" aria-level="3"><span>Note</span></div><div class=""><p>Notes are in light green boxes with a green left border and with a "Note"
header in green. Notes are normative or informative depending on the whether
they are in a normative or informative section, respectively.</p>
</div></div><div class="example" id="example-1">
          <div class="marker">
      <a class="self-link" href="#example-1">Example 1</a>
    </div> <pre aria-busy="false"><code class="hljs javascript">Examples are <span class="hljs-keyword">in</span> light khaki boxes, <span class="hljs-keyword">with</span> khaki left border, and <span class="hljs-keyword">with</span> a
numbered <span class="hljs-string">"Example"</span> header <span class="hljs-keyword">in</span> khaki. Examples are always informative.
The content <span class="hljs-keyword">of</span> the example is <span class="hljs-keyword">in</span> monospace font and may be syntax colored.</code></pre>
        </div></section><section id="key-actors"><!--OddPage--><h2 id="x4-key-actors"><span class="secno">4. </span>Key Actors<a class="self-link" aria-label="§" href="#key-actors"></a></h2><p>Of all the organisations and systems involved in a transaction, the API defined
by this specification is scoped tightly to only specify interactions between the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and
<a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, with high level prompts for interactions with <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a> and <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Providers</a>.</p><figure id="fig-illustration-of-actors-and-systems-involved-in-a-transaction-and-the-focus-of-this-specification-being-between-broker-and-booking-system"><img src="actors.png" alt="Actors in scope" height="314" width="696">
<figcaption>Figure <span class="figno">1</span> <span class="fig-title">Illustration of actors and systems involved in a transaction, and the focus
of this specification being between <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</span></figcaption>
</figure><dl class="typography">
<dt><dfn data-dfn-type="dfn" data-plurals="customers" id="dfn-customer">Customer</dfn></dt>
<dd>The user who places a booking using an application provided by a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>. The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> is not necessarily the attendee, so e.g. a parent may book on behalf of their child.</dd>
<dt><dfn data-dfn-type="dfn" data-plurals="brokers" id="dfn-broker">Broker</dfn></dt>
<dd>The organisation or developer providing an application that allows <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a> to make bookings. Those applications will be clients of the API defined in this specification</dd>
<dt><dfn data-dfn-type="dfn" data-plurals="booking systems" id="dfn-booking-system">Booking System</dfn></dt>
<dd>The organisation or developer providing an application that maintains bookable inventory on behalf of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>. The platform or service that provides a server-side implementation of this API.
</dd>
<dt><dfn data-dfn-type="dfn" data-plurals="sellers" id="dfn-seller">Seller</dfn></dt>
<dd>The organisation providing access to events or facilities via a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>. e.g. a leisure provider running yoga classes.</dd>
<dt><dfn data-dfn-type="dfn" data-plurals="payment providers" id="dfn-payment-provider">Payment Provider</dfn></dt>
<dd>The notional service providing payment processing between the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>. Although this specification refers to the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a> as a single notional service, it may in reality be composed of multiple connected services providing the same functionality to allow for the widest variety of business models.</dd>
</dl></section><section class="normative" id="booking-flows"><!--OddPage--><h2 id="x5-booking-flows"><span class="secno">5. </span>Booking Flows<a class="self-link" aria-label="§" href="#booking-flows"></a></h2><p>This specification includes two main booking flows: a <a href="#simple-booking-flow">Simple Booking Flow</a>, and a <a href="#booking-flow-with-approval">Booking Flow with Approval</a> that builds on the <a href="#simple-booking-flow">Simple Booking Flow</a>. Both have the same set of pre-conditions.</p><section id="booking-pre-conditions"><h3 id="x5-1-booking-pre-conditions"><span class="secno">5.1 </span>Booking pre-conditions<a class="self-link" aria-label="§" href="#booking-pre-conditions"></a></h3><p>In order to enter either of the booking flows described in this specification, the following pre-conditions must be met:</p><ul>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> obtain opportunity data that includes descriptions of <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunities</a>, by frequently harvesting data via opportunity data [<cite><a class="bibref" href="#bib-rpde">RPDE</a></cite>] open feeds provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</p>
</li>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> present an up-to-date view of availability data for the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> to select items to book, as this data may change over time.</p>
</li>
<li><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> ensure that the <code>remainingAttendeeCapacity</code> and <code>remainingUses</code> properties in the opportunity data are up-to-date.</p>
</li>
<li><p>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> have selected at least one <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a> pair of an <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> ("Yoga Tuesday 14th 7pm") with an associated <code>Offer</code> ("Junior (8-18) £9"). These pairs populate the <code>orderedItem</code> and <code>acceptedOffer</code> properties within the submitted <code>OrderItem</code>s, respectively.</p>
</li>
<li><p>It is not possible for opportunities from different <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Sellers</a> or with different <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a> or on behalf of different <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a> to be combined in the same <code>Order</code>.</p>
</li>
</ul></section><section id="simple-booking-flow"><h3 id="x5-2-simple-booking-flow"><span class="secno">5.2 </span>Simple Booking Flow<a class="self-link" aria-label="§" href="#simple-booking-flow"></a></h3><section id="customer-journey"><h4 id="x5-2-1-customer-journey"><span class="secno">5.2.1 </span>Customer Journey<a class="self-link" aria-label="§" href="#customer-journey"></a></h4><p>The booking journey of a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> is generalised into the following logical steps:</p><figure id="fig-illustration-of-a-typical-customer-journey"><img src="userjourney.png" alt="High level user journey" height="141" width="939">
<figcaption>Figure <span class="figno">2</span> <span class="fig-title">Illustration of a typical <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> journey.</span></figcaption>
</figure><ol>
<li><strong>Select</strong>: <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> selects at least one <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> (e.g. <code>ScheduledSession</code> or <code>Slot</code>) and an associated <code>Offer</code> ("Junior (8-18) £9")</li>
<li><strong>Identify</strong>: <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> submits personal details and other requested details</li>
<li><strong>Book and Pay</strong>: <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> submits payment details</li>
</ol><p>Note that some or all steps may be skipped, or may not be presented to the user, e.g. if their registration or payment details are already known, or they are using a voice interface. These steps are not indicative of the user experience, and simply provide a common language around the flow.</p></section><section id="high-level-api-flow"><h4 id="x5-2-2-high-level-api-flow"><span class="secno">5.2.2 </span>High-level API flow<a class="self-link" aria-label="§" href="#high-level-api-flow"></a></h4><figure id="fig-illustration-of-high-level-booking-flow"><img src="bookingflow.png" alt="High level booking flow" height="667" width="866">
<figcaption>Figure <span class="figno">3</span> <span class="fig-title">Illustration of high level booking flow.</span></figcaption>
</figure><ul>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> generates a <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a> which is used to uniquely identify the <code>Order</code> throughout the process.</p>
</li>
<li><p>After "<strong>1. Select</strong>" the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> calls the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to confirm an indicative price and the availability of the selected items using an <code>OrderQuote</code>, and retrieve a total order price. Any details that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> needs to supply to complete the booking are also specified. This is checkpoint <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> on the diagram above.</p>
</li>
<li><p>After "<strong>2. Identify</strong>" the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> calls the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to reconfirm the price and availability of the selected items using an <code>OrderQuote</code>, using all personal details required, and retrieve a total order price. Explicit consent for any terms and conditions is also captured at this stage if required. This is checkpoint <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> on the diagram above.</p>
</li>
<li><p>After "<strong>3. Book and Pay</strong>", the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> first <em>pre-authorizes</em> the payment for the total order price (if required by the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>), then confirms the booking with the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> using an <code>Order</code> (<a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> on the diagram above), and finally <em>captures</em> the payment. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> then generates invoices, and sends the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> notifications.</p>
</li>
<li><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> adds the <code>Order</code> to an <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> specific to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, which the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> reads to update its internal state, including those updates resulting from cancellations.</p>
</li>
</ul></section><section id="leasing"><h4 id="x5-2-3-leasing"><span class="secno">5.2.3 </span>Leasing<a class="self-link" aria-label="§" href="#leasing"></a></h4><p>Customers may simultaneously attempt to book the same <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> (e.g. space in an event or <code>Slot</code> of a facility), and hence contend with one another for a limited number of opportunities. In order to ensure that items cannot be "stolen" from a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>'s "shopping basket" by another <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, some <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> use the concept of a <dfn data-dfn-type="dfn" id="dfn-lease">lease</dfn>, a temporary reservation that provides a window during which a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> can complete their customer journey and improves the user experience overall.</p><p>The design of this API supports the use of time-bound leases. Using leases is <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em>, however they are not required, in order to ensure a low barrier of entry for implementers of the specification.</p><p>Individually at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> can opt to create (or extend) a lease for the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>. Whether they opt to do so may depend on the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>'s capacity to support leases, or on the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>'s configuration of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.
</p><p>At <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> an <dfn data-dfn-type="dfn" id="dfn-anonymous-lease">anonymous lease</dfn> <em class="rfc2119" title="MAY">MAY</em> be created i.e. a lease for a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> that has not yet provided any personal details.
At <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> a <dfn data-dfn-type="dfn" id="dfn-named-lease">named lease</dfn> <em class="rfc2119" title="MAY">MAY</em> be created i.e. a lease for a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> who has identified themselves via personal details and other additional details. Any existing <a href="#dfn-anonymous-lease" class="internalDFN" data-link-type="dfn">anonymous lease</a> becomes a <a href="#dfn-named-lease" class="internalDFN" data-link-type="dfn">named lease</a> when the customer's personal details are provided (even if the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> does not store them at this stage).</p><p>If a lease is created at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> and/or <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> it is used during <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a>. However, if no lease is created, or if it had expires prior to the transaction being completed, the booking completes anyway provided sufficient inventory is available.</p><p>It is <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> that if the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> supports leasing, it also guarantees the price of each leased item for the duration of the lease, so that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> is guaranteed to pay the price they have seen during <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a>.</p><p>The specification is designed to allow <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>s to be agnostic to leases: should a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> be upgraded to support these, it can do so without affecting the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>'s implementation.</p><p>By design, then, the use of leases is largely transparent to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>. However, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> provide information on the lease to help improve the user experience of the customer journey as follows: when a lease is created, a <code>Lease</code> object <em class="rfc2119" title="MUST">MUST</em> be returned in the <code>OrderQuote</code>.</p><div class="example" id="example-2-example-of-lease">
          <div class="marker">
      <a class="self-link" href="#example-2-example-of-lease">Example 2</a><span class="example-title">: Example of lease</span>
    </div> <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"lease"</span>: {
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"Lease"</span>,
  <span class="hljs-string">"leaseExpires"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>
}</code></pre>
        </div><p>The <code>leaseExpires</code> <em class="rfc2119" title="MAY">MAY</em> be used to inform the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> of the time they have remaining.</p></section><section id="high-level-type-flow"><h4 id="x5-2-4-high-level-type-flow"><span class="secno">5.2.4 </span>High-level type flow<a class="self-link" aria-label="§" href="#high-level-type-flow"></a></h4><figure id="fig-illustration-of-types-used-during-the-api-flow"><img src="typeflow.png" alt="High level type flow" height="181" width="731">
<figcaption>Figure <span class="figno">4</span> <span class="fig-title">Illustration of types used during the API flow.</span></figcaption>
</figure><p>The <code>OrderQuote</code> is an ephemeral draft of the <code>Order</code> while it is being constructed by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</p><ul>
<li><a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> - <code>OrderQuote</code> without enough personal details or additional details to be accepted as an <code>Order</code>.</li>
<li><a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> - <code>OrderQuote</code> with complete and validated detail, enough to be created successfully as an <code>Order</code>.</li>
<li><a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> - <code>Order</code> exists in an instantly successful state in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, though it transitions through <code>orderCreationStatus</code> states in the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</li>
</ul></section><section id="order-statuses"><h4 id="x5-2-5-order-statuses"><span class="secno">5.2.5 </span>Order statuses<a class="self-link" aria-label="§" href="#order-statuses"></a></h4><p>To simplify the implementation for the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, the creation of an <code>Order</code> is considered atomic to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> (it succeeds or fails at once in <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a>), and by contrast is considered to consist of steps to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.
</p><section id="order-statuses-in-the-booking-system"><h5 id="x5-2-5-1-order-statuses-in-the-booking-system"><span class="secno">5.2.5.1 </span>Order statuses in the Booking System<a class="self-link" aria-label="§" href="#order-statuses-in-the-booking-system"></a></h5><p>In this version of the specification the <code>Order</code> within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> have a status, it exists atomically in a successfully created state. Although <code>OrderItem</code>s may be cancelled by either the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> or the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, the <code>Order</code> itself within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> is simply a container. The <code>orderStatus</code> property of the <code>Order</code> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be used and is reserved for future evolution of the specification.</p><p>The <code>orderCreationStatus</code> is maintained by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> only during this flow, and <em class="rfc2119" title="MUST NOT">MUST NOT</em> be sent to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</p></section><section id="order-statuses-in-the-broker"><h5 id="x5-2-5-2-order-statuses-in-the-broker"><span class="secno">5.2.5.2 </span>Order statuses in the Broker<a class="self-link" aria-label="§" href="#order-statuses-in-the-broker"></a></h5><p>Throughout "Book and Pay" section of this flow the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> maintains the <code>orderCreationStatus</code> property in its copy of the <code>Order</code>, which is not sent to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>. This allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to consistently rollback in the case of failure.</p><p>The <code>orderCreationStatus</code> statuses are defined as follows:</p><ol>
<li><a href="https://openactive.io/OrderCreationPaymentAuthorized">https://openactive.io/OrderCreationPaymentAuthorized</a> - after successful <a href="#dfn-payment-authorisation" class="internalDFN" data-link-type="dfn">Payment Authorisation</a></li>
<li><a href="https://openactive.io/OrderCreationPaymentDue">https://openactive.io/OrderCreationPaymentDue</a> - after successful <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a></li>
<li><a href="https://openactive.io/OrderCreationPaymentCaptured">https://openactive.io/OrderCreationPaymentCaptured</a> - after successful <a href="#dfn-payment-capture" class="internalDFN" data-link-type="dfn">Payment Capture</a></li>
<li><a href="https://openactive.io/OrderCreationComplete">https://openactive.io/OrderCreationComplete</a> - after successful <a href="#dfn-invoice-generation" class="internalDFN" data-link-type="dfn">Invoice Generation</a> and <a href="#dfn-customer-notification" class="internalDFN" data-link-type="dfn">Customer Notification</a></li>
</ol><p>An <code>Order</code> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be displayed by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and other operations such as cancellation <em class="rfc2119" title="MUST NOT">MUST NOT</em> be possible until it has reached the <code>orderCreationStatus</code> of <code>https://openactive.io/OrderCreationComplete</code>, after which the <code>orderCreationStatus</code> can be ignored.</p></section></section><section id="step-by-step-process-description"><h4 id="x5-2-6-step-by-step-process-description"><span class="secno">5.2.6 </span>Step-by-step process description<a class="self-link" aria-label="§" href="#step-by-step-process-description"></a></h4><figure id="fig-sequence-diagram-showing-api-interactions"><img src="sequencediagram.png" alt="Sequence diagram" height="720" width="767">
<figcaption>Figure <span class="figno">5</span> <span class="fig-title">Sequence diagram showing API interactions</span></figcaption>
</figure><p>i) "<strong>1. Select</strong>" - User browses <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> site anonymously and adds something to basket</p><ul>
<li><a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> have determined at least one Open Booking <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a> opportunity each with an associated applicable <code>Offer</code> from the user's browsing, using the most up-to-date opportunity data.</li>
<li><a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> generates a UUID to use for the <code>Order</code>.</li>
<li>If any catastrophic failure occurs during the booking flow (any error with status code 500, or when the request consistently returns status code 503 after a number of retries) the UUID <em class="rfc2119" title="MUST">MUST</em> be regenerated to allow for a clean retry of the booking. UUID <em class="rfc2119" title="MUST NOT">MUST NOT</em> be regenerated for expected errors (status code 4xx).</li>
</ul><p>ii) <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> call with <code>OrderQuote</code> including UUID without a <code>customer</code> object to check availability and that the combination of items requested can be purchased, <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> responds with an <code>OrderQuote</code> including any <code>error</code>s against each <code>OrderItem</code>.</p><ul>
<li><a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> creates <a href="#dfn-anonymous-lease" class="internalDFN" data-link-type="dfn">anonymous lease</a> for that UUID if it is supported, otherwise it provides a simple availability and <code>totalPaymentDue</code> confirmation. An <code>OrderQuote</code> response with HTTP Status 200 will be returned if the all requested items are available. If a lease has been created, then the <code>OrderQuote</code> in the response <em class="rfc2119" title="MUST">MUST</em> include a <code>lease</code> property containing a valid <code>Lease</code> object.</li>
<li><code>OrderQuote</code> <em class="rfc2119" title="MUST">MUST</em> include <code>totalPaymentDue</code>, which allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to update any UI with the total.</li>
<li><code>OrderQuote</code> <em class="rfc2119" title="MUST">MUST</em> include a list of <code>OrderItem</code>s which contain their respective <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> objects, including enough detail to allow the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to display information about the <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> (rather than relying on the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> having the most up-to-date <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> data from the open feeds at the point of purchase).</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> ensure that the data returned to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> in the <code>remainingAttendeeCapacity</code> and <code>remainingUses</code> properties are up-to-date, including places already booked and those currently reserved by any leases from competing <code>OrderQuote</code>s.</li>
<li><code>OrderQuote</code> <em class="rfc2119" title="MUST">MUST</em> specify any additional details required to complete the booking for the selected <code>OrderItem</code>s via an <code>orderItemIntakeForm</code>.</li>
<li>If there are any issues with the <code>OrderItem</code>s requested in the <code>OrderQuote</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond with a <code>409 Conflict</code> response, with <code>error</code> details provided against each offending <code>OrderItem</code>.
</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> reflect back all properties defined by this specification that are supplied by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>'s request in its response, including <code>broker</code> and <code>brokerRole</code>, to acknowledge they have been recognised (even if they have not actually been stored by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>). The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> reflect back extension properties outside of this specification unless it explicitly supports them.</li>
<li>Where <code>totalPaymentDue</code> is not <code>0</code>, and the <code>prepayment</code> value of any <code>Offer</code> is <code>https://openactive.io/Required</code> or unspecified, the <code>payment</code> details supplied to <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> (e.g. <code>accountId</code>) <em class="rfc2119" title="MUST">MUST</em> be supplied at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a>, otherwise an <code>IncompletePaymentDetailsError</code> <em class="rfc2119" title="MUST">MUST</em> be returned. This ensures that a viable <code>payment</code> reconciliation route is available before the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> starts to enter their data. If the <code>payment</code> details supplied (e.g. <code>accountId</code>) are not considered valid for reconciliation by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> then a <code>InvalidPaymentDetailsError</code> <em class="rfc2119" title="MUST">MUST</em> be returned.</li>
</ul><p>iii) "<strong>2. Identify</strong>" - User submits personal details and any other additional details requested</p><ul>
<li>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> have been informed that their personal information is being submitted to the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</li>
<li>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> have been made aware of any relevant <code>termsOfService</code>, for example by displaying a link to them prominently, before submitting their personal details.</li>
<li>If <code>requiresExplicitConsent</code> is <code>true</code> for any <code>termsOfService</code> then the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> only be allowed to proceed if they have explicitly acted to assent to such terms.</li>
<li><code>attendee</code> and <code>orderItemIntakeFormResponse</code> data is be captured at this stage if specified via <code>attendeeDetailsRequired</code> and <code>orderItemIntakeForm</code> in the <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> response, respectively.</li>
<li>If <code>prepayment</code> of all selected <code>Offer</code>s is <code>https://openactive.io/Optional</code> where they are not <code>https://openactive.io/Unavailable</code> then the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MAY">MAY</em> be given the option to prepay or simply reserve a space without payment. Providing optionality of payment to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> is at the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>'s discretion.</li>
</ul><p>iv) <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> call with <code>OrderQuote</code> including UUID with a <code>customer</code> object and any <code>orderItemIntakeFormResponse</code> required, <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> responds with an <code>OrderQuote</code> including any <code>error</code>s against each <code>OrderItem</code>.</p><ul>
<li><a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> creates <a href="#dfn-named-lease" class="internalDFN" data-link-type="dfn">named lease</a> for that UUID if it is supported, otherwise it provides a simple availability and <code>totalPaymentDue</code> confirmation. Works exactly as <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a>, except validates <code>payment</code> details, <code>customer</code> details, any <code>attendee</code> details, and the <code>orderItemIntakeFormResponse</code>.</li>
<li><a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> presents the contents of the <code>OrderQuote</code> to the <code>Customer</code> to ensure they have the most up-to-date price and availability before proceeding with the purchase.</li>
<li>If there are any issues with the <code>OrderItem</code>s requested in the <code>OrderQuote</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond with a <code>409 Conflict</code> response, with <code>error</code> details provided against each offending <code>OrderItem</code> - including if an <code>OrderItem</code> is no longer available, cannot be purchased in combination with another <code>OrderItem</code>, or does not contain a sufficient <code>orderItemIntakeFormResponse</code>.</li>
<li>Any <code>error</code>s must be resolved by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> or <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> before proceeding, by amending the <code>OrderItem</code>s included in the <code>OrderQuote</code> and resubmitting until an <code>OrderQuote</code> is returned without <code>error</code>s.</li>
<li>In the case that payment is selected (or if the <code>prepayment</code> value of any selected <code>Offer</code> is <code>https://openactive.io/Required</code> or unspecified), the <code>payment</code> property <em class="rfc2119" title="MUST">MUST</em> be included in the <code>OrderQuote</code> request and response including all details except the <code>identifier</code>, to express the intent to pay. If the <code>payment</code> property is omitted where <code>totalPaymentDue</code> is not <code>0</code>, and the <code>prepayment</code> value of any <code>Offer</code> is <code>https://openactive.io/Required</code> or unspecified, then a <code>IncompletePaymentDetailsError</code> <em class="rfc2119" title="MUST">MUST</em> be returned. If the <code>payment</code> details supplied (e.g. <code>accountId</code>) are not considered valid for reconciliation by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> then a <code>InvalidPaymentDetailsError</code> <em class="rfc2119" title="MUST">MUST</em> be returned.</li>
</ul><p>v) "<strong>3. Book and Pay</strong>" - User submits payment details and clicks Book</p><ul>
<li><p>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> only be allowed to proceed if no <code>OrderItem</code>s in the <code>OrderQuote</code> contain any <code>error</code>s.</p>
</li>
<li><p>If <code>totalPaymentDue</code> is <code>0</code> because all <code>OrderItem</code>s are free of charge, <code>prepayment</code> of all selected <code>Offer</code>s is either <code>https://openactive.io/Unavailable</code> or <code>https://openactive.io/Optional</code>, or the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> has chosen not to pay, payment details <em class="rfc2119" title="MUST NOT">MUST NOT</em> be captured.</p>
</li>
</ul><p>vi) <dfn data-dfn-type="dfn" id="dfn-payment-authorisation">Payment Authorisation</dfn> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> pre-authorises <code>totalPaymentDue</code> from <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a></p><ul>
<li>The <code>Order</code>
<code>id</code> (which includes the UUID) <em class="rfc2119" title="SHOULD">SHOULD</em> be used as a reference in the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>, if possible.</li>
<li>If payment details were not captured due to the <code>prepayment</code> value of the selected <code>Offer</code>s or <code>totalPaymentDue</code> equalling <code>0</code>, pre-authorisation <em class="rfc2119" title="MUST NOT">MUST NOT</em> be taken.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> store the <code>Order</code> request with an <code>orderCreationStatus</code> of <code>https://openactive.io/OrderCreationPaymentAuthorized</code> at this point, even if pre-authorisation is not taken, in order to ensure that the UUID in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> is recognised without a race condition. Such a condition might arise in the (admittedly unlikely) event of, e.g., an <code>Order</code> that is created at <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> and then immediately cancelled by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, which could result in the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> receiving an unrecognised <code>Order</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> if it was retrieved before the call to <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> returned.</li>
</ul><p>vii) <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> call with <code>Order</code> including UUID with a <code>customer</code> object and any <code>orderItemIntakeFormResponse</code> required, and <code>totalPaymentDue</code> including the total amount pre-authed, <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> responds with an <code>Order</code>.</p><ul>
<li><p>If payment details were not captured due to the <code>prepayment</code> value of the selected <code>Offer</code>s, or if <code>totalPaymentDue</code> is <code>0</code> due to all <code>OrderItem</code>s being free of charge,  the <code>payment</code> property <em class="rfc2119" title="MUST NOT">MUST NOT</em> be included in the <code>Order</code> request or response. If the <code>payment</code> property is omitted where <code>totalPaymentDue</code> is not <code>0</code>, and the <code>prepayment</code> value of any <code>Offer</code> is <code>https://openactive.io/Required</code> or unspecified, then an <code>IncompletePaymentDetailsError</code> <em class="rfc2119" title="MUST">MUST</em> be returned. If the <code>payment</code> details supplied (e.g. <code>accountId</code>) are not considered valid for reconciliation by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> then an <code>InvalidPaymentDetailsError</code> <em class="rfc2119" title="MUST">MUST</em> be returned.</p>
</li>
<li><p>The <code>identifier</code> of the <code>Payment</code> is taken from the payment pre-authorization, which must be reconciled with the </p>
</li>
<li><p>If the <code>totalPaymentDue</code> included in the <code>Order</code> object is different to the current <code>totalPaymentDue</code> (which might have changed since <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a>, e.g. if the headline price is changed in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> between these two steps), the booking fails but the lease is sustained so that the user can be prompted whether they want to continue with the new amount.</p>
</li>
<li><p>If the lease has expired, or if leases are not supported, then the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> attempts to make the booking anyway. If there are insufficient spaces available for <code>OrderItem</code>s the booking fails.</p>
</li>
<li><p>If the booking succeeds only for some <code>OrderItem</code>s, the whole transaction is rolled back and the entire booking fails.</p>
</li>
<li><p>If there's a network failure, e.g. no response from server, then the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> can resubmit with same UUID. As the call is idempotent, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> will need to track the UUID supplied by <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> against any successful orders, to ensure that it can return the same <code>Order</code> for subsequent requests. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> reuse UUIDs across multiple <code>Order</code>s.</p>
</li>
<li><p>If the call is successful (returns a 200 response), the booking is considered as complete and paid by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> at this point.</p>
</li>
<li><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> reflect back all properties defined by this specification that are supplied by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>'s request in the <code>Order</code> returned from this call, including <code>broker</code> and <code>brokerRole</code>, to acknowledge they have been recognised (even if they have not actually been stored by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>). The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> reflect back extension properties outside of this specification unless it explicitly supports them.</p>
</li>
<li><p>The <code>Order</code> returned from this call <em class="rfc2119" title="MUST">MUST</em> be stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, to be subsequently updated by the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>. The <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> contains only partial-updates of the <code>Order</code> stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> is the only actor guaranteed to maintain a complete view of the <code>Order</code>. The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MAY">MAY</em> store the full <code>Order</code> if desired.</p>
</li>
<li><p>It is the responsibility of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to store any additional state it requires that is not included in the <code>Order</code> returned from this call, and <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> that such state is stored alongside the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>'s persisted <code>Order</code>.</p>
</li>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> store the <code>Order</code> response in with an <code>orderCreationStatus</code> of <code>https://openactive.io/OrderCreationPaymentDue</code> at this point (or <code>https://openactive.io/OrderCreationPaymentCaptured</code> if no payment is due).</p>
</li>
<li><p>This call is idempotent, and hence if the UUID used for an <code>Order</code> already represents a completed Order with the same set of <code>OrderItem</code>s for the same <code>customer</code> as those specified, the success response is returned as normal. If any differences exist in the <code>Order</code>s, a UUID clash is assumed, a 500 response of with <code>OrderAlreadyExistsError</code> is returned by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, and a new UUID must be generated by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to retry the call.</p>
</li>
<li><p>As this call is idempotent, it can be safely retried in the case of an temporary unexpected error (any error that returns status code 503) or rate limiting (any error that returns status code 429).</p>
</li>
<li><p>When the request still returns status code 503 after a number of retries the UUID <em class="rfc2119" title="MUST">MUST</em> be regenerated to allow for a clean retry of the booking. The UUID <em class="rfc2119" title="MUST NOT">MUST NOT</em> be regenerated for expected errors (status code 4xx).</p>
</li>
</ul><p>viii) <dfn data-dfn-type="dfn" id="dfn-payment-capture">Payment Capture</dfn> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> captures <code>totalPaymentDue</code> from <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a></p><ul>
<li><p>It is the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>'s responsibility to ensure that payment has been captured if required.</p>
</li>
<li><p>If payment is required, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> update its stored <code>Order</code> with an <code>orderCreationStatus</code> of <code>https://openactive.io/OrderCreationPaymentCaptured</code> after payment is successfully captured.</p>
</li>
<li><p>If payment details were not captured due to the <code>prepayment</code> value of the selected <code>Offer</code>s or <code>totalPaymentDue</code> equalling <code>0</code>, payment <em class="rfc2119" title="MUST NOT">MUST NOT</em> be captured.</p>
</li>
</ul><p>ix) <dfn data-dfn-type="dfn" id="dfn-invoice-generation">Invoice Generation</dfn> and <dfn data-dfn-type="dfn" id="dfn-customer-notification">Customer Notification</dfn> - Upon successful <a href="#dfn-payment-capture" class="internalDFN" data-link-type="dfn">Payment Capture</a> (or completing <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> in the case of payment capture not being required), the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> generates invoices, sends the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> notifications, and stores the <code>Order</code> in a success state based on the response from <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a>.</p><ul>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> update its stored <code>Order</code> in with an <code>orderCreationStatus</code> of <code>https://openactive.io/OrderDelivered</code> after invoices have been created and notifications successfully sent.</li>
</ul><p>x) <dfn data-dfn-type="dfn" id="dfn-refunds-and-cancellation">Refunds and Cancellation</dfn> - The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> subscribes to updates from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to process cancellations and refunds.</p><ul>
<li>A secure <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> of <code>Order</code>s <em class="rfc2119" title="MUST">MUST</em> be provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, with the contents of the feed specific to the authentication credentials. This allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to maintain an updated state of all their bookings across a number of <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a>, even when changes are made outside of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>. This also allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to handle refunds for cancellations, and process notifications to <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a> in a consistent way.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> must ensure that the <code>Order</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> represent the current state of <code>OrderItem</code>s within the system, for the properties included in the feed. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> use these <code>Order</code>s to process refunds and send update notifications to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</li>
</ul></section><section id="booking-flow-rollback"><h4 id="x5-2-7-booking-flow-rollback"><span class="secno">5.2.7 </span>Booking Flow Rollback<a class="self-link" aria-label="§" href="#booking-flow-rollback"></a></h4><p>To ensure catastrophic errors are detected and resolved the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> periodically check its own store for any <code>Orders</code> that have not been updated in over a 2 minutes, and have an <code>orderCreationStatus</code> other than <code>https://openactive.io/OrderCreationComplete</code>.</p><p>Note that due to the ordering of the Booking Flow, no notifications will have been sent to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, so no notifications regarding the rollback are required assuming it is performed promptly.</p><section id="booking-halted-at-ordercreationpaymentcaptured"><h5 id="x5-2-7-1-booking-halted-at-ordercreationpaymentcaptured"><span class="secno">5.2.7.1 </span>Booking halted at OrderCreationPaymentCaptured<a class="self-link" aria-label="§" href="#booking-halted-at-ordercreationpaymentcaptured"></a></h5><p>If the <code>orderCreationStatus</code> is <code>https://openactive.io/OrderCreationPaymentCaptured</code>, <a href="#dfn-invoice-generation" class="internalDFN" data-link-type="dfn">Invoice Generation</a> and <a href="#dfn-customer-notification" class="internalDFN" data-link-type="dfn">Customer Notification</a> should simply be retried, and the <code>orderCreationStatus</code> set to <code>https://openactive.io/OrderCreationComplete</code> on success with no further rollback steps taken.</p></section><section id="booking-halted-at-ordercreationpaymentdue"><h5 id="x5-2-7-2-booking-halted-at-ordercreationpaymentdue"><span class="secno">5.2.7.2 </span>Booking halted at OrderCreationPaymentDue<a class="self-link" aria-label="§" href="#booking-halted-at-ordercreationpaymentdue"></a></h5><p>If an error occurs during <a href="#dfn-payment-capture" class="internalDFN" data-link-type="dfn">Payment Capture</a>, which is very unlikely but possible due to system failure, and detectable where the <code>orderCreationStatus</code> is <code>https://openactive.io/OrderCreationPaymentDue</code>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> either:</p><ul>
<li>Initiate manual capture via e.g. the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>'s admin console. Note the pre-auth will typically last for 7 days, so manual capture is still possible after the event.</li>
<li>Capture the payment from the user manually.</li>
<li>Absorb the loss and make a new payment for the same amount with the same UUID in the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a> (better for UX / customer service, if manual capture not possible).</li>
<li>Acknowledge that payment cannot be successfully captured.</li>
</ul><p>After payment has been successfully captured via one of the above methods, the <code>orderCreationStatus</code> <em class="rfc2119" title="MUST">MUST</em> be set to <code>https://openactive.io/OrderCreationPaymentCaptured</code>, which will cause <a href="#dfn-invoice-generation" class="internalDFN" data-link-type="dfn">Invoice Generation</a> and <a href="#dfn-customer-notification" class="internalDFN" data-link-type="dfn">Customer Notification</a> to be retried as per the previous section.</p><p>If the payment cannot be captured successfully:</p><ul>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> issue a Order Deletion (DELETE) request for the <code>Order</code> to remove it from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</li>
<li>The <code>orderCreationStatus</code> <em class="rfc2119" title="MUST">MUST</em> be set to <code>https://openactive.io/OrderCreationPaymentAuthorized</code>, to trigger the rollback step in the next section.
</li>
</ul></section><section id="booking-halted-at-ordercreationpaymentauthorized"><h5 id="x5-2-7-3-booking-halted-at-ordercreationpaymentauthorized"><span class="secno">5.2.7.3 </span>Booking halted at OrderCreationPaymentAuthorized<a class="self-link" aria-label="§" href="#booking-halted-at-ordercreationpaymentauthorized"></a></h5><p>If the <code>orderCreationStatus</code> is <code>https://openactive.io/OrderCreationPaymentAuthorized</code>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em>:</p><ul>
<li>Cancel the associated Payment Authorisation from the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>.</li>
<li>Soft delete the contents of the <code>Order</code> from the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> (deleting any personal data, while retaining data required for audit), retaining the UUID.</li>
</ul><p>Note that the UUID is retained so that any related entries in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders Feed</a> can be appropriately assigned and ignored.</p></section></section><section id="contracts"><h4 id="x5-2-8-contracts"><span class="secno">5.2.8 </span>Contracts<a class="self-link" aria-label="§" href="#contracts"></a></h4><p>A summary of the key conformance criteria for the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> is included here.</p><section id="broker-contract-with-booking-system"><h5 id="x5-2-8-1-broker-contract-with-booking-system"><span class="secno">5.2.8.1 </span>Broker contract with Booking System<a class="self-link" aria-label="§" href="#broker-contract-with-booking-system"></a></h5><ul>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> call <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> (without <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> details)</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> call <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> (with <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> details), to retrieve the total order, providing all required details and resulting in no errors before calling <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a>.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> call <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> (with payment identifier if relevant), and <em class="rfc2119" title="MUST">MUST</em> store the resulting <code>Order</code>.</li>
<li>If <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> fails, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> cancel the payment authorisation without any consequence to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> or <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> process all updates to the <code>Order</code> from the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, specifically monitoring the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders Feed</a> for cancellations.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> generate a UUID, and use it consistently during the booking flow.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> reuse UUIDs across complete or incomplete <code>Order</code>s.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> make the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> aware of any relevant <code>termsOfService</code>, for example by displaying a link to them prominently, before they commit to the booking.</li>
<li>If <code>requiresExplicitConsent</code> is <code>true</code> for any <code>termsOfService</code> then the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> only be allowed to proceed if they have explicitly acted to assent to such terms.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> handle payments and reconciliation with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> and the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>.</li>
</ul></section><section id="booking-system-contract-with-the-broker"><h5 id="x5-2-8-2-booking-system-contract-with-the-broker"><span class="secno">5.2.8.2 </span>Booking System contract with the Broker<a class="self-link" aria-label="§" href="#booking-system-contract-with-the-broker"></a></h5><ul>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond to <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> (without <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> details) with an <code>OrderQuote</code> that includes an indicative total order price, or a relevant error. It must also include the specification of any additional details to captured from the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> to be provided to <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a>.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond to <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> (with <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> details) with an <code>OrderQuote</code> that includes an exact total order price, or a relevant error. It must also produce a relevant error if the additional details specified are not sufficient.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond to <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> with a completed <code>Order</code>, or a relevant error. The whole booking <em class="rfc2119" title="MUST">MUST</em> succeed or fails as one.</li>
<li>Upon any cancellations or updates to the <code>Order</code> or any <code>OrderItem</code> within it, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> include the updated <code>Order</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> store the UUID as part of the <code>Order</code> (and <code>OrderQuote</code> if leasing is enabled).</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> refuse attempts to create new orders with a previously used UUID.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> check availability and confirm pricing during <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a>, and <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> to ensure booking can complete.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> provide an authenticated Orders Feed specific to the Broker. The contents of this feed will consist of all <a href="#dfn-order" class="internalDFN" data-link-type="dfn"><code>Orders</code></a> updated by the Booking System.
Include sufficient pricing &amp; avail data in opportunity feeds.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> provide [<cite><a class="bibref" href="#bib-rpde">RPDE</a></cite>] open feeds of <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunities</a>.</li>
</ul><p>Calls to <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a>, and <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> <em class="rfc2119" title="MUST">MUST</em> be idempotent, based on the UUID.</p><p>With the exception of leasing, <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> have any side effects.</p></section></section></section><section id="booking-flow-with-approval"><h3 id="x5-3-booking-flow-with-approval"><span class="secno">5.3 </span>Booking Flow with Approval<a class="self-link" aria-label="§" href="#booking-flow-with-approval"></a></h3><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MAY">MAY</em> optionally support review and approval of bookings by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>. As the approval processes is initiated by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, implementation of this section by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> is only required if this flow is supported. Otherwise this section can be ignored.</p><section id="customer-journey-0"><h4 id="x5-3-1-customer-journey"><span class="secno">5.3.1 </span>Customer Journey<a class="self-link" aria-label="§" href="#customer-journey-0"></a></h4><p>The booking journey of a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> is generalised into the following logical steps:</p><figure id="fig-illustration-of-a-typical-customer-journey-with-an-approval-step"><img src="userjourneywithapproval.png" alt="High level user journey with approval" height="325" width="939">
<figcaption>Figure <span class="figno">6</span> <span class="fig-title">Illustration of a typical <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> journey, with an approval step.</span></figcaption>
</figure><p>The steps exactly mirror the <a href="#simple-booking-flow">Simple Booking Flow</a>, with two additions in the 'Identify' step:</p><ol>
<li><strong>Select</strong>: <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> selects at least one <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> (e.g. <code>ScheduledSession</code> or <code>Slot</code>) and an associated <code>Offer</code> ("Junior (8-18) £9")</li>
<li><strong>Identify</strong>: <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> submits personal details and other requested details<ol>
<li><strong>Propose</strong>: <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> submits payment details, and submits a proposed booking</li>
<li><strong>Approve</strong>: <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> approves the booking, after a period of time</li>
</ol>
</li>
<li><strong>Book and Pay</strong>: <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> confirms they are happy to proceed</li>
</ol><p>Note that some or all steps may be skipped, or may not be presented to the user, e.g. if their registration or payment details are already known, or they are using a voice interface. These steps are not indicative of the user experience, and simply provide a common language around the flow.</p></section><section id="high-level-api-flow-0"><h4 id="x5-3-2-high-level-api-flow"><span class="secno">5.3.2 </span>High-level API flow<a class="self-link" aria-label="§" href="#high-level-api-flow-0"></a></h4><figure id="fig-illustration-of-high-level-booking-flow-including-approval"><img src="bookingflowwithapproval.png" alt="High level booking flow with approval" height="713" width="894">
<figcaption>Figure <span class="figno">7</span> <span class="fig-title">Illustration of high level booking flow, including approval.</span></figcaption>
</figure><p>The flow exactly mirrors the <a href="#simple-booking-flow">Simple Booking Flow</a>, with two additions:</p><ul>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> generates a <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a> which is used to uniquely identify the <code>Order</code> throughout the process.</p>
</li>
<li><p>After "<strong>1. Select</strong>" the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> calls the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to confirm an indicative price and availability of the selected items using an <code>OrderQuote</code>, and retrieve a total order price. Any details that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> needs to supply to complete the booking are also specified. This is checkpoint <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> on the diagram above.</p>
</li>
<li><p>After "<strong>2. Identify</strong>" the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> calls the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to reconfirm the price and availability of the selected items using an <code>OrderQuote</code>, using all details required, and retrieve a total order price. Explicit consent for any terms and conditions is also captured at this stage if required. This is checkpoint <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> on the diagram above.</p>
</li>
<li><p>After "<strong>2.1. Propose</strong>", the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> first <em>pre-authorizes</em> the payment for the total order price (if required by the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>), then submits the proposed booking to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> using an <code>OrderProposal</code> (<a href="#dfn-p" class="internalDFN" data-link-type="dfn"><b>P</b></a> on the diagram above), and sends the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> a notification that the proposal is under consideration. The <code>OrderProposal</code> may be negotiated between the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> via the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> at this stage.</p>
</li>
<li><p>After "<strong>2.2. Approve</strong>" the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> approves the <code>OrderProposal</code> and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> is notified of this by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> (<strong>A</strong> on the diagram above). The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> can seek <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> permission to proceed, or simply complete the booking automatically, depending on the desired user experience.</p>
</li>
<li><p>After "<strong>3. Book and Pay</strong>", if necessary the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>
<em>re-authorizes</em> the payment for the total order price (if it has changed, and if required by the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>), then confirms the booking with <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> using an <code>Order</code> (<a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> on the diagram above), and finally <em>captures</em> the payment. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> then generates invoices, and sends <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> notifications.</p>
</li>
<li><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> adds the <code>Order</code> to an <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> specific to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, which the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> reads to update its internal state, including those updates resulting from cancellations.</p>
</li>
</ul><p>Note that the <code>OrderProposal</code> at stages 2.1 and 2.2 does not constitute a booking. The whole flow <em class="rfc2119" title="MUST">MUST</em> be completed before the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> is considered "booked" onto an <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a>.</p></section><section id="leasing-0"><h4 id="x5-3-3-leasing"><span class="secno">5.3.3 </span>Leasing<a class="self-link" aria-label="§" href="#leasing-0"></a></h4><p>Leasing works as specified in the <a href="#simple-booking-flow">Simple Booking Flow</a>, and if a lease was acquired at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> or <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> it <em class="rfc2119" title="SHOULD">SHOULD</em> be carried over to the <code>OrderProposal</code> and the lease extended for a duration sufficient to cover the lifetime of the <code>OrderProposal</code>.</p><p>A lease is <em class="rfc2119" title="NOT REQUIRED">NOT REQUIRED</em> for this flow, as in some cases <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Sellers</a> may prefer to manage contention for spaces manually via the approval process instead of leasing.</p><p>If an <code>OrderProposal</code> remains in a <code>orderProposalStatus</code> other than <code>https://openactive.io/CustomerRejected</code> or <code>https://openactive.io/SellerRejected</code> after the lease has expired, it <em class="rfc2119" title="MUST">MUST</em> be possible for the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> to still complete the booking if they attain approval. If this is not the case, this fact needs to be explicitly asserted. For example, if an <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> becomes full and no substitute opportunities are available, then all remaining outstanding <code>OrderProposal</code>s related to that <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> would need to be automatically rejected.</p><p>If the lease expires the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> could, for example, automatically reject the <code>OrderProposal</code> on behalf of the <code>Seller</code>, automatically renew the lease, or allow the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> to manually deal with the contention for spaces as part of the approval process and hence do nothing.</p></section><section id="high-level-type-flow-0"><h4 id="x5-3-4-high-level-type-flow"><span class="secno">5.3.4 </span>High-level type flow<a class="self-link" aria-label="§" href="#high-level-type-flow-0"></a></h4><figure id="fig-illustration-of-types-used-during-the-api-flow-with-approval"><img src="typeflowwithapproval.png" alt="High level type flow with approval" height="178" width="953">
<figcaption>Figure <span class="figno">8</span> <span class="fig-title">Illustration of types used during the API flow, with approval.</span></figcaption>
</figure><p>As specified in the <a href="#simple-booking-flow">Simple Booking Flow</a>, with one addition:</p><ul>
<li><strong>P/A</strong> - <code>OrderProposal</code> exists in a number of states, as described in the next section, and contains enough detail to successfully create an <code>Order</code>.</li>
</ul></section><section id="orderproposal-statuses"><h4 id="x5-3-5-orderproposal-statuses"><span class="secno">5.3.5 </span>OrderProposal statuses<a class="self-link" aria-label="§" href="#orderproposal-statuses"></a></h4><figure id="fig-state-transition-diagram-showing-orderproposal-states"><img src="order-proposal-states.png" alt="OrderProposal states" height="560" width="730">
<figcaption>Figure <span class="figno">9</span> <span class="fig-title">State transition diagram showing OrderProposal states</span></figcaption>
</figure><p><code>OrderProposal</code> has an <code>orderProposalStatus</code> which is initially set by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to <code>https://openactive.io/AwaitingSellerConfirmation</code>.</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> only proceed to <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> when <code>orderProposalStatus</code> is set to <code>https://openactive.io/SellerAccepted</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>.</p><p>An <code>OrderProposal</code> <em class="rfc2119" title="MUST">MUST</em> be approved or rejected atomically; partial approval is not supported in this version of the specification (though <a href="#proposal-amendment">Proposal Amendment</a> is supported).</p><p>To reach the criteria to proceed to <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a>, or rejection, <code>OrderProposal</code> <em class="rfc2119" title="MUST">MUST</em> be transitioned through states as follows:</p><ul>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> transition the <code>OrderProposal</code> to a new <code>orderProposalStatus</code> by updating the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> transition the <code>OrderProposal</code> to a new <code>orderProposalStatus</code> by submitting a PATCH to the <code>OrderProposal</code> using the OrderProposal Update endpoint.</li>
</ul><section id="minimal-implementation"><h5 id="x5-3-5-1-minimal-implementation"><span class="secno">5.3.5.1 </span>Minimal Implementation<a class="self-link" aria-label="§" href="#minimal-implementation"></a></h5><p>In the <strong>Minimal Implementation</strong> the <code>OrderProposal</code> can either be accepted or rejected by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, or aborted by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</p><p>If an <code>Offer</code> requires this <strong>Minimal Implementation</strong>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> include the <code>openBookingFlowRequirement</code> of <code>https://openactive.io/OpenBookingApproval</code> in the <code>Offer</code>s within its open data. This allows <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a> that do not support approval to easily filter out such offers from their experience.</p><p>Note that when <code>Offer</code>s that require approval are mixed with <code>Offer</code>s that do not require approval in a single <code>OrderQuote</code>, the whole <code>OrderQuote</code> <em class="rfc2119" title="MUST">MUST</em> always require approval. It is at the discretion of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> whether to issue two separate <code>OrderQuote</code>s (and hence complete two separate booking flows) that batch those <code>OrderItem</code>s that require approval separately to those that do not, or whether to instead combine them together into a single <code>OrderQuote</code> and hence complete a single <a href="#booking-flow-with-approval">Booking Flow with Approval</a>.</p><section id="proposal-approval"><h6 id="x5-3-5-1-1-proposal-approval"><span class="secno">5.3.5.1.1 </span>Proposal Approval<a class="self-link" aria-label="§" href="#proposal-approval"></a></h6><ul>
<li>If <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> approval is given, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> set <code>orderProposalStatus</code> to <code>https://openactive.io/SellerAccepted</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, which will give the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> permission to proceed to <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a>.</li>
<li>For the <a href="#minimal-implementation">Minimal Implementation</a>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> must check that the <code>orderProposalVersion</code> received in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders Feed</a> matches the original <code>orderProposalVersion</code> returned at <a href="#dfn-p" class="internalDFN" data-link-type="dfn"><b>P</b></a>. If this is the case the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> may seek <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> confirmation to proceed, or may simply proceed with <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> automatically, depending on the desired user experience. If this is not the case, the scenario <em class="rfc2119" title="MUST">MUST</em> be handled via the <a href="#proposal-amendment">Proposal Amendment</a> process.</li>
</ul></section><section id="proposal-rejection"><h6 id="x5-3-5-1-2-proposal-rejection"><span class="secno">5.3.5.1.2 </span>Proposal Rejection<a class="self-link" aria-label="§" href="#proposal-rejection"></a></h6><ul>
<li>If the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> rejects the proposal, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> set <code>orderProposalStatus</code> to <code>https://openactive.io/SellerRejected</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, optionally including an <code>orderSellerNote</code> containing any reason for rejection.</li>
<li>If the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> aborts the proposal, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> PATCH the <code>OrderProposal</code> to set the <code>orderProposalStatus</code> to <code>https://openactive.io/CustomerRejected</code>, optionally including an <code>orderCustomerNote</code> containing any associated reason. The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> will then update this in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>,</li>
</ul><p>Following any type of rejection, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> immediately withdraw any payment authorisation.</p></section></section><section id="proposal-amendment"><h5 id="x5-3-5-2-proposal-amendment"><span class="secno">5.3.5.2 </span>Proposal Amendment<a class="self-link" aria-label="§" href="#proposal-amendment"></a></h5><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MAY">MAY</em> optionally support <strong>Proposal Amendment</strong>. If this is not supported by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, the simple Approval/Rejection workflow described in the <a href="#minimal-implementation">Minimal Implementation</a> may be used without needing to consider this (as the amendments are initiated by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>).</p><p>If an <code>Offer</code> may require <strong>Proposal Amendment</strong>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> include the <code>openBookingFlowRequirement</code> of <code>https://openactive.io/OpenBookingNegotiation</code> in the <code>Offer</code>s within its open data. This allows <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a> that do not support such negotiation to easily filter out such offers from their experience.</p><p><strong>Proposal Amendment</strong> allows the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> to suggest amendments to the <code>OrderProposal</code> (which need to be accepted by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>) as follows:</p><ul>
<li>If the <code>orderProposalVersion</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> has changed compared with the <code>orderProposalVersion</code> in the <code>OrderProposal</code> stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> notify the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> that their booking requires confirmation before it can proceed. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> detect and highlight any changes from their stored <code>OrderProposal</code> in the notification, based on the difference between the <code>OrderItem</code>s stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and those in the feed.</li>
<li>When the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> confirms, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> re-authorise the <code>totalPaymentDue</code>, if it has increased, with the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>, then proceed to <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> using the <code>orderProposalVersion</code> the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> has agreed to.</li>
<li>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> or <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> <em class="rfc2119" title="MAY">MAY</em> also choose to abort at any point as per <a href="#minimal-implementation">Minimal Implementation</a>.</li>
</ul><p>Note that this specification does not support <code>OrderProposal</code> amendment by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, and that <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> requests for changes to an existing proposal may be done via messages communicated via <a href="#message-exchange">Message Exchange</a>.</p></section><section id="message-exchange"><h5 id="x5-3-5-3-message-exchange"><span class="secno">5.3.5.3 </span>Message Exchange<a class="self-link" aria-label="§" href="#message-exchange"></a></h5><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> and <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> support a basic level of <strong>Message Exchange</strong> while the <code>OrderProposal</code> is in-flight.
</p><p><strong>Message Exchange</strong> is achieved using the two properties <code>orderSellerNote</code> and <code>orderCustomerNote</code>, and does not have any impact on the <code>orderProposalVersion</code>.</p><p>The <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> <em class="rfc2119" title="MAY">MAY</em> send a message to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> by setting <code>orderSellerNote</code> in the <code>OrderProposal</code>, and updating the <code>OrderProposal</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>. Any change detected in the <code>orderSellerNote</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> <em class="rfc2119" title="MUST">MUST</em> promptly trigger a notification from the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, so that the value of <code>orderSellerNote</code> can be safely overwritten with another message. To ensure that messages are not lost in the RPDE feed, the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> <em class="rfc2119" title="MAY">MAY</em> send no more than one message every 5 minutes per <code>OrderProposal</code>.</p><p>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MAY">MAY</em> send a message to the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> making a PATCH call to the OrderProposal Update endpoint to set <code>orderCustomerNote</code> in the <code>OrderProposal</code> e.g. <code>{"orderCustomerNote": "If you let me attend for free this time, you're on!" }</code>. Any such <code>orderCustomerNote</code> updates via PATCH calls <em class="rfc2119" title="MUST">MUST</em> either trigger a notification from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, or be stored in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> for later reference by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, so that the value of <code>orderCustomerNote</code> can be safely overwritten with another message.</p><p>Note that the <code>orderCustomerNote</code> property <em class="rfc2119" title="MUST NOT">MUST NOT</em> be available in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, to remove unnecessary RPDE updates.</p></section></section><section id="step-by-step-process-description-0"><h4 id="x5-3-6-step-by-step-process-description"><span class="secno">5.3.6 </span>Step-by-step process description<a class="self-link" aria-label="§" href="#step-by-step-process-description-0"></a></h4><figure id="fig-sequence-diagram-showing-api-interactions-with-approval"><img src="sequencediagramwithapproval.png" alt="Sequence diagram with approval" height="720" width="960">
<figcaption>Figure <span class="figno">10</span> <span class="fig-title">Sequence diagram showing API interactions with approval</span></figcaption>
</figure><p>For an <code>Order</code> that requires approval, the flow differs from the <a href="#simple-booking-flow">Simple Booking Flow</a> as follows:</p><ul>
<li><code>OrderQuote</code> is returned at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> with <code>orderRequiresApproval</code> set to <code>true</code> if any <code>OrderItem</code>s require approval.</li>
<li><code>OrderItem</code>s that require approval within an <code>OrderProposal</code> have <code>orderItemStatus</code> of either <code>https://openactive.io/OrderApprovalPending</code> or <code>https://openactive.io/OrderApprovalAutomatic</code>, to indicate which specific items are contingent on approval and which could be purchased separately.</li>
<li>The <code>OrderProposal</code> <em class="rfc2119" title="MAY">MAY</em> include an <code>orderCustomerNote</code> in order to "Ask a question about this opportunity?".</li>
<li>Additional data is supplied at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> as in the <a href="#simple-booking-flow">Simple Booking Flow</a> to satisfy the <code>orderItemIntakeForm</code> for all <code>OrderItems</code>.</li>
<li>The <code>totalPaymentDue</code> from <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> is used for Payment Authorisation as with the <a href="#simple-booking-flow">Simple Booking Flow</a>.</li>
<li>An additional step <a href="#dfn-p" class="internalDFN" data-link-type="dfn"><b>P</b></a> is required after <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> where the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> submits the completed <code>OrderProposal</code> to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, which returns an <code>OrderProposal</code> that the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> store, with <code>orderProposalStatus</code> set to <code>https://openactive.io/AwaitingSellerConfirmation</code>. The call is atomic. The returned <code>OrderProposal</code> also contains an <code>orderProposalVersion</code> (constructed from the <code>id</code> of the <code>OrderProposal</code> combined an additional version UUID). Note that as with <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a>, the <code>OrderProposal</code> from <a href="#dfn-p" class="internalDFN" data-link-type="dfn"><b>P</b></a> will not be present in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> until it is updated at least once.</li>
<li>Once approved, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> puts the updated <code>OrderProposal</code> onto the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> (<strong>A</strong>), with either an unchanged <code>orderProposalVersion</code> (see <a href="#minimal-implementation">Minimal Implementation</a>) or a new <code>orderProposalVersion</code> (see <a href="#proposal-amendment">Proposal Amendment</a>).</li>
<li>If required due to expiration of the existing Payment Authorisation or a change in the <code>totalPaymentDue</code>, the payment can be re-authorised before <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a>.
</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> supplies a minimal <code>Order</code> to <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> that just contains this <code>orderProposalVersion</code> and any additional <code>payment</code> data from the re-authorisation step, and continues the flow with <a href="#dfn-payment-capture" class="internalDFN" data-link-type="dfn">Payment Capture</a>, <a href="#dfn-invoice-generation" class="internalDFN" data-link-type="dfn">Invoice Generation</a>, and <a href="#dfn-customer-notification" class="internalDFN" data-link-type="dfn">Customer Notification</a> as per the <a href="#simple-booking-flow">Simple Booking Flow</a>.</li>
</ul></section><section id="contract"><h4 id="x5-3-7-contract"><span class="secno">5.3.7 </span>Contract<a class="self-link" aria-label="§" href="#contract"></a></h4><p>A summary of the key conformance criteria is included here. These apply for the <a href="#booking-flow-with-approval">Booking Flow with Approval</a>
<em>in addition to</em> the contract specified in the <a href="#simple-booking-flow">Simple Booking Flow</a>.</p><section id="broker-contract-with-booking-system-0"><h5 id="x5-3-7-1-broker-contract-with-booking-system"><span class="secno">5.3.7.1 </span>Broker contract with Booking System<a class="self-link" aria-label="§" href="#broker-contract-with-booking-system-0"></a></h5><ul>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> call <a href="#dfn-p" class="internalDFN" data-link-type="dfn"><b>P</b></a> with <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> details as they would for <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> in the <a href="#simple-booking-flow">Simple Booking Flow</a>, and <em class="rfc2119" title="MUST">MUST</em> store the resulting <code>OrderProposal</code>.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> process updates to the <code>OrderProposal</code> from the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, including <strong>A</strong>.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MAY">MAY</em> negotiate on the <code>OrderProposal</code> using a OrderProposal Update call.</li>
</ul></section><section id="booking-system-contract-with-the-broker-0"><h5 id="x5-3-7-2-booking-system-contract-with-the-broker"><span class="secno">5.3.7.2 </span>Booking System contract with the Broker<a class="self-link" aria-label="§" href="#booking-system-contract-with-the-broker-0"></a></h5><ul>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond to <a href="#dfn-p" class="internalDFN" data-link-type="dfn"><b>P</b></a> with an <code>OrderProposal</code>, or a relevant error. The whole creation of the <code>OrderProposal</code> <em class="rfc2119" title="MUST">MUST</em> succeed or fails as one.</li>
<li>Upon approval or updates to the <code>OrderProposal</code> or any <code>OrderItem</code> within it, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> include the updated <code>OrderProposal</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, including <strong>A</strong>.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MAY">MAY</em> negotiate on the <code>OrderProposal</code> using the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>.</li>
</ul><p>Calls to <a href="#dfn-p" class="internalDFN" data-link-type="dfn"><b>P</b></a> <em class="rfc2119" title="MUST">MUST</em> be idempotent, based on the UUID.</p></section></section></section><section id="customer-details-and-additional-details-capture"><h3 id="x5-4-customer-details-and-additional-details-capture"><span class="secno">5.4 </span>Customer Details and Additional Details capture<a class="self-link" aria-label="§" href="#customer-details-and-additional-details-capture"></a></h3><section id="customer-details"><h4 id="x5-4-1-customer-details"><span class="secno">5.4.1 </span>Customer Details<a class="self-link" aria-label="§" href="#customer-details"></a></h4><p>The specification includes provision to capture of the following details related to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> (the actor who is booking), with only the e-mail address being required.</p><ul>
<li>E-mail address (<code>email</code>)</li>
<li>Forename (<code>givenName</code>)</li>
<li>Surname (<code>familyName</code>)</li>
<li>Telephone (<code>telephone</code>)</li>
</ul><p>Note that these are <em>not</em> the details of attendees, and that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> is not guaranteed to participate in the activity.</p></section><section id="attendee-details"><h4 id="x5-4-2-attendee-details"><span class="secno">5.4.2 </span>Attendee Details<a class="self-link" aria-label="§" href="#attendee-details"></a></h4><p>If attendee details in scope of the <code>Person</code> type are captured, they <em class="rfc2119" title="MUST">MUST</em> be captured via the <code>attendee</code> property of the <code>OrderItem</code> (and not using the <code>orderItemIntakeForm</code>). This allows attendee details to be stored and reused by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</p><p>Note that conformance with this specification requires that the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> <em>require</em> attendee data to be submitted in all cases, and that configuration of which attendee details are required (if any) <em class="rfc2119" title="MUST">MUST</em> be available to the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</p><p>If an <code>Offer</code> requires attendee details capture, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> include the <code>openBookingFlowRequirement</code> of <code>https://openactive.io/OpenBookingAttendeeDetails</code> in the <code>Offer</code>s within its open data. This allows <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a> that do not support attendee details capture to easily filter out such offers from their experience.</p><div class="example" id="example-3-example-of-attendeedetailsrequired-provided-by-booking-system-at-c1">
          <div class="marker">
      <a class="self-link" href="#example-3-example-of-attendeedetailsrequired-provided-by-booking-system-at-c1">Example 3</a><span class="example-title">: Example of attendeeDetailsRequired provided by Booking System at C1</span>
    </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"attendeeDetailsRequired"</span>: [
    <span class="hljs-string">"https://schema.org/givenName"</span>,
    <span class="hljs-string">"https://schema.org/familyName"</span>
  ],
}</code></pre>
        </div><div class="example" id="example-4-example-of-attendee-details-provided-with-each-orderitem-at-c2">
          <div class="marker">
      <a class="self-link" href="#example-4-example-of-attendee-details-provided-with-each-orderitem-at-c2">Example 4</a><span class="example-title">: Example of attendee details provided with each OrderItem at C2</span>
    </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"attendee"</span>: {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-string">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-string">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-string">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-string">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  }
}</code></pre>
        </div><p>If a required property within <code>Person</code> is not supplied by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> include an <code>IncompleteAttendeeDetailsError</code> against the offending <code>OrderItem</code> at <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> which includes an <code>instance</code> that references the <code>id</code> of the missing or invalid <code>Property</code>.</p><div class="example" id="example-5-example-of-an-error-for-missing-attendee-property-data">
          <div class="marker">
      <a class="self-link" href="#example-5-example-of-an-error-for-missing-attendee-property-data">Example 5</a><span class="example-title">: Example of an error for missing attendee property data</span>
    </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"error"</span>: [
    {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"IncompleteAttendeeDetailsError"</span>,
      <span class="hljs-string">"instance"</span>: <span class="hljs-string">"https://schema.org/givenName"</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"Missing attendee first name"</span>
    }
  ]
}</code></pre>
        </div><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MAY">MAY</em> remember the attendee data previously submitted by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, if consent is provided.</p></section><section id="additional-details"><h4 id="x5-4-3-additional-details"><span class="secno">5.4.3 </span>Additional Details<a class="self-link" aria-label="§" href="#additional-details"></a></h4><p>This version of the specification does not provide details to construct a complex additional details capture form, however it does facilitate simple text fields to capture additional details. These can be used for both the <a href="#simple-booking-flow">Simple Booking Flow</a> and the <a href="#booking-flow-with-approval">Booking Flow with Approval</a>.</p><p>If an <code>Offer</code> requires additional details capture, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> include the <code>openBookingFlowRequirement</code> of <code>https://openactive.io/OpenBookingIntakeForm</code> in the <code>Offer</code>s within its open data. This allows <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a> that do not support additional details capture to easily filter out such offers from their experience.</p><div class="example" id="example-6-example-of-orderitemintakeform-provided-by-booking-system-at-c1">
          <div class="marker">
      <a class="self-link" href="#example-6-example-of-orderitemintakeform-provided-by-booking-system-at-c1">Example 6</a><span class="example-title">: Example of orderItemIntakeForm provided by Booking System at C1</span>
    </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"orderItemIntakeForm"</span>: [
    {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"PropertyValueSpecification"</span>,
      <span class="hljs-string">"id"</span>: <span class="hljs-string">"https://example.com/experience"</span>,
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"More information about you"</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"Have you played before? Are you a complete beginner or seasoned pro?"</span>,
      <span class="hljs-string">"valueRequired"</span>: <span class="hljs-literal">true</span>
    }
  ]
}</code></pre>
        </div><div class="example" id="example-7-example-of-orderitemintakeformresponse-provided-by-broker-at-c2">
          <div class="marker">
      <a class="self-link" href="#example-7-example-of-orderitemintakeformresponse-provided-by-broker-at-c2">Example 7</a><span class="example-title">: Example of orderItemIntakeFormResponse provided by Broker at C2</span>
    </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"orderItemIntakeFormResponse"</span>: [
    {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"PropertyValue"</span>,
      <span class="hljs-string">"propertyID"</span>: <span class="hljs-string">"https://example.com/experience"</span>,
      <span class="hljs-string">"value"</span>: <span class="hljs-string">"I've played twice before, but I'm a quick learner so I hope to keep up!"</span>
    }
  ]
}</code></pre>
        </div><p>If a field with <code>valueRequired</code> is not supplied by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> include an <code>IncompleteIntakeFormError</code> against the offending <code>OrderItem</code> at <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> which includes an <code>instance</code> that references the <code>id</code> of the <code>PropertyValueSpecification</code>.</p><div class="example" id="example-8-example-of-an-error-for-missing-additional-details-field-data">
          <div class="marker">
      <a class="self-link" href="#example-8-example-of-an-error-for-missing-additional-details-field-data">Example 8</a><span class="example-title">: Example of an error for missing additional details field data</span>
    </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"error"</span>: [
    {
      <span class="hljs-string">"type"</span>: <span class="hljs-string">"IncompleteIntakeFormError"</span>,
      <span class="hljs-string">"instance"</span>: <span class="hljs-string">"https://example.com/experience"</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"Incomplete additional details supplied"</span>
    }
  ]
}</code></pre>
        </div><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MAY">MAY</em> remember the values previously submitted by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> based on the <code>id</code> of the <code>PropertyValueSpecification</code>, if consent is provided.</p><p>It is expected that future versions of the specification will support more complex field types.</p></section></section></section><section class="normative" id="broker-roles"><!--OddPage--><h2 id="x6-broker-roles"><span class="secno">6. </span>Broker Roles<a class="self-link" aria-label="§" href="#broker-roles"></a></h2><p>A <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> is an actor that arranges transactions between a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> and <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, either directly or indirectly.</p><p>From a contractual and taxation perspective, there are two types of <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>: agents (<code>AgentBroker</code>), and resellers (<code>ResellerBroker</code>). In addition, situations in which the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">customer</a> contracts directly with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">seller</a> without a third party are represented by the <code>brokerRole</code> value of <code>NoBroker</code>.</p><p>Note that this specification does not deal with contractual relationships, and simply provides a mechanism to record bookings.</p><section id="resellerbroker"><h3 id="x6-1-resellerbroker"><span class="secno">6.1 </span><code>ResellerBroker</code><a class="self-link" aria-label="§" href="#resellerbroker"></a></h3><section id="definition"><h4 id="x6-1-1-definition"><span class="secno">6.1.1 </span>Definition<a class="self-link" aria-label="§" href="#definition"></a></h4><p>A reseller is a company or individual that purchases goods or services with the intention of selling them rather than consuming or using them. This is usually done for profit (but could be resold at a loss).</p></section><section id="contractual-relationships"><h4 id="x6-1-2-contractual-relationships"><span class="secno">6.1.2 </span>Contractual Relationships<a class="self-link" aria-label="§" href="#contractual-relationships"></a></h4><p>In the context of OpenActive, a <code>ResellerBroker</code> contracts directly with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> as a business-to-business relationship to purchase access to the opportunity. It then, at a later point in time (which may only be milliseconds later), separately forms a contractual relationship with the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, who purchases access to the opportunity from the <code>ResellerBroker</code>.</p><figure id="fig-contractual-relationships-in-resellerbroker-mode"><img src="ResellerBroker.png" alt="ResellerBroker relationships" height="303" width="577">
<figcaption>Figure <span class="figno">11</span> <span class="fig-title">Contractual relationships in ResellerBroker mode</span></figcaption>
</figure></section><section id="taxation"><h4 id="x6-1-3-taxation"><span class="secno">6.1.3 </span>Taxation<a class="self-link" aria-label="§" href="#taxation"></a></h4><p>The <code>ResellerBroker</code>'s purchase from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> is business-to-business, which is subject to the appropriate taxation based on the <code>ResellerBroker</code> as the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.
The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>'s purchase from the <code>ResellerBroker</code> is business-to-consumer, which is subject to the appropriate taxation based on the <code>ResellerBroker</code> as the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</p><p>Hence any tax exemption that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> may enjoy when purchasing directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> (e.g. in UK law, if the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> is a <a href="https://www.gov.uk/guidance/sport-supplies-that-are-vat-exempt-notice-70145">VAT exempt eligible body</a>) is not relevant here, as no direct contractual relationship is formed between <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> and <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</p></section><section id="scope-of-specification"><h4 id="x6-1-4-scope-of-specification"><span class="secno">6.1.4 </span>Scope of Specification<a class="self-link" aria-label="§" href="#scope-of-specification"></a></h4><p>This specification is designed to govern the interaction between the <code>ResellerBroker</code> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>. It does not include provision for the interaction between the <code>ResellerBroker</code> and <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> explicitly, though it may be repurposed by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to perform this function by treating the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> as a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>. This specification also does not include provision for the recording of the execution of the contractual relationship with any <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a> (e.g. for payment processing fees). Such relationships <em class="rfc2119" title="MUST">MUST</em> be handled separately.
When the <code>brokerRole</code> is set to <code>ResellerBroker</code>, this indicates that the payee for accounting and tax purposes is the <code>broker</code> specified in the <code>Order</code>.
Note that the <code>customer</code> may still optionally be included in the Order, for example to help front-of-house staff identify the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</p></section><section id="conformance-criteria"><h4 id="x6-1-5-conformance-criteria"><span class="secno">6.1.5 </span>Conformance criteria<a class="self-link" aria-label="§" href="#conformance-criteria"></a></h4><p>When the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> generates the <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a>, it must be made payable to <code>Order.broker</code>, <code>Order.broker</code> <em class="rfc2119" title="MUST">MUST</em> be provided and <code>Order.customer</code> is optional.</p></section></section><section id="agentbroker"><h3 id="x6-2-agentbroker"><span class="secno">6.2 </span><code>AgentBroker</code><a class="self-link" aria-label="§" href="#agentbroker"></a></h3><section id="definition-0"><h4 id="x6-2-1-definition"><span class="secno">6.2.1 </span>Definition<a class="self-link" aria-label="§" href="#definition-0"></a></h4><p>An agent is authorized to act on behalf of another (the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, or "principal") to create legal relations with a third party (the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>). Succinctly, it may be referred to as the equal relationship between a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> and an agent whereby the principal, expressly or implicitly, authorizes the agent to work under his or her control and on his or her behalf. The agent is required to negotiate on behalf of the principal (<a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>) and/or bring them and third parties (<a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a>) into contractual relationship.</p></section><section id="contractual-relationships-0"><h4 id="x6-2-2-contractual-relationships"><span class="secno">6.2.2 </span>Contractual Relationships<a class="self-link" aria-label="§" href="#contractual-relationships-0"></a></h4><p>There are three separate types of contractual relationship involved:
<code>AgentBroker</code> with <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, known as the principal-agent relationship or "internal" relationship;
<code>AgentBroker</code> with <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> with whom they deal on their <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>'s behalf ("external relationship"); and
<a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> with <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> when arranged by an <code>AgentBroker</code>.</p><figure id="fig-contractual-relationships-in-agentbroker-mode"><img src="AgentBroker.png" alt="AgentBroker relationships" height="293" width="558">
<figcaption>Figure <span class="figno">12</span> <span class="fig-title">Contractual relationships in AgentBroker mode</span></figcaption>
</figure></section><section id="taxation-0"><h4 id="x6-2-3-taxation"><span class="secno">6.2.3 </span>Taxation<a class="self-link" aria-label="§" href="#taxation-0"></a></h4><p>While facilitated by the <code>AgentBroker</code>, the primary purchase is made by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, as would be the case if the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> was to purchase from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> independently.
Hence any tax exemption that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> may enjoy when purchasing directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> (e.g. in UK law, if the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> is an <a href="https://www.gov.uk/guidance/sport-supplies-that-are-vat-exempt-notice-70145">VAT exempt eligible body</a>) is relevant here.</p><p>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>'s relationship with <code>AgentBroker</code> is business-to-consumer. Hence any additional services (e.g. customer-facing booking fees) are subject to the appropriate taxation based on the <code>AgentBroker</code> as the <code>seller</code>.</p><p>The <code>AgentBroker</code>'s relationship with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> is business-to-business. Hence any additional services (e.g. booking commission) are subject to the appropriate taxation.</p></section><section id="scope-of-specification-0"><h4 id="x6-2-4-scope-of-specification"><span class="secno">6.2.4 </span>Scope of Specification<a class="self-link" aria-label="§" href="#scope-of-specification-0"></a></h4><p>This specification is designed to govern the recording of the execution of the contractual relationship between the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.
The scope of this specification does not include the contractual relationship between the <code>AgentBroker</code> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> (e.g. for booking commission), between the <code>AgentBroker</code> and the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> (e.g. for booking fees) or with any <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a> (e.g. for payment processing fees). Such relationships and the reconciliation of associated invoices <em class="rfc2119" title="MUST">MUST</em> be handled separately.
When the <code>brokerRole</code> is set to <code>AgentBroker</code>, this indicates that the payee for accounting and tax purposes is the <code>customer</code> specified in the <code>Order</code>.</p></section><section id="conformance-criteria-0"><h4 id="x6-2-5-conformance-criteria"><span class="secno">6.2.5 </span>Conformance criteria<a class="self-link" aria-label="§" href="#conformance-criteria-0"></a></h4><p>When the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> generates the <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a>, it must be made payable to <code>Order.customer</code>, <code>Order.broker</code> <em class="rfc2119" title="MUST">MUST</em> be provided and <code>Order.customer</code> <em class="rfc2119" title="MUST">MUST</em> be provided.</p></section><section id="informed-purchase"><h4 id="x6-2-6-informed-purchase"><span class="secno">6.2.6 </span>Informed purchase<a class="self-link" aria-label="§" href="#informed-purchase"></a></h4><p>When using a <code>brokerRole</code> of <code>AgentBroker</code>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> make the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> aware that they are purchasing directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> via the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, and not directly from the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</p></section></section><section id="nobroker"><h3 id="x6-3-nobroker"><span class="secno">6.3 </span><code>NoBroker</code><a class="self-link" aria-label="§" href="#nobroker"></a></h3><section id="definition-1"><h4 id="x6-3-1-definition"><span class="secno">6.3.1 </span>Definition<a class="self-link" aria-label="§" href="#definition-1"></a></h4><p>This specification supports direct purchase by a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> (for example in the context of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>'s own website, or for businesses that purchase large volumes of FacilityUse slots to run leagues).</p></section><section id="contractual-relationships-1"><h4 id="x6-3-2-contractual-relationships"><span class="secno">6.3.2 </span>Contractual Relationships<a class="self-link" aria-label="§" href="#contractual-relationships-1"></a></h4><p>The contractual relationship is a simple one between the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> and the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</p><figure id="fig-contractual-relationships-in-nobroker-mode"><img src="NoBroker.png" alt="NoBroker relationships" height="132" width="564">
<figcaption>Figure <span class="figno">13</span> <span class="fig-title">Contractual relationships in NoBroker mode</span></figcaption>
</figure></section><section id="taxation-1"><h4 id="x6-3-3-taxation"><span class="secno">6.3.3 </span>Taxation<a class="self-link" aria-label="§" href="#taxation-1"></a></h4><p>The purchase is made by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, as would be the case if the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> was to purchase from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> outside of this specification.
Hence any tax exemption that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> may enjoy when purchasing directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> (e.g. in UK law, if the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> is an VAT exempt eligible body) is relevant here.</p></section><section id="scope-of-specification-1"><h4 id="x6-3-4-scope-of-specification"><span class="secno">6.3.4 </span>Scope of Specification<a class="self-link" aria-label="§" href="#scope-of-specification-1"></a></h4><p>This specification is designed to govern the recording of the execution of the contractual relationship between the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.
The scope of this specification does not include the contractual relationship with any <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a> (e.g. for payment processing fees). Such relationships <em class="rfc2119" title="MUST">MUST</em> be handled separately.</p><p>When the <code>brokerRole</code> is set to <code>NoBroker</code>, this indicates that the payee for accounting and tax purposes is the <code>customer</code> specified in the <code>Order</code>.</p></section><section id="conformance-criteria-1"><h4 id="x6-3-5-conformance-criteria"><span class="secno">6.3.5 </span>Conformance criteria<a class="self-link" aria-label="§" href="#conformance-criteria-1"></a></h4><p>When an <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a> is generated, it must be made payable to <code>Order.customer</code>, <code>Order.broker</code> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be provided and <code>Order.customer</code> <em class="rfc2119" title="MUST">MUST</em> be provided.</p></section></section></section><section class="normative" id="systems-of-record"><!--OddPage--><h2 id="x7-systems-of-record"><span class="secno">7. </span>Systems of Record<a class="self-link" aria-label="§" href="#systems-of-record"></a></h2><section id="roles-and-responsibilities-overview"><h3 id="x7-1-roles-and-responsibilities-overview"><span class="secno">7.1 </span>Roles and responsibilities overview<a class="self-link" aria-label="§" href="#roles-and-responsibilities-overview"></a></h3><p>For the purposes of this specification, the key components of a booking are: <code>Order</code>, <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a>, <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> and <a href="#dfn-refund" class="internalDFN" data-link-type="dfn">Refund</a>.</p><p>Note that <code>OrderQuote</code> is a subclass of <code>Order</code> used during the <code>Order</code> creation process, and is not explicitly persisted.</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> has visibility of all components, while for simplicity of implementation the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> only has visibility of the <code>Order</code>, as shown below:</p><figure id="fig-roles-and-responsibilities"><img src="roles.png" alt="Roles and responsibilities" height="316" width="814">
<figcaption>Figure <span class="figno">14</span> <span class="fig-title">Roles and responsibilities</span></figcaption>
</figure><p><code>Order</code>s are the basis of the exchange between the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, with <code>OrderQuote</code>s used as part of the <code>Order</code> creation process. This specification describes a detailed model and API to allow <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a> to manipulate <code>Order</code>s, and only high level functional requirements for the expected behaviour of <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoices</a>, <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payments</a>, and <a href="#dfn-refund" class="internalDFN" data-link-type="dfn">Refunds</a>.</p><table>
<thead>
<tr>
<th>Component</th>
<th>Description</th>
<th>Owner</th>
<th>Audit</th>
</tr>
</thead>
<tbody><tr>
<td><dfn data-dfn-type="dfn" data-plurals="orders" id="dfn-order"><code>Order</code></dfn></td>
<td>A mutable object that encompasses the live state of the bookable <code>Event</code>s within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>. An <code>Order</code> has a <code>orderItem</code>s, a <code>totalPaymentDue</code>, and all tax details, but is not itself a legal representation of a purchase from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</td>
<td><a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
<td>Mutable</td>
</tr>
<tr>
<td><dfn data-dfn-type="dfn" data-plurals="invoices" id="dfn-invoice">Invoice</dfn></td>
<td>An immutable object that is a legal representation of the purchase, which <em class="rfc2119" title="MUST">MUST</em> be rendered to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> as a legally permissible tax receipt, and exist as a tax point. A new <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a> <em class="rfc2119" title="MUST">MUST</em> be generated for the <code>Order</code> to replace the previous <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a> each occasion that an <code>orderItem</code> within an <code>Order</code> is cancelled.</td>
<td><a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a></td>
<td>Immutable</td>
</tr>
<tr>
<td><dfn data-dfn-type="dfn" data-plurals="payments" id="dfn-payment">Payment</dfn></td>
<td>A immutable object that represents the original payment to the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> for the initial <code>Order</code>. Although modelling the <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> is outside the scope of this specification, it is recommended that one payment exists for each <code>Order</code>.</td>
<td><a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a></td>
<td>Immutable</td>
</tr>
<tr>
<td><dfn data-dfn-type="dfn" data-plurals="refunds" id="dfn-refund">Refund</dfn></td>
<td>An immutable object that represents each refund made against the <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a>, up to the <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a>'s total amount</td>
<td><a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a></td>
<td>Immutable</td>
</tr>
</tbody></table></section><section id="invoices-and-tax-receipts"><h3 id="x7-2-invoices-and-tax-receipts"><span class="secno">7.2 </span>Invoices and Tax receipts<a class="self-link" aria-label="§" href="#invoices-and-tax-receipts"></a></h3><p>Due to the variety of business models in use in OpenActive, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> send receipts directly to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> for <code>AgentBroker</code> and <code>ResellerBroker</code> bookings.</p><p>For each successful booking operation (where <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> and <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> together constitute a successful booking operation), the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> generate a new <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a> in the form of a tax receipt, on the basis of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> contents. To ensure that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> is provided with the correct tax receipt, if <code>totalPaymentTaxSpecification</code> is provided in an <code>Order</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> generate a new or updated <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a> and either (a) send a tax receipt representation of the <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a> to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and/or (b) offer a means to allow the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> to easily retrieve a full tax receipt representation of the specific version of the  <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a> at any future date for any previous booking made. As it is ultimately the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>'s responsibility to send tax receipts, they need to be confident that the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> is making tax information available to its <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a> in an accurate and timely manner.</p><p>The tax receipt sent by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> comply with any legal requirements of the jurisdiction of operation.</p><p>Note that if the specification is followed correctly, for all <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> modes where a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> may need to supply a tax receipt manually for any reason, the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> will have sufficient details of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and of the transaction to generate the most recent tax receipt.</p></section><section id="payments-and-refunds"><h3 id="x7-3-payments-and-refunds"><span class="secno">7.3 </span>Payments and Refunds<a class="self-link" aria-label="§" href="#payments-and-refunds"></a></h3><p>Although the details of <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payments</a> and <a href="#dfn-refund" class="internalDFN" data-link-type="dfn">Refunds</a> are not in the scope of this specification, a single <code>Payment</code> object is included in the <code>Order</code> in the <code>payment</code> property to ensure payments are fully traceable in case of audit.</p><p>If payment details were not captured due to the <code>prepayment</code> value of the selected <code>Offer</code>, or if <code>totalPaymentDue</code> is <code>0</code> due to all <code>OrderItem</code>s being free of charge,  the <code>payment</code> property <em class="rfc2119" title="MUST NOT">MUST NOT</em> be included. In all other cases <code>payment</code> property <em class="rfc2119" title="MUST">MUST</em> be included in the <code>Offer</code> at <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a>.</p><section id="virtual-payments"><h4 id="x7-3-1-virtual-payments"><span class="secno">7.3.1 </span>Virtual payments<a class="self-link" aria-label="§" href="#virtual-payments"></a></h4><p>Note that this <code>Payment</code> is permitted to represent a virtual <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> consolidating a number of actual <strong>Payments</strong> to allow for a wide variety of payment methods. In the case where the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> is paid monthly, the <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> may refer to a future invoice against which the <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> will eventually be paid.
</p></section><section id="basic-payment"><h4 id="x7-3-2-basic-payment"><span class="secno">7.3.2 </span>Basic <code>Payment</code><a class="self-link" aria-label="§" href="#basic-payment"></a></h4><p>A unique reference to this <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> <em class="rfc2119" title="MUST">MUST</em> be included in the <code>Payment</code>
<code>identifier</code> of the <code>Order</code> sent to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>. This <code>Payment</code>
<code>identifier</code> <em class="rfc2119" title="MUST">MUST</em> be uniquely resolvable for audit purposes.</p><p>The <code>accountId</code> of the <code>Payment</code> <em class="rfc2119" title="SHOULD">SHOULD</em> be provided to reference the specific account within the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a> that is used for reconciliation purposes.</p><p>The <code>paymentProviderId</code> of the <code>Payment</code> <em class="rfc2119" title="SHOULD">SHOULD</em> be provided to reference the specific <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a> that is used.</p><p>The <code>name</code> of the <code>Payment</code> <em class="rfc2119" title="SHOULD">SHOULD</em> be used to provide information about the source of the payment that can be stored in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, to help the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> in discussions with the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> (e.g. "AcmeBroker Points" or "AcmeBroker via Credit Card").</p><div class="example" id="example-9-example-of-payment">
          <div class="marker">
      <a class="self-link" href="#example-9-example-of-payment">Example 9</a><span class="example-title">: Example of Payment</span>
    </div> <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"payment"</span>: {
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"Payment"</span>,
  <span class="hljs-string">"identifier"</span>: <span class="hljs-string">"12345678ABCD"</span>,
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"Big Media Services"</span>,
  <span class="hljs-string">"accountId"</span>: <span class="hljs-string">"SN1593"</span>,
  <span class="hljs-string">"paymentProviderId"</span>: <span class="hljs-string">"STRIPE"</span>
},</code></pre>
        </div></section><section id="dynamicpayment"><h4 id="x7-3-3-dynamicpayment"><span class="secno">7.3.3 </span><code>DynamicPayment</code><a class="self-link" aria-label="§" href="#dynamicpayment"></a></h4><p>For fully dynamic pricing, where price is not known at the point of purchase, a <code>DynamicPayment</code> <em class="rfc2119" title="MUST">MUST</em> be used. Example use cases include volume-based pricing, where the price of items are calculated at the end of the month depending on the total volume booked during that period.</p><p>To use the <code>DynamicPayment</code> the following preconditions must be met:</p><ul>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> <em class="rfc2119" title="MUST">MUST</em> have agreed an arrangement for dynamic pricing out-of-band, including which <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunities</a> and <code>Offer</code>s it applies to.</li>
<li>Dynamic pricing cannot be mixed with standard pricing behaviour within the same <code>Order</code>, so all <code>OrderItem</code>s selected <em class="rfc2119" title="MUST">MUST</em> be applicable for dynamic pricing based on such agreements.</li>
<li>The <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunities</a> that are selected for booking <em class="rfc2119" title="MUST">MUST</em> be <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a> as in the standard flow.</li>
</ul><p>To use <code>DynamicPayment</code> the booking flow <em class="rfc2119" title="MUST">MUST</em> be completed as normal with the following additional requirements:</p><ul>
<li>The <code>OrderQuote</code>, <code>OrderProposal</code> and <code>Order</code> in request, response, and in the subsequent <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> include <code>totalPaymentDue</code> or <code>totalPaymentTaxSpecification</code>, and <code>OrderItem</code>s <em class="rfc2119" title="MUST NOT">MUST NOT</em> include <code>acceptedOffer</code> or <code>unitTaxSpecification</code>.</li>
<li>The booking flow <em class="rfc2119" title="MUST">MUST</em> be completed <em>as if</em>
<code>prepayment</code> was set to <code>https://openactive.io/Unavailable</code> for the <code>acceptedOffer</code> for all <code>OrderItem</code>s.</li>
<li>The <code>OrderQuote</code> / <code>OrderProposal</code> / <code>Order</code> submitted to <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> and <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> (and <a href="#dfn-p" class="internalDFN" data-link-type="dfn"><b>P</b></a> if using approval) <em class="rfc2119" title="MUST">MUST</em> have a <code>payment</code> property that contains a <code>DynamicPayment</code>, which is consistent throughout the calls.</li>
<li>If the <code>DynamicPayment</code> details supplied (e.g. <code>accountId</code>) are not considered either sufficient or valid for reconciliation by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> then an <code>IncompletePaymentDetailsError</code> or <code>InvalidPaymentDetailsError</code> <em class="rfc2119" title="MUST">MUST</em> be returned by all calls, respectively.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> record any price against the <code>Order</code> or <code>OrderItem</code>s for reconciliation, as such reconciliation <em class="rfc2119" title="MUST">MUST</em> occur completely out-of-band.</li>
</ul><p>The <code>accountId</code> of the <code>DynamicPayment</code> <em class="rfc2119" title="MUST">MUST</em> be used consistently in order to allow the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> to reconcile opportunities booked using a particular account.</p><p>The <code>name</code> of the <code>DynamicPayment</code> <em class="rfc2119" title="SHOULD">SHOULD</em> be used to provide information about the source of the payment that can be stored in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>,  to help the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> in discussions with the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> (e.g. "AcmeBroker Points" or "AcmeBroker Membership").</p><p>Note that the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MAY">MAY</em> choose to validate the <code>DynamicPayment</code> details, as above, though this is not a requirement - it could simply accept any values provided.</p><div class="example" id="example-10-example-of-dynamicpayment">
          <div class="marker">
      <a class="self-link" href="#example-10-example-of-dynamicpayment">Example 10</a><span class="example-title">: Example of DynamicPayment</span>
    </div> <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"payment"</span>: {
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"DynamicPayment"</span>,
  <span class="hljs-string">"identifier"</span>: <span class="hljs-string">"12345678ABCD"</span>,
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"MoveGB Membership"</span>,
  <span class="hljs-string">"accountId"</span>: <span class="hljs-string">"MOVE"</span>
},</code></pre>
        </div></section><section id="payment-reconciliation"><h4 id="x7-3-4-payment-reconciliation"><span class="secno">7.3.4 </span>Payment reconciliation<a class="self-link" aria-label="§" href="#payment-reconciliation"></a></h4><p>Although automated payment reconciliation is outside the current scope of this specification, a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MAY">MAY</em> include identifiers suitable for payment reconciliation to be handled out-of-band with each <code>OrderItem</code> using the <code>additionalProperty</code> property.</p><p>In keeping with the Schema.org definition of <code>PropertyValue</code>, the <code>name</code> and <code>value</code> properties <em class="rfc2119" title="MUST">MUST</em> be provided within any given <code>PropertyValue</code>, and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="SHOULD">SHOULD</em> include these in any reconciliation process with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</p><div class="example" id="example-11-example-of-additionalproperty-for-orderitem">
          <div class="marker">
      <a class="self-link" href="#example-11-example-of-additionalproperty-for-orderitem">Example 11</a><span class="example-title">: Example of additionalProperty for OrderItem</span>
    </div> <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"additionalProperty"</span>: [
  {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"PropertyValue"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"SiteID"</span>,
    <span class="hljs-string">"value"</span>: <span class="hljs-string">"ABC1234"</span>
  },
  {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"PropertyValue"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"DeptID"</span>,
    <span class="hljs-string">"value"</span>: <span class="hljs-string">"D89"</span>
  }
],</code></pre>
        </div></section><section id="integrated-payments"><h4 id="x7-3-5-integrated-payments"><span class="secno">7.3.5 </span>Integrated Payments<a class="self-link" aria-label="§" href="#integrated-payments"></a></h4><p>In some limited circumstances it might also be desirable for an Open Booking API to act as a facade over a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>, and Invoicing systems. For these circumstances the specification allows the API defined here to be extended via additional <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> properties in the <code>Payment</code> type used in <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> in a custom namespace (as specified in the [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>] specification), to facilitate a full payment.</p><div class="example" id="example-12-example-of-payment-extension-point">
          <div class="marker">
      <a class="self-link" href="#example-12-example-of-payment-extension-point">Example 12</a><span class="example-title">: Example of Payment extension point</span>
    </div> <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"payment"</span>: {
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"Payment"</span>,
  <span class="hljs-string">"identifier"</span>: <span class="hljs-string">"12345678ABCD"</span>,
  <span class="hljs-string">"paymentMethod"</span>: <span class="hljs-string">"stripe:StripePayment"</span>,
  <span class="hljs-string">"stripe:token"</span>: <span class="hljs-string">"tok_KPte7942xySKBKyrBu11yEpf"</span>
},</code></pre>
        </div><p>Note that due to the variety of business models available in the OpenActive ecosystem, conformance to this specification requires that the use of any native payment functionality in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> be optional, and the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> always accept a lack of <code>paymentMethod</code> as indication of an external <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a> being used. To maximise flexibility of this extension point, the <code>identifier</code> property within <code>Payment</code> is <em class="rfc2119" title="NOT REQUIRED">NOT REQUIRED</em> if <code>paymentMethod</code> is specified.</p></section></section><section id="tax-calculation"><h3 id="x7-4-tax-calculation"><span class="secno">7.4 </span>Tax calculation<a class="self-link" aria-label="§" href="#tax-calculation"></a></h3><section id="business-to-consumer-tax-calculation-by-booking-system-is-mandatory"><h4 id="x7-4-1-business-to-consumer-tax-calculation-by-booking-system-is-mandatory"><span class="secno">7.4.1 </span>Business-to-consumer tax calculation by Booking System is mandatory<a class="self-link" aria-label="§" href="#business-to-consumer-tax-calculation-by-booking-system-is-mandatory"></a></h4><p>For <code>AgentBroker</code> and <code>NoBroker</code> modes, where the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> is of type <code>Person</code> and a tax receipt is usually generated by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, the tax calculation and associated properties this specification <em class="rfc2119" title="MUST">MUST</em> be implemented by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> (even if the resulting tax amount is zero).</p></section><section id="business-to-business-tax-calculation-by-booking-system-is-optional"><h4 id="x7-4-2-business-to-business-tax-calculation-by-booking-system-is-optional"><span class="secno">7.4.2 </span>Business-to-business tax calculation by Booking System is optional<a class="self-link" aria-label="§" href="#business-to-business-tax-calculation-by-booking-system-is-optional"></a></h4><p>Tax calculation at the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> is <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> when the <code>brokerRole</code> of <code>ResellerBroker</code> is specified, or when a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> of type <code>Organization</code> is specified. If tax calculation is not supported for a <code>ResellerBroker</code>, <code>unitTaxSpecification</code> and <code>totalPaymentTaxSpecification</code> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be included, and the <code>taxMode</code>
<code>https://openactive/TaxNet</code> <em class="rfc2119" title="MUST">MUST</em> be returned in the <code>OrderQuote</code> and <code>Order</code> (i.e. explicitly not including tax).</p><p>This allows tax to be calculated by the <code>ResellerBroker</code> or business <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and reconciled outside of this specification.</p><p>Note that for business-to-business sales for a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> with <code>taxMode</code> of the <code>organizer</code> or <code>provider</code> set to <code>https://openactive/TaxGross</code>, the <code>Offer</code>s available in the opportunity data will still be calculated as tax-inclusive for a business-to-consumer sale, and so <em class="rfc2119" title="MUST">MUST</em> be presented by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> as such, with the business-to-business tax calculation occurring during the booking flow. If the usecase of presenting the correct price up-front gains traction, additional price data must be made available as part of the openly published opportunity data to resolve this shortcoming.</p></section></section><section id="tax-mode"><h3 id="x7-5-tax-mode"><span class="secno">7.5 </span>Tax mode<a class="self-link" aria-label="§" href="#tax-mode"></a></h3><p>The <code>taxMode</code> (<code>https://openactive/TaxNet</code> or <code>https://openactive/TaxGross</code>) is <em class="rfc2119" title="REQUIRED">REQUIRED</em> to be specified at the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> level, and <em class="rfc2119" title="MUST">MUST</em> be reflected within the <code>Organization</code> that is included in the <em class="rfc2119" title="REQUIRED">REQUIRED</em> <code>organizer</code> or <code>provider</code> properties within opportunity data specified in [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>]. It <em class="rfc2119" title="MUST">MUST</em> also be consistent for all <code>Order</code>s originating from that <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</p><p>Note that <code>taxMode</code> only affects the interpretation of the <code>price</code> of the <code>Offer</code>. <code>totalPaymentDue</code> is always Gross (tax inclusive), and <code>unitTaxSpecification</code> and <code>totalPaymentTaxSpecification</code> include only the taxes themselves so are unaffected.</p><table>
<thead>
<tr>
<th><code>taxMode</code></th>
<th><code>https://openactive/TaxNet</code></th>
<th><code>https://openactive/TaxGross</code></th>
</tr>
</thead>
<tbody><tr>
<td>Price displayed</td>
<td>Excludes tax</td>
<td>Includes all applicable taxes assuming a <code>Person</code> as a <code>customer</code></td>
</tr>
<tr>
<td>Currencies usually associated</td>
<td>USD, CAD</td>
<td>EUR, AUD, GBP</td>
</tr>
<tr>
<td>Example price of opportunity before tax</td>
<td>10.00</td>
<td>10.00</td>
</tr>
<tr>
<td>Example tax rate</td>
<td>0.2</td>
<td>0.2</td>
</tr>
<tr>
<td>Price displayed to <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> during browsing (<code>Offer</code>)</td>
<td>10.00</td>
<td>12.00</td>
</tr>
<tr>
<td>Total paid by <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> (<code>totalPaymentDue</code>)</td>
<td>12.00</td>
<td>12.00</td>
</tr>
</tbody></table></section><section id="free-opportunities"><h3 id="x7-6-free-opportunities"><span class="secno">7.6 </span>Free opportunities<a class="self-link" aria-label="§" href="#free-opportunities"></a></h3><p>Free opportunities, defined by those with at least one <code>Offer</code> with a <code>price</code> of <code>0</code>, <em class="rfc2119" title="MUST">MUST</em> follow the same workflow as paid opportunities, except with no interaction with a <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>, and no <code>payment</code> included in <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a>, <a href="#dfn-p" class="internalDFN" data-link-type="dfn"><b>P</b></a> or <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> requests.</p><p>For free <code>Offer</code>s publishers <em class="rfc2119" title="MAY">MAY</em> not include <code>priceCurrency</code>. If a <code>priceCurrency</code> is not available then <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a> <em class="rfc2119" title="SHOULD">SHOULD</em> display "Free" or equivalent when displaying a zero price.</p></section><section id="offer-overrides"><h3 id="x7-7-offer-overrides"><span class="secno">7.7 </span>Offer overrides<a class="self-link" aria-label="§" href="#offer-overrides"></a></h3><p>The unit price of an <code>OrderItem</code> <em class="rfc2119" title="MAY">MAY</em> be overridden to allow for business models with variable pricing (where price differs from list price).</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> <em class="rfc2119" title="MUST">MUST</em> have agreed an arrangement for offer overrides out-of-band, including which <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunities</a> and <code>Offer</code>s they may be applied to.</p><p>An <code>OfferOverride</code> type may be supplied by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to the <code>acceptedOffer</code> property at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> and <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a>. When an <code>OfferOverride</code> is used, it <em class="rfc2119" title="MUST">MUST</em> be used consistently between <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> and <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a>, it <em class="rfc2119" title="MUST">MUST</em> be used by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> instead of <code>acceptedOffer</code> to calculate the tax and totals. It <em class="rfc2119" title="MAY">MAY</em> be used for any <code>brokerRole</code>.</p><p>The <code>unitTaxSpecification</code> is calculated by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> exactly as it would be for a standard <code>Offer</code>. The <code>price</code> of the <code>OfferOverride</code> may be zero, and also may be higher or lower than the available <code>Offer</code>s that exist in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</p><p><code>OfferOverride</code> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be used when <code>isAccessibleForFree</code> is <code>true</code>, as free events cannot be overridden. Note that <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> that only offer free opportunities <em class="rfc2119" title="MUST NOT">MUST NOT</em> implement <code>OfferOverride</code> support, and must always throw an error when it is used.</p><div class="example" id="example-13-example-of-offeroverride">
          <div class="marker">
      <a class="self-link" href="#example-13-example-of-offeroverride">Example 13</a><span class="example-title">: Example of OfferOverride</span>
    </div> <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"acceptedOffer"</span>: {
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"OfferOverride"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
  <span class="hljs-string">"price"</span>: <span class="hljs-number">10.00</span>,
  <span class="hljs-string">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
}</code></pre>
        </div></section></section><section class="normative" id="order-operations"><!--OddPage--><h2 id="x8-order-operations"><span class="secno">8. </span>Order Operations<a class="self-link" aria-label="§" href="#order-operations"></a></h2><section id="definition-of-an-open-booking-bookable-opportunity-and-offer-pair"><h3 id="x8-1-definition-of-an-open-booking-bookable-opportunity-and-offer-pair"><span class="secno">8.1 </span>Definition of an Open Booking 'bookable' Opportunity and Offer pair<a class="self-link" aria-label="§" href="#definition-of-an-open-booking-bookable-opportunity-and-offer-pair"></a></h3><p>Before entering into the Booking Flow, the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> have selected at least one <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a> pair of an <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> ("Yoga Tuesday 14th 7pm") with an associated <code>Offer</code> ("Junior (8-18) £9"). These pairs populate the <code>acceptedOffer</code> and <code>orderedItem</code> properties within the <code>OrderItem</code>s.</p><p>The pairing of an <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> of type <code>Event</code>, <code>ScheduledSession</code>, <code>HeadlineEvent</code>, <code>Slot</code> or <code>CourseInstance</code> with an <code>Offer</code> is deemed to be <dfn data-dfn-type="dfn" id="dfn-bookable">bookable</dfn> via the Open Booking API if the <code>Offer</code> is applicable to the <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> following the principles of <code>Offer</code> inheritance contained in [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>], and if both the <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> and <code>Offer</code> meet the criteria specified below.</p><p>Bookable <code>Offer</code>s:</p><ul>
<li><p><code>availableChannel</code> of the <code>Offer</code> includes <code>https://openactive.io/OpenBookingPrepayment</code>.</p>
</li>
<li><p><code>advanceBooking</code> of the <code>Offer</code> is not equal to <code>https://openactive.io/Unavailable</code>.</p>
</li>
<li><p>The <code>Offer</code> is current based on <code>validFromBeforeStartDate</code>.</p>
</li>
</ul><p>Bookable <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunities</a>:</p><ul>
<li><p>The <code>endDate</code> is not already in the past (note that bookings are still possible after the <code>startDate</code>).</p>
</li>
<li><p>The <code>eventStatus</code> of the <code>Event</code>, <code>ScheduledSession</code>, or <code>Slot</code> is not <code>https://schema.org/EventCancelled</code> or <code>https://schema.org/EventPostponed</code>.</p>
</li>
<li><p>The <code>remainingAttendeeCapacity</code> or <code>remainingUses</code> is greater than the number required.</p>
</li>
<li><p>The <code>potentialAction</code> of dataset site includes an <code>OpenBookingAction</code> object.</p>
</li>
<li><p>The <code>validFromBeforeStartDate</code> duration (if provided) subtracted from the <code>startDate</code> in the past. This allows for a "bookahead" window to be specified.</p>
</li>
<li><p>The <code>taxMode</code> (<code>https://openactive/TaxNet</code> or <code>https://openactive/TaxGross</code>) is specified within the <code>Organization</code> that is included in the <em class="rfc2119" title="REQUIRED">REQUIRED</em> <code>organizer</code> or <code>provider</code> properties.</p>
</li>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> has machine readable permission to access the relevant instance of a compliant Open Booking API provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> via an API key or similar token.</p>
</li>
</ul><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> attempt to book an opportunity that is not <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a> by the above criteria. The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> include an <code>error</code> of value <code>UnavailableOpportunityError</code> against each <code>OrderItem</code> in the <code>OrderQuote</code> that is not <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a>.</p><section id="booking-restrictions"><h4 id="x8-1-1-booking-restrictions"><span class="secno">8.1.1 </span>Booking restrictions<a class="self-link" aria-label="§" href="#booking-restrictions"></a></h4><p>Note that although the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> may be ineligible to attend a <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a>
<a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> via an associated <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a>
<code>Offer</code> based on the <code>genderRestriction</code> or <code>ageRange</code>, this specification encourages the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> NOT to capture additional personal data about the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> (e.g. gender and date of birth) and NOT to enforce validation of these restrictions using such data, but instead to prominently display clear messaging regarding such restrictions throughout the booking process to ensure that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> is aware of these and able to make an informed decision.</p><p>There may be additional restrictions placed on an <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>. For example, it may be that one of the party must be over a certain age as a supervising adult if some of the party are minors. It is the responsibility of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> to make such restrictions available as <code>attendeeInstructions</code> on the <code>SessionSeries</code>, <code>FacilityUse</code>, <code>Event</code>, <code>HeadlineEvent</code> or <code>CourseInstance</code>, and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> display these instructions clearly during the booking process.</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MAY">MAY</em> filter the <code>Offer</code>s it displays, for example based on <code>ageRange</code> of the <code>Offer</code>, to increase the relevance of the <code>Offer</code>s displayed to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>'s audience.</p></section></section><section id="amending-the-orderquote-before-b"><h3 id="x8-2-amending-the-orderquote-before-b"><span class="secno">8.2 </span>Amending the OrderQuote before <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a><a class="self-link" aria-label="§" href="#amending-the-orderquote-before-b"></a></h3><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MAY">MAY</em> call <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> and <em class="rfc2119" title="MUST">MUST</em> call <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> when the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> updates their basket to add and remove items.</p><p>When repeated calls to <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> or <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> are made with the same UUID, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> update any associated lease to match the latest set of <code>OrderItem</code>s by removing those <code>OrderItem</code> that are not present in the request from the lease, and adding those <code>OrderItem</code> that have been added since the last call to the lease.</p><p>Leases may be cancelled by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> as a courtesy by submitting an OrderQuote Deletion request using the same UUID. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="SHOULD">SHOULD</em> make a reasonable attempt to cancel all leases when it is aware that a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> has abandoned their journey, or if an error occurs and a new UUID is to be generated for the same customer. This increases the likelihood of an opportunity being booked with one space remaining.</p><p>For <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> that have not implemented leasing, an OrderQuote Deletion request <em class="rfc2119" title="MUST">MUST</em> simply return a 204 success status in all cases.</p></section><section id="cancellation-after-b"><h3 id="x8-3-cancellation-after-b"><span class="secno">8.3 </span>Cancellation after <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a><a class="self-link" aria-label="§" href="#cancellation-after-b"></a></h3><p>Either the whole <code>Order</code> or individual <code>OrderItem</code>s within the <code>Order</code> may be cancelled after <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a>, however <code>OrderItem</code>s cannot be replaced or added to an existing <code>Order</code> past this point within this version of the specification.</p><p>The cancellation may be requested by either the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> or the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, and results in an updated <code>Order</code> item on the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>. Once a cancellation status is placed on an <code>OrderItem</code> within an <code>Order</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> it is assumed by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to have been processed, and it <em class="rfc2119" title="MUST NOT">MUST NOT</em> be reversed. A new <code>Order</code> will need to created to reinstate the booking.</p><section id="refund-after-the-opportunity-has-occurred"><h4 id="x8-3-1-refund-after-the-opportunity-has-occurred"><span class="secno">8.3.1 </span>Refund after the opportunity has occurred<a class="self-link" aria-label="§" href="#refund-after-the-opportunity-has-occurred"></a></h4><p>Although a cancellation may be requested before the opportunity has occurred in order to trigger a refund, cancellation and refund after an opportunity has occurred is currently outside the scope of this specification.</p><p>Full and partial refunds after an opportunity has occurred <em class="rfc2119" title="MUST">MUST</em> be handled out-of-band directly between the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</p></section><section id="customer-requested-cancellation"><h4 id="x8-3-2-customer-requested-cancellation"><span class="secno">8.3.2 </span>Customer requested cancellation<a class="self-link" aria-label="§" href="#customer-requested-cancellation"></a></h4><figure id="fig-customer-requested-cancellation"><img src="customercancelled.png" alt="Customer requested cancellation" height="531" width="766">
<figcaption>Figure <span class="figno">15</span> <span class="fig-title">Customer requested cancellation</span></figcaption>
</figure><p>To cancel an existing OrderItem, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em>:</p><ol>
<li><p>Use the latest state of the <code>Order</code> stored during the booking flow and updated via the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> to determine which <code>OrderItem</code>s may be cancelled and refunded. If <code>allowCustomerCancellationFullRefund</code> is <code>true</code> and <code>latestCancellationBeforeStartDate</code> subtracted from the opportunity <code>startDate</code> is in the future, a PATCH against the <code>Order</code> including the <code>OrderItem</code> with <code>"orderItemStatus": "https://openactive.io/CustomerCancelled"</code> <em class="rfc2119" title="SHOULD">SHOULD</em> succeed.</p>
</li>
<li><p>Inform the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> of the refund being requested before they commit to cancellation, using the existing data available in the stored <code>Order</code> to communicate the <code>OrderItem</code>s that are included in the full refund request. </p>
</li>
<li><p>Submit a PATCH for the <code>Order</code> including only the <code>id</code> for each of the <code>OrderItem</code>s to be cancelled, with an <code>"orderItemStatus": "https://openactive.io/CustomerCancelled"</code> set on each. On success, a status code 204 response will be received, without any body. On failure a status code 400 response will be received, containing a <code>CancellationNotPermittedError</code> error including a <code>description</code> of the reason, which <em class="rfc2119" title="SHOULD">SHOULD</em> be displayed to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.
</p>
</li>
<li><p>Process any refunds based on the resulting updates to the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, based on the updated <code>totalPaymentDue</code>. Successfully cancelled <code>OrderItems</code> will have <code>orderItemStatus</code> set to <code>https://openactive.io/CustomerCancelled</code>. Note refunds <em class="rfc2119" title="MUST NOT">MUST NOT</em> be processed except in response to updates in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>.</p>
</li>
</ol><p>To cancel an entire <code>Order</code>, the PATCH request <em class="rfc2119" title="MUST">MUST</em> include <code>"orderItemStatus": "https://openactive.io/CustomerCancelled"</code> for each <code>OrderItem</code> within it.</p><p>Note that there is no provision for a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> to cancel an <code>Order</code> after the cancellation window specified by <code>latestCancellationBeforeStartDate</code>. They may wish to do this out of politeness even though no refund is possible, with the benefit that their place may be taken by another participant, which can be included in future versions of this specification.</p></section><section id="seller-requested-cancellation"><h4 id="x8-3-3-seller-requested-cancellation"><span class="secno">8.3.3 </span>Seller requested cancellation<a class="self-link" aria-label="§" href="#seller-requested-cancellation"></a></h4><figure id="fig-seller-requested-cancellation"><img src="sellercancelled.png" alt="Seller requested cancellation" height="317" width="653">
<figcaption>Figure <span class="figno">16</span> <span class="fig-title">Seller requested cancellation</span></figcaption>
</figure><p><code>OrderItems</code> cancelled by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> will have <code>orderItemStatus</code> set to <code>https://openactive.io/SellerCancelled</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, and will optionally include a <code>cancellationMessage</code>. Refunds <em class="rfc2119" title="MUST">MUST</em> be processed in response to the resulting updates in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, and the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> be notified with the <code>cancellationMessage</code> if provided.</p></section></section><section id="orders-feed-notifications-updates-and-refunds"><h3 id="x8-4-orders-feed-notifications-updates-and-refunds"><span class="secno">8.4 </span>Orders feed: Notifications, updates and refunds<a class="self-link" aria-label="§" href="#orders-feed-notifications-updates-and-refunds"></a></h3><p>An <dfn data-dfn-type="dfn" id="dfn-orders-feed">Orders feed</dfn>, which is a secure [<cite><a class="bibref" href="#bib-rpde">RPDE</a></cite>] feed of <code>Order</code>s, <em class="rfc2119" title="MUST">MUST</em> be provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, with the contents of the feed specific to the authenticating <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>. As noted in <a href="#new-orders-and-orderproposals">New Orders and OrderProposals</a>, this list must include all, and only, <a href="#dfn-order" class="internalDFN" data-link-type="dfn"><code>Order</code></a>s that have been updated by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> subsequent to successful completion of <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a>. This allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to maintain an updated state of all their bookings across a number of <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a>, even when changes are made outside of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</p><p>This also allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to handle refunds to cancellations, and process notifications to <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a> in a consistent way.</p><section id="orders-feed-inconsistencies"><h4 id="x8-4-1-orders-feed-inconsistencies"><span class="secno">8.4.1 </span>Orders Feed Inconsistencies<a class="self-link" aria-label="§" href="#orders-feed-inconsistencies"></a></h4><p>An error condition exists where an unrecognised <code>Order</code> item is found by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> on the feed. Due to the <code>Order</code> being stored during the <a href="#dfn-payment-authorisation" class="internalDFN" data-link-type="dfn">Payment Authorisation</a> stage, there should always be a matching <code>Order</code> to any UUID on the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> even if it has been soft-deleted. This would make an unrecognised <code>Order</code> an impossible scenario, and hence an unrecognised <code>Order</code> should be logged as a serious error within the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and promptly investigated.</p></section><section id="order-stores-with-eventual-consistency"><h4 id="x8-4-2-order-stores-with-eventual-consistency"><span class="secno">8.4.2 </span>Order stores with eventual consistency<a class="self-link" aria-label="§" href="#order-stores-with-eventual-consistency"></a></h4><p>It is important that the storage used by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> for <code>Order</code>s provides a <a href="https://aphyr.com/posts/313-strong-consistency-models">linearizability</a> guarantee when <code>Order</code>s are retrieved by ID, due to the partial updates that are applied to it from the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> and the creation of the initial <code>Order</code> being synchronous.</p></section><section id="booking-system-updating-the-orders-feed"><h4 id="x8-4-3-booking-system-updating-the-orders-feed"><span class="secno">8.4.3 </span>Booking System: Updating the Orders feed<a class="self-link" aria-label="§" href="#booking-system-updating-the-orders-feed"></a></h4><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> must ensure that the <code>Order</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> represent the current state of <code>OrderItem</code>s within the system, for the properties included in the feed. Hence any change to any property within an <code>Order</code> in the feed must result in a change to the <code>modified</code> property associated with that <code>Order</code>.</p></section><section id="broker-processing-the-orders-feed"><h4 id="x8-4-4-broker-processing-the-orders-feed"><span class="secno">8.4.4 </span>Broker: Processing the Orders feed<a class="self-link" aria-label="§" href="#broker-processing-the-orders-feed"></a></h4><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> maintain an up-to-date store of <code>Order</code>s received from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>. Each <code>Order</code> received is compared to the last <code>Order</code> stored, and any differences between the old and new content trigger notifications and refunds to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, as well as updating the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>'s store.</p><p>Hence it is important for the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to consider their store of <code>Order</code>s as durable, and not simply a cache, to ensure their <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a> always get relevant notifications.</p><p>Note that the properties included in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> <em class="rfc2119" title="MAY">MAY</em> be a subset of the <code>Order</code> response from <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> (effectively making the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> a series of PATCH requests for the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>). It is the responsibility of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to process the contents of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> in a manner that maintains a complete view of the <code>Order</code> state.</p><p><a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a> <em class="rfc2119" title="MUST">MUST</em> harvest the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> with a frequency of at least once every 60 seconds to ensure expediency of updates and notifications to <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a>.</p></section><section id="new-orders-and-orderproposals"><h4 id="x8-4-5-new-orders-and-orderproposals"><span class="secno">8.4.5 </span>New <code>Order</code>s and <code>OrderProposal</code>s<a class="self-link" aria-label="§" href="#new-orders-and-orderproposals"></a></h4><p>A new <code>Order</code> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be displayed by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and other operations such as cancellation <em class="rfc2119" title="MUST NOT">MUST NOT</em> be possible until it has reached the <code>orderCreationStatus</code> of <code>https://openactive.io/OrderCreationComplete</code>, after which the <code>orderCreationStatus</code> can be completely ignored.</p><p>New <code>OrderProposal</code>s <em class="rfc2119" title="MUST">MUST</em> be stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> based on a successful response to the Order Proposal call.</p><p>New <code>Order</code>s and <code>OrderProposal</code>s are not included in the feed until they have been updated at least once. This minimises the volume of <code>Order</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, and allows the polling frequency of the feed to be greatly reduced, which reduces the overall load on the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</p><p>Hence all <code>Order</code>s and <code>OrderProposal</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> will always be recognised by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> as updates to an existing stored <code>Order</code> or <code>OrderProposal</code>, and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> should treat any unrecognised <code>Order</code>s or <code>OrderProposal</code>s in the feed as a serious implementation error.</p></section><section id="cancellation-refund-calculation-and-notification"><h4 id="x8-4-6-cancellation-refund-calculation-and-notification"><span class="secno">8.4.6 </span>Cancellation, refund calculation and notification<a class="self-link" aria-label="§" href="#cancellation-refund-calculation-and-notification"></a></h4><p>Regardless of the source of the cancellation, the process for refunding and notifying the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and updating the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>'s records is exactly the same.</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> process refunds for each new cancellation found in the feed, and it is the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>'s responsibility to continually retry failed refund processing and escalate any processing failure to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> accordingly. Note that the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> is "fire and forget" for the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>: once an <code>OrderItem</code> is updated with a cancellation status in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, the status <em class="rfc2119" title="MUST">MUST</em> not be reversed, and is assumed by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to be processed.</p><p>For <code>Order</code>s found with <code>OrderItem</code>s that contain <code>orderItemStatus</code> with new <code>https://openactive.io/CustomerCancelled</code> or <code>https://openactive.io/SellerCancelled</code> values and a new corresponding <code>totalPaymentDue</code> value, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> instruct the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a> to issue a new <a href="#dfn-refund" class="internalDFN" data-link-type="dfn">Refund</a> such that the new <code>totalPaymentDue</code> value of the <code>Order</code> is equal to the value of the associated <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> less all <a href="#dfn-refund" class="internalDFN" data-link-type="dfn">Refunds</a> including the new one.</p><p>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> be notified after a refund is successfully processed, using the <code>orderItemStatus</code> to indicate the source of the cancellation.</p><p>If refund processing takes longer than 1 minute, and a new status of <code>https://openactive.io/SellerCancelled</code> was detected by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, then the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> must be notified immediately of a cancellation ahead of the notification of the completed refund. This ensures the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> can rely on the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> as a notification channel in the event of cancellation. The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> be notified with the <code>cancellationMessage</code> for the <code>OrderItem</code> if provided.</p><p>Note that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> be notified in the event of all cancellations, even if no refund is due for free opportunities.</p></section><section id="partial-refunds-and-out-of-band-arrangements"><h4 id="x8-4-7-partial-refunds-and-out-of-band-arrangements"><span class="secno">8.4.7 </span>Partial Refunds and out-of-band arrangements<a class="self-link" aria-label="§" href="#partial-refunds-and-out-of-band-arrangements"></a></h4><p>This version of the specification does not allow a refund to be processed (in full or in part) by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> without going via the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> for any <code>Order</code> that has been placed via the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>. <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> <em class="rfc2119" title="MUST">MUST</em> disable their own refund functionality for <code>Order</code>s placed via a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> - only allowing Seller requested cancellations which trigger the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to provide full item refunds - to ensure that the book keeping and invoices of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> are not invalidated.</p><p>Partial refunds <em class="rfc2119" title="MAY">MAY</em> be handled by out-of-band arrangements between the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> provided they do not have any affect on the Open Booking API interface. For example, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> could issue a partial refund and then reassign the remaining funds as a cancellation penalty via a new invoice handled and reconciled directly with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> outside the scope of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> and this specification.</p></section><section id="change-of-logistics-notifications"><h4 id="x8-4-8-change-of-logistics-notifications"><span class="secno">8.4.8 </span>Change of logistics notifications<a class="self-link" aria-label="§" href="#change-of-logistics-notifications"></a></h4><p>The <code>orderedItem</code> within the <code>OrderItem</code> of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> includes an <code>id</code> reference to an opportunity, which may be found and cross-referenced with other sources of opportunity data, for example an [<cite><a class="bibref" href="#bib-rpde">RPDE</a></cite>] open feed.</p><p>This specification does not require the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> to include the full contents of the opportunities within the <code>orderedItem</code>, and hence the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> monitor the opportunity data feeds for this information and <em class="rfc2119" title="MUST">MUST</em> provide a notification to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> for substantive changes to the opportunity (e.g. changes to <code>startDate</code>).</p></section></section><section id="amending-the-order-after-b"><h3 id="x8-5-amending-the-order-after-b"><span class="secno">8.5 </span>Amending the Order after <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a><a class="self-link" aria-label="§" href="#amending-the-order-after-b"></a></h3><p><code>OrderItem</code>s cannot be replaced or added to an existing <code>Order</code> within this version of the specification. A new <code>Order</code> must be created, and the old <code>Order</code> cancelled.</p><p>For the common case of rescheduling a <code>SessionSeries</code> or <code>FacilityUse</code> booking, the following steps are <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> for the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>:</p><ol>
<li><p>Request an <code>OrderQuote</code> for the new <code>orderItem</code>s with a new UUID, using <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a>.</p>
</li>
<li><p>Check the latest stored state of <code>Order</code>s from the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> to ensure that old <code>OrderItem</code> allows <code>allowCustomerCancellationFullRefund</code>.</p>
</li>
<li><p>Clearly display messaging to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> that explains that this transaction will involve a refund and new purchase, and so they will expect a refund for the old item and a new transaction for the new one. Information should be displayed to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> if any price difference exists between the two <code>Order</code>s, for the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> to confirm.</p>
</li>
<li><p>Request new payment details from the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and Authorise the amount specified by <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a>, then PATCH the old <code>Order</code> via the Order Cancellation endpoint, and if successful, complete <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> as normal.</p>
</li>
</ol><p>The new <code>Order</code> is completed as described in the <a href="#simple-booking-flow">Simple Booking Flow</a>, and the existing <code>OrderItem</code> is cancelled with the refund processed as described elsewhere.</p></section><section id="delivery-of-terms-and-conditions-and-privacy-policy"><h3 id="x8-6-delivery-of-terms-and-conditions-and-privacy-policy"><span class="secno">8.6 </span>Delivery of Terms and Conditions and Privacy Policy<a class="self-link" aria-label="§" href="#delivery-of-terms-and-conditions-and-privacy-policy"></a></h3><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> make the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> aware of any <code>termsOfService</code> provided within the <code>seller</code>, <code>broker</code>, and <code>bookingService</code> (which may include Terms and Conditions and Privacy Policy) before the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> confirms their purchase.</p><p>If <code>requiresExplicitConsent</code> is <code>true</code> for any <code>termsOfService</code> then the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> have explicitly acted to assent to such terms before the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> completes <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a>.</p><p>Since, during booking, the details of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> are provided to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> inform the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> of any implications with respect to the GDPR or other data protection legislation.</p><p>Note that <code>termsOfService</code> may only be specified at the <code>seller</code>, <code>broker</code> or <code>bookingService</code> level within the <code>Order</code>, and may not be provided for a specific <code>Offer</code> or <code>OrderItem</code>.</p><div class="example" id="example-14-properties-for-terms-and-conditions-and-privacy-policy">
          <div class="marker">
      <a class="self-link" href="#example-14-properties-for-terms-and-conditions-and-privacy-policy">Example 14</a><span class="example-title">: Properties for Terms and Conditions and Privacy Policy</span>
    </div> <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"termsOfService"</span>: [
  {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"Terms"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>,
    <span class="hljs-string">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
  },
  {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"Terms"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>,
    <span class="hljs-string">"requiresExplicitConsent"</span>: <span class="hljs-literal">true</span>
  }
]</code></pre>
        </div><p>The URLs in the example are only illustrative.</p></section><section id="access-control"><h3 id="x8-7-access-control"><span class="secno">8.7 </span>Access control<a class="self-link" aria-label="§" href="#access-control"></a></h3><p>For opportunities that require entry into a restricted building or area to participate, it is <em class="rfc2119" title="REQUIRED">REQUIRED</em> that <code>OrderItem</code> include unique access control data within <code>accessCode</code> and <code>accessToken</code>. An <code>accessCode</code> <em class="rfc2119" title="SHOULD">SHOULD</em> be provided for manual use in the event that an <code>accessToken</code> fails.</p><p>Each <code>accessCode</code> and <code>accessToken</code> <em class="rfc2119" title="MUST">MUST</em> represent unique methods of entry, and <em class="rfc2119" title="MUST NOT">MUST NOT</em> be duplicated in different formats. For example, multiple formats (e.g. PNG, JPEG) of the same <code>accessToken</code> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be supplied.</p><p>A <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> make all supplied <code>accessToken</code>s and <code>accessCode</code>s available to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, with the exception of <code>Barcode</code>s that do not have fallback image <code>url</code>. <code>Barcode</code>s without a <code>url</code> <em class="rfc2119" title="MAY">MAY</em> be ignored if the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> is unable to process them.
</p><section id="text-based-access-control"><h4 id="x8-7-1-text-based-access-control"><span class="secno">8.7.1 </span>Text-based access control<a class="self-link" aria-label="§" href="#text-based-access-control"></a></h4><p>PIN codes, Order identifiers, or simply the e-mail address of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> are all permissible for the purposes of access control.</p><p>In keeping with the Schema.org definition of <code>PropertyValue</code>, the <code>name</code> property <em class="rfc2119" title="SHOULD">SHOULD</em> be used for the name of the property, and the <code>description</code> property <em class="rfc2119" title="SHOULD">SHOULD</em> be used for any human-readable access control code(s).
</p><div class="example" id="example-15-example-of-accesscode-used-for-a-pin-code">
          <div class="marker">
      <a class="self-link" href="#example-15-example-of-accesscode-used-for-a-pin-code">Example 15</a><span class="example-title">: Example of accessCode used for a PIN Code</span>
    </div> <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"accessCode"</span>: [
  {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"PropertyValue"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"PIN Code"</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"1234"</span>
  }
],</code></pre>
        </div><div class="example" id="example-16-example-of-accesscode-used-for-a-booking-reference">
          <div class="marker">
      <a class="self-link" href="#example-16-example-of-accesscode-used-for-a-booking-reference">Example 16</a><span class="example-title">: Example of accessCode used for a booking reference</span>
    </div> <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"accessCode"</span>: [
  {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"PropertyValue"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Booking Reference"</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"123456789"</span>
  }
],</code></pre>
        </div></section><section id="image-based-access-control"><h4 id="x8-7-2-image-based-access-control"><span class="secno">8.7.2 </span>Image-based access control<a class="self-link" aria-label="§" href="#image-based-access-control"></a></h4><p>Images to be displayed to provide access, for example access tickets rendered by the booking system, <em class="rfc2119" title="MAY">MAY</em> be included as an <code>ImageObject</code> within the <code>accessToken</code> array.</p><p><code>ImageObject</code> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be used for fallback images of a <code>Barcode</code>; the <code>url</code> property of the <code>Barcode</code> <em class="rfc2119" title="MUST">MUST</em> be used for this purpose.</p><div class="example" id="example-17-example-of-imageobject-in-accesstoken">
          <div class="marker">
      <a class="self-link" href="#example-17-example-of-imageobject-in-accesstoken">Example 17</a><span class="example-title">: Example of ImageObject in accessToken</span>
    </div> <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"accessToken"</span>: [
  {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://access.example.com/476ac24c694da79c5e33731ebbb5f1"</span>
  }
],</code></pre>
        </div></section><section id="extension-point-for-barcode-based-access-control"><h4 id="x8-7-3-extension-point-for-barcode-based-access-control"><span class="secno">8.7.3 </span>Extension point for barcode-based access control<a class="self-link" aria-label="§" href="#extension-point-for-barcode-based-access-control"></a></h4><p>Access barcodes to be rendered by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MAY">MAY</em> be included as a <code>Barcode</code> within the <code>accessToken</code> array. Note that <code>Barcode</code> subclasses <code>ImageObject</code>, allowing it to contain a fallback rendered barcode image <code>url</code> in addition to the raw barcode details. <code>Barcode</code>s <em class="rfc2119" title="SHOULD">SHOULD</em> include a fallback image <code>url</code>.</p><p>Due to the variety of barcode formats available, the specification expects the <code>Barcode</code> to include additional properties using a custom namespace (as specified in the [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>] specification), enough to allow the barcode to be reproduced by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>. This will help inform future versions of the specification.</p><div class="example" id="example-18-example-of-barcode-in-accesstoken">
          <div class="marker">
      <a class="self-link" href="#example-18-example-of-barcode-in-accesstoken">Example 18</a><span class="example-title">: Example of Barcode in accessToken</span>
    </div> <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"accessToken"</span>: [
  {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"Barcode"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://fallback.image.example.com/476ac24c694da79c5e33731ebbb5f1"</span>,
    <span class="hljs-string">"text"</span>: <span class="hljs-string">"0123456789"</span>,
    <span class="hljs-string">"bookwhen:codeType"</span>: <span class="hljs-string">"code128"</span>
  }
],</code></pre>
        </div></section></section><section id="general-extension-mechanism"><h3 id="x8-8-general-extension-mechanism"><span class="secno">8.8 </span>General extension mechanism<a class="self-link" aria-label="§" href="#general-extension-mechanism"></a></h3><p>Additional <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> extension properties <em class="rfc2119" title="MAY">MAY</em> be included in any request and response defined within this specification using a custom namespace (as specified in the [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>] specification), and the values of such extension properties <em class="rfc2119" title="MAY">MAY</em> alter the behaviour of the API. However such extension properties <em class="rfc2119" title="MUST NOT">MUST NOT</em> be required and the API <em class="rfc2119" title="MUST">MUST</em> function exactly according to this specification when these extension properties are completely omitted or ignored, in order to ensure full compatibility with this specification is retained.</p><p>Any extension properties defined for an API implementation <em class="rfc2119" title="MUST">MUST</em> be fully documented, in order to ensure that the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> has a complete view of the functionality it is exposing to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</p></section></section><section class="normative" id="endpoints"><!--OddPage--><h2 id="x9-endpoints"><span class="secno">9. </span>Endpoints<a class="self-link" aria-label="§" href="#endpoints"></a></h2><p>This API has been defined around the concept of URL discovery, using the [<cite><a class="bibref" href="#bib-dataset-api-discovery">Dataset-API-Discovery</a></cite>] specification as a basis. This allows resource URLs which match the naming conventions of each <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</p><section id="paths-and-verbs"><h3 id="x9-1-paths-and-verbs"><span class="secno">9.1 </span>Paths and Verbs<a class="self-link" aria-label="§" href="#paths-and-verbs"></a></h3><p>Due to URL discovery, the paths of the endpoints below are illustrative, as the actual paths may vary provided they are consistent within an implementation.</p><p>A summary of endpoints defined by this specification is provided below:</p><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td>OrderQuote Creation <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Yes</td>
<td>OrderQuote</td>
<td>PUT</td>
<td><code>/order-quote-templates/{uuid}</code></td>
</tr>
<tr>
<td>OrderQuote Creation <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Yes</td>
<td>OrderQuote</td>
<td>PUT</td>
<td><code>/order-quotes/{uuid}</code></td>
</tr>
<tr>
<td><a href="#dfn-orderquote-deletion" class="internalDFN" data-link-type="dfn">OrderQuote Deletion</a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td></td>
<td>OrderQuote</td>
<td>DELETE</td>
<td><code>/order-quotes/{uuid}</code></td>
</tr>
<tr>
<td>OrderProposal Creation <a href="#dfn-p" class="internalDFN" data-link-type="dfn"><b>P</b></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>Yes</td>
<td>OrderProposal</td>
<td>PUT</td>
<td><code>/order-proposals/{uuid}</code></td>
</tr>
<tr>
<td><a href="#dfn-orderproposal-update" class="internalDFN" data-link-type="dfn">OrderProposal Update</a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td></td>
<td>OrderProposal</td>
<td>PATCH</td>
<td><code>/order-proposals/{uuid}</code></td>
</tr>
<tr>
<td>Order Creation <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Yes</td>
<td>Order</td>
<td>PUT</td>
<td><code>/orders/{uuid}</code></td>
</tr>
<tr>
<td><a href="#dfn-order-deletion" class="internalDFN" data-link-type="dfn">Order Deletion</a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td></td>
<td>Order</td>
<td>DELETE</td>
<td><code>/orders/{uuid}</code></td>
</tr>
<tr>
<td><a href="#dfn-order-cancellation" class="internalDFN" data-link-type="dfn">Order Cancellation</a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td></td>
<td>Order</td>
<td>PATCH</td>
<td><code>/orders/{uuid}</code></td>
</tr>
<tr>
<td><a href="#orders-rpde-feed">Orders RPDE Feed</a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Yes</td>
<td>Orders feed</td>
<td>GET</td>
<td><code>/orders-rpde</code></td>
</tr>
<tr>
<td><a href="#dfn-order-status" class="internalDFN" data-link-type="dfn">Order Status</a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>Yes</td>
<td>Order</td>
<td>GET</td>
<td><code>/orders/{uuid}</code></td>
</tr>
</tbody></table><p>Note that for simple implementation, <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> can be exactly the same endpoint.</p><section id="order-endpoint-restful-semantics"><h4 id="x9-1-1-order-endpoint-restful-semantics"><span class="secno">9.1.1 </span>Order Endpoint RESTful Semantics<a class="self-link" aria-label="§" href="#order-endpoint-restful-semantics"></a></h4><p>Note that practically all <code>Order</code> endpoints above (those that relate to <code>Order</code> or its subclasses <code>OrderQuote</code> and <code>OrderProposal</code>) share the same UUID namespace, and can be successfully implemented with a single underlying <code>Order</code> record behind them all. These endpoints are distinct purely to reduce the logic required in each and to increase testability and maintainability.</p><p>An <code>Order</code> with a particular UUID <em class="rfc2119" title="MUST">MUST</em> only exist as either an <code>Order</code>, <code>OrderQuote</code> or <code>OrderProposal</code> at a single point in time.</p><p>Hence the Order Status endpoint <em class="rfc2119" title="SHOULD">SHOULD</em> return any stored <code>Order</code>, <code>OrderQuote</code> or <code>OrderProposal</code> with that UUID, and the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders Feed</a> <em class="rfc2119" title="MUST">MUST</em> return both <code>Order</code> and <code>OrderProposal</code> items (noting that <code>OrderQuote</code> are not included in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders Feed</a>).</p><p>To aid the reader in their semantic reasoning, from a REST perspective, there are four resources:</p><ul>
<li><code>/order-quote-templates</code> and <code>/order-quotes</code> - both are a collection resource of <code>OrderQuote</code>s. These are always ephemeral, so are created only for the duration of the PUT request, unless the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> chooses to persist them, in which case they exist until the lease expires or an <code>OrderProposal</code> or <code>Order</code> is created.</li>
<li><code>/order-proposals</code> - a collection resource of <code>OrderProposal</code>s, which are deleted when a corresponding <code>Order</code> is created.</li>
<li><code>/orders</code> - a collection resource of <code>Order</code>s which includes its subclasses <code>OrderQuote</code>s and <code>OrderProposal</code>s</li>
</ul></section></section><section id="request-and-response"><h3 id="x9-2-request-and-response"><span class="secno">9.2 </span>Request and Response<a class="self-link" aria-label="§" href="#request-and-response"></a></h3><p>This section includes request and response examples for each of the endpoints specified in this API.</p><section id="orderquote-creation-c1"><h4 id="x9-2-1-orderquote-creation-c1"><span class="secno">9.2.1 </span>OrderQuote Creation C1<a class="self-link" aria-label="§" href="#orderquote-creation-c1"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td>OrderQuote Creation <dfn data-dfn-type="dfn" id="dfn-c1"><b>C1</b></dfn></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Yes</td>
<td>OrderQuote</td>
<td>PUT</td>
<td><code>/order-quote-templates/{uuid}</code></td>
</tr>
</tbody></table><p>The <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> is an endpoint that accepts an <code>OrderQuote</code> without a <code>customer</code> object to check availability and confirm that the specific combination of <code>OrderItem</code>s requested can be purchased.</p><p>A PUT request to this endpoint of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> with an object of type <code>OrderQuote</code> will return an <code>OrderQuote</code> which represents a "dry run" of the booking, with the state of the <code>Order</code> nearly identical to the result of <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> (except it excludes <code>customer</code>, <code>attendee</code>, <code>orderItemIntakeFormResponse</code> and the <code>payment</code>
<code>identifier</code>), without any side effects (with the exception of optional leasing).</p><p>Note that in a simple implementation that does not manage lease state, attendee details, or additional details, <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> <em class="rfc2119" title="MAY">MAY</em> be exactly the same endpoint that simply validates the <code>email</code> of the <code>customer</code> only if a <code>customer</code> value is supplied. Even for complex implementations, given the similarities between <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a>, a single endpoint can used to cover both.</p><div class="example" id="example-19-orderquote-creation-c1-example-request">
          <div class="marker">
      <a class="self-link" href="#example-19-orderquote-creation-c1-example-request">Example 19</a><span class="example-title">: OrderQuote Creation C1: example request</span>
    </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/api/order-quote-templates/e11429ea-467f-4270-ab62-e47368996fe8</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderQuote"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/BrokerAgent"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"orderQuantity"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>
      }
    }
  ]
}</span></code></pre>
        </div><p>If successful the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> will respond with an OrderQuote:</p><div class="example" id="example-20-orderquote-creation-c1-example-success-response">
          <div class="marker">
      <a class="self-link" href="#example-20-orderquote-creation-c1-example-success-response">Example 20</a><span class="example-title">: OrderQuote Creation C1: example success response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderQuote"</span>,
  <span class="hljs-attr">"taxMode"</span>: <span class="hljs-string">"https://openactive/TaxGross"</span>,
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Better"</span>,
    <span class="hljs-attr">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A charitable social enterprise for all the community"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.better.org.uk"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.better.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 3457 8700"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"customerservices@gll.org"</span>,
    <span class="hljs-attr">"vatID"</span>: <span class="hljs-string">"GB 789 1234 56"</span>,
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    },
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>
      },
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>
      }
    ]
  },
  <span class="hljs-attr">"bookingService"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"BookingService"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Playwaze"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.playwaze.com"</span>,
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://brokerexample.com/terms.html"</span>
      }
    ]
  },
  <span class="hljs-attr">"lease"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Lease"</span>,
    <span class="hljs-attr">"leaseExpires"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"orderQuantity"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderConfirmed"</span>,
      <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">"unitTaxSpecification"</span>: [
        {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 0% for EU transactions"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
          <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
        }
      ],
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
        <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
        <span class="hljs-attr">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
        <span class="hljs-attr">"maximumAttendeeCapacity"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-attr">"remainingAttendeeCapacity"</span>: <span class="hljs-number">20</span>,
        <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
        <span class="hljs-attr">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
        <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
        <span class="hljs-attr">"superEvent"</span>: {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"SessionSeries"</span>,
          <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball"</span>,
          <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
          <span class="hljs-attr">"organizer"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Central Speedball Association"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.speedball-world.com"</span>
          },
          <span class="hljs-attr">"location"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Place"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.everyoneactive.com/centres/Middlesbrough-Sports-Village"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Middlesbrough Sports Village"</span>,
            <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"0140"</span>,
            <span class="hljs-attr">"address"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
              <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
              <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
              <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
              <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
              <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
            },
            <span class="hljs-attr">"geo"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"GeoCoordinates"</span>,
              <span class="hljs-attr">"latitude"</span>: <span class="hljs-number">54.543964</span>,
              <span class="hljs-attr">"longitude"</span>: <span class="hljs-number">-1.20978500000001</span>
            }
          }
        }
      }
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"totalTaxSpecification"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
      <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
      <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
    }
  ]
}</span></code></pre>
        </div><p>If there are any issues with the <code>OrderItem</code>s requested in the <code>OrderQuote</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond with a <code>409 Conflict</code> response (as the error is expected to be resolved, and the request resubmitted, as per [<cite><a class="bibref" href="#bib-rfc2616">RFC2616</a></cite>]), with <code>error</code> details provided against each offending <code>OrderItem</code>. Note that <code>totalPaymentDue</code> and <code>totalPaymentTaxSpecification</code> <em class="rfc2119" title="MUST">MUST</em> be calculated <em>excluding</em> any <code>OrderItem</code>s that include <code>error</code>s.</p><div class="example" id="example-21-orderquote-creation-c1-example-orderitem-error-response">
          <div class="marker">
      <a class="self-link" href="#example-21-orderquote-creation-c1-example-orderitem-error-response">Example 21</a><span class="example-title">: OrderQuote Creation C1: example OrderItem error response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">409</span> Conflict
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderQuote"</span>,
  <span class="hljs-attr">"taxMode"</span>: <span class="hljs-string">"https://openactive/TaxGross"</span>,
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Better"</span>,
    <span class="hljs-attr">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A charitable social enterprise for all the community"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.better.org.uk"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.better.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 3457 8700"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"customerservices@gll.org"</span>,
    <span class="hljs-attr">"vatID"</span>: <span class="hljs-string">"GB 789 1234 56"</span>,
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    },
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>
      },
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>
      }
    ]
  },
  <span class="hljs-attr">"bookingService"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"BookingService"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Playwaze"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.playwaze.com"</span>,
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://brokerexample.com/terms.html"</span>
      }
    ]
  },
  <span class="hljs-attr">"lease"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Lease"</span>,
    <span class="hljs-attr">"leaseExpires"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"orderQuantity"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderConfirmed"</span>,
      <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">"unitTaxSpecification"</span>: [
        {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 0% for EU transactions"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
          <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
        }
      ],
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
        <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
        <span class="hljs-attr">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
        <span class="hljs-attr">"maximumAttendeeCapacity"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-attr">"remainingAttendeeCapacity"</span>: <span class="hljs-number">20</span>,
        <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
        <span class="hljs-attr">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
        <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
        <span class="hljs-attr">"superEvent"</span>: {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"SessionSeries"</span>,
          <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball"</span>,
          <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
          <span class="hljs-attr">"organizer"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Central Speedball Association"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.speedball-world.com"</span>
          },
          <span class="hljs-attr">"location"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Place"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.everyoneactive.com/centres/Middlesbrough-Sports-Village"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Middlesbrough Sports Village"</span>,
            <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"0140"</span>,
            <span class="hljs-attr">"address"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
              <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
              <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
              <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
              <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
              <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
            },
            <span class="hljs-attr">"geo"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"GeoCoordinates"</span>,
              <span class="hljs-attr">"latitude"</span>: <span class="hljs-number">54.543964</span>,
              <span class="hljs-attr">"longitude"</span>: <span class="hljs-number">-1.20978500000001</span>
            }
          }
        }
      },
      <span class="hljs-attr">"error"</span>: [
        {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OpportunityIsFullError"</span>,
          <span class="hljs-attr">"description"</span>: <span class="hljs-string">"There are no spaces remaining in this opportunity"</span>
        }
      ]
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"totalTaxSpecification"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
      <span class="hljs-attr">"price"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
      <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
    }
  ]
}</span></code></pre>
        </div><p>If there are issues with other properties of the <code>OrderQuote</code> outside of <code>orderedItem</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond with a JSON-LD response which includes only the appropriate <code>OpenBookingError</code> and the appropriate status code.</p><div class="example" id="example-22-orderquote-creation-c1-example-failure-response">
          <div class="marker">
      <a class="self-link" href="#example-22-orderquote-creation-c1-example-failure-response">Example 22</a><span class="example-title">: OrderQuote Creation C1: example failure response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">500</span> Internal Server Error
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TemporarilyUnableToProduceOrderQuoteError"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Temporary error occurred in the database"</span>
}</span></code></pre>
        </div></section><section id="orderquote-creation-c2"><h4 id="x9-2-2-orderquote-creation-c2"><span class="secno">9.2.2 </span>OrderQuote Creation C2<a class="self-link" aria-label="§" href="#orderquote-creation-c2"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td>OrderQuote Creation <dfn data-dfn-type="dfn" id="dfn-c2"><b>C2</b></dfn></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Yes</td>
<td>OrderQuote</td>
<td>PUT</td>
<td><code>/order-quotes/{uuid}</code></td>
</tr>
</tbody></table><p>The <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> is PUT endpoint that accepts an <code>OrderQuote</code> with a <code>customer</code> object to check availability and confirm that the specific combination of <code>OrderItem</code>s requested can be purchased.
</p><p>A PUT request to this endpoint of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> with an object of type <code>OrderQuote</code> will return an <code>OrderQuote</code> which represents a "dry run" of the booking, with the state of the <code>Order</code> nearly identical to the result of <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> (except it excludes <code>payment</code>
<code>identifier</code>), without any side effects (with the exception of optional leasing).</p><p>Note that the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>&nbsp;<em class="rfc2119" title="MUST NOT">MUST NOT</em> store any personal information of the <code>customer</code> provided for the <code>OrderQuote</code> past the expiry of any associated lease created.</p><div class="example" id="example-23-orderquote-creation-c2-example-request">
          <div class="marker">
      <a class="self-link" href="#example-23-orderquote-creation-c2-example-request">Example 23</a><span class="example-title">: OrderQuote Creation C2: example request</span>
    </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/api/order-quotes/e11429ea-467f-4270-ab62-e47368996fe8</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderQuote"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/BrokerAgent"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"orderQuantity"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>
      }
    }
  ]
}</span></code></pre>
        </div><p>If successful the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> will respond with an OrderQuote:</p><div class="example" id="example-24-orderquote-creation-c2-example-success-response">
          <div class="marker">
      <a class="self-link" href="#example-24-orderquote-creation-c2-example-success-response">Example 24</a><span class="example-title">: OrderQuote Creation C2: example success response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderQuote"</span>,
  <span class="hljs-attr">"taxMode"</span>: <span class="hljs-string">"https://openactive/TaxGross"</span>,
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Better"</span>,
    <span class="hljs-attr">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A charitable social enterprise for all the community"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.better.org.uk"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.better.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 3457 8700"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"customerservices@gll.org"</span>,
    <span class="hljs-attr">"vatID"</span>: <span class="hljs-string">"GB 789 1234 56"</span>,
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    },
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>
      },
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>
      }
    ]
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"bookingService"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"BookingService"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Playwaze"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.playwaze.com"</span>,
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://brokerexample.com/terms.html"</span>
      }
    ]
  },
  <span class="hljs-attr">"lease"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Lease"</span>,
    <span class="hljs-attr">"leaseExpires"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"orderQuantity"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderConfirmed"</span>,
      <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">"unitTaxSpecification"</span>: [
        {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 0% for EU transactions"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
          <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
        }
      ],
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
        <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
        <span class="hljs-attr">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
        <span class="hljs-attr">"maximumAttendeeCapacity"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-attr">"remainingAttendeeCapacity"</span>: <span class="hljs-number">20</span>,
        <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
        <span class="hljs-attr">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
        <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
        <span class="hljs-attr">"superEvent"</span>: {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"SessionSeries"</span>,
          <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball"</span>,
          <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
          <span class="hljs-attr">"organizer"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Central Speedball Association"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.speedball-world.com"</span>
          },
          <span class="hljs-attr">"location"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Place"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.everyoneactive.com/centres/Middlesbrough-Sports-Village"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Middlesbrough Sports Village"</span>,
            <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"0140"</span>,
            <span class="hljs-attr">"address"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
              <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
              <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
              <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
              <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
              <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
            },
            <span class="hljs-attr">"geo"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"GeoCoordinates"</span>,
              <span class="hljs-attr">"latitude"</span>: <span class="hljs-number">54.543964</span>,
              <span class="hljs-attr">"longitude"</span>: <span class="hljs-number">-1.20978500000001</span>
            }
          }
        }
      }
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"totalTaxSpecification"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
      <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
      <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
    }
  ]
}</span></code></pre>
        </div><p>Note if the response includes <code>orderRequiresApproval</code> with a value of <code>true</code> the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> make it clear to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> of the additional process they are about to enter into, and once they are aware, move forward according to the <a href="#booking-flow-with-approval">Booking Flow with Approval</a> rather than the <a href="#simple-booking-flow">Simple Booking Flow</a>.</p><p>If there are any issues with the <code>OrderItem</code>s requested in the <code>OrderQuote</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond with a <code>409 Conflict</code> response (as the error is expected to be resolved, and the request resubmitted, as per [<cite><a class="bibref" href="#bib-rfc2616">RFC2616</a></cite>]), with <code>error</code> details provided against each offending <code>OrderItem</code>. Note that <code>totalPaymentDue</code> and <code>totalPaymentTaxSpecification</code> <em class="rfc2119" title="MUST">MUST</em> be calculated <em>excluding</em> any <code>OrderItem</code>s that include <code>error</code>s.</p><div class="example" id="example-25-orderquote-creation-c2-example-orderitem-error-response">
          <div class="marker">
      <a class="self-link" href="#example-25-orderquote-creation-c2-example-orderitem-error-response">Example 25</a><span class="example-title">: OrderQuote Creation C2: example OrderItem error response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">409</span> Conflict
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderQuote"</span>,
  <span class="hljs-attr">"taxMode"</span>: <span class="hljs-string">"https://openactive/TaxGross"</span>,
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Better"</span>,
    <span class="hljs-attr">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A charitable social enterprise for all the community"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.better.org.uk"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.better.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 3457 8700"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"customerservices@gll.org"</span>,
    <span class="hljs-attr">"vatID"</span>: <span class="hljs-string">"GB 789 1234 56"</span>,
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    },
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>
      },
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>
      }
    ]
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"bookingService"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"BookingService"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Playwaze"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.playwaze.com"</span>,
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://brokerexample.com/terms.html"</span>
      }
    ]
  },
  <span class="hljs-attr">"lease"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Lease"</span>,
    <span class="hljs-attr">"leaseExpires"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"orderQuantity"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderConfirmed"</span>,
      <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">"unitTaxSpecification"</span>: [
        {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 0% for EU transactions"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
          <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
        }
      ],
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
        <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
        <span class="hljs-attr">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
        <span class="hljs-attr">"maximumAttendeeCapacity"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-attr">"remainingAttendeeCapacity"</span>: <span class="hljs-number">20</span>,
        <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
        <span class="hljs-attr">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
        <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
        <span class="hljs-attr">"superEvent"</span>: {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"SessionSeries"</span>,
          <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball"</span>,
          <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
          <span class="hljs-attr">"organizer"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Central Speedball Association"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.speedball-world.com"</span>
          },
          <span class="hljs-attr">"location"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Place"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.everyoneactive.com/centres/Middlesbrough-Sports-Village"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Middlesbrough Sports Village"</span>,
            <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"0140"</span>,
            <span class="hljs-attr">"address"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
              <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
              <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
              <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
              <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
              <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
            },
            <span class="hljs-attr">"geo"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"GeoCoordinates"</span>,
              <span class="hljs-attr">"latitude"</span>: <span class="hljs-number">54.543964</span>,
              <span class="hljs-attr">"longitude"</span>: <span class="hljs-number">-1.20978500000001</span>
            }
          }
        }
      },
      <span class="hljs-attr">"error"</span>: [
        {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OpportunityIsFullError"</span>,
          <span class="hljs-attr">"description"</span>: <span class="hljs-string">"There are no spaces remaining in this opportunity"</span>
        }
      ]
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"totalTaxSpecification"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
      <span class="hljs-attr">"price"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
      <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
    }
  ]
}</span></code></pre>
        </div><p>If there are issues with other properties of the <code>OrderQuote</code> outside of <code>orderedItem</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond with a JSON-LD response which includes only the appropriate <code>OpenBookingError</code> and the appropriate status code.</p><div class="example" id="example-26-orderquote-creation-c2-example-failure-response">
          <div class="marker">
      <a class="self-link" href="#example-26-orderquote-creation-c2-example-failure-response">Example 26</a><span class="example-title">: OrderQuote Creation C2: example failure response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">500</span> Internal Server Error
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TemporarilyUnableToProduceOrderQuoteError"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Temporary error occurred in the database"</span>
}</span></code></pre>
        </div></section><section id="orderquote-deletion"><h4 id="x9-2-3-orderquote-deletion"><span class="secno">9.2.3 </span>OrderQuote Deletion<a class="self-link" aria-label="§" href="#orderquote-deletion"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td><dfn data-dfn-type="dfn" id="dfn-orderquote-deletion">OrderQuote Deletion</dfn></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td></td>
<td>OrderQuote</td>
<td>DELETE</td>
<td><code>/order-quotes/{uuid}</code></td>
</tr>
</tbody></table><p>Deleting an <code>OrderQuote</code> releases any lease associated with it, which the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="SHOULD">SHOULD</em> do as a courtesy if the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> has abandoned their journey. For <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> that have not implemented leasing, an OrderQuote Deletion request <em class="rfc2119" title="MUST">MUST</em> simply return a 204 success status in all cases.</p><div class="example" id="example-27-order-deletion-example-request">
          <div class="marker">
      <a class="self-link" href="#example-27-order-deletion-example-request">Example 27</a><span class="example-title">: Order Deletion: example request</span>
    </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">DELETE</span> <span class="hljs-string">/api/orders/e11429ea-467f-4270-ab62-e47368996fe8</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0</code></pre>
        </div><div class="example" id="example-28-order-deletion-example-response">
          <div class="marker">
      <a class="self-link" href="#example-28-order-deletion-example-response">Example 28</a><span class="example-title">: Order Deletion: example response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">204</span> No Content
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0</code></pre>
        </div></section><section id="orderproposal-creation-p"><h4 id="x9-2-4-orderproposal-creation-p"><span class="secno">9.2.4 </span>OrderProposal Creation P<a class="self-link" aria-label="§" href="#orderproposal-creation-p"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td>OrderProposal Creation <dfn data-dfn-type="dfn" id="dfn-p"><b>P</b></dfn></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>Yes</td>
<td>OrderProposal</td>
<td>PUT</td>
<td><code>/order-proposals/{uuid}</code></td>
</tr>
</tbody></table><p><a href="#dfn-p" class="internalDFN" data-link-type="dfn"><b>P</b></a> is a PUT endpoint that creates and returns the submitted <code>OrderProposal</code> with an <code>orderProposalStatus</code> of <code>https://openactive.io/AwaitingSellerConfirmation</code>. The details submitted are identical to those required for <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> with the addition of an optional <code>lease</code>.</p><div class="example" id="example-29-orderproposal-creation-example-request">
          <div class="marker">
      <a class="self-link" href="#example-29-orderproposal-creation-example-request">Example 29</a><span class="example-title">: OrderProposal Creation: example request</span>
    </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/api/order-proposals/e11429ea-467f-4270-ab62-e47368996fe8</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderProposal"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/BrokerAgent"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"orderQuantity"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>
      }
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"payment"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Payment"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"AcmeBroker Points"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"1234567890npduy2f"</span>
  }
}</span></code></pre>
        </div><p>If successful the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> will respond with an <code>OrderProposal</code>:</p><div class="example" id="example-30-orderproposal-creation-example-success-response">
          <div class="marker">
      <a class="self-link" href="#example-30-orderproposal-creation-example-success-response">Example 30</a><span class="example-title">: OrderProposal Creation: example success response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">201</span> Created
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0
<span class="hljs-attribute">Location</span>: /api/order-proposals/e11429ea-467f-4270-ab62-e47368996fe8

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderProposal"</span>,
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/api/orders/e11429ea-467f-4270-ab62-e47368996fe8"</span>,
  <span class="hljs-attr">"orderNumber"</span>: <span class="hljs-string">"AB000001"</span>,
  <span class="hljs-attr">"orderProposalVersion"</span>: <span class="hljs-string">"https://api.example.com/order-proposals/358105b4-e571-43fa-b737-906d319c6a32/version/8eb1a6ce-3f5b-40b0-87a7-bddb4c5518bd"</span>,
  <span class="hljs-attr">"taxMode"</span>: <span class="hljs-string">"https://openactive/TaxGross"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/BrokerAgent"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Better"</span>,
    <span class="hljs-attr">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A charitable social enterprise for all the community"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.better.org.uk"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.better.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 3457 8700"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"customerservices@gll.org"</span>,
    <span class="hljs-attr">"vatID"</span>: <span class="hljs-string">"GB 789 1234 56"</span>,
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    },
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>
      },
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>
      }
    ]
  },
  <span class="hljs-attr">"bookingService"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"BookingService"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Playwaze"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.playwaze.com"</span>,
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://brokerexample.com/terms.html"</span>
      }
    ]
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/api/orders/123e4567-e89b-12d3-a456-426655440000/order-items/1234"</span>,
      <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderConfirmed"</span>,
      <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">"unitTaxSpecification"</span>: [
        {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 0% for EU transactions"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
          <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
        }
      ],
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
        <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
        <span class="hljs-attr">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
        <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
        <span class="hljs-attr">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
        <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
        <span class="hljs-attr">"superEvent"</span>: {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"SessionSeries"</span>,
          <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball"</span>,
          <span class="hljs-attr">"organizer"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Central Speedball Association"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.speedball-world.com"</span>
          },
          <span class="hljs-attr">"location"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Place"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.everyoneactive.com/centres/Middlesbrough-Sports-Village"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Middlesbrough Sports Village"</span>,
            <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"0140"</span>,
            <span class="hljs-attr">"address"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
              <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
              <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
              <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
              <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
              <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
            },
            <span class="hljs-attr">"geo"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"GeoCoordinates"</span>,
              <span class="hljs-attr">"latitude"</span>: <span class="hljs-number">54.543964</span>,
              <span class="hljs-attr">"longitude"</span>: <span class="hljs-number">-1.20978500000001</span>
            }
          }
        }
      },
      <span class="hljs-attr">"accessToken"</span>: [
        {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Barcode"</span>,
          <span class="hljs-attr">"text"</span>: <span class="hljs-string">"0123456789"</span>
        }
      ]
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"totalTaxSpecification"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
      <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
      <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
    }
  ],
  <span class="hljs-attr">"payment"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Payment"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"AcmeBroker Points"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"1234567890npduy2f"</span>
  },
  <span class="hljs-attr">"lease"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Lease"</span>,
    <span class="hljs-attr">"leaseExpires"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>
  }
}</span></code></pre>
        </div><p>If there are issues with any properties of the <code>OrderProposal</code>, including the <code>orderedItem</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond with an error response which includes only the appropriate <code>OpenBookingError</code> and the appropriate status code. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> is expected to retry the <code>OrderQuote</code> to get specific <code>orderedItem</code> level errors.</p><div class="example" id="example-31-orderproposal-creation-example-failure-response">
          <div class="marker">
      <a class="self-link" href="#example-31-orderproposal-creation-example-failure-response">Example 31</a><span class="example-title">: OrderProposal Creation: example failure response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">400</span> Bad Request
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"IncompleteBrokerDetailsError"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Only 'https://openactive.io/CustomerRejected' is permitted for this property."</span>
}</span></code></pre>
        </div><p>Note that any validation errors raised at <a href="#dfn-p" class="internalDFN" data-link-type="dfn"><b>P</b></a> regarding any property values <em class="rfc2119" title="MUST">MUST</em> also be raised at <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> (and ideally also <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> if relevant), so it should be very unusual to receive an error at <a href="#dfn-p" class="internalDFN" data-link-type="dfn"><b>P</b></a>.</p></section><section id="orderproposal-update"><h4 id="x9-2-5-orderproposal-update"><span class="secno">9.2.5 </span>OrderProposal Update<a class="self-link" aria-label="§" href="#orderproposal-update"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td><dfn data-dfn-type="dfn" id="dfn-orderproposal-update">OrderProposal Update</dfn></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td></td>
<td>OrderProposal</td>
<td>PATCH</td>
<td><code>/order-proposals/{uuid}</code></td>
</tr>
</tbody></table><p>The endpoint accepts a simple PATCH containing either or both of <code>orderProposalStatus</code> and <code>orderCustomerNote</code>.</p><div class="example" id="example-32-orderproposal-update-example-request">
          <div class="marker">
      <a class="self-link" href="#example-32-orderproposal-update-example-request">Example 32</a><span class="example-title">: OrderProposal Update: example request</span>
    </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PATCH</span> <span class="hljs-string">/api/order-proposals/e11429ea-467f-4270-ab62-e47368996fe8</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderProposal"</span>,
  <span class="hljs-attr">"orderProposalStatus"</span>: <span class="hljs-string">"https://openactive.io/CustomerRejected"</span>,
  <span class="hljs-attr">"orderCustomerNote"</span>: <span class="hljs-string">"Sorry I've actually made other plans, hope you find someone!"</span>
}</span></code></pre>
        </div><div class="example" id="example-33-orderproposal-update-example-response">
          <div class="marker">
      <a class="self-link" href="#example-33-orderproposal-update-example-response">Example 33</a><span class="example-title">: OrderProposal Update: example response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">204</span> No Content
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0</code></pre>
        </div><p>A PATCH to update <code>orderProposalStatus</code> <em class="rfc2119" title="MUST">MUST</em> have the value <code>https://openactive.io/CustomerRejected</code>, as that is the only permissible value based on the logic defined in this version of the specification. If another value for <code>orderProposalStatus</code> is specified the endpoint <em class="rfc2119" title="MUST">MUST</em> return an <code>PatchNotAllowedOnProperty</code> error with its status code.</p><div class="example" id="example-34-orderproposal-update-example-property-error-response">
          <div class="marker">
      <a class="self-link" href="#example-34-orderproposal-update-example-property-error-response">Example 34</a><span class="example-title">: OrderProposal Update: example property error response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">400</span> Bad Request
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PatchNotAllowedOnProperty"</span>,
  <span class="hljs-attr">"instance"</span>: <span class="hljs-string">"https://openactive.io/orderProposalStatus"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Only 'https://openactive.io/CustomerRejected' is permitted for this property."</span>
}</span></code></pre>
        </div><p>If the PATCH request includes any properties other than <code>type</code>, <code>@context</code>, <code>orderProposalStatus</code> and <code>orderCustomerNote</code> (excluding any properties with a custom namespace), the endpoint <em class="rfc2119" title="MUST">MUST</em> return a <code>PatchContainsExcessiveProperties</code> error with its status code.</p><div class="example" id="example-35-orderproposal-update-example-property-error-response-for-excessive-properties">
          <div class="marker">
      <a class="self-link" href="#example-35-orderproposal-update-example-property-error-response-for-excessive-properties">Example 35</a><span class="example-title">: OrderProposal Update: example property error response for excessive properties</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">400</span> Bad Request
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PatchContainsExcessiveProperties"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"PATCH includes unexpected properties that are not permitted."</span>
}</span></code></pre>
        </div></section><section id="order-creation-b"><h4 id="x9-2-6-order-creation-b"><span class="secno">9.2.6 </span>Order Creation B<a class="self-link" aria-label="§" href="#order-creation-b"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td>Order Creation <dfn data-dfn-type="dfn" id="dfn-b"><b>B</b></dfn></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Yes</td>
<td>Order</td>
<td>PUT</td>
<td><code>/orders/{uuid}</code></td>
</tr>
</tbody></table><p>A PUT request to the Order Creation endpoint of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> with an object of type <code>Order</code> will create the <code>Order</code> and complete the booking from the point of the view of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</p><div class="example" id="example-36-order-creation-example-request">
          <div class="marker">
      <a class="self-link" href="#example-36-order-creation-example-request">Example 36</a><span class="example-title">: Order Creation: example request</span>
    </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/api/orders/e11429ea-467f-4270-ab62-e47368996fe8</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Order"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/BrokerAgent"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"orderQuantity"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>
      }
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"payment"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Payment"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"AcmeBroker Points"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"1234567890npduy2f"</span>
  }
}</span></code></pre>
        </div><p>If successful the server will respond with the location of a newly created <code>Order</code> resource.</p><p>For the <code>Order</code> response and the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, the <code>OrderItems</code> <em class="rfc2119" title="MUST">MUST</em> include a unique <code>id</code>. This allows <code>OrderItem</code>s to be cancelled individually once the <code>Order</code> has been created.</p><p><a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> responses <em class="rfc2119" title="MUST">MUST</em> reflect back properties provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, for example:</p><div class="example" id="example-37-order-creation-example-response">
          <div class="marker">
      <a class="self-link" href="#example-37-order-creation-example-response">Example 37</a><span class="example-title">: Order Creation: example response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">201</span> Created
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0
<span class="hljs-attribute">Location</span>: /api/orders/e11429ea-467f-4270-ab62-e47368996fe8

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Order"</span>,
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/api/orders/e11429ea-467f-4270-ab62-e47368996fe8"</span>,
  <span class="hljs-attr">"orderNumber"</span>: <span class="hljs-string">"AB000001"</span>,
  <span class="hljs-attr">"taxMode"</span>: <span class="hljs-string">"https://openactive/TaxGross"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/BrokerAgent"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Better"</span>,
    <span class="hljs-attr">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A charitable social enterprise for all the community"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.better.org.uk"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.better.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 3457 8700"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"customerservices@gll.org"</span>,
    <span class="hljs-attr">"vatID"</span>: <span class="hljs-string">"GB 789 1234 56"</span>,
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    },
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>
      },
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>
      }
    ]
  },
  <span class="hljs-attr">"bookingService"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"BookingService"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Playwaze"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.playwaze.com"</span>,
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://brokerexample.com/terms.html"</span>
      }
    ]
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/api/orders/123e4567-e89b-12d3-a456-426655440000/order-items/1234"</span>,
      <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderConfirmed"</span>,
      <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">"unitTaxSpecification"</span>: [
        {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 0% for EU transactions"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
          <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
        }
      ],
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
        <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
        <span class="hljs-attr">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
        <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
        <span class="hljs-attr">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
        <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
        <span class="hljs-attr">"superEvent"</span>: {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"SessionSeries"</span>,
          <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball"</span>,
          <span class="hljs-attr">"organizer"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Central Speedball Association"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.speedball-world.com"</span>
          },
          <span class="hljs-attr">"location"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Place"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.everyoneactive.com/centres/Middlesbrough-Sports-Village"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Middlesbrough Sports Village"</span>,
            <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"0140"</span>,
            <span class="hljs-attr">"address"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
              <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
              <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
              <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
              <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
              <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
            },
            <span class="hljs-attr">"geo"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"GeoCoordinates"</span>,
              <span class="hljs-attr">"latitude"</span>: <span class="hljs-number">54.543964</span>,
              <span class="hljs-attr">"longitude"</span>: <span class="hljs-number">-1.20978500000001</span>
            }
          }
        }
      },
      <span class="hljs-attr">"accessToken"</span>: [
        {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Barcode"</span>,
          <span class="hljs-attr">"text"</span>: <span class="hljs-string">"0123456789"</span>
        }
      ]
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"totalTaxSpecification"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
      <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
      <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
    }
  ],
  <span class="hljs-attr">"payment"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Payment"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"AcmeBroker Points"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"1234567890npduy2f"</span>
  }
}</span></code></pre>
        </div><p>If there are issues any properties of the <code>Order</code>, including the <code>orderedItem</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond with only the appropriate <code>OpenBookingError</code> and associated status code. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> is expected to retry the <code>OrderQuote</code> to get specific <code>orderedItem</code> level errors.</p><p>Note that any validation errors raised at <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> regarding any property values <em class="rfc2119" title="MUST">MUST</em> also be raised at <a href="#dfn-c2" class="internalDFN" data-link-type="dfn"><b>C2</b></a> (and ideally also <a href="#dfn-c1" class="internalDFN" data-link-type="dfn"><b>C1</b></a> if relevant), so it should be very unusual to receive an error at <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a>.</p><p>For the <a href="#booking-flow-with-approval">Booking Flow with Approval</a> specifically, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> decides to proceed from <strong>A</strong> to <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> by supplying a minimal <code>Order</code> to <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> that contains just the <code>orderProposalVersion</code> and any additional <code>payment</code> data if reauthorisation was required.</p><div class="example" id="example-38-order-creation-example-request-from-orderproposal">
          <div class="marker">
      <a class="self-link" href="#example-38-order-creation-example-request-from-orderproposal">Example 38</a><span class="example-title">: Order Creation: example request from OrderProposal</span>
    </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/api/orders/e11429ea-467f-4270-ab62-e47368996fe8</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Order"</span>,
  <span class="hljs-attr">"orderProposalVersion"</span>: <span class="hljs-string">"https://api.example.com/order-proposals/358105b4-e571-43fa-b737-906d319c6a32/version/8eb1a6ce-3f5b-40b0-87a7-bddb4c5518bd"</span>,
  <span class="hljs-attr">"payment"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Payment"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"AcmeBroker Points"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"1234567890npduy2f"</span>
  }
}</span></code></pre>
        </div></section><section id="order-deletion"><h4 id="x9-2-7-order-deletion"><span class="secno">9.2.7 </span>Order Deletion<a class="self-link" aria-label="§" href="#order-deletion"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td><dfn data-dfn-type="dfn" id="dfn-order-deletion">Order Deletion</dfn></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td></td>
<td>Order</td>
<td>DELETE</td>
<td><code>/orders/{uuid}</code></td>
</tr>
</tbody></table><p>Deleting an <code>Order</code> allows for the whole Booking Flow to be reversed for fatal error and testing scenarios.</p><p>When an <code>Order</code> is deleted the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="SHOULD">SHOULD</em> hard delete it as if it was not created, but <em class="rfc2119" title="MAY">MAY</em> soft delete it providing all related personal data is purged. The audit for the deletion is guaranteed to be stored in the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> in all cases.</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> use Order Deletion for cancellation, but instead only use it in the unusual case of a fatal error or testing. An appropriate approach for cancellation is defined elsewhere.</p><p>The corresponding <code>Order</code> <em class="rfc2119" title="MUST">MUST</em> be marked as <code>deleted</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>.</p><div class="example" id="example-39-order-deletion-example-request">
          <div class="marker">
      <a class="self-link" href="#example-39-order-deletion-example-request">Example 39</a><span class="example-title">: Order Deletion: example request</span>
    </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">DELETE</span> <span class="hljs-string">/api/orders/e11429ea-467f-4270-ab62-e47368996fe8</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0</code></pre>
        </div><div class="example" id="example-40-order-deletion-example-response">
          <div class="marker">
      <a class="self-link" href="#example-40-order-deletion-example-response">Example 40</a><span class="example-title">: Order Deletion: example response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">204</span> No Content
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0</code></pre>
        </div></section><section id="order-cancellation"><h4 id="x9-2-8-order-cancellation"><span class="secno">9.2.8 </span>Order Cancellation<a class="self-link" aria-label="§" href="#order-cancellation"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td><dfn data-dfn-type="dfn" id="dfn-order-cancellation">Order Cancellation</dfn></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td></td>
<td>Order</td>
<td>PATCH</td>
<td><code>/orders/{uuid}</code></td>
</tr>
</tbody></table><p>The cancellation may be requested by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>. <code>OrderItem</code>s omitted from the PATCH request <em class="rfc2119" title="MUST">MUST</em> be ignored.</p><div class="example" id="example-41-order-cancellation-example-order-request">
          <div class="marker">
      <a class="self-link" href="#example-41-order-cancellation-example-order-request">Example 41</a><span class="example-title">: Order Cancellation: example Order request</span>
    </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PATCH</span> <span class="hljs-string">/api/orders/e11429ea-467f-4270-ab62-e47368996fe8</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Order"</span>,
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/api/orders/123e4567-e89b-12d3-a456-426655440000/order-items/1234"</span>,
      <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/CustomerCancelled"</span>
    }
  ]
}</span></code></pre>
        </div><p>The cancellation request succeeds and fails atomically.</p><div class="example" id="example-42-order-cancellation-example-success-response">
          <div class="marker">
      <a class="self-link" href="#example-42-order-cancellation-example-success-response">Example 42</a><span class="example-title">: Order Cancellation: example success response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">204</span> No Content
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0</code></pre>
        </div><div class="example" id="example-43-order-cancellation-example-error-response">
          <div class="marker">
      <a class="self-link" href="#example-43-order-cancellation-example-error-response">Example 43</a><span class="example-title">: Order Cancellation: example error response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">400</span> Bad Request
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"CancellationNotPermittedError"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"The horse has already been fed, and cannot be put back in the box."</span>
}</span></code></pre>
        </div><p>A PATCH to update <code>orderItemStatus</code> <em class="rfc2119" title="MUST">MUST</em> have the value <code>https://openactive.io/CustomerCancelled</code>, as that is the only permissible value based on the logic defined in this version of the specification. If another value for <code>orderItemStatus</code> is specified the endpoint <em class="rfc2119" title="MUST">MUST</em> return an <code>PatchNotAllowedOnProperty</code> error with its status code.</p><div class="example" id="example-44-order-cancellation-example-property-error-response">
          <div class="marker">
      <a class="self-link" href="#example-44-order-cancellation-example-property-error-response">Example 44</a><span class="example-title">: Order Cancellation: example property error response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">400</span> Bad Request
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PatchNotAllowedOnProperty"</span>,
  <span class="hljs-attr">"instance"</span>: <span class="hljs-string">"https://openactive.io/orderItemStatus"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Only 'https://openactive.io/CustomerCancelled' is permitted for this property."</span>
}</span></code></pre>
        </div><p>If the PATCH request includes any properties other than <code>type</code>, <code>@context</code>, <code>id</code>, <code>orderedItem</code> and <code>orderItemStatus</code> (excluding any properties with a custom namespace), the endpoint <em class="rfc2119" title="MUST">MUST</em> return a <code>PatchContainsExcessiveProperties</code> error with its status code.</p><div class="example" id="example-45-order-cancellation-example-property-error-response-for-excessive-properties">
          <div class="marker">
      <a class="self-link" href="#example-45-order-cancellation-example-property-error-response-for-excessive-properties">Example 45</a><span class="example-title">: Order Cancellation: example property error response for excessive properties</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">400</span> Bad Request
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PatchContainsExcessiveProperties"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"PATCH includes unexpected properties that are not permitted."</span>
}</span></code></pre>
        </div></section><section id="orders-rpde-feed"><h4 id="x9-2-9-orders-rpde-feed"><span class="secno">9.2.9 </span>Orders RPDE feed<a class="self-link" aria-label="§" href="#orders-rpde-feed"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td><a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Yes</td>
<td>Orders feed</td>
<td>GET</td>
<td><code>/orders-rpde</code></td>
</tr>
</tbody></table><p>This feed is described at length in the <a href="#orders-feed-notifications-updates-and-refunds">Orders feed</a> section.</p><p>An illustrative request and response is provided here.</p><div class="example" id="example-46-order-rpde-feed-example-request">
          <div class="marker">
      <a class="self-link" href="#example-46-order-rpde-feed-example-request">Example 46</a><span class="example-title">: Order RPDE Feed: example request</span>
    </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/api/orders-rpde</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0</code></pre>
        </div><div class="example" id="example-47-order-rpde-feed-example-response">
          <div class="marker">
      <a class="self-link" href="#example-47-order-rpde-feed-example-response">Example 47</a><span class="example-title">: Order RPDE Feed: example response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"next"</span>: <span class="hljs-string">"/api/orders-rpde?afterTimestamp=1521565719&amp;afterId=e11429ea-467f-4270-ab62-e47368996fe8"</span>,
  <span class="hljs-attr">"items"</span>: [
    {
      <span class="hljs-attr">"state"</span>: <span class="hljs-string">"updated"</span>,
      <span class="hljs-attr">"kind"</span>: <span class="hljs-string">"Order"</span>,
      <span class="hljs-attr">"id"</span>: <span class="hljs-string">"e11429ea-467f-4270-ab62-e47368996fe8"</span>,
      <span class="hljs-attr">"modified"</span>: <span class="hljs-number">1521565719</span>,
      <span class="hljs-attr">"data"</span>: {
        <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Order"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/api/orders/e11429ea-467f-4270-ab62-e47368996fe8"</span>,
        <span class="hljs-attr">"taxMode"</span>: <span class="hljs-string">"https://openactive/TaxGross"</span>,
        <span class="hljs-attr">"orderedItem"</span>: [
          {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
            <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/api/orders/123e4567-e89b-12d3-a456-426655440000/order-items/1234"</span>,
            <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderConfirmed"</span>,
            <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
            <span class="hljs-attr">"unitTaxSpecification"</span>: [
              {
                <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
                <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 0% for EU transactions"</span>,
                <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
                <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
                <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
              }
            ],
            <span class="hljs-attr">"acceptedOffer"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
              <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
              <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
              <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
              <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
              <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
              <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
              <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
            },
            <span class="hljs-attr">"orderedItem"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
              <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>
            }
          }
        ],
        <span class="hljs-attr">"totalPaymentDue"</span>: {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
        },
        <span class="hljs-attr">"totalTaxSpecification"</span>: [
          {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
            <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
            <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
          }
        ]
      }
    }
  ]
}</span></code></pre>
        </div></section><section id="order-status"><h4 id="x9-2-10-order-status"><span class="secno">9.2.10 </span>Order Status<a class="self-link" aria-label="§" href="#order-status"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td><dfn data-dfn-type="dfn" id="dfn-order-status">Order Status</dfn></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>Yes</td>
<td>Order</td>
<td>GET</td>
<td><code>/orders/{uuid}</code></td>
</tr>
</tbody></table><p>A <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="SHOULD">SHOULD</em> provide an endpoint to allow a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to retrieve complete <code>Order</code>s. In future versions of the specification, endpoints may be provided which permit a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to see all <code>Order</code>s created by a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>. In this current implementation, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> keep its own record of <code>Order</code>s as described elsewhere in this specification, and not rely on this <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> Order Status endpoint.</p><div class="example" id="example-48-order-status-example-request">
          <div class="marker">
      <a class="self-link" href="#example-48-order-status-example-request">Example 48</a><span class="example-title">: Order Status: example request</span>
    </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/api/orders/e11429ea-467f-4270-ab62-e47368996fe8</span> HTTP/1.1
<span class="hljs-attribute">Host</span>: example.com
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0</code></pre>
        </div><div class="example" id="example-49-order-status-example-response">
          <div class="marker">
      <a class="self-link" href="#example-49-order-status-example-response">Example 49</a><span class="example-title">: Order Status: example response</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0
<span class="hljs-attribute">Location</span>: /api/orders/e11429ea-467f-4270-ab62-e47368996fe8

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Order"</span>,
  <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/api/orders/e11429ea-467f-4270-ab62-e47368996fe8"</span>,
  <span class="hljs-attr">"taxMode"</span>: <span class="hljs-string">"https://openactive/TaxGross"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/BrokerAgent"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Better"</span>,
    <span class="hljs-attr">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A charitable social enterprise for all the community"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.better.org.uk"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.better.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 3457 8700"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"customerservices@gll.org"</span>,
    <span class="hljs-attr">"vatID"</span>: <span class="hljs-string">"GB 789 1234 56"</span>,
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    },
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>
      },
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>
      }
    ]
  },
  <span class="hljs-attr">"bookingService"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"BookingService"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Playwaze"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.playwaze.com"</span>,
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://brokerexample.com/terms.html"</span>
      }
    ]
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/api/orders/123e4567-e89b-12d3-a456-426655440000/order-items/1234"</span>,
      <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderConfirmed"</span>,
      <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">"unitTaxSpecification"</span>: [
        {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 0% for EU transactions"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
          <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
        }
      ],
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
        <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
        <span class="hljs-attr">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
        <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
        <span class="hljs-attr">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
        <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
        <span class="hljs-attr">"superEvent"</span>: {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"SessionSeries"</span>,
          <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball"</span>,
          <span class="hljs-attr">"organizer"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Organization"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Central Speedball Association"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.speedball-world.com"</span>
          },
          <span class="hljs-attr">"location"</span>: {
            <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Place"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.everyoneactive.com/centres/Middlesbrough-Sports-Village"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Middlesbrough Sports Village"</span>,
            <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"0140"</span>,
            <span class="hljs-attr">"address"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PostalAddress"</span>,
              <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
              <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
              <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
              <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
              <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
            },
            <span class="hljs-attr">"geo"</span>: {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"GeoCoordinates"</span>,
              <span class="hljs-attr">"latitude"</span>: <span class="hljs-number">54.543964</span>,
              <span class="hljs-attr">"longitude"</span>: <span class="hljs-number">-1.20978500000001</span>
            }
          }
        }
      },
      <span class="hljs-attr">"accessToken"</span>: [
        {
          <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Barcode"</span>,
          <span class="hljs-attr">"text"</span>: <span class="hljs-string">"0123456789"</span>
        }
      ]
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"totalTaxSpecification"</span>: [
    {
      <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
      <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
      <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
    }
  ],
  <span class="hljs-attr">"payment"</span>: {
    <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Payment"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"AcmeBroker Points"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"1234567890npduy2f"</span>
  }
}</span></code></pre>
        </div></section><section id="url-discovery"><h4 id="x9-2-11-url-discovery"><span class="secno">9.2.11 </span>URL discovery<a class="self-link" aria-label="§" href="#url-discovery"></a></h4><p>Discovery of URLs is an implicit part of the design of this specification, and <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a> <em class="rfc2119" title="SHOULD">SHOULD</em> avoid hard-coding URLs for specific actions into their applications and client libraries. <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a> <em class="rfc2119" title="SHOULD">SHOULD</em> use most applicable URL discovered at the point in the workflow they are currently in - e.g. not use a cached URL that has been previously successfully used. They should also not attempt to create URLs for a specific action based on patterns within previously used URLs.</p><p>It is the responsibility of <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> to advertise the URL for further activity in the booking workflow at the point of need or via the [<cite><a class="bibref" href="#bib-dataset-api-discovery">Dataset-API-Discovery</a></cite>] specification. For example they <em class="rfc2119" title="MUST">MUST</em> advertise the URL for the <code>Order</code> resource in the Orders <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> by including the <code>id</code> property within the <code>Order</code>.</p></section></section></section><section class="normative" id="model"><!--OddPage--><h2 id="x10-model"><span class="secno">10. </span>Model<a class="self-link" aria-label="§" href="#model"></a></h2><p>These models are designed compatible with [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>], and includes conformance criteria that are both stricter and more relaxed when existing models are used in the context of this specification.</p><section id="order-model"><h3 id="x10-1-order-model"><span class="secno">10.1 </span>Order Model<a class="self-link" aria-label="§" href="#order-model"></a></h3><section id="schema-order"><h4 id="x10-1-1-schema-order"><span class="secno">10.1.1 </span><code>schema:Order</code><a class="self-link" aria-label="§" href="#schema-order"></a></h4><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Orders feed</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Order</code></td>
</tr>
<tr>
<td><code>@id</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>URI</td>
<td>A URI providing a unique identifier for the resource, which <em class="rfc2119" title="MUST">MUST</em> match the PUT URL containing the UUID</td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The UUID of the <code>Order</code></td>
</tr>
<tr>
<td><a href="http://schema.org/seller"><code>schema:seller</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Organization"><code>schema:Organization</code></a></td>
<td>The organisation providing access to events or facilities via a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>. e.g. a leisure provider running yoga classes.</td>
</tr>
<tr>
<td><a href="https://openactive.io/taxMode"><code>oa:taxMode</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://openactive.io/TaxMode"><code>oa:TaxMode</code></a></td>
<td>Either <code>https://openactive/TaxNet</code> or <code>https://openactive/TaxGross</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/broker"><code>oa:broker</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Organization"><code>schema:Organization</code></a></td>
<td>The organisation or developer providing an application that allows <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a> to make bookings. Those applications will be clients of the API defined in this specification.</td>
</tr>
<tr>
<td><a href="https://openactive.io/brokerRole"><code>oa:brokerRole</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://openactive.io/BrokerType"><code>oa:BrokerType</code></a></td>
<td>Either <code>https://openactive/AgentBroker</code>, <code>https://openactive/ResellerBroker</code> or <code>https://openactive/NoBroker</code>, as agreed in advance between the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/orderNumber"><code>schema:orderNumber</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The Customer-facing identifier of the <code>Order</code>.</td>
</tr>
<tr>
<td><a href="http://schema.org/customer"><code>schema:customer</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td>-</td>
<td><a href="https://schema.org/Organization"><code>schema:Organization</code></a> or a <a href="https://schema.org/Person"><code>schema:Person</code></a></td>
<td>The person or organization purchasing the Order.</td>
</tr>
<tr>
<td><a href="https://openactive.io/bookingService"><code>oa:bookingService</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://openactive.io/BookingService"><code>oa:BookingService</code></a></td>
<td>Details about the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a></td>
</tr>
<tr>
<td><a href="http://schema.org/orderedItem"><code>schema:orderedItem</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Array of <a href="http://schema.org/OrderItem"><code>schema:OrderItem</code></a></td>
<td>The items that constitute the <code>Order</code></td>
</tr>
<tr>
<td><a href="http://schema.org/totalPaymentDue"><code>schema:totalPaymentDue</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="http://schema.org/PriceSpecification"><code>schema:PriceSpecification</code></a></td>
<td>The total price of the <code>Order</code>, which includes or excludes tax depending on the <code>taxMode</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/totalPaymentTaxSpecification"><code>oa:totalPaymentTaxSpecification</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Array of <a href="https://openactive.io/TaxChargeSpecification"><code>oa:TaxChargeSpecification</code></a></td>
<td>Breakdown of tax payable for the Order.</td>
</tr>
<tr>
<td><a href="https://openactive.io/payment"><code>oa:payment</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://openactive.io/Payment"><code>oa:Payment</code></a></td>
<td>The payment associated with the Order by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>. It is <em class="rfc2119" title="REQUIRED">REQUIRED</em> for cases where a payment has been taken.</td>
</tr>
<tr>
<td><a href="https://openactive.io/orderCreationStatus"><code>oa:orderCreationStatus</code></a></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>Array of <a href="https://openactive.io/OrderCreationStatusType"><code>oa:OrderCreationStatusType</code></a></td>
<td>Can include <code>https://openactive.io/OrderCreationPaymentAuthorized</code>, <code>https://openactive.io/OrderCreationPaymentDue</code>, <code>https://openactive.io/OrderCreationPaymentCaptured</code>, <code>https://openactive.io/OrderCreationComplete</code>. This property is internal to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> in this version of the specification.</td>
</tr>
<tr>
<td><a href="https://openactive.io/orderProposalVersion"><code>oa:orderProposalVersion</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The unique URL representing this version of the <code>OrderProposal</code>, or the version of the <code>OrderProposal</code> to which this <code>Order</code> is related.</td>
<td></td>
</tr>
</tbody></table></section><section id="oa-orderquote"><h4 id="x10-1-2-oa-orderquote"><span class="secno">10.1.2 </span><code>oa:OrderQuote</code><a class="self-link" aria-label="§" href="#oa-orderquote"></a></h4><p><code>OrderQuote</code> subclasses <code>Order</code>, and includes of the above properties as specified for <code>Order</code> with the addition of <code>oa:lease</code>, without <code>oa:payment</code>, and with <code>totalPaymentDue</code> only required in the response.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>OrderQuote</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/lease"><code>oa:lease</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://openactive.io/Lease"><code>oa:Lease</code></a></td>
<td>The lease on the OrderItems which lasts for the duration specified by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/payment"><code>oa:payment</code></a></td>
<td>-</td>
<td>-</td>
<td><a href="https://openactive.io/Payment"><code>oa:Payment</code></a></td>
<td><code>payment</code> is not expected for <code>OrderQuote</code>.</td>
</tr>
<tr>
<td><a href="http://schema.org/totalPaymentDue"><code>schema:totalPaymentDue</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="http://schema.org/PriceSpecification"><code>schema:PriceSpecification</code></a></td>
</tr>
<tr>
<td><a href="https://openactive.io/orderRequiresApproval"><code>oa:orderRequiresApproval</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Boolean"><code>schema:Boolean</code></a></td>
<td>Whether the <a href="#booking-flow-with-approval">Booking Flow with Approval</a> <em class="rfc2119" title="MUST">MUST</em> be used to book the set of <code>OrderItem</code>s included. <em class="rfc2119" title="MUST">MUST</em> be <code>true</code> if any of the <code>OrderItem</code>s require approval.</td>
</tr>
</tbody></table></section><section id="oa-orderproposal"><h4 id="x10-1-3-oa-orderproposal"><span class="secno">10.1.3 </span><code>oa:OrderProposal</code><a class="self-link" aria-label="§" href="#oa-orderproposal"></a></h4><p><code>OrderProposal</code> subclasses <code>OrderQuote</code>, and includes of the above properties as specified for <code>OrderQuote</code> with the addition of <code>oa:orderApprovalRequestNote</code>
<code>oa:orderProposalStatus</code>, without <code>oa:payment</code>, and with <code>totalPaymentDue</code> only required in the response and <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>OrderQuote</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/lease"><code>oa:lease</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://openactive.io/Lease"><code>oa:Lease</code></a></td>
<td>The lease on the OrderItems which lasts for the duration specified by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/payment"><code>oa:payment</code></a></td>
<td>-</td>
<td>-</td>
<td><a href="https://openactive.io/Payment"><code>oa:Payment</code></a></td>
<td><code>payment</code> is not expected for <code>OrderQuote</code>.</td>
</tr>
<tr>
<td><a href="http://schema.org/totalPaymentDue"><code>schema:totalPaymentDue</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="http://schema.org/PriceSpecification"><code>schema:PriceSpecification</code></a></td>
</tr>
<tr>
<td><a href="https://openactive.io/orderProposalStatus"><code>oa:orderProposalStatus</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Array of <a href="https://openactive.io/OrderProposalStatusType"><code>oa:OrderProposalStatusType</code></a></td>
<td>Can include <code>https://openactive.io/AwaitingSellerConfirmation</code>, <code>https://openactive.io/SellerAccepted</code>, <code>https://openactive.io/SellerRejected</code>, <code>https://openactive.io/CustomerRejected</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/orderSellerNote"><code>oa:orderSellerNote</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
</tr>
<tr>
<td><a href="https://openactive.io/orderCustomerNote"><code>oa:orderCustomerNote</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
</tr>
</tbody></table></section><section id="schema-organization-for-seller"><h4 id="x10-1-4-schema-organization-for-seller"><span class="secno">10.1.4 </span><code>schema:Organization</code> for <code>seller</code><a class="self-link" aria-label="§" href="#schema-organization-for-seller"></a></h4><p>The <code>seller</code> <em class="rfc2119" title="MUST">MUST</em> be a <code>schema:Organization</code> with the following properties, in order for tax receipts to be successfully generated.</p><p>The <code>seller</code> is specified with each <code>Order</code> to account for scenarios where multiple <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> brands are in use.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Organization</code></td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> used by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Trading name of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/legalName"><code>schema:legalName</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Legal name of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, used on tax receipts.</td>
</tr>
<tr>
<td><a href="http://schema.org/email"><code>schema:email</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Email address used to contact the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/taxMode"><code>oa:taxMode</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://openactive.io/TaxMode"><code>oa:TaxMode</code></a></td>
<td>Either <code>https://openactive/TaxNet</code> or <code>https://openactive/TaxGross</code></td>
</tr>
<tr>
<td><a href="http://schema.org/vatID"><code>schema:vatID</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The Value-added Tax ID of the of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/telephone"><code>schema:telephone</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Telephone number of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/url"><code>schema:url</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The URL of the website of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/logo"><code>schema:logo</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/ImageObject"><code>schema:ImageObject</code></a></td>
<td>Logo of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, used on tax receipts.</td>
</tr>
<tr>
<td><a href="http://schema.org/address"><code>schema:address</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/PostalAddress"><code>schema:PostalAddress</code></a></td>
<td>Address of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, used on tax receipts.</td>
</tr>
<tr>
<td><a href="http://schema.org/termsOfService"><code>schema:termsOfService</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>Array of <a href="https://openactive.io/Terms"><code>oa:Terms</code></a></td>
<td>The terms of service of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</td>
</tr>
</tbody></table></section><section id="schema-organization-for-broker"><h4 id="x10-1-5-schema-organization-for-broker"><span class="secno">10.1.5 </span><code>schema:Organization</code> for <code>broker</code><a class="self-link" aria-label="§" href="#schema-organization-for-broker"></a></h4><p>The <code>broker</code> <em class="rfc2119" title="MUST">MUST</em> be a <code>schema:Organization</code> with the following properties, in order for the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to represent the third-party booking.</p><p>The <code>broker</code> is specified with each <code>Order</code> to account for scenarios where multiple <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> brands are in use.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Organization</code></td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the brand used by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Name of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/email"><code>schema:email</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Support email address used to contact the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/telephone"><code>schema:telephone</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Support telephone number of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/url"><code>schema:url</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The URL of the website of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/logo"><code>schema:logo</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/ImageObject"><code>schema:ImageObject</code></a></td>
<td>Logo of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, used within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/termsOfService"><code>schema:termsOfService</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td>Array of <a href="https://openactive.io/Terms"><code>oa:Terms</code></a></td>
<td>The terms of service of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</td>
</tr>
</tbody></table></section><section id="schema-orderitem"><h4 id="x10-1-6-schema-orderitem"><span class="secno">10.1.6 </span><code>schema:OrderItem</code><a class="self-link" aria-label="§" href="#schema-orderitem"></a></h4><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>OrderItem</code></td>
</tr>
<tr>
<td><code>@id</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>A URI providing a unique identifier for the OrderItem</td>
</tr>
<tr>
<td><a href="http://schema.org/orderItemStatus"><code>schema:orderItemStatus</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/OrderStatus"><code>schema:OrderStatus</code></a></td>
<td>Either <code>https://openactive.io/SellerCancelled</code>, <code>https://openactive.io/CustomerCancelled</code>, or <code>https://openactive.io/OrderConfirmed</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/allowCustomerCancellationFullRefund"><code>oa:allowCustomerCancellationFullRefund</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Boolean"><code>schema:Boolean</code></a></td>
<td>Whether the event can be cancelled.</td>
</tr>
<tr>
<td><a href="https://openactive.io/unitTaxSpecification"><code>oa:unitTaxSpecification</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Array of <a href="https://openactive.io/TaxChargeSpecification"><code>oa:TaxChargeSpecification</code></a></td>
<td>Breakdown of tax payable for the OrderItem.</td>
</tr>
<tr>
<td><a href="http://schema.org/acceptedOffer"><code>schema:acceptedOffer</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Offer"><code>schema:Offer</code></a></td>
<td>The offer from the associated <code>orderedItem</code> that has been selected by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>. The price of which includes or excludes tax depending on the <code>taxMode</code> of the <code>Order</code>.</td>
</tr>
<tr>
<td><a href="http://schema.org/orderedItem"><code>schema:orderedItem</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://openactive.io/ScheduledSession"><code>oa:ScheduledSession</code></a>, <a href="https://openactive.io/Slot"><code>oa:Slot</code></a>, <a href="https://openactive.io/HeadlineEvent"><code>oa:HeadlineEvent</code></a>, <a href="https://schema.org/Event"><code>schema:Event</code></a> or <a href="https://schema.org/CourseInstance"><code>schema:CourseInstance</code></a></td>
<td>The specific bookable Thing that has been selected by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>. See the [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>] for more information on these types. Note that the Broker Request and Orders feed only requires <code>id</code> within these objects to be included, all other properties are ignored.</td>
</tr>
<tr>
<td><a href="https://schema.org/additionalProperty"><code>schema:additionalProperty</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>Array of <a href="https://schema.org/PropertyValue"><code>schema:PropertyValue</code></a></td>
<td><code>PropertyValue</code> that contains a text value useful for reconciliation.</td>
</tr>
<tr>
<td><a href="https://schema.org/accessCode"><code>schema:accessCode</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>Array of <a href="https://schema.org/PropertyValue"><code>schema:PropertyValue</code></a></td>
<td><code>PropertyValue</code> that contains a text value usable for entrance. Not applicable for an <code>OrderQuote</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/accessToken"><code>oa:accessToken</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>Array of <a href="https://schema.org/ImageObject"><code>schema:ImageObject</code></a></td>
<td><code>ImageObject</code> or <code>Barcode</code> that contains reference to an asset (e.g. Barcode, QR code image or PDF) usable for entrance. Not applicable for an <code>OrderQuote</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/error"><code>oa:error</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Array of <a href="https://openactive.io/OpenBookingError"><code>oa:OpenBookingError</code></a></td>
<td>Array of errors related to the OrderItem being included in the Order, only applicable for an <code>OrderQuote</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/cancellationMessage"><code>oa:cancellationMessage</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A message set by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> in the event of opportunity cancellation, only applicable for an <code>Order</code> and where the <code>OrderItem</code> has <code>orderItemStatus</code> set to <code>https://openactive.io/SellerCancelled</code></td>
</tr>
<tr>
<td><a href="http://schema.org/attendee"><code>schema:attendee</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Person"><code>schema:Person</code></a></td>
</tr>
<tr>
<td><a href="http://openactive.io/attendeeDetailsRequired"><code>oa:attendeeDetailsRequired</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td>Array of <a href="https://schema.org/Property"><code>schema:Property</code></a></td>
</tr>
<tr>
<td><a href="https://openactive.io/orderItemIntakeForm"><code>oa:orderItemIntakeForm</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>Array of <a href="https://schema.org/PropertyValueSpecification"><code>schema:PropertyValueSpecification</code></a></td>
<td><code>PropertyValueSpecification</code>s that describe fields in the <code>orderItemIntakeForm</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/orderItemIntakeFormResponse"><code>oa:orderItemIntakeFormResponse</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>Array of <a href="https://schema.org/PropertyValue"><code>schema:PropertyValue</code></a></td>
<td><code>PropertyValue</code>s that contains a text value responses to the <code>orderItemIntakeForm</code>.</td>
</tr>
</tbody></table></section><section id="schema-offer"><h4 id="x10-1-7-schema-offer"><span class="secno">10.1.7 </span><code>schema:Offer</code><a class="self-link" aria-label="§" href="#schema-offer"></a></h4><p>Use of properties of <code>Offer</code> defined in the [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>] are also encouraged.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Offer</code></td>
</tr>
<tr>
<td><code>@id</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>A URI providing a unique identifier for the Offer</td>
</tr>
<tr>
<td><a href="http://schema.org/price"><code>schema:price</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Float"><code>schema:Float</code></a></td>
<td>The offer price available to participants, which includes or excludes tax depending on the <code>taxMode</code> of the <code>Order</code>.</td>
</tr>
<tr>
<td><a href="http://schema.org/priceCurrency"><code>schema:priceCurrency</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The currency of the <code>price</code>. Specified as a 3-letter ISO 4217 value. If a <code>PriceSpecification</code> has a zero <code>price</code>, then this property is not required. Otherwise the <code>priceCurrency</code> <em class="rfc2119" title="MUST">MUST</em> be specified.</td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The name of the offer suitable for display to participants.</td>
</tr>
<tr>
<td><a href="https://openactive.io/availableChannel"><code>oa:availableChannel</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Array of <a href="https://openactive.io/AvailableChannelType"><code>oa:AvailableChannelType</code></a></td>
<td>Can include <code>https://openactive.io/OpenBookingPrepayment</code>, <code>https://openactive.io/TelephoneAdvanceBooking</code>, <code>https://openactive.io/TelephonePrepayment</code>, <code>https://openactive.io/OnlinePrepayment</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/validFromBeforeStartDate"><code>oa:validFromBeforeStartDate</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Duration"><code>schema:Duration</code></a></td>
<td>The duration before the <code>startDate</code> for which this Offer is valid, given in [ISO8601] format. This is a relative equivalent of <a href="http://schema.org/validFrom"><code>schema:validFrom</code></a>, to allow for Offer inheritance.</td>
</tr>
<tr>
<td><a href="https://openactive.io/latestCancellationBeforeStartDate"><code>oa:latestCancellationBeforeStartDate</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Duration"><code>schema:Duration</code></a></td>
<td>The duration before the <code>startDate</code> during which this Offer may <strong>not</strong> be cancelled, given in [ISO8601] format.</td>
</tr>
<tr>
<td><a href="https://openactive.io/openBookingFlowRequirement"><code>oa:openBookingFlowRequirement</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>Array of <a href="https://openactive.io/OpenBookingFlowRequirement"><code>oa:OpenBookingFlowRequirement</code></a></td>
<td>Can include <code>https://openactive.io/OpenBookingIntakeForm</code>, <code>https://openactive.io/OpenBookingAttendeeDetails</code>, <code>https://openactive.io/OpenBookingApproval</code>, <code>https://openactive.io/OpenBookingNegotiation</code></td>
</tr>
</tbody></table><p>Note that for an <code>Offer</code> to be bookable under this specification, <code>availableChannel</code> must include <code>https://openactive.io/OpenBookingPrepayment</code>.</p></section><section id="schema-offeroverride"><h4 id="x10-1-8-schema-offeroverride"><span class="secno">10.1.8 </span><code>schema:OfferOverride</code><a class="self-link" aria-label="§" href="#schema-offeroverride"></a></h4><p><code>OfferOverride</code> subclasses <code>Offer</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Offer</code></td>
</tr>
<tr>
<td><code>@id</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>A URI providing a unique identifier for the Offer</td>
</tr>
<tr>
<td><a href="http://schema.org/price"><code>schema:price</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Float"><code>schema:Float</code></a></td>
<td>The offer price available to participants, which includes or excludes tax depending on the <code>taxMode</code> of the <code>Order</code>.</td>
</tr>
<tr>
<td><a href="http://schema.org/priceCurrency"><code>schema:priceCurrency</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The currency of the <code>price</code>. Specified as a 3-letter ISO 4217 value. If a <code>PriceSpecification</code> has a zero <code>price</code>, then this property is not required. Otherwise the <code>priceCurrency</code> <em class="rfc2119" title="MUST">MUST</em> be specified.</td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The name of the offer suitable for display to participants.</td>
</tr>
<tr>
<td><a href="https://openactive.io/availableChannel"><code>oa:availableChannel</code></a></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td>Not included in <code>OfferOverride</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/validFromBeforeStartDate"><code>oa:validFromBeforeStartDate</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Duration"><code>schema:Duration</code></a></td>
<td>The duration before the <code>startDate</code> for which this Offer is valid, given in [ISO8601] format. This is a relative equivalent of <a href="http://schema.org/validFrom"><code>schema:validFrom</code></a>, to allow for Offer inheritance.</td>
</tr>
<tr>
<td><a href="https://openactive.io/latestCancellationBeforeStartDate"><code>oa:latestCancellationBeforeStartDate</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Duration"><code>schema:Duration</code></a></td>
<td>The duration before the <code>startDate</code> during which this Offer may <strong>not</strong> be cancelled, given in [ISO8601] format.</td>
</tr>
</tbody></table></section><section id="schema-person"><h4 id="x10-1-9-schema-person"><span class="secno">10.1.9 </span><code>schema:Person</code><a class="self-link" aria-label="§" href="#schema-person"></a></h4><p>For business-to-consumer transactions, the <code>customer</code> <em class="rfc2119" title="MUST">MUST</em> be a <code>schema:Person</code>.</p><p>The required fields below relate to a <code>schema:Person</code> when used in the <code>customer</code> property.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Person</code></td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> used by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and/or <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/email"><code>schema:email</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Email address used to uniquely identify the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/givenName"><code>schema:givenName</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Name of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/familyName"><code>schema:familyName</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Name of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/telephone"><code>schema:telephone</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Telephone number of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
</tbody></table><p>Note that in all cases any <code>Person</code> received from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> when it is reflected back in the response <em class="rfc2119" title="MUST">MUST</em> only contain exactly the data that was provided by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and <em class="rfc2119" title="MUST NOT">MUST NOT</em> contain any additional data that may be known about the <code>Person</code> by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>. It is strongly <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> that the personal data received by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> be treated as a "guest checkout" and is not used to create a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> record in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</p><p>In this current iteration of the Booking API specification, the programmatic matching of <code>Person</code> records provided by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to existing records within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> is considered to be out of scope, and is <em class="rfc2119" title="NOT RECOMMENDED">NOT RECOMMENDED</em>.</p><p>For conformance with this specification the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> require more data about the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> than is specified as <em class="rfc2119" title="REQUIRED">REQUIRED</em> properties above.</p></section><section id="schema-organization-for-customer"><h4 id="x10-1-10-schema-organization-for-customer"><span class="secno">10.1.10 </span><code>schema:Organization</code> for <code>customer</code><a class="self-link" aria-label="§" href="#schema-organization-for-customer"></a></h4><p>For business-to-business transactions, the <code>customer</code> <em class="rfc2119" title="MUST">MUST</em> be a <code>schema:Organization</code> with the following properties.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Organization</code></td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> used by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and/or <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/email"><code>schema:email</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Email address used to uniquely identify the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Name of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/telephone"><code>schema:telephone</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Telephone number of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/address"><code>schema:address</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/PostalAddress"><code>schema:PostalAddress</code></a></td>
<td>Address of the business <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
</tbody></table><p>Note that any <code>Organization</code> received from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> when it is reflected back in the response <em class="rfc2119" title="MUST">MUST</em> only contain exactly the data that was provided by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and <em class="rfc2119" title="MUST NOT">MUST NOT</em> contain any additional data that may be known about the <code>Organization</code> by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</p></section><section id="schema-postaladdress"><h4 id="x10-1-11-schema-postaladdress"><span class="secno">10.1.11 </span><code>schema:PostalAddress</code><a class="self-link" aria-label="§" href="#schema-postaladdress"></a></h4><p>For <code>schema:Organization</code> when used for <code>customer</code> or <code>seller</code>, the following properties are required.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>PostalAddress</code></td>
</tr>
<tr>
<td><a href="http://schema.org/streetAddress"><code>schema:streetAddress</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Street address</td>
</tr>
<tr>
<td><a href="http://schema.org/addressLocality"><code>schema:addressLocality</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Town or other area</td>
</tr>
<tr>
<td><a href="http://schema.org/addressRegion"><code>schema:addressRegion</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Region</td>
</tr>
<tr>
<td><a href="http://schema.org/postalCode"><code>schema:postalCode</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Postcode</td>
</tr>
<tr>
<td><a href="http://schema.org/addressCountry"><code>schema:addressCountry</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>ISO 3166-1 alpha-2 country code.</td>
</tr>
</tbody></table></section><section id="oa-lease"><h4 id="x10-1-12-oa-lease"><span class="secno">10.1.12 </span><code>oa:Lease</code><a class="self-link" aria-label="§" href="#oa-lease"></a></h4><p>Used for <code>lease</code>. An object is provided for extensibility.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Lease</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/leaseExpires"><code>oa:leaseExpires</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/DateTime"><code>schema:DateTime</code></a></td>
<td>Expiry DateTime of the lease in [ISO8601] format</td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Optional identifier of the lease if useful for audit or debugging purposes.</td>
</tr>
</tbody></table></section><section id="schema-pricespecification"><h4 id="x10-1-13-schema-pricespecification"><span class="secno">10.1.13 </span><code>schema:PriceSpecification</code><a class="self-link" aria-label="§" href="#schema-pricespecification"></a></h4><p>Used for <code>totalPaymentDue</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>PriceSpecification</code></td>
</tr>
<tr>
<td><a href="http://schema.org/price"><code>schema:price</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Float"><code>schema:Float</code></a></td>
<td>The total amount.</td>
</tr>
<tr>
<td><a href="http://schema.org/priceCurrency"><code>schema:priceCurrency</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The currency of the <code>price</code>. Specified as a 3-letter ISO 4217 value. If a <code>PriceSpecification</code> has a zero <code>price</code>, then this property is not required. Otherwise the <code>priceCurrency</code> <em class="rfc2119" title="MUST">MUST</em> be specified.</td>
</tr>
</tbody></table></section><section id="oa-taxchargespecification"><h4 id="x10-1-14-oa-taxchargespecification"><span class="secno">10.1.14 </span><code>oa:TaxChargeSpecification</code><a class="self-link" aria-label="§" href="#oa-taxchargespecification"></a></h4><p><code>TaxChargeSpecification</code> subclasses <code>PriceSpecification</code>, and so includes the same properties and a few additional ones. These are listed below.</p><p><code>TaxChargeSpecification</code> properties are intended to be rendered to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> as-is, and are not designed to be manipulated by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>TaxChargeSpecification</code></td>
</tr>
<tr>
<td><a href="http://schema.org/price"><code>schema:price</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Float"><code>schema:Float</code></a></td>
<td>The monetary value of the tax charge.</td>
</tr>
<tr>
<td><a href="http://schema.org/priceCurrency"><code>schema:priceCurrency</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The currency of the tax charge. Specified as a 3-letter ISO 4217 value. If an tax charge has a zero <code>price</code>, then this property is not required. Otherwise the <code>priceCurrency</code> <em class="rfc2119" title="MUST">MUST</em> be specified.</td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Integer"><code>schema:Integer</code></a>, <a href="https://schema.org/Text"><code>schema:Text</code></a>, <a href="https://schema.org/PropertyValue"><code>schema:PropertyValue</code></a> or an array of <a href="https://schema.org/PropertyValue"><code>schema:PropertyValue</code></a></td>
<td>A local identifier for the tax charge e.g. "VAT-20", used to identify the type of tax within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>. Note an array of <code>PropertyValue</code> can be used to provide multiple identifiers where available.</td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The name of the tax charge, e.g. "VAT at 0% for EU transactions"</td>
</tr>
<tr>
<td><a href="https://openactive.io/rate"><code>oa:rate</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Float"><code>schema:Float</code></a></td>
<td>The rate of VAT.</td>
</tr>
</tbody></table></section><section id="oa-payment"><h4 id="x10-1-15-oa-payment"><span class="secno">10.1.15 </span><code>oa:Payment</code><a class="self-link" aria-label="§" href="#oa-payment"></a></h4><p>Used for <code>payment</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Payment</code></td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Optional free text description of the payment method for the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, to help the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> in discussions with the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> (e.g. "AcmeBroker Points" or "AcmeBroker via Credit Card").</td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the payment held by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and/or <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/paymentMethod"><code>schema:paymentMethod</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/PaymentMethod"><code>schema:PaymentMethod</code></a></td>
<td>If using the payment extension point, this references the payment method used. If not present indicates <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> uses the external <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/accountId"><code>schema:accountId</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A reference used by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> to group transactions, which is used to aid reconciliation.</td>
</tr>
<tr>
<td><a href="https://openactive.io/paymentProviderId"><code>oa:paymentProviderId</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A reference to the specific <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a> that is used.</td>
</tr>
</tbody></table><p>Note that <code>identifier</code> and are <em class="rfc2119" title="NOT REQUIRED">NOT REQUIRED</em> if <code>paymentMethod</code> is specified, to maximise flexibility of the payments extension point.</p></section><section id="oa-dynamicpayment"><h4 id="x10-1-16-oa-dynamicpayment"><span class="secno">10.1.16 </span><code>oa:DynamicPayment</code><a class="self-link" aria-label="§" href="#oa-dynamicpayment"></a></h4><p><code>oa:DynamicPayment</code> subclasses <code>oa:Payment</code>, and includes all of the above properties as specified for <code>Payment</code>, but with <code>accountId</code> being <em class="rfc2119" title="REQUIRED">REQUIRED</em>.</p><p>Used for fully dynamic pricing, where price is not known at the point of purchase</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><a href="http://schema.org/accountId"><code>schema:accountId</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A reference used by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> to group transactions related, which is used to aid reconciliation.</td>
</tr>
</tbody></table></section><section id="oa-bookingservice"><h4 id="x10-1-17-oa-bookingservice"><span class="secno">10.1.17 </span><code>oa:BookingService</code><a class="self-link" aria-label="§" href="#oa-bookingservice"></a></h4><p><code>oa:BookingService</code> subclasses <code>schema:Service</code>.</p><p>Used for <code>bookingService</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>BookingService</code></td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The name of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a></td>
</tr>
<tr>
<td><a href="http://schema.org/url"><code>schema:url</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The URL of the website of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/termsOfService"><code>schema:termsOfService</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>Array of <a href="https://openactive.io/Terms"><code>oa:Terms</code></a></td>
<td>The terms of service of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
</tr>
</tbody></table></section><section id="oa-terms"><h4 id="x10-1-18-oa-terms"><span class="secno">10.1.18 </span><code>oa:Terms</code><a class="self-link" aria-label="§" href="#oa-terms"></a></h4><p>Used for <code>termsOfService</code>.</p><p><code>oa:Terms</code> subclasses <code>schema:DigitalDocument</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Terms</code></td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The name of the terms which must distinguish this from other terms provided, e.g. "Terms and Conditions" or "Privacy Policy"</td>
</tr>
<tr>
<td><a href="http://schema.org/url"><code>schema:url</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The URL of the webpage containing the contents of the terms.</td>
</tr>
<tr>
<td><a href="https://openactive.io/requiresExplicitConsent"><code>oa:requiresExplicitConsent</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td></td>
<td><a href="https://schema.org/Boolean"><code>schema:Boolean</code></a></td>
</tr>
</tbody></table></section><section id="oa-privacypolicy"><h4 id="x10-1-19-oa-privacypolicy"><span class="secno">10.1.19 </span><code>oa:PrivacyPolicy</code><a class="self-link" aria-label="§" href="#oa-privacypolicy"></a></h4><p>Used for <code>termsOfService</code>.</p><p><code>oa:PrivacyPolicy</code> subclasses <code>oa:Terms</code>.</p><p>A specific subclass for Privacy Policies, to help the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> distinguish these types of <code>Terms</code> in their user experience.</p></section><section id="oa-termsofuse"><h4 id="x10-1-20-oa-termsofuse"><span class="secno">10.1.20 </span><code>oa:TermsOfUse</code><a class="self-link" aria-label="§" href="#oa-termsofuse"></a></h4><p>Used for <code>termsOfService</code>.</p><p><code>oa:TermsOfUse</code> subclasses <code>oa:Terms</code>.</p><p>A specific subclass for Terms of Use, to help the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> distinguish these types of <code>Terms</code> in their user experience.</p></section></section><section id="error-model"><h3 id="x10-2-error-model"><span class="secno">10.2 </span>Error Model<a class="self-link" aria-label="§" href="#error-model"></a></h3><section id="oa-openbookingerror"><h4 id="x10-2-1-oa-openbookingerror"><span class="secno">10.2.1 </span><code>oa:OpenBookingError</code><a class="self-link" aria-label="§" href="#oa-openbookingerror"></a></h4><table>
<thead>
<tr>
<th>Property</th>
<th>Status</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Error</code></td>
</tr>
<tr>
<td><a href="https://schema.org/name"><code>schema:name</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A short, human-readable summary of the problem type. It <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> change from occurrence to occurrence of the problem, except for purposes of localization</td>
</tr>
<tr>
<td><a href="https://schema.org/description"><code>schema:description</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A slightly longer, human-readable summary of the problem type. It largely <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> change from occurrence to occurrence of the problem, except for purposes of localization or to provide specific information about why the error occurred in that particular case.</td>
</tr>
<tr>
<td><a href="https://openactive.io/instance"><code>oa:instance</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The requested URL.</td>
</tr>
<tr>
<td><a href="https://openactive.io/method"><code>oa:method</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The method of the request (e.g. GET).</td>
</tr>
<tr>
<td><a href="https://openactive.io/status"><code>oa:status</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Integer"><code>schema:Integer</code></a></td>
<td>An integer representing the HTTP status code.</td>
</tr>
<tr>
<td><a href="https://openactive.io/invalidParams"><code>oa:invalidParams</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>Array of <a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>An array of invalid parameters, if appropriate.</td>
</tr>
<tr>
<td><a href="https://openactive.io/requestId"><code>oa:requestId</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Used by technical support for diagnostics purposes.</td>
</tr>
</tbody></table></section><section id="oa-openbookingerror-subclasses"><h4 id="x10-2-2-oa-openbookingerror-subclasses"><span class="secno">10.2.2 </span><code>oa:OpenBookingError</code> subclasses<a class="self-link" aria-label="§" href="#oa-openbookingerror-subclasses"></a></h4><p>A number of <code>OpenBookingError</code> subclasses are specified to identify the problem type.</p><section id="order-creation-orderquote-and-order-error-responses"><h5 id="x10-2-2-1-order-creation-orderquote-and-order-error-responses"><span class="secno">10.2.2.1 </span>Order Creation - <code>OrderQuote</code> and <code>Order</code> error responses<a class="self-link" aria-label="§" href="#order-creation-orderquote-and-order-error-responses"></a></h5><table>
<thead>
<tr>
<th>Error Type</th>
<th>Status Code</th>
<th>Use Case</th>
</tr>
</thead>
<tbody><tr>
<td><code>IncompleteCustomerDetailsError</code></td>
<td>400</td>
<td>If the <code>email</code> address of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> is not supplied within a <code>schema:Person</code> object; or if the <code>customer</code> property supplied is not a valid <code>schema:Person</code> or <code>schema:Organization</code> object.</td>
</tr>
<tr>
<td><code>IncompleteAttendeeDetailsError</code></td>
<td>400</td>
<td>If the <code>attendeeDetailsRequired</code> properties of the <code>attendee</code> are not supplied within a <code>schema:Person</code> object.</td>
</tr>
<tr>
<td><code>IncompleteIntakeFormError</code></td>
<td>400</td>
<td>If the <code>orderItemIntakeFormResponse</code> is missing fields that are specified as <code>valueRequired</code> within the <code>orderItemIntakeForm</code>.</td>
</tr>
<tr>
<td><code>IncompleteBrokerDetailsError</code></td>
<td>400</td>
<td>If there is insufficient detail in the <code>schema:Organisation</code> object describing the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>; or if the <code>broker</code> property supplied is not a valid schema:Organisation object.</td>
</tr>
<tr>
<td><code>IncompletePaymentDetailsError</code></td>
<td>400</td>
<td>If the <code>payment</code> property of the <code>OrderQuote</code> is missing details required by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, or if the <code>payment</code> property of the <code>Order</code> is missing or does not include an <code>identifier</code> or <code>paymentMethod</code>.</td>
</tr>
<tr>
<td><code>InvalidPaymentDetailsError</code></td>
<td>400</td>
<td>If the <code>payment</code> property of the <code>OrderQuote</code> or <code>Order</code> contains data that is not accepted the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> for reconciliation, e.g. <code>accountId</code>.</td>
</tr>
<tr>
<td><code>OrderAlreadyExistsError</code></td>
<td>500</td>
<td>If the UUID used for an <code>OrderQuote</code> already represents a completed Order with a different set of <code>OrderItem</code>s to those specified (note call to <a href="#dfn-b" class="internalDFN" data-link-type="dfn"><b>B</b></a> is idempotent for the case where <code>OrderItem</code>s match). This happens in the rare event of a UUID clash.</td>
</tr>
</tbody></table></section><section id="order-cancellation-orderquote-and-order-error-responses"><h5 id="x10-2-2-2-order-cancellation-orderquote-and-order-error-responses"><span class="secno">10.2.2.2 </span>Order Cancellation - <code>OrderQuote</code> and <code>Order</code> error responses<a class="self-link" aria-label="§" href="#order-cancellation-orderquote-and-order-error-responses"></a></h5><table>
<thead>
<tr>
<th>Error Type</th>
<th>Status Code</th>
<th>Use Case</th>
</tr>
</thead>
<tbody><tr>
<td><code>CancellationNotPermittedError</code></td>
<td>400</td>
<td>The cancellation is not permitted due to internal rules of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> not otherwise exposed to the <code>Broker</code>. The <code>description</code> property of the object <em class="rfc2119" title="MUST">MUST</em> include a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>-facing description of the reason that cancellation is not permitted.</td>
</tr>
</tbody></table></section><section id="order-creation-orderitem-errors"><h5 id="x10-2-2-3-order-creation-orderitem-errors"><span class="secno">10.2.2.3 </span>Order Creation - <code>OrderItem</code> errors<a class="self-link" aria-label="§" href="#order-creation-orderitem-errors"></a></h5><p>Note that all <code>OrderItem</code> errors for an <code>OrderQuote</code> request result in a <code>409 Conflict</code> response, as the error is expected to be resolved, and the request resubmitted, as per [<cite><a class="bibref" href="#bib-rfc2616">RFC2616</a></cite>] section 10.4.10.</p><table>
<thead>
<tr>
<th>Error Type</th>
<th>Status Code</th>
<th>Use Case</th>
</tr>
</thead>
<tbody><tr>
<td><code>IncompleteOrderItemError</code></td>
<td>409</td>
<td>If there is a missing <code>acceptedOffer</code> or <code>orderedItem</code> property on the <code>OrderItem</code>.</td>
</tr>
<tr>
<td><code>IntakeFormOrderItemError</code></td>
<td>409</td>
<td>If <code>orderItemIntakeFormResponse</code> is insufficient on the <code>OrderItem</code>.</td>
</tr>
<tr>
<td><code>UnacceptableOfferError</code></td>
<td>409</td>
<td>If the <code>acceptedOffer</code> is not a URL which corresponds to an applicable <code>Offer</code> for the opportunity.</td>
</tr>
<tr>
<td><code>UnknownOfferError</code></td>
<td>409</td>
<td>If the <code>acceptedOffer</code> is not a URL which corresponds to an <code>Offer</code> within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
</tr>
<tr>
<td><code>UnknownOpportunityDetailsError</code></td>
<td>409</td>
<td>If the <code>orderedItem</code> is not a URL which corresponds to an opportunity on the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
</tr>
<tr>
<td><code>UnavailableOpportunityError</code></td>
<td>409</td>
<td>If the <code>Offer</code> contained in the <code>acceptedOffer</code> property is not <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a>.</td>
</tr>
<tr>
<td><code>OpportunityIsInConflictError</code></td>
<td>409</td>
<td>If the specific <code>orderedItem</code>s against which this error is emitted are not able to be booked together.</td>
</tr>
<tr>
<td><code>OpportunityIsFullError</code></td>
<td>409</td>
<td>If there are no available spaces for the opportunity contained in the <code>orderedItem</code> property.</td>
</tr>
<tr>
<td><code>OpportunityHasInsufficientCapacityError</code></td>
<td>409</td>
<td>If there are not enough available spaces in the opportunity contained in the <code>orderedItem</code> property of the <code>OrderItem</code> to fulfil the number of repeated <code>OrderItem</code>s. If the <code>OrderItem</code> is repeated (for multiple attendees) this error must only be displayed against the <code>OrderItem</code>s which are in excess of the capacity - for example in an <a href="#dfn-opportunities" class="internalDFN" data-link-type="dfn">Opportunity</a> with a <code>remainingAttendeeCapacity</code> of 2 and with 5 <code>OrderItem</code>s related to it, this error would only be emitted against 3 of the <code>OrderItem</code>s.</td>
</tr>
</tbody></table></section><section id="api-authentication"><h5 id="x10-2-2-4-api-authentication"><span class="secno">10.2.2.4 </span>API authentication<a class="self-link" aria-label="§" href="#api-authentication"></a></h5><table>
<thead>
<tr>
<th>Error Type</th>
<th>Status Code</th>
<th>Use Case</th>
</tr>
</thead>
<tbody><tr>
<td><code>UnauthenticatedError</code></td>
<td>403</td>
<td>If the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> did not supply any form of authentication.</td>
</tr>
<tr>
<td><code>NoAPITokenError</code></td>
<td>403</td>
<td>If the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> did not supply an API key.</td>
</tr>
<tr>
<td><code>InvalidAPITokenError</code></td>
<td>401</td>
<td>If the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> supplied an invalid API key, either malformed or expired.</td>
</tr>
<tr>
<td><code>InvalidAuthorizationDetailsError</code></td>
<td>401</td>
<td>If the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> supplied an invalid set of authorization details, either malformed or expired.</td>
</tr>
</tbody></table></section><section id="technical-errors"><h5 id="x10-2-2-5-technical-errors"><span class="secno">10.2.2.5 </span>Technical errors<a class="self-link" aria-label="§" href="#technical-errors"></a></h5><table>
<thead>
<tr>
<th>Error Type</th>
<th>Status Code</th>
<th>Use Case</th>
</tr>
</thead>
<tbody><tr>
<td><code>TemporarilyUnableToProduceOrderQuoteError</code></td>
<td>503</td>
<td>If the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> is unable for technical reasons to produce an <code>OrderQuote</code> where the data provided to it is sufficient to allow it to do so.</td>
</tr>
<tr>
<td><code>TemporarilyUnableToCreateOrderError</code></td>
<td>503</td>
<td>If the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> is unable for technical reasons to create an <code>Order</code> where the data provided to it is sufficient to allow it to do so.</td>
</tr>
<tr>
<td><code>TemporarilyUnableToUpdateOrderError</code></td>
<td>503</td>
<td>If the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> is unable for technical reasons to update an <code>Order</code> (which includes attempting to PATCH for cancellation) where the data provided to it is sufficient to allow it to do so.</td>
</tr>
<tr>
<td><code>TemporarilyUnableToDeleteOrderError</code></td>
<td>503</td>
<td>If the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> is unable for technical reasons to delete an <code>Order</code> where the data provided to it is sufficient to allow it to do so</td>
</tr>
</tbody></table></section><section id="generic-errors"><h5 id="x10-2-2-6-generic-errors"><span class="secno">10.2.2.6 </span>Generic errors<a class="self-link" aria-label="§" href="#generic-errors"></a></h5><table>
<thead>
<tr>
<th>Error Type</th>
<th>Status Code</th>
<th>Use Case</th>
</tr>
</thead>
<tbody><tr>
<td><code>UnknownOrderError</code></td>
<td>404</td>
<td>Where a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> has no <code>Order</code> matching the one requested.</td>
</tr>
<tr>
<td><code>UnknownOrIncorrectEndpointError</code></td>
<td>404</td>
<td>Where a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> has no endpoint matching the one requested.</td>
</tr>
<tr>
<td><code>NotFoundError</code></td>
<td>404</td>
<td>Where a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> does not have the generic resource specified.</td>
</tr>
<tr>
<td><code>MethodNotAllowed</code></td>
<td>405</td>
<td>Where a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> does not recognise a specific HTTP method for the endpoint requested with that specific HTTP verb.</td>
</tr>
<tr>
<td><code>PatchContainsExcessiveProperties</code></td>
<td>400</td>
<td>Where a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> recognises a PATCH request but the request object contains properties that the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> is not permitted to update. Custom namespace properties are always excluded from consideration.</td>
</tr>
<tr>
<td><code>PatchNotAllowedOnProperty</code></td>
<td>400</td>
<td>Where a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> recognises a PATCH request but the request object contains one or many properties that the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> is not permitted to update to the requested value.</td>
</tr>
<tr>
<td><code>GoneError</code></td>
<td>410</td>
<td>Where an <code>Order</code> has been soft-deleted by an Order Deletion request.</td>
</tr>
<tr>
<td><code>TooManyRequestsError</code></td>
<td>429</td>
<td>Where the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> is rate-limiting the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</td>
</tr>
</tbody></table></section></section></section></section><section class="normative" id="common-requirements"><!--OddPage--><h2 id="x11-common-requirements"><span class="secno">11. </span>Common Requirements<a class="self-link" aria-label="§" href="#common-requirements"></a></h2><p>This section defines some common functionality that applies to the design of the
whole API.</p><section id="media-types"><h3 id="x11-1-media-types"><span class="secno">11.1 </span>Media types<a class="self-link" aria-label="§" href="#media-types"></a></h3><p>Custom media types are used in this API to allow clients to choose the format
of the data they receive, and for <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> to stipulate which versions
of the specification they support.</p><p><a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> <em class="rfc2119" title="MAY">MAY</em> choose to support additional media types but <em class="rfc2119" title="MUST">MUST</em> support the
media type(s) defined by this specification.</p><p>Media types will conform to the following pattern:</p><pre><code aria-busy="false" class="hljs">application/vnd.openactive+json; model=[m], booking=[b], rpde=[r]</code></pre><p>The current media type is:</p><pre><code aria-busy="false" class="hljs">application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0</code></pre><p><a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a> specifying a media type without a version, such as:</p><pre><code aria-busy="false" class="hljs">application/vnd.openactive+json</code></pre><p>will receive data in in the most current format.</p><p>If you are building an application as a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and care about the stability
of the response, or have a client application which is tied to a specific
version you should always try to use a media type containing the version number.</p><div class="issue" id="issue-container-number-93"><div role="heading" class="issue-title marker" id="h-issue-0" aria-level="4"><a href="https://github.com/openactive/open-booking-api/issues/93"><span class="issue-number">Issue 93</span></a><span class="issue-label" aria-label="This issue is labelled as Community Feedback Requested.">: Alignment media types <a class="respec-gh-label respec-label-light" href="https://github.com/openactive/open-booking-api/issues/?q=is%3Aissue+is%3Aopen+label%3A%22Community+Feedback+Requested%22" style="background-color: rgb(150, 224, 234);">Community Feedback Requested</a></span></div><p>The specification has been updated to use media types that follow this pattern:<br>
<code>application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0</code></p>
<p>Instead of:<br>
<code>application/vnd.openactive.1.0+json</code></p>
<p>Rationalle:</p>
<ul>
<li>Separates versions of booking spec from the RPDE and model versions, so they may evolve separately.</li>
<li>It uses media type parameters, which simplifies IANA registration at a later date (IANA registered media types do not have versions baked in)</li>
</ul>
<p>Please comment on this issue if you can foresee any challenges with this.</p></div></section><section id="response-formats"><h3 id="x11-2-response-formats"><span class="secno">11.2 </span>Response formats<a class="self-link" aria-label="§" href="#response-formats"></a></h3><p>Requests and response documents exchanged via this API will all be valid
[<cite><a class="bibref" href="#bib-json-ld">JSON-LD</a></cite>] documents, with the exception of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, where only documents
included in the <code>data</code> property are valid [<cite><a class="bibref" href="#bib-json-ld">JSON-LD</a></cite>].</p><p>The [<cite><a class="bibref" href="#bib-json-ld">JSON-LD</a></cite>] documents <em class="rfc2119" title="MUST">MUST</em> include a [<cite><a class="bibref" href="#bib-json-ld">JSON-LD</a></cite>] <code>context</code> that refers
to the [<cite><a class="bibref" href="#bib-openactive-vocabulary">OpenActive-Vocabulary</a></cite>] as follows:</p><div class="example" id="example-50-minimal-json-ld-document">
          <div class="marker">
      <a class="self-link" href="#example-50-minimal-json-ld-document">Example 50</a><span class="example-title">: minimal JSON-LD document</span>
    </div> <pre aria-busy="false"><code class="hljs json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>
}</code></pre>
        </div><p>Unless otherwise specified the request and response documents <em class="rfc2119" title="MUST">MUST</em> conform to
the [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>] data model.</p></section><section id="errors"><h3 id="x11-3-errors"><span class="secno">11.3 </span>Errors<a class="self-link" aria-label="§" href="#errors"></a></h3><p>Error responses <em class="rfc2119" title="MUST">MUST</em> be served using an appropriate HTTP 4XX status code or HTTP 5XX status code specified in the model.</p><p>All error responses from this API <em class="rfc2119" title="MUST">MUST</em> be returned in a JSON-LD format subclass of the <code>OpenBookingError</code> using a content type of <code>application/vnd.openactive+json</code> (optionally including any version parameters).</p><div class="example" id="example-51-error-response-example">
          <div class="marker">
      <a class="self-link" href="#example-51-error-response-example">Example 51</a><span class="example-title">: Error response example</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">400</span> Bad Request
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"IncompleteCustomerDetailsError"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"No customer details supplied"</span>
}</span></code></pre>
        </div></section><section id="rate-limiting"><h3 id="x11-4-rate-limiting"><span class="secno">11.4 </span>Rate Limiting<a class="self-link" aria-label="§" href="#rate-limiting"></a></h3><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MAY">MAY</em> choose to apply rate limiting for each unique set of authentication credentials. In such circumstances where a request is rate limited, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> return a response with status code 429.</p><p>To allow for a broad range of API management solutions to be used, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> rely only on the status code 429 when detecting and retrying a rate-limited request, as specified elsewhere in this specification. The following guidance is included to encourage convergence in implementations where possible.
</p><p>All rate-limited responses from this API <em class="rfc2119" title="SHOULD">SHOULD</em> return a JSON-LD format <code>TooManyRequestsError</code> object using a content type of <code>application/vnd.openactive+json</code> (optionally including any version parameters) with status code 429.</p><p>The response <em class="rfc2119" title="SHOULD">SHOULD</em> also include the <code>Retry-After</code> HTTP Header with a value set to the number of seconds after which the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="SHOULD">SHOULD</em> retry as per [<cite><a class="bibref" href="#bib-rfc2616">RFC2616</a></cite>] section 14.37.
</p><div class="example" id="example-52-rate-limited-response-example">
          <div class="marker">
      <a class="self-link" href="#example-52-rate-limited-response-example">Example 52</a><span class="example-title">: Rate limited response example</span>
    </div> <pre aria-busy="false"><code class="hljs http">HTTP/1.1 <span class="hljs-number">429</span> Too Many Requests
<span class="hljs-attribute">Date</span>: Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span>: application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0
<span class="hljs-attribute">Retry-After</span>: 8

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"TooManyRequestsError"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Rate Limit Reached. Retry in 8 seconds."</span>
}</span></code></pre>
        </div></section><section id="security"><h3 id="x11-5-security"><span class="secno">11.5 </span>Security<a class="self-link" aria-label="§" href="#security"></a></h3><p>Although this specification does not mandate a specific means of securing an API, it does mandate that at a minimum all HTTP requests and responses <em class="rfc2119" title="MUST">MUST</em> be secured using SSL.</p></section><section id="authentication"><h3 id="x11-6-authentication"><span class="secno">11.6 </span>Authentication<a class="self-link" aria-label="§" href="#authentication"></a></h3><section id="api-level-authentication-and-data-security"><h4 id="x11-6-1-api-level-authentication-and-data-security"><span class="secno">11.6.1 </span>API level authentication and data security<a class="self-link" aria-label="§" href="#api-level-authentication-and-data-security"></a></h4><p>All of the API transactions described in this document <em class="rfc2119" title="MUST">MUST</em> require authentication.</p><p>The content and data available to all endpoints provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> be specific to the authentication credentials, to ensure that bookings are secure. It is the responsibility of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to ensure that only authentication credentials that created an <code>Order</code> can amend and cancel the <code>Order</code>.</p><p>Note that a client using the same authentication credentials may represent more than one <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, and the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> make no assumptions regarding which <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> is being represented by a particular set of credentials. For the avoidance of doubt: the same <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> accessing a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> using two sets of credentials <em class="rfc2119" title="MUST">MUST</em> not be able to access <code>Order</code>'s created by one set of credentials when using the other.</p><p>In terms of implementation, all data partitioning and security <em class="rfc2119" title="MUST">MUST</em> be based on the authentication credentials; the <code>broker</code> property within the <code>Order</code> is for information only.</p><p>This specification does not mandate a particular authentication method, but its recommendation is that implementers <em class="rfc2119" title="SHOULD">SHOULD</em> consider using [<cite><a class="bibref" href="#bib-oauth2">OAuth2</a></cite>] as it is well-defined, widely supported and can be used in a variety of different application flows (e.g. via a Javascript web application or between servers).</p><p>Other server-to-server authentication mechanisms such as basic authentication, API key or bearer token based mechanisms are also appropriate.</p></section><section id="broker-and-authenticating-party"><h4 id="x11-6-2-broker-and-authenticating-party"><span class="secno">11.6.2 </span>Broker and Authenticating Party<a class="self-link" aria-label="§" href="#broker-and-authenticating-party"></a></h4><p>Note that the <code>broker</code> property in the request body is to help the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to clarify who is making request and to help them in situations such as queries to allow reconciliation of payments. It is not designed as any part of an authentication which <em class="rfc2119" title="MUST">MUST</em> be performed outside of the JSON body of the request. Authentication tokens <em class="rfc2119" title="MUST NOT">MUST NOT</em> be present within the <code>broker</code> property of the submitted JSON.</p><p>In the situation where a middleware is used for various <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a>, independently of API key provisioning at the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> level, the <code>broker</code> property <em class="rfc2119" title="SHOULD">SHOULD</em> contain the details of the end-user <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> rather than the middleware.</p></section><section id="customer-level-authentication"><h4 id="x11-6-3-customer-level-authentication"><span class="secno">11.6.3 </span><a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> level authentication<a class="self-link" aria-label="§" href="#customer-level-authentication"></a></h4><p>OpenID Connect ([<cite><a class="bibref" href="#bib-openidconnect">OpenIdConnect</a></cite>]) is recommended as standard way of verifying the identity of <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>. It is a thin layer that sits atop OAuth2.</p><p>One principle relating to authentication and the Booking API is that <code>Order</code>s created by a specific <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> be able to be changed by any other <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>. It is the responsibility of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to ensure that subsequent requests to an <code>Order</code> should only be initiated by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> which created the <code>Order</code>.</p></section></section></section><section class="normative" id="future-versions-of-this-api"><!--OddPage--><h2 id="x12-future-versions-of-this-api"><span class="secno">12. </span>Future versions of this API<a class="self-link" aria-label="§" href="#future-versions-of-this-api"></a></h2><p>Future iterations of the specification be shaped by the OpenActive community, and we encourage you to get involved.</p></section><section class="appendix informative" id="acknowledgements"><!--OddPage--><h2 id="a-acknowledgements"><span class="secno">A. </span>Acknowledgements<a class="self-link" aria-label="§" href="#acknowledgements"></a></h2><p><em>This section is non-normative.</em></p><p>The editors thank <a href="https://www.w3.org/community/openactive/participants">all members</a> of the OpenActive Community Group for their contributions.</p><p>Icons made by Freepik, Darius Dan, Eucalyp, smalllikeart, bqlqn, Maxim Basinski from <a href="https://www.flaticon.com">www.flaticon.com</a>.</p></section><section id="references" class="appendix">
      <!--OddPage--><h2 id="b-references"><span class="secno">B. </span>References<a class="self-link" aria-label="§" href="#references"></a></h2>
      
    <section id="normative-references">
        <h3 id="b-1-normative-references"><span class="secno">B.1 </span>Normative references<a class="self-link" aria-label="§" href="#normative-references"></a></h3>
      <dl class="bibliography">
        <dt id="bib-dataset-api-discovery">[Dataset-API-Discovery]</dt><dd><a href="https://www.openactive.io/dataset-api-discovery/EditorsDraft/"><cite>Dataset API Discovery</cite></a>.  OpenActive Community Group. URL: <a href="https://www.openactive.io/dataset-api-discovery/EditorsDraft/">https://www.openactive.io/dataset-api-discovery/EditorsDraft/</a></dd><dt id="bib-json-ld">[JSON-LD]</dt><dd><a href="https://www.w3.org/TR/json-ld/"><cite>JSON-LD 1.0</cite></a>.  W3C. W3C Recommendation. URL: <a href="https://www.w3.org/TR/json-ld/">https://www.w3.org/TR/json-ld/</a></dd><dt id="bib-modelling-opportunity-data">[Modelling-Opportunity-Data]</dt><dd><a href="https://www.openactive.io/modelling-opportunity-data/"><cite>Modelling Opportunity Data</cite></a>.  OpenActive Community Group. URL: <a href="https://www.openactive.io/modelling-opportunity-data/">https://www.openactive.io/modelling-opportunity-data/</a></dd><dt id="bib-oauth2">[OAuth2]</dt><dd><a href="https://oauth.net/2/"><cite>OAuth 2.0</cite></a>. URL: <a href="https://oauth.net/2/">https://oauth.net/2/</a></dd><dt id="bib-openactive-vocabulary">[OpenActive-Vocabulary]</dt><dd><a href="https://www.openactive.io/ns/"><cite>OpenActive Vocabulary</cite></a>.  OpenActive Community Group. URL: <a href="https://www.openactive.io/ns/">https://www.openactive.io/ns/</a></dd><dt id="bib-openidconnect">[OpenIdConnect]</dt><dd><a href="https://openid.net/connect/"><cite>OpenID Connect</cite></a>. URL: <a href="https://openid.net/connect/">https://openid.net/connect/</a></dd><dt id="bib-rfc2119">[RFC2119]</dt><dd><a href="https://tools.ietf.org/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner. IETF. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a></dd><dt id="bib-rfc2616">[RFC2616]</dt><dd><a href="https://tools.ietf.org/html/rfc2616"><cite>Hypertext Transfer Protocol -- HTTP/1.1</cite></a>. R. Fielding; J. Gettys; J. Mogul; H. Frystyk; L. Masinter; P. Leach; T. Berners-Lee. IETF. June 1999. Draft Standard. URL: <a href="https://tools.ietf.org/html/rfc2616">https://tools.ietf.org/html/rfc2616</a></dd><dt id="bib-rpde">[RPDE]</dt><dd><a href="https://www.openactive.io/realtime-paged-data-exchange/"><cite>Realtime Paged Data Exchange</cite></a>.  OpenActive Community Group. URL: <a href="https://www.openactive.io/realtime-paged-data-exchange/">https://www.openactive.io/realtime-paged-data-exchange/</a></dd>
      </dl></section></section><p role="navigation" id="back-to-top"><a href="#title"><abbr title="Back to Top">↑</abbr></a></p><script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script></body></html>