<!DOCTYPE html><html xmlns="https://www.w3.org/1999/xhtml" lang="en"><head><meta charset="utf-8"><meta name="generator" content="ReSpec 24.4.0"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><style>/* --- EXAMPLES --- */
span.example-title {
    text-transform: none;
}
aside.example, div.example, div.illegal-example {
    padding: 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
div.illegal-example { color: red }
div.illegal-example p { color: black }
aside.example, div.example {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
    border-color: #e0cb52;
    background: #fcfaee;
}

aside.example div.example {
    border-left-width: .1em;
    border-color: #999;
    background: #fff;
}
aside.example div.example span.example-title {
    color: #999;
}
</style><style>/* --- ISSUES/NOTES --- */
div.issue-title, div.note-title , div.ednote-title, div.warning-title {
    padding-right:  1em;
    min-width: 7.5em;
    color: #b9ab2d;
}
div.issue-title { color: #e05252; }
div.note-title, div.ednote-title { color: #2b2; }
div.warning-title { color: #f22; }
div.note-title span, div.ednote-title span, div.warning-title span {
    text-transform: uppercase;
}
div.issue-title span { text-transform: none; }
div.note, div.issue, div.ednote, div.warning {
    margin-top: 1em;
    margin-bottom: 1em;
}
.warning > p:first-child { margin-top: 0 }
.warning {
    padding: .5em;
    border-left-width: .5em;
    border-left-style: solid;
}
div.issue, div.note , div.ednote,  div.warning {
    padding: 1em 1.2em 0.5em;
    margin: 1em 0;
    position: relative;
    clear: both;
}
span.warning { padding: .1em .5em .15em; }

.issue.closed span.issue-number {
    text-decoration: line-through;
}

.warning {
    border-color: #f11;
    border-width: .2em;
    border-style: solid;
    background: #fbe9e9;
}

.warning-title:before{
    content: "⚠"; /*U+26A0 WARNING SIGN*/
    font-size: 3em;
    float: left;
    height: 100%;
    padding-right: .3em;
    vertical-align: top;
    margin-top: -0.5em;
}

li.task-list-item {
    list-style: none;
}

input.task-list-item-checkbox {
    margin: 0 0.35em 0.25em -1.6em;
    vertical-align: middle;
}

.issue a.respec-gh-label {
  padding: 5px;
  margin: 0 2px 0 2px;
  font-size: 10px;
  text-transform: none;
  text-decoration: none;
  font-weight: bold;
  border-radius: 4px;
  position: relative;
  bottom: 2px;
  border: none;
}

.issue a.respec-label-dark {
  color: #fff;
  background-color: #000;
}

.issue a.respec-label-light {
  color: #000;
  background-color: #fff;
}
</style><script src="//localhost:35729/livereload.js?snipver=1" async="" defer=""></script>



    
    <title>Open Booking API 1.0</title>

    

    

    <style id="respec-mainstyle">/*****************************************************************
 * ReSpec 3 CSS
 * Robin Berjon - http://berjon.com/
 *****************************************************************/

/* Override code highlighter background */
.hljs {
  background: transparent !important;
}

/* --- INLINES --- */
h1 abbr,
h2 abbr,
h3 abbr,
h4 abbr,
h5 abbr,
h6 abbr,
a abbr {
  border: none;
}

dfn {
  font-weight: bold;
}

a.internalDFN {
  color: inherit;
  border-bottom: 1px solid #99c;
  text-decoration: none;
}

a.externalDFN {
  color: inherit;
  border-bottom: 1px dotted #ccc;
  text-decoration: none;
}

a.bibref {
  text-decoration: none;
}

#references :target {
  background: #eaf3ff;
}

cite .bibref {
  font-style: normal;
}

code {
  color: #c83500;
}

th code {
  color: inherit;
}

/* --- TOC --- */

.toc a,
.tof a {
  text-decoration: none;
}

a .secno,
a .figno {
  color: #000;
}

ul.tof,
ol.tof {
  list-style: none outside none;
}

.caption {
  margin-top: 0.5em;
  font-style: italic;
}

/* --- TABLE --- */

table.simple {
  border-spacing: 0;
  border-collapse: collapse;
  border-bottom: 3px solid #005a9c;
}

.simple th {
  background: #005a9c;
  color: #fff;
  padding: 3px 5px;
  text-align: left;
}

.simple th[scope="row"] {
  background: inherit;
  color: inherit;
  border-top: 1px solid #ddd;
}

.simple td {
  padding: 3px 10px;
  border-top: 1px solid #ddd;
}

.simple tr:nth-child(even) {
  background: #f0f6ff;
}

/* --- DL --- */

.section dd>p:first-child {
  margin-top: 0;
}

.section dd>p:last-child {
  margin-bottom: 0;
}

.section dd {
  margin-bottom: 1em;
}

.section dl.attrs dd,
.section dl.eldef dd {
  margin-bottom: 0;
}

#issue-summary>ul,
.respec-dfn-list {
  column-count: 2;
}

#issue-summary li,
.respec-dfn-list li {
  list-style: none;
}

details.respec-tests-details {
  margin-left: 1em;
  display: inline-block;
  vertical-align: top;
}

details.respec-tests-details>* {
  padding-right: 2em;
}

details.respec-tests-details[open] {
  z-index: 999999;
  position: absolute;
  border: thin solid #cad3e2;
  border-radius: 0.3em;
  background-color: white;
  padding-bottom: 0.5em;
}

details.respec-tests-details[open]>summary {
  border-bottom: thin solid #cad3e2;
  padding-left: 1em;
  margin-bottom: 1em;
  line-height: 2em;
}

details.respec-tests-details>ul {
  width: 100%;
  margin-top: -0.3em;
}

details.respec-tests-details>li {
  padding-left: 1em;
}

a[href].self-link:hover {
  opacity: 1;
  text-decoration: none;
  background-color: transparent;
}

h2,
h3,
h4,
h5,
h6 {
  position: relative;
}

aside.example .marker > a.self-link {
  color: inherit;
}

h2>a.self-link,
h3>a.self-link,
h4>a.self-link,
h5>a.self-link,
h6>a.self-link {
  border: none;
  color: inherit;
  font-size: 83%;
  height: 2em;
  left: -1.6em;
  opacity: .5;
  position: absolute;
  text-align: center;
  text-decoration: none;
  top: 0;
  transition: opacity .2s;
  width: 2em;
}

h2>a.self-link::before,
h3>a.self-link::before,
h4>a.self-link::before,
h5>a.self-link::before,
h6>a.self-link::before {
  content: "§";
  display: block;
}

@media (max-width: 767px) {
  dd {
    margin-left: 0;
  }

  /* Don't position self-link in headings off-screen */
  h2>a.self-link,
  h3>a.self-link,
  h4>a.self-link,
  h5>a.self-link,
  h6>a.self-link {
    left: auto;
    top: auto;
  }
}

@media print {
  .removeOnSave {
    display: none;
  }
}
</style><style>/*

github.com style (c) Vasily Polovnyov <vast@whiteants.net>

*/

.hljs {
  display: block;
  overflow-x: auto;
  padding: 0.5em;
  color: #333;
  background: #f8f8f8;
}

.hljs-comment,
.hljs-quote {
  color: #998;
  font-style: italic;
}

.hljs-keyword,
.hljs-selector-tag,
.hljs-subst {
  color: #333;
  font-weight: bold;
}

.hljs-number,
.hljs-literal,
.hljs-variable,
.hljs-template-variable,
.hljs-tag .hljs-attr {
  color: #008080;
}

.hljs-string,
.hljs-doctag {
  color: #d14;
}

.hljs-title,
.hljs-section,
.hljs-selector-id {
  color: #900;
  font-weight: bold;
}

.hljs-subst {
  font-weight: normal;
}

.hljs-type,
.hljs-class .hljs-title {
  color: #458;
  font-weight: bold;
}

.hljs-tag,
.hljs-name,
.hljs-attribute {
  color: #000080;
  font-weight: normal;
}

.hljs-regexp,
.hljs-link {
  color: #009926;
}

.hljs-symbol,
.hljs-bullet {
  color: #990073;
}

.hljs-built_in,
.hljs-builtin-name {
  color: #0086b3;
}

.hljs-meta {
  color: #999;
  font-weight: bold;
}

.hljs-deletion {
  background: #fdd;
}

.hljs-addition {
  background: #dfd;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}
</style>

    <style>
        table {
            border-collapse: collapse;
            border: 1px solid #bec9d9
        }

        td,
        th {
            padding: 3px 0.5em;
            border-left: 1px solid black;
            border-right: 1px solid black;
            border-bottom: 1px solid #E2EDFE;
        }

        tr th[colspan] {
            color: #005A9C;
            background-color: #FEEDE2;
            text-align: center
        }

        th {
            color: #005A9C;
            background-color: #E2EDFE;
            font-weight: normal;
            border-bottom: 1px solid #BEC9D9;
        }

        tbody tr th {
            text-align: left;
        }

        td.nb {
            font-size: smaller;
        }

        .rec,
        .pr {
            color: #005A9C;
            background-color: #99EE99
        }

        .ext {
            background-color: #FFFFFF
        }

        .cr,
        .lcwd {
            color: #005A9C;
            background-color: #EEEE99
        }

        .wd {
            color: #005A9C;
            background-color: #EE9999
        }

        .ed,
        .fpwd {
            color: #005A9C;
            background-color: #FF7777
        }

        code {
            white-space: pre;
        }

        html {
            background-image: none !important;
        }

        body {
            background: white top left fixed no-repeat !important;
            background-size: 25px auto !important;
            background-image:
                url('https://www.openactive.io/assets/openactive-label-specification.png') !important;
        }

        h1 {
            font-family: 'Open Sans', sans-serif !important;
            font-weight: 300 !important;
            color: #69b9ff !important;
            font-size: 220%;
        }

        #toc {
            padding-top: 0px !important;
        }

        .remove {
            background-colour: yellow;
        }

        code {
            color: #C83500;
        }

        em.rfc2119 {
          text-transform:     lowercase;
          font-variant:       small-caps;
          font-style:         normal;
          color:              #900;
        }
    </style>

<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/cg-draft"><link rel="canonical" href="https://www.w3.org/TR/open-booking-api/"><script id="initialUserConfig" type="application/json">{
  "specStatus": "CG-DRAFT",
  "shortName": "open-booking-api",
  "edDraftURI": "https://openactive.io/open-booking-api/EditorsDraft/",
  "copyrightStart": 2018,
  "editors": [
    {
      "name": "Leigh Dodds",
      "url": "https://ldodds.com",
      "company": "Open Data Institute",
      "companyURL": "https://theodi.org",
      "w3cid": 55359
    },
    {
      "name": "Nick Evans",
      "url": "https://nickevans.me/",
      "company": "Open Data Institute",
      "companyURL": "https://theodi.org"
    },
    {
      "name": "Chris Thorpe",
      "url": "https://github.com/drchristhorpe"
    }
  ],
  "otherLinks": [
    {
      "key": "Participate",
      "data": [
        {
          "value": "GitHub openactive/open-booking-api",
          "href": {}
        },
        {
          "value": "File a bug",
          "href": "https://github.com/openactive/open-booking-api/issues/"
        },
        {
          "value": "Commit history",
          "href": "https://github.com/openactive/open-booking-api/commits/gh-pages"
        },
        {
          "value": "Pull requests",
          "href": "https://github.com/openactive/open-booking-api/pulls/"
        }
      ]
    },
    {
      "key": "Version",
      "value": "1.0",
      "href": "https://github.com/openactive/open-booking-api/issues/"
    }
  ],
  "logos": [
    {
      "src": "https://www.openactive.io/assets/openactive-logo-large.png",
      "href": "https://openactive.io",
      "alt": "openactive.io",
      "width": 255,
      "height": 43,
      "id": "logo"
    }
  ],
  "wg": "OpenActive Community Group",
  "wgURI": "https://www.w3.org/community/openactive/",
  "wgPublicList": "public-openactive",
  "maxTocLevel": 4,
  "preProcess": [],
  "noRecTrack": true,
  "github": "https://github.com/openactive/open-booking-api/",
  "format": "markdown",
  "localBiblio": {
    "JSON-LD": {
      "href": "https://www.w3.org/TR/json-ld/",
      "title": "JSON-LD 1.0",
      "status": "REC",
      "publisher": "W3C",
      "id": "json-ld"
    },
    "SCHEMA-ORG": {
      "href": "https://schema.org/",
      "title": "Schema.org"
    },
    "Modelling-Opportunity-Data": {
      "href": "https://openactive.io/modelling-opportunity-data/",
      "title": "Modelling Opportunity Data",
      "publisher": "OpenActive Community Group",
      "id": "modelling-opportunity-data"
    },
    "RPDE": {
      "href": "https://openactive.io/realtime-paged-data-exchange/",
      "title": "Realtime Paged Data Exchange",
      "publisher": "OpenActive Community Group",
      "id": "rpde"
    },
    "OpenActive-Vocabulary": {
      "href": "https://openactive.io/ns/",
      "title": "OpenActive Vocabulary",
      "publisher": "OpenActive Community Group",
      "id": "openactive-vocabulary"
    },
    "OAuth2": {
      "href": "https://oauth.net/2/",
      "title": "OAuth 2.0",
      "id": "oauth2"
    },
    "OpenIdConnect": {
      "href": "https://openid.net/connect/",
      "title": "OpenID Connect",
      "id": "openidconnect"
    }
  },
  "publishISODate": "2019-02-25T00:00:00.000Z",
  "generatedSubtitle": "Draft Community Group Report 25 February 2019"
}</script><meta name="description" content="This document specifies an HTTP API for placing bookings to participate in
physical activities, either by attending events or through the use of leisure
or sports facilities."></head>

<body class="h-entry"><div class="head">
      <a href="" class="logo"><img id="logo" alt="openactive.io" width="255" height="43" src="https://www.openactive.io/assets/openactive-logo-large.png"></a>
      <h1 class="title p-name" id="title">Open Booking API 1.0</h1>
      
      <h2>
        Draft Community Group Report
        <time class="dt-published" datetime="2019-02-25">25 February 2019</time>
      </h2>
      <dl>
        
        
        <dt>Latest editor's draft:</dt><dd><a href="https://openactive.io/open-booking-api/EditorsDraft/">https://openactive.io/open-booking-api/EditorsDraft/</a></dd>
        
        
        
        
        
        <dt>Editors:</dt>
        <dd class="p-author h-card vcard" data-editor-id="55359"><a class="u-url url p-name fn" href="https://ldodds.com">Leigh Dodds</a>
            (<a class="p-org org h-org h-card" href="https://theodi.org">Open Data Institute</a>)
          </dd><dd class="p-author h-card vcard"><a class="u-url url p-name fn" href="https://nickevans.me/">Nick Evans</a>
            (<a class="p-org org h-org h-card" href="https://theodi.org">Open Data Institute</a>)
          </dd><dd class="p-author h-card vcard"><a class="u-url url p-name fn" href="https://github.com/drchristhorpe">Chris Thorpe</a></dd>
        
        
        <dt>Participate:</dt><dd>
      <a href="https://github.com/openactive/open-booking-api/">GitHub openactive/open-booking-api</a>
    </dd><dd>
      <a href="https://github.com/openactive/open-booking-api/issues/">File a bug</a>
    </dd><dd>
      <a href="https://github.com/openactive/open-booking-api/commits/gh-pages">Commit history</a>
    </dd><dd>
      <a href="https://github.com/openactive/open-booking-api/pulls/">Pull requests</a>
    </dd><dt>Version:</dt><dd>
      <a href="https://github.com/openactive/open-booking-api/issues/">1.0</a>
    </dd>
      </dl>
      
      <p class="copyright">
        <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
        ©
        2018-2019
        
        the Contributors to the Open Booking API 1.0 Specification, published by the
        <a href="https://www.w3.org/community/openactive/">OpenActive Community Group</a> under the
        <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>. A human-readable
              <a href="https://www.w3.org/community/about/agreements/cla-deed/">summary</a>
              is available.
            
      </p>
      <hr title="Separator for header">
    </div><style>
body {
    background-size: 25px auto !important;
}

body.toc-sidebar #toc {
    background-size: 25px auto !important;
    background-attachment: fixed !important;
}
</style><section id="abstract" class="introductory"><h2>Abstract</h2><p>This document specifies an HTTP API for placing bookings to participate in
physical activities, either by attending events or through the use of leisure
or sports facilities.</p></section><section id="sotd" class="introductory"><h2>Status of This Document</h2><p>
      This specification was published by the
      <a href="https://www.w3.org/community/openactive/">OpenActive Community Group</a>. It is not a W3C Standard nor is it
      on the W3C Standards Track.
      
            Please note that under the
            <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>
            there is a limited opt-out and other conditions apply.
          
      Learn more about
      <a href="https://www.w3.org/community/">W3C Community and Business Groups</a>.
    </p><p>Contributions to this document are not only welcomed but are actively solicited
and should be made via
<a href="https://github.com/openactive/open-booking-api/issues">GitHub Issues</a> and
pull requests. The source code is available
on <a href="https://github.com/openactive/open-booking-api">GitHub</a>.</p><div class="note" role="note" id="issue-container-generatedID"><div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>Note</span></div><div class=""><p>This document represents a complete Editors Draft. It is currently in the final stages of community review and we hope that it is nearing stability. The draft is intended to allow developers to provide feedback by developing proof-of-concept implementations. We encourage developers to explore this API and
contribute to the development of the specification.</p>
</div></div><p>
            If you wish to make comments regarding this document, please send
            them to
            <a href="mailto:public-openactive@w3.org">public-openactive@w3.org</a>
            (<a href="mailto:public-openactive-request@w3.org?subject=subscribe">subscribe</a>,
            <a href="https://lists.w3.org/Archives/Public/public-openactive/">archives</a>).
          </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#introduction"><span class="secno">1. </span>Introduction</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#scope-and-requirements"><span class="secno">1.1 </span>Scope and requirements</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#functionality-that-is-out-of-scope"><span class="secno">1.1.1 </span>Functionality that is out of scope</a></li></ol></li><li class="tocline"><a class="tocxref" href="#audience"><span class="secno">1.2 </span>Audience</a></li></ol></li><li class="tocline"><a class="tocxref" href="#conformance"><span class="secno">2. </span>Conformance</a></li><li class="tocline"><a class="tocxref" href="#typographical-conventions"><span class="secno">3. </span>Typographical Conventions</a></li><li class="tocline"><a class="tocxref" href="#key-actors"><span class="secno">4. </span>Key Actors</a></li><li class="tocline"><a class="tocxref" href="#booking-flow"><span class="secno">5. </span>Booking Flow</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#user-journey"><span class="secno">5.1 </span>User Journey</a></li><li class="tocline"><a class="tocxref" href="#high-level-summary-of-the-api"><span class="secno">5.2 </span>High-level summary of the API</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#broker-contract-with-booking-system"><span class="secno">5.2.1 </span>Broker contract with Booking System</a></li><li class="tocline"><a class="tocxref" href="#booking-system-contract-with-the-broker"><span class="secno">5.2.2 </span>Booking System contract with the Broker</a></li><li class="tocline"><a class="tocxref" href="#leasing"><span class="secno">5.2.3 </span>Leasing</a></li></ol></li><li class="tocline"><a class="tocxref" href="#step-by-step-process-description"><span class="secno">5.3 </span>Step-by-step process description</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#single-state-orders"><span class="secno">5.3.1 </span>Single state Orders</a></li><li class="tocline"><a class="tocxref" href="#payment-capture-rollback"><span class="secno">5.3.2 </span>Payment Capture Rollback</a></li><li class="tocline"><a class="tocxref" href="#order-feed-inconsistencies"><span class="secno">5.3.3 </span>Order Feed Inconsistencies</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#broker-roles"><span class="secno">6. </span>Broker Roles</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#resellerbroker"><span class="secno">6.1 </span><code>ResellerBroker</code></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition"><span class="secno">6.1.1 </span>Definition</a></li><li class="tocline"><a class="tocxref" href="#contractual-relationships"><span class="secno">6.1.2 </span>Contractual Relationships</a></li><li class="tocline"><a class="tocxref" href="#taxation"><span class="secno">6.1.3 </span>Taxation</a></li><li class="tocline"><a class="tocxref" href="#scope-of-specification"><span class="secno">6.1.4 </span>Scope of Specification</a></li><li class="tocline"><a class="tocxref" href="#conformance-criteria"><span class="secno">6.1.5 </span>Conformance criteria</a></li></ol></li><li class="tocline"><a class="tocxref" href="#agentbroker"><span class="secno">6.2 </span><code>AgentBroker</code></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition-0"><span class="secno">6.2.1 </span>Definition</a></li><li class="tocline"><a class="tocxref" href="#contractual-relationships-0"><span class="secno">6.2.2 </span>Contractual Relationships</a></li><li class="tocline"><a class="tocxref" href="#taxation-0"><span class="secno">6.2.3 </span>Taxation</a></li><li class="tocline"><a class="tocxref" href="#scope-of-specification-0"><span class="secno">6.2.4 </span>Scope of Specification</a></li><li class="tocline"><a class="tocxref" href="#conformance-criteria-0"><span class="secno">6.2.5 </span>Conformance criteria</a></li><li class="tocline"><a class="tocxref" href="#informed-purchase"><span class="secno">6.2.6 </span>Informed purchase</a></li></ol></li><li class="tocline"><a class="tocxref" href="#nobroker"><span class="secno">6.3 </span><code>NoBroker</code></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition-1"><span class="secno">6.3.1 </span>Definition</a></li><li class="tocline"><a class="tocxref" href="#contractual-relationships-1"><span class="secno">6.3.2 </span>Contractual Relationships</a></li><li class="tocline"><a class="tocxref" href="#taxation-1"><span class="secno">6.3.3 </span>Taxation</a></li><li class="tocline"><a class="tocxref" href="#scope-of-specification-1"><span class="secno">6.3.4 </span>Scope of Specification</a></li><li class="tocline"><a class="tocxref" href="#conformance-criteria-1"><span class="secno">6.3.5 </span>Conformance criteria</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#systems-of-record"><span class="secno">7. </span>Systems of Record</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#roles-and-responsibilities-overview"><span class="secno">7.1 </span>Roles and responsibilities overview</a></li><li class="tocline"><a class="tocxref" href="#invoices-and-tax-receipts"><span class="secno">7.2 </span>Invoices and Tax receipts</a></li><li class="tocline"><a class="tocxref" href="#payments-and-refunds"><span class="secno">7.3 </span>Payments and Refunds</a></li><li class="tocline"><a class="tocxref" href="#tax-calculation"><span class="secno">7.4 </span>Tax calculation</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#business-to-consumer-tax-calculation-by-booking-system-is-mandatory"><span class="secno">7.4.1 </span>Business-to-consumer tax calculation by Booking System is mandatory</a></li><li class="tocline"><a class="tocxref" href="#business-to-business-tax-calculation-by-booking-system-is-optional"><span class="secno">7.4.2 </span>Business-to-business tax calculation by Booking System is optional</a></li></ol></li><li class="tocline"><a class="tocxref" href="#tax-mode"><span class="secno">7.5 </span>Tax mode</a></li><li class="tocline"><a class="tocxref" href="#free-opportunities"><span class="secno">7.6 </span>Free opportunities</a></li><li class="tocline"><a class="tocxref" href="#offer-overrides"><span class="secno">7.7 </span>Offer overrides</a></li></ol></li><li class="tocline"><a class="tocxref" href="#order-operations"><span class="secno">8. </span>Order Operations</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#opportunity-selection"><span class="secno">8.1 </span>Opportunity Selection</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition-of-an-open-booking-bookable-opportunity"><span class="secno">8.1.1 </span>Definition of an Open Booking 'bookable' opportunity</a></li><li class="tocline"><a class="tocxref" href="#applicable-offers"><span class="secno">8.1.2 </span>Applicable <code>Offer</code>s</a></li></ol></li><li class="tocline"><a class="tocxref" href="#amending-the-orderquote-before-b"><span class="secno">8.2 </span>Amending the OrderQuote before <strong>B</strong></a></li><li class="tocline"><a class="tocxref" href="#cancellation-after-b"><span class="secno">8.3 </span>Cancellation after <strong>B</strong></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#customer-requested-cancellation"><span class="secno">8.3.1 </span>Customer requested cancellation</a></li><li class="tocline"><a class="tocxref" href="#seller-requested-cancellation"><span class="secno">8.3.2 </span>Seller requested cancellation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#notifications-updates-and-refunds"><span class="secno">8.4 </span>Notifications, updates and refunds</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#booking-system-updating-the-orders-feed"><span class="secno">8.4.1 </span>Booking System: Updating the Orders feed</a></li><li class="tocline"><a class="tocxref" href="#broker-processing-the-orders-feed"><span class="secno">8.4.2 </span>Broker: Processing the Orders feed</a></li><li class="tocline"><a class="tocxref" href="#new-orders"><span class="secno">8.4.3 </span>New <code>Order</code>s</a></li><li class="tocline"><a class="tocxref" href="#cancellation-refund-calculation-and-notification"><span class="secno">8.4.4 </span>Cancellation, refund calculation and notification</a></li><li class="tocline"><a class="tocxref" href="#change-of-logistics-notifications"><span class="secno">8.4.5 </span>Change of logistics notifications</a></li></ol></li><li class="tocline"><a class="tocxref" href="#amending-the-order-after-b"><span class="secno">8.5 </span>Amending the Order after <strong>B</strong></a></li><li class="tocline"><a class="tocxref" href="#delivery-of-terms-and-conditions-and-privacy-policy"><span class="secno">8.6 </span>Delivery of Terms and Conditions and Privacy Policy</a></li><li class="tocline"><a class="tocxref" href="#extension-point-for-including-payments"><span class="secno">8.7 </span>Extension point for including payments</a></li><li class="tocline"><a class="tocxref" href="#extension-point-for-access-control"><span class="secno">8.8 </span>Extension point for access control</a></li></ol></li><li class="tocline"><a class="tocxref" href="#endpoints"><span class="secno">9. </span>Endpoints</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#paths-and-verbs"><span class="secno">9.1 </span>Paths and Verbs</a></li><li class="tocline"><a class="tocxref" href="#request-and-response"><span class="secno">9.2 </span>Request and Response</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#order-creation"><span class="secno">9.2.1 </span>Order Creation</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#orderquote"><span class="secno">9.2.1.1 </span><code>OrderQuote</code></a></li><li class="tocline"><a class="tocxref" href="#order"><span class="secno">9.2.1.2 </span><code>Order</code></a></li></ol></li><li class="tocline"><a class="tocxref" href="#order-deletion"><span class="secno">9.2.2 </span>Order Deletion</a></li><li class="tocline"><a class="tocxref" href="#orders-rpde-feed"><span class="secno">9.2.3 </span>Orders RPDE Feed</a></li><li class="tocline"><a class="tocxref" href="#orderitem-cancellation"><span class="secno">9.2.4 </span>OrderItem Cancellation</a></li><li class="tocline"><a class="tocxref" href="#order-status"><span class="secno">9.2.5 </span>Order Status</a></li><li class="tocline"><a class="tocxref" href="#url-discovery"><span class="secno">9.2.6 </span>URL discovery</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#example"><span class="secno">9.2.6.1 </span>Example</a></li></ol></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#model"><span class="secno">10. </span>Model</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#order-model"><span class="secno">10.1 </span>Order Model</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#schema-order"><span class="secno">10.1.1 </span><code>schema:Order</code></a></li><li class="tocline"><a class="tocxref" href="#oa-orderquote"><span class="secno">10.1.2 </span><code>oa:OrderQuote</code></a></li><li class="tocline"><a class="tocxref" href="#schema-organization-for-seller"><span class="secno">10.1.3 </span><code>schema:Organization</code> for <code>seller</code></a></li><li class="tocline"><a class="tocxref" href="#schema-organization-for-broker"><span class="secno">10.1.4 </span><code>schema:Organization</code> for <code>broker</code></a></li><li class="tocline"><a class="tocxref" href="#schema-orderitem"><span class="secno">10.1.5 </span><code>schema:OrderItem</code></a></li><li class="tocline"><a class="tocxref" href="#schema-offer"><span class="secno">10.1.6 </span><code>schema:Offer</code></a></li><li class="tocline"><a class="tocxref" href="#schema-person"><span class="secno">10.1.7 </span><code>schema:Person</code></a></li><li class="tocline"><a class="tocxref" href="#schema-organization-for-customer"><span class="secno">10.1.8 </span><code>schema:Organization</code> for <code>customer</code></a></li><li class="tocline"><a class="tocxref" href="#schema-postaladdress"><span class="secno">10.1.9 </span><code>schema:PostalAddress</code></a></li><li class="tocline"><a class="tocxref" href="#oa-lease"><span class="secno">10.1.10 </span><code>oa:Lease</code></a></li><li class="tocline"><a class="tocxref" href="#schema-pricespecification"><span class="secno">10.1.11 </span><code>schema:PriceSpecification</code></a></li><li class="tocline"><a class="tocxref" href="#oa-taxchargespecification"><span class="secno">10.1.12 </span><code>oa:TaxChargeSpecification</code></a></li><li class="tocline"><a class="tocxref" href="#oa-payment"><span class="secno">10.1.13 </span><code>oa:Payment</code></a></li><li class="tocline"><a class="tocxref" href="#oa-bookingservice"><span class="secno">10.1.14 </span><code>oa:BookingService</code></a></li><li class="tocline"><a class="tocxref" href="#oa-terms"><span class="secno">10.1.15 </span><code>oa:Terms</code></a></li></ol></li><li class="tocline"><a class="tocxref" href="#discovery-model"><span class="secno">10.2 </span>Discovery Model</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#oa-openbookingaction"><span class="secno">10.2.1 </span><code>oa:OpenBookingAction</code></a></li><li class="tocline"><a class="tocxref" href="#schema-entrypoint"><span class="secno">10.2.2 </span><code>schema:EntryPoint</code></a></li><li class="tocline"><a class="tocxref" href="#schema-datafeed-for-supportingdata"><span class="secno">10.2.3 </span><code>schema:DataFeed</code> for <code>supportingData</code></a></li><li class="tocline"><a class="tocxref" href="#schema-datadownload"><span class="secno">10.2.4 </span><code>schema:DataDownload</code></a></li></ol></li><li class="tocline"><a class="tocxref" href="#error-model"><span class="secno">10.3 </span>Error Model</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#oa-error"><span class="secno">10.3.1 </span><code>oa:Error</code></a></li><li class="tocline"><a class="tocxref" href="#oa-openbookingerror"><span class="secno">10.3.2 </span><code>oa:OpenBookingError</code></a></li><li class="tocline"><a class="tocxref" href="#oa-openbookingerror-subclasses"><span class="secno">10.3.3 </span><code>oa:OpenBookingError</code> subclasses</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#order-creation-orderquote-and-order-error-responses"><span class="secno">10.3.3.1 </span>Order Creation - <code>OrderQuote</code> and <code>Order</code> error responses</a></li><li class="tocline"><a class="tocxref" href="#order-creation-orderitem-errors"><span class="secno">10.3.3.2 </span>Order Creation - <code>OrderItem</code> errors</a></li><li class="tocline"><a class="tocxref" href="#api-authentication"><span class="secno">10.3.3.3 </span>API authentication</a></li><li class="tocline"><a class="tocxref" href="#technical-errors"><span class="secno">10.3.3.4 </span>Technical errors</a></li><li class="tocline"><a class="tocxref" href="#generic-errors"><span class="secno">10.3.3.5 </span>Generic errors</a></li></ol></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#common-requirements"><span class="secno">11. </span>Common Requirements</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#media-types"><span class="secno">11.1 </span>Media types</a></li><li class="tocline"><a class="tocxref" href="#response-formats"><span class="secno">11.2 </span>Response formats</a></li><li class="tocline"><a class="tocxref" href="#errors"><span class="secno">11.3 </span>Errors</a></li><li class="tocline"><a class="tocxref" href="#security"><span class="secno">11.4 </span>Security</a></li><li class="tocline"><a class="tocxref" href="#authentication"><span class="secno">11.5 </span>Authentication</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#api-level-authentication-and-data-security"><span class="secno">11.5.1 </span>API level authentication and data security</a></li><li class="tocline"><a class="tocxref" href="#customer-level-authentication"><span class="secno">11.5.2 </span>Customer level authentication</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#future-versions-of-this-api"><span class="secno">12. </span>Future versions of this API</a></li><li class="tocline"><a class="tocxref" href="#acknowledgements"><span class="secno">A. </span>Acknowledgements</a></li><li class="tocline"><a class="tocxref" href="#references"><span class="secno">B. </span>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><span class="secno">B.1 </span>Normative references</a></li></ol></li></ol></nav><section class="informative" id="introduction"><!--OddPage--><h2 id="x1-introduction"><span class="secno">1. </span>Introduction<a class="self-link" aria-label="§" href="#introduction"></a></h2><p><em>This section is non-normative.</em></p><p>The document is an output of the
<a href="https://www.w3.org/community/openactive/">OpenActive Community Group</a>. As part
of the <a href="https://openactive.io">OpenActive</a> initiative, the community group is
developing standards that will promote the publication and use of open
<a href="https://openactive.io/modelling-opportunity-data/#categories-of-physical-activity-data">opportunity data</a>
in helping people to become more physically active.</p><p>The Community Group have already published specifications that define standard
data models ([<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>]) and support the publication and
harvesting of data in standard formats ([<cite><a class="bibref" href="#bib-rpde">RPDE</a></cite>]).</p><p>This existing work helps increase the discovery of opportunities for people to
be active. This specification builds on that work by defining an HTTP API that
can be implemented by <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> that are publishing opportunity data. By
allowing third-party applications to place bookings in their systems, it becomes
possible for more people to participate in events or make use of leisure and
sporting facilities.</p><p>The specification defines the flow of HTTP requests and responses between the
booking system (server) and the third-party application (client). This includes
definitions of the overall application flow, detailed request and response
formats and the potential error conditions that applications may encounter.</p><section id="scope-and-requirements"><h3 id="x1-1-scope-and-requirements"><span class="secno">1.1 </span>Scope and requirements<a class="self-link" aria-label="§" href="#scope-and-requirements"></a></h3><p>The current scope of the specification should conform to a set of
<a href="https://docs.google.com/document/d/1fsCr071V12i_2g0DK818OAGlEAJFLWwkBp9bpgx4fo8/edit?usp=sharing">use cases and requirements</a>
that have previously been identified and discussed with the OpenActive
community.</p><p>The focus of the initial versions of this specification will be on the simplest
use cases that will support making bookings on behalf of users. This core
functionality includes:</p><ul>
<li><strong>Pricing and availability</strong> – checking the price and current availabilty of
an event or for the use of a facility</li>
<li><strong>Leasing</strong> – temporarily reserving spaces for a user to attend an event or
make use of a facility, whilst placing a booking</li>
<li><strong>Booking</strong> – placing and viewing bookings, and where necessary, confirming
receipt of payment from users</li>
<li><strong>Multiple order items</strong> - handling bookings for multiple events ("shopping carts") and for groups of users</li>
<li><strong>Child booking</strong> - booking on behalf of a child</li>
</ul><p>A number of additional requirements that relate to the booking of events and
facilities are currently out of scope:</p><ul>
<li>creating and managing accounts for users</li>
<li>more complex pricing options, e.g. membership based pricing</li>
<li>waiting lists for events</li>
</ul><p>It is possible that future versions of this specification may include support
for these or other features. Revisions will be driven by the needs of the
community.</p><section id="functionality-that-is-out-of-scope"><h4 id="x1-1-1-functionality-that-is-out-of-scope"><span class="secno">1.1.1 </span>Functionality that is out of scope<a class="self-link" aria-label="§" href="#functionality-that-is-out-of-scope"></a></h4><p>By design this specification will not define some types of functionality.</p><p>These have been declared as permanently out of scope because they are either
adequately covered by existing specifications, or will be covered by future
work of the OpenActive Community Group.</p><p>The functionality that is currently defined as out of scope includes:</p><ul>
<li><strong>API authentication and security</strong> – while the specification recommends some
best practices relating to authentication and security it does not mandate a
specific means of securing an API. Implementers are free to choose the system
that offers the best security for their platform and users</li>
<li><strong>Payment processing</strong> – the design assumes that all payment handling will
be carried out by the third-party application, in a separate payment flow.
Booking systems and application developers are able to use the payment and
reconciliation mechanisms that provide the best options for their customers</li>
<li><strong>API business models</strong> – the design is agnostic to any business models that
might govern the use of the API, e.g. revenue-sharing or transaction processing
fees</li>
<li><strong>Discovery</strong>  – finding, filtering and searching for opportunity data. This
specification assumes that the client and server applications have already
shared data about the relevant opportunities. Additional functionality in this
area will be addressed by future specifications from the Community Group</li>
</ul></section></section><section id="audience"><h3 id="x1-2-audience"><span class="secno">1.2 </span>Audience<a class="self-link" aria-label="§" href="#audience"></a></h3><p>The document is primarily intended for the following audiences:</p><ul>
<li>Software developers who want to implement the API, e.g. as part of a booking
system</li>
<li>Software developers building client libraries or applications that will use
the API</li>
</ul><p>The following sections introduce terminology, concepts and requirements that
underpin the design of the API. This content might also be useful for a wider
audience, e.g. business analysts or product managers looking for a high-level
overview of the API functionality.</p></section></section><section id="conformance"><!--OddPage--><h2 id="x2-conformance"><span class="secno">2. </span>Conformance<a class="self-link" aria-label="§" href="#conformance"></a></h2><p>
      As well as sections marked as non-normative, all authoring guidelines,
      diagrams, examples, and notes in this specification are non-normative.
      Everything else in this specification is normative.
    </p><p>
            The key words <em class="rfc2119">MAY</em>, <em class="rfc2119">MUST</em>, <em class="rfc2119">MUST NOT</em>, <em class="rfc2119">NOT REQUIRED</em>, <em class="rfc2119">OPTIONAL</em>, <em class="rfc2119">RECOMMENDED</em>, <em class="rfc2119">REQUIRED</em>, <em class="rfc2119">SHOULD</em>, and <em class="rfc2119">SHOULD NOT</em>
            are to be interpreted as described in
            [<cite><a class="bibref" href="#bib-rfc2119">RFC2119</a></cite>].
          </p><p>This specification makes use of the compact IRI Syntax; please refer to the
<a href="https://www.w3.org/TR/json-ld/#compact-iris">Compact IRIs</a> from [<cite><a class="bibref" href="#bib-json-ld">JSON-LD</a></cite>].</p></section><section id="typographical-conventions"><!--OddPage--><h2 id="x3-typographical-conventions"><span class="secno">3. </span>Typographical Conventions<a class="self-link" aria-label="§" href="#typographical-conventions"></a></h2><p>The following typographic conventions are used in this specification:</p><dl class="typography">
<dt><code>markup</code></dt>
<dd>Markup (elements, attributes, properties), machine processable
values (string, characters, media types), property name, or a
file name is in a monospace font.</dd>
<dt><strong>definition</strong></dt>
<dd>A definition of a term, to be used elsewhere in this or other
specifications, is in bold and italics.</dd>
<dt><a href="">hyperlink</a></dt>
<dd>A hyperlink is underlined and in blue.</dd>
<dt>[<a href="">reference</a>]</dt>
<dd>A document reference (normative or informative) is enclosed in
square brackets and links to the references section.</dd>
</dl><div class="note" role="note" id="issue-container-generatedID-0"><div role="heading" class="note-title marker" id="h-note-0" aria-level="3"><span>Note</span></div><div class=""><p>Notes are in light green boxes with a green left border and with a "Note"
header in green. Notes are normative or informative depending on the whether
they are in a normative or informative section, respectively.</p>
</div></div><div class="example" id="example-1">
          <div class="marker">
      <a class="self-link" href="#example-1">Example 1</a>
    </div>
          <pre class="hljs javascript" aria-busy="false">Examples are <span class="hljs-keyword">in</span> light khaki boxes, <span class="hljs-keyword">with</span> khaki left border, and <span class="hljs-keyword">with</span> a
numbered <span class="hljs-string">"Example"</span> header <span class="hljs-keyword">in</span> khaki. Examples are always informative.
The content <span class="hljs-keyword">of</span> the example is <span class="hljs-keyword">in</span> monospace font and may be syntax colored.</pre>
        </div></section><section id="key-actors"><!--OddPage--><h2 id="x4-key-actors"><span class="secno">4. </span>Key Actors<a class="self-link" aria-label="§" href="#key-actors"></a></h2><p>Of all the organisations and systems involved in a transaction, the API defined
by this specification is scoped tightly to only specify interactions between the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and
<a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, with high level prompts for interactions with a <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>.</p><figure id="fig-illustration-of-actors-and-systems-involved-in-a-transaction-and-the-focus-of-this-specification-being-between-broker-and-booking-system"><img src="actors.png" alt="Actors in scope" height="314" width="696">
<figcaption>Figure <span class="figno">1</span> <span class="fig-title">Illustration of actors and systems involved in a transaction, and the focus
of this specification being between Broker and Booking System.</span></figcaption>
</figure><dl class="typography">
<dt><dfn data-dfn-type="dfn" data-plurals="customers" id="dfn-customer">Customer</dfn></dt>
<dd>The user who places a booking using an application provided by
a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</dd>
<dt><dfn data-dfn-type="dfn" data-plurals="brokers" id="dfn-broker">Broker</dfn></dt>
<dd>The organisation or developer providing an application that
allows <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a> to make bookings. Those applications will be
clients of the API defined in this specification</dd>
<dt><dfn data-dfn-type="dfn" data-plurals="booking systems" id="dfn-booking-system">Booking System</dfn></dt>
<dd>The organisation or developer providing an application that
maintains bookable inventory on behalf of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.
The platform or service that provides a server-side implementation
of this API.
</dd>
<dt><dfn data-dfn-type="dfn" data-plurals="sellers" id="dfn-seller">Seller</dfn></dt>
<dd>The organisation providing access to events or facilities
via a booking system. e.g. a leisure provider running yoga classes.</dd>
<dt><dfn data-dfn-type="dfn" id="dfn-payment-provider">Payment Provider</dfn></dt>
<dd>The organisation providing payment processing between the
<a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and
            <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</dd>
</dl></section><section class="normative" id="booking-flow"><!--OddPage--><h2 id="x5-booking-flow"><span class="secno">5. </span>Booking Flow<a class="self-link" aria-label="§" href="#booking-flow"></a></h2><section id="user-journey"><h3 id="x5-1-user-journey"><span class="secno">5.1 </span>User Journey<a class="self-link" aria-label="§" href="#user-journey"></a></h3><p>The booking journey of a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> is generalised into the following key steps:</p><ol>
<li><strong>Select</strong>: Customer selects an item</li>
<li><strong>Register / Login</strong>: Customer enters personal details</li>
<li><strong>Book and Pay</strong>: Customer enters payment details</li>
</ol><p>Note that some or all steps may not actually be visible to the user if details are already known (e.g. known registration or payment details, or booking via voice command).</p><figure id="fig-illustration-of-the-expected-user-journey"><img src="userjourney.png" alt="High level user journey" height="150" width="960">
<figcaption>Figure <span class="figno">2</span> <span class="fig-title">Illustration of the expected user journey.</span></figcaption>
</figure></section><section id="high-level-summary-of-the-api"><h3 id="x5-2-high-level-summary-of-the-api"><span class="secno">5.2 </span>High-level summary of the API<a class="self-link" aria-label="§" href="#high-level-summary-of-the-api"></a></h3><p>This specification assumes that the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> has already obtained opportunity data from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> that includes descriptions of <code>SessionSeries</code>, <code>FacilityUse</code>, <code>Slot</code> etc. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> present an up-to-date view of availability data (for example by frequently harvesting data via an opportunity data [<cite><a class="bibref" href="#bib-rpde">RPDE</a></cite>] open feed) for the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> to select items to book, as this data may change over time. The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> ensure that the <code>remainingAttendeeCapacity</code> and <code>remainingUses</code> properties in the opportunity data are up-to-date, and only include places already booked and <em>not</em> places currently reserved by leases.</p><ul>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> generates session <a href="https://en.wikipedia.org/wiki/Universally_unique_identifier">UUID</a> which it uses throughout the process.</p>
</li>
<li><p>After both "<strong>1. Select</strong>" and "<strong>2. Register / Login</strong>", the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> calls the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to confirm the price and availability of the selected items using an <code>OrderQuote</code>, and retrieve a total order price. These calls are illustrated as checkpoints <strong>C1</strong> and <strong>C2</strong> on the diagram below.</p>
</li>
<li><p>After "<strong>3. Book and Pay</strong>", the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> first <em>authorizes</em> the payment for the total order price (if required by the payment provider), then confirms the booking with <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> using an <code>Order</code> (<strong>B</strong> on the diagram below), and finally <em>captures</em> the payment.</p>
</li>
<li><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> adds an <code>Order</code> to an <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> specific to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, which the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> reads to update its internal state, generate Invoices, and deliver a notification to the Customer.</p>
</li>
</ul><figure id="fig-illustration-of-high-level-booking-flow"><img src="bookingflow.png" alt="High level booking flow" height="667" width="839">
<figcaption>Figure <span class="figno">3</span> <span class="fig-title">Illustration of high level booking flow.</span></figcaption>
</figure><section id="broker-contract-with-booking-system"><h4 id="x5-2-1-broker-contract-with-booking-system"><span class="secno">5.2.1 </span>Broker contract with Booking System<a class="self-link" aria-label="§" href="#broker-contract-with-booking-system"></a></h4><p>To complete a successful booking journey:</p><ul>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="SHOULD">SHOULD</em> call <strong>C1</strong> (without customer details)</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> call <strong>C2</strong> (with customer details), to retrieve the total order, with the exception of free orders where the order total is not required.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> call <strong>B</strong> (with payment details), and store the resulting <code>Order</code>.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> process all updates to the <code>Order</code> from the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a></li>
</ul><p>If <strong>B</strong> fails, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> cancel the payment without any consequence to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> or <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</p></section><section id="booking-system-contract-with-the-broker"><h4 id="x5-2-2-booking-system-contract-with-the-broker"><span class="secno">5.2.2 </span>Booking System contract with the Broker<a class="self-link" aria-label="§" href="#booking-system-contract-with-the-broker"></a></h4><ul>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond to <strong>C1</strong> (without customer details) with an <code>OrderQuote</code> that includes an indicative total order price, or a relevant error.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond to <strong>C2</strong> (with customer details) with an <code>OrderQuote</code> that includes an exact total order price, or a relevant error.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond to <strong>B</strong> with a completed <code>Order</code>, or a relevant error. The whole booking succeeds or fails as one.</li>
<li>Upon any cancellations or updates to the <code>Order</code> or any <code>OrderItem</code> within it, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> include the updated <code>Order</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>.</li>
</ul><p>With the exception of leasing, <strong>C1</strong> and <strong>C2</strong> <em class="rfc2119" title="MUST NOT">MUST NOT</em> have any side effects.</p></section><section id="leasing"><h4 id="x5-2-3-leasing"><span class="secno">5.2.3 </span>Leasing<a class="self-link" aria-label="§" href="#leasing"></a></h4><p>In order to ensure that items cannot be "stolen" from a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>'s shopping basket by another <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, the use of time-bound leases are <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em>, however they are not required to ensure a low barrier of entry for implementers of the specification.</p><p>Individually at <strong>C1</strong> and <strong>C2</strong>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> can opt to create (or extend) a lease for the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>. Whether they opt to do so may depend on the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>'s capability to support leases, or on the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>'s configuration of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>. At <strong>C1</strong> the lease is anonymous, at <strong>C2</strong> customer details are provided.</p><p>If a lease is created at <strong>C1</strong> and/or <strong>C2</strong> it is used during <strong>B</strong>, if not or if it had expired the booking completes anyway provided sufficient inventory is available.</p><p>The specification is designed to allow for leasing to be implemented at a later stage by a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> without affecting the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>'s implementation.</p><p>When a lease is created, a <code>Lease</code> object <em class="rfc2119" title="MUST">MUST</em> be returned in the <code>OrderQuote</code>.</p><div class="example" id="example-2-example-of-lease">
          <div class="marker">
      <a class="self-link" href="#example-2-example-of-lease">Example 2</a><span class="example-title">: Example of lease</span>
    </div>
          <pre class="hljs javascript" aria-busy="false"><span class="hljs-string">"lease"</span>: {
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"Lease"</span>,
  <span class="hljs-string">"leaseExpires"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>
}</pre>
        </div></section></section><section id="step-by-step-process-description"><h3 id="x5-3-step-by-step-process-description"><span class="secno">5.3 </span>Step-by-step process description<a class="self-link" aria-label="§" href="#step-by-step-process-description"></a></h3><figure id="fig-sequence-diagram-showing-api-interactions"><img src="sequencediagram.png" alt="Sequence diagram" height="720" width="766">
<figcaption>Figure <span class="figno">4</span> <span class="fig-title">Sequence diagram showing API interactions</span></figcaption>
</figure><p>i) "<strong>1. Select</strong>" - User browses broker site anonymously and adds something to basket</p><ul>
<li><a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> have determined at least one an Open Booking <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a> opportunity each with an associated <a href="#dfn-applicable-offers" class="internalDFN" data-link-type="dfn">Applicable <code>offer</code></a> from the user's browsing, using the most up-to-date opportunity data.</li>
<li><a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> generates session UUID.</li>
<li>If any catastrophic failure occurs during the booking flow, the UUID <em class="rfc2119" title="MUST">MUST</em> be regenerated to allow for a clean retry of the booking. UUID <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> be regenerated for expected errors.</li>
</ul><p>ii) <strong>C1</strong> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> call with <code>OrderQuote</code> including UUID without a <code>customer</code> object to check availability and that the combination of items requested can be purchased (call is idempotent), <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> responds with an <code>OrderQuote</code>.</p><ul>
<li><a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> creates anonymous lease for that UUID if it is supported, otherwise it provides a simple availability and <code>totalPaymentDue</code> confirmation. Response 200 indicates quote has been successfully produced (which implies all requested items are available). Response may include a <code>lease</code> to indicate a lease has also been created against the UUID.</li>
<li><code>OrderQuote</code> includes total pricing confirmation in response for basket to be updated, as well as enumerated <code>OrderItem</code>s with their respective details that can be rendered by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to ensure accuracy (rather than relying on syncing with the open feed).</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> ensure that the data returned to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> in the <code>remainingAttendeeCapacity</code> and <code>remainingUses</code> properties are up-to-date, and only include places already booked and <em>not</em> places currently reserved by leases from competing <code>OrderQuote</code>s.</li>
</ul><p>iii) "<strong>2. Register / Login</strong>" - User clicks checkout and enters personal details</p><ul>
<li>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> have indicated that their personal information is being submitted to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</li>
</ul><p>iv) <strong>C2</strong> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> call with <code>OrderQuote</code> including UUID with a <code>customer</code> object to check viability (call is idempotent), <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> responds with an <code>OrderQuote</code>.</p><ul>
<li><a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> creates named lease for that UUID if it is supported, otherwise it provides a simple availability and <code>totalPaymentDue</code> confirmation. Works exactly as <strong>C1</strong>.</li>
<li><a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> presents the contents of the <code>OrderQuote</code> to the <code>Customer</code> to ensure they have the most up-to-date price and availability before proceeding with the purchase.</li>
</ul><p>v) "<strong>3. Book and Pay</strong>" - User enters payment details and clicks Book</p><ul>
<li>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> have been made aware of and assent to any relevant <code>termsOfService</code>.</li>
<li>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> only be allowed to proceed if no <code>OrderItem</code>s in the <code>OrderQuote</code> contain any <code>error</code>s.</li>
</ul><p>vi) <strong>Authorise Payment</strong> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> pre-authorises <code>totalPaymentDue</code> from <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a></p><ul>
<li><code>Order</code>
<code>id</code> (which includes the UUID) <em class="rfc2119" title="SHOULD">SHOULD</em> be used as a reference in the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>, if possible.</li>
</ul><ul>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> store the <code>Order</code> request with an internal status of <code>https://openactive/PaymentAuthorized</code> at this point.</li>
</ul><p>vii) <strong>B</strong> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> call with <code>Order</code> including UUID with a Person object to check viability and with a Payment object for the total amount pre-authed (call is idempotent, can be retried if 500 returned), <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> responds with an <code>Order</code>.</p><ul>
<li><p>The <code>identifier</code> of the <code>Payment</code> is taken from the payment pre-authorization.</p>
</li>
<li><p>If the <code>totalPaymentDue</code> in the <code>Order</code> object is different to the current <code>totalPaymentDue</code> (which might have changed since <strong>C2</strong>, e.g. if the headline price is changed in the booking system between these two steps), the booking fails but the lease is sustained so that the user can be prompted whether they want to continue with the new amount.</p>
</li>
<li><p>If some of the leases have expired, or if leases are not supported, then the booking system attempts to make the booking anyway. If there are no spaces available the booking fails.</p>
</li>
<li><p>If the booking succeeds only for some basket items, the whole transaction is rolled back and the entire booking fails.</p>
</li>
<li><p>If there's a network failure, e.g. no response from server, then <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> can resubmit with same UUID. As the call is idempotent, the Booking System will need to track the UUID supplied by <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> against any successful orders, to ensure that it can return the same <code>Order</code> for subsiquent requests. <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> reuse UUIDs across multiple <code>Order</code>s.</p>
</li>
<li><p>The booking is considered as complete and paid by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> at this point.</p>
</li>
<li><p>The <code>Order</code> returned from this call <em class="rfc2119" title="MUST">MUST</em> be stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, to be subsequently updated by the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>.</p>
</li>
<li><p>If the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> requires any <code>Order</code> properties included in the request but <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> in the <code>Order</code> response, including the <code>customer</code>, it must store them alongside the <code>Order</code> as part of this call, as they may not be included in the <code>Order</code> response or the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>.</p>
</li>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> store the <code>Order</code> response in with an internal status of <code>https://schema.org/OrderPaymentDue</code> at this point (or <code>https://openactive/PaymentCaptured</code> if no payment is due).</p>
</li>
</ul><p>viii) <strong>Capture Payment</strong> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> captures <code>totalPaymentDue</code> from payment provider</p><ul>
<li><p>If an error occurs during capture (very unlikely but possible due to system failure, and detectable using the internal status, and this may only be noticed after the event due to server failure and observation of logs, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> either:</p>
<ul>
<li>Initiate manual capture via e.g. the Stripe console. Note the pre-auth will typically last for 7 days, so manual capture is still possible after the event.</li>
<li>Capture the payment from the user manually.</li>
<li>Absorb the loss and make a new payment for the same amount with the same UUID in the payment provider (better for UX / customer service, if manual capture not possible).</li>
<li>Perform the rollback procedure detailed in the following section.</li>
</ul>
</li>
<li><p>To ensure payment capture errors are detected and resolved the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> periodically check for any <code>Orders</code> that have not been updated in over a 5 minutes, and are in a state other than <code>https://schema.org/OrderDelivered</code>.</p>
</li>
<li><p>It is the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>'s responsibility to ensure that payment has been captured.</p>
</li>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> update the <code>Order</code> in with an internal status of <code>https://openactive/PaymentCaptured</code> after payment is successfully captured.</p>
</li>
</ul><p>ix) <strong>Invoice Generation</strong> and <strong>Customer Notification</strong> - Upon successfully capturing payment, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> generates invoices, sends <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> notifications, and stores the <code>Order</code> in a success state based on the response from <strong>B</strong>.</p><ul>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> update the <code>Order</code> in with an internal status of <code>https://schema.org/OrderDelivered</code> after invoices have been created and notifications successfully sent.</li>
</ul><p>x) <strong>Refunds an Cancellation</strong> - The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> subscribes to updates from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to process cancellations and refunds.</p><ul>
<li>A secure <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> of <code>Order</code>s <em class="rfc2119" title="MUST">MUST</em> be provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, with the contents of the feed specific to the authentication credentials. This allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to maintain an updated state of all their bookings across a number of <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a>, even when changes are made outside of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>. This also allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to handle refunds to cancellations, and process notifications to <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a> in a consistent way.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> must ensure that the <code>Order</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> represent the current state of <code>OrderItem</code>s within the system, for the properties included in the feed.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> uses these <code>Order</code>s to process refunds and send update notifications to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</li>
</ul><section id="single-state-orders"><h4 id="x5-3-1-single-state-orders"><span class="secno">5.3.1 </span>Single state Orders<a class="self-link" aria-label="§" href="#single-state-orders"></a></h4><p>The <code>Order</code> is created in a successful state, although their <code>OrderItem</code>s may be cancelled by either the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> or the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, the <code>Order</code> itself within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> will not exist in the any other state. The <code>orderStatus</code> property of the <code>Order</code> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be used and is reserved for future evolution of the specification.</p></section><section id="payment-capture-rollback"><h4 id="x5-3-2-payment-capture-rollback"><span class="secno">5.3.2 </span>Payment Capture Rollback<a class="self-link" aria-label="§" href="#payment-capture-rollback"></a></h4><p>The following actions <em class="rfc2119" title="MUST">MUST</em> be performed to rollback the <code>Order</code> following an error during Capture Payment, starting at the internal status of the <code>Order</code> and continuing through the list from that point unless otherwise specified:</p><ol>
<li><a href="https://openactive/PaymentCaptured">https://openactive/PaymentCaptured</a> - Invoice generation and notification should simply be retried, with no further rollback steps taken - a rollback <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> be performed from this status.</li>
<li><a href="https://schema.org/OrderPaymentDue">https://schema.org/OrderPaymentDue</a> - Issue a DELETE request for the <code>Order</code> to remove it from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</li>
<li><a href="https://openactive/PaymentAuthorized">https://openactive/PaymentAuthorized</a> - Cancel the associated Payment Authorisation from the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>.</li>
<li>Soft delete the contents of the <code>Order</code> from the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> (including any personal data), retaining the UUID.</li>
</ol><p>Note that due to the ordering of the Booking Flow, no notifications will have been sent to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and no money taken, so no notifications regarding the rollback are required assuming it is performed promptly.</p></section><section id="order-feed-inconsistencies"><h4 id="x5-3-3-order-feed-inconsistencies"><span class="secno">5.3.3 </span>Order Feed Inconsistencies<a class="self-link" aria-label="§" href="#order-feed-inconsistencies"></a></h4><p>An error condition exists where an unrecognised <code>Order</code> item is found by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> on the feed. Due to internal status of <code>Order</code>s being monitored as described previously, there should always be a matching <code>Order</code> to any UUID on the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> even if it has been soft-deleted. This would make an unrecognised <code>Order</code> an impossible scenario, and hence an unrecognised <code>Order</code> should be logged as a serious error within the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and promptly investigated.</p></section></section></section><section class="normative" id="broker-roles"><!--OddPage--><h2 id="x6-broker-roles"><span class="secno">6. </span>Broker Roles<a class="self-link" aria-label="§" href="#broker-roles"></a></h2><p>A <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> is an actor that arranges transactions between a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> and <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, either directly or indirectly.</p><p>From a contractual and taxation perspective, there are two types of Broker, and agent (<code>AgentBroker</code>), and a reseller (<code>ResellerBroker</code>), as well direct purchase (<code>NoBroker</code>).</p><p>Note that this specification does not deal with contractual relationships, and simply provides a mechanism to record bookings.</p><section id="resellerbroker"><h3 id="x6-1-resellerbroker"><span class="secno">6.1 </span><code>ResellerBroker</code><a class="self-link" aria-label="§" href="#resellerbroker"></a></h3><section id="definition"><h4 id="x6-1-1-definition"><span class="secno">6.1.1 </span>Definition<a class="self-link" aria-label="§" href="#definition"></a></h4><p>A reseller is a company or individual that purchases goods or services with the intention of selling them rather than consuming or using them. This is usually done for profit (but could be resold at a loss).</p></section><section id="contractual-relationships"><h4 id="x6-1-2-contractual-relationships"><span class="secno">6.1.2 </span>Contractual Relationships<a class="self-link" aria-label="§" href="#contractual-relationships"></a></h4><p>In the context of OpenActive, a <code>ResellerBroker</code> contracts directly with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> as a business-to-business relationship to purchase access to the opportunity. It then, at a later point in time (which may only be milliseconds later), separately forms a contractual relationship with the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, who purchases access to the opportunity from the <code>ResellerBroker</code>.</p><figure id="fig-contractual-relationships-in-resellerbroker-mode"><img src="ResellerBroker.png" alt="ResellerBroker relationships" height="303" width="577">
<figcaption>Figure <span class="figno">5</span> <span class="fig-title">Contractual relationships in ResellerBroker mode</span></figcaption>
</figure></section><section id="taxation"><h4 id="x6-1-3-taxation"><span class="secno">6.1.3 </span>Taxation<a class="self-link" aria-label="§" href="#taxation"></a></h4><p>The <code>ResellerBroker</code>'s purchase from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> is business-to-business, which is subject to the appropriate taxation based on the <code>ResellerBroker</code> as the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.
The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>'s purchase from the <code>ResellerBroker</code> is business-to-consumer, which is subject to the appropriate taxation based on the <code>ResellerBroker</code> as the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</p><p>Hence any tax exception that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> may enjoy when purchasing directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> (e.g. if the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> is an <a href="https://www.gov.uk/guidance/sport-supplies-that-are-vat-exempt-notice-70145">VAT exempt eligible body</a>) is not relevant here, as no direct contractual relationship is formed between <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> and <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</p></section><section id="scope-of-specification"><h4 id="x6-1-4-scope-of-specification"><span class="secno">6.1.4 </span>Scope of Specification<a class="self-link" aria-label="§" href="#scope-of-specification"></a></h4><p>This specification is designed to govern the interaction between the <code>ResellerBroker</code> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>. It does include provision for the interaction between the <code>ResellerBroker</code> and <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> explicitly, though it may be repurposed by the broker to perform this function by treating the Broker as a Booking system. This specification also does not include provision for the recording of the execution of the contractual relationship with any payment provider (e.g. for payment processing fees). Such relationships <em class="rfc2119" title="MUST">MUST</em> be handled separately.
When the brokerRole is set to <code>ResellerBroker</code>, this indicates that the payee for accounting and tax purposes is the "broker" specified in the Order.
Note that the <code>customer</code> may still optionally be included in the Order, for example to help front-of-house staff identify the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</p></section><section id="conformance-criteria"><h4 id="x6-1-5-conformance-criteria"><span class="secno">6.1.5 </span>Conformance criteria<a class="self-link" aria-label="§" href="#conformance-criteria"></a></h4><p>When the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> generates the <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a>, it must be made payable to <code>Order.broker</code>, <code>Order.broker</code> <em class="rfc2119" title="MUST">MUST</em> be provided and <code>Order.customer</code> is optional.</p></section></section><section id="agentbroker"><h3 id="x6-2-agentbroker"><span class="secno">6.2 </span><code>AgentBroker</code><a class="self-link" aria-label="§" href="#agentbroker"></a></h3><section id="definition-0"><h4 id="x6-2-1-definition"><span class="secno">6.2.1 </span>Definition<a class="self-link" aria-label="§" href="#definition-0"></a></h4><p>An agent is authorized to act on behalf of another (the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, or "principle") to create legal relations with a third party (the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>). Succinctly, it may be referred to as the equal relationship between a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> and an agent whereby the principal, expressly or implicitly, authorizes the agent to work under his or her control and on his or her behalf. The agent is required to negotiate on behalf of the principal (<a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>) and/or bring them and third parties (<a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a>) into contractual relationship.</p></section><section id="contractual-relationships-0"><h4 id="x6-2-2-contractual-relationships"><span class="secno">6.2.2 </span>Contractual Relationships<a class="self-link" aria-label="§" href="#contractual-relationships-0"></a></h4><p>There are three separate types of contractual relationship involved:
<code>AgentBroker</code> with <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, known as the principal-agent relationship or "internal" relationship;
<code>AgentBroker</code> with <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> with whom they deal on their <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>'s behalf ("external relationship"); and
<a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> with <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> when arranged by an <code>AgentBroker</code>.</p><figure id="fig-contractual-relationships-in-agentbroker-mode"><img src="AgentBroker.png" alt="AgentBroker relationships" height="293" width="558">
<figcaption>Figure <span class="figno">6</span> <span class="fig-title">Contractual relationships in AgentBroker mode</span></figcaption>
</figure></section><section id="taxation-0"><h4 id="x6-2-3-taxation"><span class="secno">6.2.3 </span>Taxation<a class="self-link" aria-label="§" href="#taxation-0"></a></h4><p>While facilitated by the <code>AgentBroker</code>, the primary purchase is made by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, as would be the case if the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> was to purchase from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> independently.
Hence any tax exception that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> may enjoy when purchasing directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> (e.g. if the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> is an <a href="https://www.gov.uk/guidance/sport-supplies-that-are-vat-exempt-notice-70145">VAT exempt eligible body</a>) is relevant here.</p><p>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>'s relationship with <code>AgentBroker</code> is business-to-consumer. Hence any additional services (e.g. customer-facing booking fees) are subject to the appropriate taxation based on the <code>AgentBroker</code> as the <code>seller</code>.</p><p>The <code>AgentBroker</code>'s relationship with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> is business-to-business. Hence any additional services (e.g. booking commission) are subject to the appropriate taxation.</p></section><section id="scope-of-specification-0"><h4 id="x6-2-4-scope-of-specification"><span class="secno">6.2.4 </span>Scope of Specification<a class="self-link" aria-label="§" href="#scope-of-specification-0"></a></h4><p>This specification is designed to govern the recording of the execution of the contractual relationship between the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.
The scope of this specification does not include the contractual relationship between the <code>AgentBroker</code> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> (e.g. for booking commission), between the <code>AgentBroker</code> and the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> (e.g. for booking fees) or with any payment provider (e.g. for payment processing fees). Such relationships and the reconciliation of associated invoices <em class="rfc2119" title="MUST">MUST</em> be handled separately.
When the brokerRole is set to "AgentBroker", this indicates that the payee for accounting and tax purposes is the <code>customer</code> specified in the Order.</p></section><section id="conformance-criteria-0"><h4 id="x6-2-5-conformance-criteria"><span class="secno">6.2.5 </span>Conformance criteria<a class="self-link" aria-label="§" href="#conformance-criteria-0"></a></h4><p>When the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> generates the <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a>, it must be made payable to <code>Order.customer</code>, <code>Order.broker</code> <em class="rfc2119" title="MUST">MUST</em> be provided and <code>Order.customer</code> <em class="rfc2119" title="MUST">MUST</em> be provided.</p></section><section id="informed-purchase"><h4 id="x6-2-6-informed-purchase"><span class="secno">6.2.6 </span>Informed purchase<a class="self-link" aria-label="§" href="#informed-purchase"></a></h4><p>When using a <code>brokerRole</code> of <code>AgentBroker</code>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> make the customer aware that they are purchasing directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> via the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, and not directly from the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</p></section></section><section id="nobroker"><h3 id="x6-3-nobroker"><span class="secno">6.3 </span><code>NoBroker</code><a class="self-link" aria-label="§" href="#nobroker"></a></h3><section id="definition-1"><h4 id="x6-3-1-definition"><span class="secno">6.3.1 </span>Definition<a class="self-link" aria-label="§" href="#definition-1"></a></h4><p>This specification supports direct purchase by a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> (for example in the context of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>'s own website, or for businesses that purchase large volumes of FacilityUse slots to run leagues).</p></section><section id="contractual-relationships-1"><h4 id="x6-3-2-contractual-relationships"><span class="secno">6.3.2 </span>Contractual Relationships<a class="self-link" aria-label="§" href="#contractual-relationships-1"></a></h4><p>The contractual relationship is a simple one between the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> and the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</p><figure id="fig-contractual-relationships-in-nobroker-mode"><img src="NoBroker.png" alt="NoBroker relationships" height="132" width="564">
<figcaption>Figure <span class="figno">7</span> <span class="fig-title">Contractual relationships in NoBroker mode</span></figcaption>
</figure></section><section id="taxation-1"><h4 id="x6-3-3-taxation"><span class="secno">6.3.3 </span>Taxation<a class="self-link" aria-label="§" href="#taxation-1"></a></h4><p>The purchase is made by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, as would be the case if the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> was to purchase from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> outside of this specification.
Hence any tax exception that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> may enjoy when purchasing directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> (e.g. if the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> is an VAT exempt eligible body) is relevant here.</p></section><section id="scope-of-specification-1"><h4 id="x6-3-4-scope-of-specification"><span class="secno">6.3.4 </span>Scope of Specification<a class="self-link" aria-label="§" href="#scope-of-specification-1"></a></h4><p>This specification is designed to govern the recording of the execution of the contractual relationship between the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.
The scope of this specification does not include the contractual relationship with any payment provider (e.g. for payment processing fees). Such relationships <em class="rfc2119" title="MUST">MUST</em> be handled separately.</p><p>When the brokerRole is set to "NoBroker", this indicates that the payee for accounting and tax purposes is the <code>customer</code> specified in the Order.</p></section><section id="conformance-criteria-1"><h4 id="x6-3-5-conformance-criteria"><span class="secno">6.3.5 </span>Conformance criteria<a class="self-link" aria-label="§" href="#conformance-criteria-1"></a></h4><p>When an <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a> is generated, it must be made payable to <code>Order.customer</code>, <code>Order.broker</code> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be provided and <code>Order.customer</code> <em class="rfc2119" title="MUST">MUST</em> be provided.</p></section></section></section><section class="normative" id="systems-of-record"><!--OddPage--><h2 id="x7-systems-of-record"><span class="secno">7. </span>Systems of Record<a class="self-link" aria-label="§" href="#systems-of-record"></a></h2><section id="roles-and-responsibilities-overview"><h3 id="x7-1-roles-and-responsibilities-overview"><span class="secno">7.1 </span>Roles and responsibilities overview<a class="self-link" aria-label="§" href="#roles-and-responsibilities-overview"></a></h3><p>For the purposes of this specification, the key components of a booking are: <code>Order</code>, <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a>, <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> and <a href="#dfn-refund" class="internalDFN" data-link-type="dfn">Refund</a>.</p><p>Note that <code>OrderQuote</code> is a subclass of <code>Order</code> used during the <code>Order</code> creation process, and is not explicitly persisted.</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> has visibility of all components, while for simplicity of implementation the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> only has visibility of the <code>Order</code>, as shown below:</p><figure id="fig-roles-and-responsibilities"><img src="roles.png" alt="Roles and responsibilities" height="316" width="815">
<figcaption>Figure <span class="figno">8</span> <span class="fig-title">Roles and responsibilities</span></figcaption>
</figure><p><code>Order</code>s are the basis of the exchange between the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, with <code>OrderQuote</code>s used as part of the <code>Order</code> creation process. This specification describes a detailed model and API to allow <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a> to manipulate <code>Order</code>s, and only high level functional requirements for the expected behaviour of <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoices</a>, <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payments</a>, and <a href="#dfn-refund" class="internalDFN" data-link-type="dfn">Refunds</a>.</p><table>
<thead>
<tr>
<th>Component</th>
<th>Description</th>
<th>Owner</th>
<th>Audit</th>
</tr>
</thead>
<tbody><tr>
<td><dfn data-dfn-type="dfn" id="dfn-order"><code>Order</code></dfn></td>
<td>A mutable object that encompasses the live state of the bookable <code>Event</code>s within the booking system. An <code>Order</code> has a <code>orderItem</code>s, a <code>totalPaymentDue</code>, and all tax details, but is not itself a legal representation of a purchase from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</td>
<td><a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
<td>Mutable</td>
</tr>
<tr>
<td><dfn data-dfn-type="dfn" data-plurals="invoices" id="dfn-invoice">Invoice</dfn></td>
<td>An immutable object that is a legal representation of the purchase, which <em class="rfc2119" title="MUST">MUST</em> be rendered to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> as a legally permissible tax receipt, and exist as a tax point. A new <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a> <em class="rfc2119" title="MUST">MUST</em> be generated for the <code>Order</code> to replace the previous <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a> each occasion that an <code>orderItem</code> within an <code>Order</code> is cancelled.</td>
<td><a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a></td>
<td>Immutable</td>
</tr>
<tr>
<td><dfn data-dfn-type="dfn" data-plurals="payments" id="dfn-payment">Payment</dfn></td>
<td>A immutable object that represents the original payment to the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> for the initial <code>Order</code>. Although modelling the <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> is outside the scope of this specification, it is recommended that one payment exists for each <code>Order</code>.</td>
<td><a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a></td>
<td>Immutable</td>
</tr>
<tr>
<td><dfn data-dfn-type="dfn" data-plurals="refunds" id="dfn-refund">Refund</dfn></td>
<td>An immutable object that represents each refund made against the <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a>, up to the <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a>'s total amount</td>
<td><a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a></td>
<td>Immutable</td>
</tr>
</tbody></table></section><section id="invoices-and-tax-receipts"><h3 id="x7-2-invoices-and-tax-receipts"><span class="secno">7.2 </span>Invoices and Tax receipts<a class="self-link" aria-label="§" href="#invoices-and-tax-receipts"></a></h3><p>Due to the variety of business models in use in OpenActive, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> send receipts directly to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> for <code>AgentBroker</code> and <code>ResellerBroker</code> bookings.</p><p>For each successful <code>Order</code> operation (where <strong>C1</strong>, <strong>C2</strong> and <strong>B</strong> together constitute a successful Order Creation operation), the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> generate a new <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a> in the form of a tax receipt, on the basis of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> contents. To ensure that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> is provided with the correct tax receipt, if <code>totalPaymentTaxSpecification</code> is provided in an <code>Order</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> generate a new or updated <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a> and either (a) send a tax receipt representation of the <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a> to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and/or (b) offer a means to allow the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> to easily retrieve a full tax receipt representation of the specific version of the  <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn">Invoice</a> at any future date for any previous booking made. As it is ultimately the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>'s responsibility to send tax receipts, they need to be confident that the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> is making tax information available to its customers in an accurate and timely manner.</p><p>The tax receipt sent by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> comply with any legal requirements of the jurisdiction of operation.</p><p>Note by following specification, for all broker modes where a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> may need to supply a tax receipt manually for any reason, the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> will have the details of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and the transaction enough to generate the most recent tax receipt.</p></section><section id="payments-and-refunds"><h3 id="x7-3-payments-and-refunds"><span class="secno">7.3 </span>Payments and Refunds<a class="self-link" aria-label="§" href="#payments-and-refunds"></a></h3><p>Although the details of <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payments</a> and <a href="#dfn-refund" class="internalDFN" data-link-type="dfn">Refunds</a> are not in the scope of this specification, a single <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> <em class="rfc2119" title="MUST">MUST</em> be related to each <code>Order</code>, and a unique reference to this <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> <em class="rfc2119" title="MUST">MUST</em> be included in the <code>Payment</code>
<code>identifier</code> of the <code>Order</code> sent to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>. Note that this <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> is permitted to represent a virtual <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> consolidating a number of actual <strong>Payments</strong> to allow for a wide variety of <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> methods. In the case where the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> is paid monthly, the <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> may also represent a reference to a future invoice against which the eventual <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> will be paid. In all cases the <code>Payment</code>
<code>identifier</code> <em class="rfc2119" title="MUST">MUST</em> be uniquely resolvable for audit purposes.</p></section><section id="tax-calculation"><h3 id="x7-4-tax-calculation"><span class="secno">7.4 </span>Tax calculation<a class="self-link" aria-label="§" href="#tax-calculation"></a></h3><section id="business-to-consumer-tax-calculation-by-booking-system-is-mandatory"><h4 id="x7-4-1-business-to-consumer-tax-calculation-by-booking-system-is-mandatory"><span class="secno">7.4.1 </span>Business-to-consumer tax calculation by Booking System is mandatory<a class="self-link" aria-label="§" href="#business-to-consumer-tax-calculation-by-booking-system-is-mandatory"></a></h4><p>For <code>AgentBroker</code> and <code>NoBroker</code> modes, where the customer is of type <code>Person</code> and a tax receipt is usually generated by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, the tax calculation and associated properties this specification <em class="rfc2119" title="MUST">MUST</em> be implemented by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> (even if the resulting tax amount is zero).</p></section><section id="business-to-business-tax-calculation-by-booking-system-is-optional"><h4 id="x7-4-2-business-to-business-tax-calculation-by-booking-system-is-optional"><span class="secno">7.4.2 </span>Business-to-business tax calculation by Booking System is optional<a class="self-link" aria-label="§" href="#business-to-business-tax-calculation-by-booking-system-is-optional"></a></h4><p>Tax calculation at the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> is <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> when the <code>brokerRole</code> of <code>ResellerBroker</code> is specified, or when a customer of type <code>Organization</code> is specified. If tax calculation is not supported for a <code>ResellerBroker</code>, <code>unitTaxSpecification</code> and <code>totalPaymentTaxSpecification</code> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be included, and the <code>taxMode</code>
<code>https://openactive/TaxNet</code> <em class="rfc2119" title="MUST">MUST</em> be returned in the <code>OrderQuote</code> and <code>Order</code> (i.e. explicitly not including tax).</p><p>This allows tax to be calculated by the <code>ResellerBroker</code> or business <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and reconciled outside of this specification.</p><p>Note that for business-to-business sales for a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> with <code>taxMode</code> of the <code>organizer</code> or <code>provider</code> set to <code>https://openactive/TaxGross</code>, the <code>Offer</code>s available in the opportunity data will still be calculated as tax-inclusive for a business-to-consumer sale, and so <em class="rfc2119" title="MUST">MUST</em> be presented by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> as such, with the business-to-business tax calculation occurring during the booking flow. If the usecase of presenting the correct price up-front gains traction, additional price data must be made available as part of the openly published opportunity data to resolve this shortcoming.</p></section></section><section id="tax-mode"><h3 id="x7-5-tax-mode"><span class="secno">7.5 </span>Tax mode<a class="self-link" aria-label="§" href="#tax-mode"></a></h3><p>The <code>taxMode</code> (<code>https://openactive/TaxNet</code> or <code>https://openactive/TaxGross</code>) is <em class="rfc2119" title="REQUIRED">REQUIRED</em> to be specified at the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> level, and <em class="rfc2119" title="MUST">MUST</em> be reflected within the <code>Organization</code> that is included in the <em class="rfc2119" title="REQUIRED">REQUIRED</em> <code>organizer</code> or <code>provider</code> properties within opportunity data specified in [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>]. It <em class="rfc2119" title="MUST">MUST</em> also be consistent for all <code>Order</code>s originating from that <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</p><table>
<thead>
<tr>
<th><code>taxMode</code></th>
<th><code>https://openactive/TaxNet</code></th>
<th><code>https://openactive/TaxGross</code></th>
</tr>
</thead>
<tbody><tr>
<td>Price displayed</td>
<td>Excludes tax</td>
<td>Includes all applicable taxes assuming a <code>Person</code> as a <code>customer</code></td>
</tr>
<tr>
<td>Currencies usually associated</td>
<td>USD</td>
<td>EUR, AUD, GBP</td>
</tr>
<tr>
<td>Example price of opportunity before tax</td>
<td>10.00</td>
<td>10.00</td>
</tr>
<tr>
<td>Example tax rate</td>
<td>0.2</td>
<td>0.2</td>
</tr>
<tr>
<td>Price displayed to Customer during browsing</td>
<td>10.00</td>
<td>12.00</td>
</tr>
<tr>
<td>Total paid by Customer</td>
<td>12.00</td>
<td>12.00</td>
</tr>
</tbody></table></section><section id="free-opportunities"><h3 id="x7-6-free-opportunities"><span class="secno">7.6 </span>Free opportunities<a class="self-link" aria-label="§" href="#free-opportunities"></a></h3><p>Free opportunities, defined by those with at least one <code>Offer</code> with a <code>price</code> of <code>0</code>, <em class="rfc2119" title="MUST">MUST</em> follow the same workflow as paid opportunities, except with no interaction with a <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>, and no <code>payment</code> included in the Order Creation request.</p><p>For free <code>Offer</code>s publishers <em class="rfc2119" title="MAY">MAY</em> not include <code>priceCurrency</code>. If a <code>priceCurrency</code> is not available then brokers <em class="rfc2119" title="SHOULD">SHOULD</em> display "Free" or equivalent when displaying a zero price.</p></section><section id="offer-overrides"><h3 id="x7-7-offer-overrides"><span class="secno">7.7 </span>Offer overrides<a class="self-link" aria-label="§" href="#offer-overrides"></a></h3><p>The unit price of an OrderItem may be overridden to allow for business models with dynamic or variable pricing.</p><p>An <code>OfferOverride</code> type may be supplied to the <code>acceptedOffer</code> property at <strong>C1</strong>, <strong>C2</strong> and <strong>B</strong>. When an <code>OfferOverride</code> is used, it must be used consistently between <strong>C2</strong> and <strong>B</strong> to OrderQuote, it must be used by the booking system instead of acceptedOffer to calculate the tax and totals.</p><p>The <code>unitTaxSpecification</code> is calculated by the booking system exactly as it would be for an standard <code>Offer</code>. The <code>price</code> of the <code>OfferOverride</code> may be zero, and also may be higher or lower than the available <code>Offer</code>s that exist in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</p><p><code>OfferOverride</code> <em class="rfc2119" title="MUST NOT">MUST NOT</em> be used when <code>isAccessibleForFree</code> is <code>true</code>, as free events cannot be overridden. Note that <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> that only offer free opportunities <em class="rfc2119" title="MUST NOT">MUST NOT</em> implement <code>OfferOverride</code> support, and must always throw an error when it is used.</p><div class="example" id="example-3-example-of-offeroverride">
          <div class="marker">
      <a class="self-link" href="#example-3-example-of-offeroverride">Example 3</a><span class="example-title">: Example of OfferOverride</span>
    </div>
          <pre class="hljs javascript" aria-busy="false"><span class="hljs-string">"acceptedOffer"</span>: {
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"OfferOverride"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
  <span class="hljs-string">"price"</span>: <span class="hljs-number">10.00</span>,
  <span class="hljs-string">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
}</pre>
        </div><div class="issue" id="issue-container-number-96"><div role="heading" class="issue-title marker" id="h-issue" aria-level="4"><a href="https://github.com/openactive/open-booking-api/issues/96"><span class="issue-number">Issue 96</span></a><span class="issue-label" aria-label="This issue is labelled as Community Feedback Requested.">: Allow price overrides in this version of the specification? <a class="respec-gh-label respec-label-light" href="https://github.com/openactive/open-booking-api/issues/?q=is%3Aissue+is%3Aopen+label%3A%22Community+Feedback+Requested%22" style="background-color: rgb(150, 224, 234);">Community Feedback Requested</a></span></div><p>The only business model not automatically permissible within this specification (if the section "Offer overrides" was to be removed) is one that requires price variability on the part of the <strong>Seller</strong>.</p>
<p>As the <strong>Invoice</strong> generation and <strong>Payment</strong> is the responsibility of the <strong>Broker</strong> (so the invoice may contain additional items as needed and Orders can be assigned to arbitrary Invoices which cover arbitrary time periods), the only thing that isn't flexible by default is the total price of the Order itself and the price of the items within it.</p>
<p>Should this version of the specification include price overrides?</p>
<p>Pros:</p>
<ul>
<li>Including price overrides ensures that the specification covers all business models.</li>
</ul>
<p>Cons:</p>
<ul>
<li>Including price overrides slightly increases complexity of implementation.</li>
</ul></div></section></section><section class="normative" id="order-operations"><!--OddPage--><h2 id="x8-order-operations"><span class="secno">8. </span>Order Operations<a class="self-link" aria-label="§" href="#order-operations"></a></h2><section id="opportunity-selection"><h3 id="x8-1-opportunity-selection"><span class="secno">8.1 </span>Opportunity Selection<a class="self-link" aria-label="§" href="#opportunity-selection"></a></h3><p>Before entering into the Booking Flow, pairs of appropriate <code>acceptedOffer</code> and <code>orderedItem</code> must be selected by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</p><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> ensure that the <code>remainingAttendeeCapacity</code> and <code>remainingUses</code> properties in the opportunity data are up-to-date, and only include places already booked and <em>not</em> places currently reserved by leases.</p><section id="definition-of-an-open-booking-bookable-opportunity"><h4 id="x8-1-1-definition-of-an-open-booking-bookable-opportunity"><span class="secno">8.1.1 </span>Definition of an Open Booking 'bookable' opportunity<a class="self-link" aria-label="§" href="#definition-of-an-open-booking-bookable-opportunity"></a></h4><p>An opportunity of type <code>Event</code>, <code>ScheduledSession</code>, <code>HeadlineEvent</code>, <code>Slot</code> or <code>CourseInstance</code> is deemed to be <dfn data-dfn-type="dfn" id="dfn-bookable">bookable</dfn> via the Open Booking API if:</p><ul>
<li><p><code>availableChannel</code> of a valid <code>Offer</code> includes <code>https://openactive.io/OpenBookingPrepayment</code>.</p>
</li>
<li><p>The <code>endDate</code> is not already in the past (note that bookings are still possible after the <code>startDate</code>).</p>
</li>
<li><p>The <code>eventStatus</code> of the <code>Event</code>, <code>ScheduledSession</code>, or <code>Slot</code> is not <code>https://schema.org/EventCancelled</code> or <code>https://schema.org/EventPostponed</code>.</p>
</li>
<li><p>The <code>remainingAttendeeCapacity</code> or <code>remainingUses</code> is greater than the number required.</p>
</li>
<li><p>The <code>potentialAction</code> of dataset site includes an <code>OpenBookingAction</code> object.</p>
</li>
<li><p>The <code>validFromBeforeStartDate</code> duration (if provided) subtracted from the <code>startDate</code> in the past. This allows for a "bookahead" window to be specified.</p>
</li>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> has machine readable permission to access the relevant instance of a compliant Open Booking API provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> via an API key or similar token.</p>
</li>
</ul><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> attempt to book an opportunity that is not <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a> by the above criteria. The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> return an error if an <code>Order</code> is submitted that contains activities that are not <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a>, and include an <code>error</code> against each <code>OrderItem</code> in the <code>OrderQuote</code> that is not <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a>.</p><p>Note that although the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> may be ineligible to attend a <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a> opportunity based on the <code>genderRestriction</code> or <code>ageRange</code>, this specification encourages the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> NOT to capture gender and age data from the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and NOT to enforce validation of these restrictions, but instead to prominently display any restrictions in the booking process to ensure that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> is aware of these.</p><p>There may be more restrictions placed by a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> on a booking. For example, it may be that one of the party must be over a certain age as a supervising adult if some of the party are minors. It is the responsibility of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> to make such restrictions available as <code>oa:attendeeInstructions</code> on the <code>SessionSeries</code>, <code>FacilityUse</code>, <code>Event</code>, <code>HeadlineEvent</code> or <code>CourseInstance</code>, and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> display these instructions clearly during the booking process.</p></section><section id="applicable-offers"><h4 id="x8-1-2-applicable-offers"><span class="secno">8.1.2 </span>Applicable <code>Offer</code>s<a class="self-link" aria-label="§" href="#applicable-offers"></a></h4><p><dfn data-dfn-type="dfn" data-plurals="applicable offer" id="dfn-applicable-offers">Applicable <code>Offer</code>s</dfn> are a complete set of <code>Offers</code> for an opportunity, deduced from inheritance following the parent/child relationship defined by the <code>superEvent</code>/<code>subEvent</code> properties for all types that subclass <code>schema:Event</code>, and defined by the <code>facilityUse</code>/<code>event</code> properties for <code>oa:FacilityUse</code> and <code>oa:Slot</code>.</p><p>The following recursive algorithm should be applied to calculate applicable offers:</p><ol>
<li>The applicable set of offers is initialised with the <code>offers</code> property of the <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a> opportunity.</li>
<li>If a parent is available for a <a href="#dfn-bookable" class="internalDFN" data-link-type="dfn">bookable</a> opportunity, the applicable set of offers <em class="rfc2119" title="MUST">MUST</em> also include all <code>Offer</code>s specified in the <code>offers</code> property of the parent, where the <code>identifier</code> of that <code>Offer</code> does not match an existing applicable offer. This allows <code>Offer</code>s to be overridden in the child using the <code>identifier</code> attribute.</li>
<li>Step 2 is repeated for each parent recursively.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> then filter this applicable set to provide a set of <code>Offers</code> which are current (based on <code>validFromBeforeStartDate</code>) and are available to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> through the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> (based on <code>availableChannel</code>).</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MAY">MAY</em> additionally filter based on the <code>Offer</code>s that apply to the customer, for example based on <code>ageRange</code> if specified in the <code>Offer</code>. This specification provides no guidance as to how the filtering should be performed, however it recommends against gathering additional personal data about the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> in order to restrict <code>Offer</code>s presented, and instead advocates clear messaging regarding the restrictions of each <code>Offer</code> to allow the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> to make an informed decision.</li>
</ol></section></section><section id="amending-the-orderquote-before-b"><h3 id="x8-2-amending-the-orderquote-before-b"><span class="secno">8.2 </span>Amending the OrderQuote before <strong>B</strong><a class="self-link" aria-label="§" href="#amending-the-orderquote-before-b"></a></h3><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MAY">MAY</em> call <strong>C1</strong> and <em class="rfc2119" title="MUST">MUST</em> call <strong>C2</strong> when the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> updates their basket to add and remove items.</p><p>When repeated calls to <strong>C1</strong> or <strong>C2</strong> are made with the same UUID, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> expire the leases of items that have been removed from the basket.</p><p>All leases may be cancelled by submitting an <code>OrderQuote</code> with the same UUID but without any <code>orderItem</code>s as either <strong>C1</strong> or <strong>C2</strong>. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="SHOULD">SHOULD</em> make a reasonable attempt to cancel all leases when it is aware that a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> has abandoned their journey. For <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> that have not implemented leasing, an <code>OrderQuote</code> without any <code>orderItem</code>s can simply be ignored.</p></section><section id="cancellation-after-b"><h3 id="x8-3-cancellation-after-b"><span class="secno">8.3 </span>Cancellation after <strong>B</strong><a class="self-link" aria-label="§" href="#cancellation-after-b"></a></h3><p>Either the whole <code>Order</code> or individual <code>OrderItem</code>s within the <code>Order</code> may be cancelled after <strong>B</strong>, however <code>OrderItem</code>s cannot be replaced or added to an existing <code>Order</code> within this version of the specification.</p><p>The cancellation may be requested by either the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> or the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, and results in an updated <code>Order</code> item on the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>. Once a cancellation status is placed on an <code>OrderItem</code> within an <code>Order</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> it is assumed by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to have been processed, and it <em class="rfc2119" title="MUST NOT">MUST NOT</em> be reversed. A new <code>Order</code> will need to created to reinstate the booking.</p><div class="issue" id="issue-container-number-97"><div role="heading" class="issue-title marker" id="h-issue-0" aria-level="4"><a href="https://github.com/openactive/open-booking-api/issues/97"><span class="issue-number">Issue 97</span></a><span class="issue-label" aria-label="This issue is labelled as Community Feedback Requested.">: Arbitrary refunds are not in scope <a class="respec-gh-label respec-label-light" href="https://github.com/openactive/open-booking-api/issues/?q=is%3Aissue+is%3Aopen+label%3A%22Community+Feedback+Requested%22" style="background-color: rgb(150, 224, 234);">Community Feedback Requested</a></span></div><p>Refunds are only permitted for entire items, and partial item refunds (including cancellation fees) are not in scope for this version of the specification.</p>
<p>Although it is understood that some booking systems support partial item refunds, this is a superset of the functionality currently offered within the specification, so should not be an issue for refunds triggered due to cancellations via the <strong>Broker</strong>. As it stands <strong>Seller</strong> requested cancellation will be limited to whole item refunds and no cancellation fees.</p>
<p>Please comment if partial item refunds or cancellation fees are essential to your usecase.</p></div><section id="customer-requested-cancellation"><h4 id="x8-3-1-customer-requested-cancellation"><span class="secno">8.3.1 </span>Customer requested cancellation<a class="self-link" aria-label="§" href="#customer-requested-cancellation"></a></h4><figure id="fig-customer-requested-cancellation"><img src="customercancelled.png" alt="Customer requested cancellation" height="529" width="765">
<figcaption>Figure <span class="figno">9</span> <span class="fig-title">Customer requested cancellation</span></figcaption>
</figure><p>To cancel an existing OrderItem, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em>:</p><ol>
<li><p>Use the latest state of the <code>Order</code> from the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> to determine which <code>OrderItem</code>s may be cancelled. If <code>allowSimpleCancellation</code> is <code>true</code> and <code>latestCancellationBeforeStartDate</code> subtracted from the opportunity <code>startDate</code> is in the future, a PATCH against the <code>OrderItem</code>
<code>id</code> with a body of <code>{ "orderItemStatus": "https://openactive.io/CustomerCancelled" }</code> <em class="rfc2119" title="MUST">MUST</em> succeed.</p>
</li>
<li><p>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> be informed of the expected refund before they commit to cancellation, where the value of the refund for each <code>OrderItem</code> <em class="rfc2119" title="MUST">MUST</em> be equal to:</p>
</li>
</ol><ul>
<li>For <code>taxMode</code> of <code>https://openactive/TaxNet</code>: the sum of the <code>price</code> in the <code>acceptedOffer</code> and all the prices in <code>unitTaxSpecification</code>.</li>
<li>For <code>taxMode</code> of <code>https://openactive/TaxGross</code>: the <code>price</code> in the <code>acceptedOffer</code>.</li>
</ul><ol start="3">
<li><p>For each <code>OrderItem</code> to be cancelled, a PATCH must be submitted using the URI <code>id</code> of the <code>OrderItem</code> from the feed with a body of <code>{ "orderItemStatus": "https://openactive.io/CustomerCancelled" }</code>. On success, a 204 response will be received, without any body. On failure a 5xx response will be received with an error message.</p>
</li>
<li><p>Process any refunds based on the resulting updates to the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>. Successfully cancelled <code>OrderItems</code> will have <code>orderItemStatus</code> set to <code>https://openactive.io/CustomerCancelled</code>. Note refunds <em class="rfc2119" title="MUST NOT">MUST NOT</em> be processed except in response to updates in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>.</p>
</li>
</ol><p>To cancel an entire <code>Order</code>, a PATCH request must be made to each <code>OrderItem</code> within it individually. To minimise the number of updates in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, it is recommended that multiple DELETEs are sent in quick succession.</p><p>Note that there is no provision for a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> to cancel an <code>Order</code> after the cancellation window specified by <code>latestCancellationBeforeStartDate</code>, yet they may wish to do this out of politeness even though no refund is possible, with the benefit that their place may be taken by another participant.</p><div class="issue" id="issue-container-number-92"><div role="heading" class="issue-title marker" id="h-issue-1" aria-level="5"><a href="https://github.com/openactive/open-booking-api/issues/92"><span class="issue-number">Issue 92</span></a><span class="issue-label" aria-label="This issue is labelled as Community Feedback Requested.">: Allow whole Order cancellation? <a class="respec-gh-label respec-label-light" href="https://github.com/openactive/open-booking-api/issues/?q=is%3Aissue+is%3Aopen+label%3A%22Community+Feedback+Requested%22" style="background-color: rgb(150, 224, 234);">Community Feedback Requested</a></span></div><p>Should we allow the cancellation of a whole <code>Order</code>?</p>
<p>Pros:</p>
<ul>
<li>Easier for broker</li>
</ul>
<p>Cons:</p>
<ul>
<li>More complexity for booking system</li>
<li>Requires booking system to test both all <code>OrderItems</code> being cancelled to cancel whole <code>Order</code>, as well as cancellation of the <code>Order</code> directly</li>
</ul></div></section><section id="seller-requested-cancellation"><h4 id="x8-3-2-seller-requested-cancellation"><span class="secno">8.3.2 </span>Seller requested cancellation<a class="self-link" aria-label="§" href="#seller-requested-cancellation"></a></h4><figure id="fig-seller-requested-cancellation"><img src="sellercancelled.png" alt="Seller requested cancellation" height="316" width="763">
<figcaption>Figure <span class="figno">10</span> <span class="fig-title">Seller requested cancellation</span></figcaption>
</figure><p><code>OrderItems</code> cancelled by the Seller will have <code>orderItemStatus</code> set to <code>https://openactive.io/SellerCancelled</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, and will optionally include a <code>cancellationMessage</code>. Refunds <em class="rfc2119" title="MUST">MUST</em> be processed in response to the resulting updates in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, and the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> be notified with the <code>cancellationMessage</code> if provided.</p></section></section><section id="notifications-updates-and-refunds"><h3 id="x8-4-notifications-updates-and-refunds"><span class="secno">8.4 </span>Notifications, updates and refunds<a class="self-link" aria-label="§" href="#notifications-updates-and-refunds"></a></h3><p>An <dfn data-dfn-type="dfn" id="dfn-orders-feed">Orders feed</dfn>, which is a secure [<cite><a class="bibref" href="#bib-rpde">RPDE</a></cite>] feed of <code>Order</code>s, <em class="rfc2119" title="MUST">MUST</em> be provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, with the contents of the feed specific to the authenticating <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>. This allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to maintain an updated state of all their bookings across a number of <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a>, even when changes are made outside of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</p><p>This also allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to handle refunds to cancellations, and process notifications to <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a> in a consistent way.</p><section id="booking-system-updating-the-orders-feed"><h4 id="x8-4-1-booking-system-updating-the-orders-feed"><span class="secno">8.4.1 </span>Booking System: Updating the Orders feed<a class="self-link" aria-label="§" href="#booking-system-updating-the-orders-feed"></a></h4><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> must ensure that the <code>Order</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> represent the current state of <code>OrderItem</code>s within the system, for the properties included in the feed. Hence any change to any property within an <code>Order</code> in the feed must result in a change to the <code>modified</code> property associated with that <code>Order</code>.</p><p>In order to allow a natural batching of updates in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, where multiple cancellations may be made across multiple <code>Order</code>s for the same <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, cancellation updates made to <code>Order</code>s in the feed by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> be posted with a modified date 30 seconds into the future. The following query will easily exclude such updates while still meeting the [<cite><a class="bibref" href="#bib-rpde">RPDE</a></cite>] specification:</p><div class="example" id="example-4-example-of-rpde-query-with-natural-batching">
          <div class="marker">
      <a class="self-link" href="#example-4-example-of-rpde-query-with-natural-batching">Example 4</a><span class="example-title">: Example of RPDE query with natural batching</span>
    </div>
          <pre class="sql hljs" aria-busy="false">--include first part of WHERE clause only if @afterTimestamp and @afterId provided
   WHERE (
        (modified = @afterTimestamp
              AND id &gt; @afterId)
        OR (modified &gt; @afterTimestamp)
      )
      AND modified &lt;= GETDATE()
ORDER BY modified,
         id</pre>
        </div><p>Note that this delay of cancellation requests being processed by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> also mitigates the unlikely race condition of an <code>Order</code> that is created and then immediately cancelled by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, which would result in the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> receiving an unrecognised <code>Order</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>.</p></section><section id="broker-processing-the-orders-feed"><h4 id="x8-4-2-broker-processing-the-orders-feed"><span class="secno">8.4.2 </span>Broker: Processing the Orders feed<a class="self-link" aria-label="§" href="#broker-processing-the-orders-feed"></a></h4><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> maintain an up-to-date store of <code>Order</code>s received from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>. Each <code>Order</code> received is compared to the last <code>Order</code> stored, and any differences between the old and new content trigger notifications and refunds to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>, as well as updating the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>'s store.</p><p>Hence it is important for the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to consider their store of <code>Order</code>s as durable, and not simply a cache, to ensure their customers always get relevant notifications.</p><p>Note that the properties included in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> and the <code>Order</code> response from the Order Creation call <em class="rfc2119" title="MAY">MAY</em> be a subset of the <code>Order</code> request to <strong>B</strong> (effectively making the Orders feed a series of PATCH requests for the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>), and hence any additional properties required (including properties that are <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> in the <code>Order</code> response but that were used to create the <code>Order</code>) <em class="rfc2119" title="SHOULD">SHOULD</em> be stored alongside the <code>Order</code> by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> during <strong>B</strong>.</p></section><section id="new-orders"><h4 id="x8-4-3-new-orders"><span class="secno">8.4.3 </span>New <code>Order</code>s<a class="self-link" aria-label="§" href="#new-orders"></a></h4><p>New <code>Order</code>s <em class="rfc2119" title="MUST">MUST</em> be stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> based on the response to the Order Creation call, but only stored with a success state on successful completion of the Booking Flow</p><p>New <code>Order</code>s are not included in the feed until they have been updated at least once. This minimises the volume of <code>Order</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, and allows the polling frequency of the feed to be greatly reduced, which reduces the overall load on the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>. It also removes any race conditions between <strong>B</strong> completing and Order Creation updates from the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> being received.</p><p>Hence all <code>Order</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> will always be recognised by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> as updates to an existing stored <code>Order</code>, and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> should treat any unrecognised <code>Order</code>s in the feed as a serious implementation error.</p></section><section id="cancellation-refund-calculation-and-notification"><h4 id="x8-4-4-cancellation-refund-calculation-and-notification"><span class="secno">8.4.4 </span>Cancellation, refund calculation and notification<a class="self-link" aria-label="§" href="#cancellation-refund-calculation-and-notification"></a></h4><p>Regardless of the source of the cancellation, the process for refunding and notifying the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and updating the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>'s records is exactly the same.</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> process refunds for each new cancellation found in the feed, and it is the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>'s responsibility to continually retry failed refund processing and escalate any processing failure to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> accordingly. Note that the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> is "fire and forget" for the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>: once an <code>OrderItem</code> is updated with a cancellation status in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, the status <em class="rfc2119" title="MUST">MUST</em> not be reversed, and is assumed by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to be processed.</p><p>For <code>Order</code>s found with <code>OrderItem</code>s that contain <code>orderItemStatus</code> with new <code>https://openactive.io/CustomerCancelled</code> or <code>https://openactive.io/SellerCancelled</code> values, the new <code>totalPaymentDue</code> value of the <code>Order</code> must be made to equal the value of the associated <a href="#dfn-payment" class="internalDFN" data-link-type="dfn">Payment</a> less any <a href="#dfn-refund" class="internalDFN" data-link-type="dfn">Refunds</a>, by creating an additional <a href="#dfn-refund" class="internalDFN" data-link-type="dfn">Refunds</a> if necessary.</p><p>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> be notified after a refund is successfully processed, using the <code>orderItemStatus</code> to indicate the source of the cancellation.</p><p>If refund processing takes longer than 15 minutes, and a new status of <code>https://openactive.io/SellerCancelled</code> was detected by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, then the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> must be notified immediately of a cancellation ahead of the notification of the completed refund. This ensures the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> can rely on the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> as a notification channel in the event of cancellation. The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> be notified with the <code>cancellationMessage</code> for the <code>OrderItem</code> if provided.</p><p>Note that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="MUST">MUST</em> be notified in the event of all cancellations, even if no refund is due for free opportunities.</p></section><section id="change-of-logistics-notifications"><h4 id="x8-4-5-change-of-logistics-notifications"><span class="secno">8.4.5 </span>Change of logistics notifications<a class="self-link" aria-label="§" href="#change-of-logistics-notifications"></a></h4><p>The <code>orderedItem</code> within the <code>OrderItem</code> of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> includes an <code>id</code> reference to an opportunity, which may be found and cross-referenced with other sources of opportunity data, for example an [<cite><a class="bibref" href="#bib-rpde">RPDE</a></cite>] open feed.</p><p>This specification does not require the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> to include the full contents of the opportunities within the <code>orderedItem</code>, and hence the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> monitor the opportunity data feeds for this information and <em class="rfc2119" title="MUST">MUST</em> provide a notification to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> for substantive changes to the opportunity (e.g. changes to <code>startDate</code>).</p><div class="issue" id="issue-container-number-100"><div role="heading" class="issue-title marker" id="h-issue-2" aria-level="5"><a href="https://github.com/openactive/open-booking-api/issues/100"><span class="issue-number">Issue 100</span></a><span class="issue-label" aria-label="This issue is labelled as Community Feedback Requested.">: How much content should Orders feed provide? <a class="respec-gh-label respec-label-light" href="https://github.com/openactive/open-booking-api/issues/?q=is%3Aissue+is%3Aopen+label%3A%22Community+Feedback+Requested%22" style="background-color: rgb(150, 224, 234);">Community Feedback Requested</a></span></div><p>The Orders feed contains opportunity data references to e.g. <code>ScheduledSessions</code>.</p>
<p>In the case that the startDate changes for a booked ScheduledSession, should the Broker expect to get this update from the Orders feed, or from the other open data feeds that already include this information?</p>
<p><strong>Option 1</strong>: Orders feed focusses on financial transactions only i.e. anything that results in a cancellation or refund (feed items effectively PATCH):</p>
<ul>
<li>This greatly simplifies implementation of the Orders feed for the booking system</li>
<li>The broker needs to link updates received via the open feeds to updates in the Order items</li>
<li>The specification is tied more closely to the presence of open opportunity feeds</li>
</ul>
<p><strong>Option 2</strong>: Orders feed includes updates to logistics and transactions (feed items effectively PATCH)</p>
<ul>
<li>More complex implementation for the booking system, but still only a limited number of fields to store</li>
<li>The broker only needs to monitor the Orders feed to update Customers</li>
</ul>
<p><strong>Option 3</strong>: Orders feed includes full Order (feed items effectively PUT)</p>
<ul>
<li>Issues around GDPR if implementation causes sharing of Customer data</li>
<li>Much more complex for booking system</li>
<li>Broker can be sure they have accurate representation of Order if they lose data, as they can do an RPDE resync (however note that Broker still is required to be responsible for Invoice and payment data, so they need to have a robust store of this in any case).</li>
</ul>
<p>Based on the largest barrier to progress in OpenActive is scaling adoption/implementation on the booking system side, Option 1 has been used in this version of the specification to create the lowest possible barrier to entry for booking systems.</p></div></section></section><section id="amending-the-order-after-b"><h3 id="x8-5-amending-the-order-after-b"><span class="secno">8.5 </span>Amending the Order after <strong>B</strong><a class="self-link" aria-label="§" href="#amending-the-order-after-b"></a></h3><p><code>OrderItem</code>s cannot be replaced or added to an existing <code>Order</code> within this version of the specification. A new <code>Order</code> must be created, and the old <code>Order</code> cancelled.</p><p>For the common case of rescheduling a <code>SessionSeries</code> or <code>FacilityUse</code> booking, the following steps are recommended for the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>:</p><ol>
<li><p>Request an <code>OrderQuote</code> for the new <code>orderItem</code>s with a new UUID, using <strong>C2</strong>.</p>
</li>
<li><p>Check the latest stored state of <code>Order</code>s from the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> to ensure that old <code>orderItem</code>
<code>allowSimpleCancellation</code>.</p>
</li>
<li><p>Clearly display messaging to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> that explains that this transaction will involve a refund and new purchase, and so they will expect a refund for the old item and a new transaction for the new one. Information should be displayed to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> if any price difference exists between the two Orders, for the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> to confirm.</p>
</li>
<li><p>Request new payment details from the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> and Authorise the amount specified by <strong>C2</strong>, then DELETE the old <code>orderItem</code>, and if successful, complete <strong>B</strong> as normal.</p>
</li>
</ol><p>The new <code>Order</code> is completed as described in the new booking process, and the existing <code>Order</code> is cancelled with the refund processed as described in the next section.</p></section><section id="delivery-of-terms-and-conditions-and-privacy-policy"><h3 id="x8-6-delivery-of-terms-and-conditions-and-privacy-policy"><span class="secno">8.6 </span>Delivery of Terms and Conditions and Privacy Policy<a class="self-link" aria-label="§" href="#delivery-of-terms-and-conditions-and-privacy-policy"></a></h3><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> make the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> aware of and assent to any <code>termsOfService</code>
provided within the <code>seller</code>, <code>broker</code>, and <code>bookingService</code> (which may include
Terms and Conditions and Privacy Policy) before the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> completes <strong>B</strong>.</p><p>Since, during booking, the details of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> are provided to the
<a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="SHOULD">SHOULD</em> inform the
<a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> of this any implications with respect to GDPR and any other
data protection legislation.</p><p>Note that <code>termsOfService</code> may only be specified at the <code>seller</code>, <code>broker</code> or
<code>bookingService</code> level, and may not be provided for a specific <code>Offer</code> or <code>OrderItem</code>.</p><div class="example" id="example-5-properties-for-terms-and-conditions-and-privacy-policy">
          <div class="marker">
      <a class="self-link" href="#example-5-properties-for-terms-and-conditions-and-privacy-policy">Example 5</a><span class="example-title">: Properties for Terms and Conditions and Privacy Policy</span>
    </div>
          <pre class="hljs javascript" aria-busy="false"><span class="hljs-string">"termsOfService"</span>: [
  {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"Terms"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>
  },
  {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"Terms"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>
  }
]</pre>
        </div><p>The URLs in the example are only illustrative.</p><div class="issue" id="issue-container-number-95"><div role="heading" class="issue-title marker" id="h-issue-3" aria-level="4"><a href="https://github.com/openactive/open-booking-api/issues/95"><span class="issue-number">Issue 95</span></a><span class="issue-label" aria-label="This issue is labelled as Community Feedback Requested.">: termsOfService is only provided at an Organization level <a class="respec-gh-label respec-label-light" href="https://github.com/openactive/open-booking-api/issues/?q=is%3Aissue+is%3Aopen+label%3A%22Community+Feedback+Requested%22" style="background-color: rgb(150, 224, 234);">Community Feedback Requested</a></span></div><p>Scope reduction: <code>termsOfService</code> may now only be specified at the <code>seller</code>, <code>broker</code> or<br>
<code>bookingService</code> level, and may not be provided for a specific <code>Offer</code> or <code>OrderItem</code>.</p>
<p><code>Offer</code> or <code>OrderItem</code> level <code>termsOfService</code> is reserved for future versions of the specification.</p>
<p>Please comment if this is problematic.</p></div></section><section id="extension-point-for-including-payments"><h3 id="x8-7-extension-point-for-including-payments"><span class="secno">8.7 </span>Extension point for including payments<a class="self-link" aria-label="§" href="#extension-point-for-including-payments"></a></h3><p>In some limited circumstances it might also be desirable for an Open Booking API to act as a facade over a Booking System, Payment Processor, and Invoicing systems. For these circumstances the specification allows the API defined here to be extended via additional <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> properties in the <code>Payment</code> type used in <code>B</code> in a custom namespace, to facilitate a full payment.</p><div class="example" id="example-6-example-of-payment-extension-point">
          <div class="marker">
      <a class="self-link" href="#example-6-example-of-payment-extension-point">Example 6</a><span class="example-title">: Example of Payment extension point</span>
    </div>
          <pre class="hljs javascript" aria-busy="false"><span class="hljs-string">"payment"</span>: {
  <span class="hljs-string">"type"</span>: <span class="hljs-string">"Payment"</span>,
  <span class="hljs-string">"identifier"</span>: <span class="hljs-string">"12345678ABCD"</span>,
  <span class="hljs-string">"paymentMethod"</span>: <span class="hljs-string">"stripe:StripePayment"</span>,
  <span class="hljs-string">"stripe:token"</span>: <span class="hljs-string">"tok_KPte7942xySKBKyrBu11yEpf"</span>
},</pre>
        </div><p>Note that due to the variety of business models available in the OpenActive ecosystem, conformance to this specification requires that the use of any native payment functionality in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> be optional, and the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> always accept a lack of <code>paymentMethod</code> as indication of an external <strong>Payment Processor</strong> being used. To maximise flexibility of this extension point, <code>identifier</code> and <code>name</code> within <code>Payment</code> are <em class="rfc2119" title="NOT REQUIRED">NOT REQUIRED</em> if <code>paymentMethod</code> is specified.</p></section><section id="extension-point-for-access-control"><h3 id="x8-8-extension-point-for-access-control"><span class="secno">8.8 </span>Extension point for access control<a class="self-link" aria-label="§" href="#extension-point-for-access-control"></a></h3><p>For opportunities based at locations that have access control, it is <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> that <code>OrderItem</code> include unique access control data within <code>accessToken</code>.</p><div class="example" id="example-7-example-of-accesstoken">
          <div class="marker">
      <a class="self-link" href="#example-7-example-of-accesstoken">Example 7</a><span class="example-title">: Example of accessToken</span>
    </div>
          <pre class="hljs javascript" aria-busy="false"><span class="hljs-string">"accessToken"</span>: [
  {
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"Barcode"</span>,
    <span class="hljs-string">"text"</span>: <span class="hljs-string">"0123456789"</span>,
    <span class="hljs-string">"bookwhen:codeType"</span>: <span class="hljs-string">"code128"</span>
  }
],</pre>
        </div><p>Due to the variety of Barcode and QR code formats available, the specification expects the <code>Barcode</code> to include additional properties using a custom namespace, enough to allow the barcode to be reproduced by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>. This will help inform future versions of the specification.</p></section></section><section class="normative" id="endpoints"><!--OddPage--><h2 id="x9-endpoints"><span class="secno">9. </span>Endpoints<a class="self-link" aria-label="§" href="#endpoints"></a></h2><p>This API has been defined around the concept of URL discovery. This
allows resource URLs which match the naming conventions of each <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</p><section id="paths-and-verbs"><h3 id="x9-1-paths-and-verbs"><span class="secno">9.1 </span>Paths and Verbs<a class="self-link" aria-label="§" href="#paths-and-verbs"></a></h3><p>Due to URL discovery, the paths of the endpoints below are illustrative, as the actual paths may vary provided they are consistent within an implementation.</p><p>A summary of endpoints defined by this specification is provided below:</p><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td>Order Creation</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Order</td>
<td>PUT</td>
<td><code>/orders/{uuid}</code></td>
</tr>
<tr>
<td>Order Deletion</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Order</td>
<td>DELETE</td>
<td><code>/orders/{uuid}</code></td>
</tr>
<tr>
<td>Orders RPDE Feed</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Orders feed</td>
<td>GET</td>
<td><code>/orders-rpde</code></td>
</tr>
<tr>
<td>OrderItem Cancellation</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>OrderItem</td>
<td>PATCH</td>
<td><code>/orders/{uuid}/order-items/{order-item-id}</code></td>
</tr>
<tr>
<td>Order Status</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>Order</td>
<td>GET</td>
<td><code>/orders/{uuid}</code></td>
</tr>
</tbody></table><div class="issue" id="issue-container-number-98"><div role="heading" class="issue-title marker" id="h-issue-4" aria-level="4"><a href="https://github.com/openactive/open-booking-api/issues/98"><span class="issue-number">Issue 98</span></a><span class="issue-label" aria-label="This issue is labelled as Community Feedback Requested.">: Removal of availability check endpoint in favour of OrderQuote <a class="respec-gh-label respec-label-light" href="https://github.com/openactive/open-booking-api/issues/?q=is%3Aissue+is%3Aopen+label%3A%22Community+Feedback+Requested%22" style="background-color: rgb(150, 224, 234);">Community Feedback Requested</a></span></div><p>Since <code>SessionSeries</code> and <code>ScheduledSession</code>, and <code>FacilityUse</code> and <code>Slot</code> are often found in different RPDE feeds and due to <code>Offer</code> inheritance, constructing an object that will be useful for returning the availability of a number of slots is non-trivial.</p>
<p>Furthermore when there are a large number of available <code>Slot</code>s (e.g. for squash court) or <code>ScheduledSession</code>s (e.g Virtual RPM classes which run very frequently), the response to "get all <code>Slots</code> within the <code>FacilityUse</code>" or "get all <code>ScheduledSession</code>s within a <code>SessionSeries</code>" can be large and will likely need to be filtered further. Given this complexity, getting just the availability for a single <code>Slot</code> or <code>ScheduledSession</code> would be preferable, however due to <code>Offer</code> inheritance this can also be of limited use, and quickly converges with the functionality already available from <code>OrderQuote</code>.</p>
<p>More detail of these issues can be found here: <a class="issue-link js-issue-link" data-error-text="Failed to load issue title" data-id="365245404" data-permission-text="Issue title is private" data-url="https://github.com/openactive/open-booking-api/issues/91" data-hovercard-type="issue" data-hovercard-url="/openactive/open-booking-api/issues/91/hovercard" href="https://github.com/openactive/open-booking-api/issues/91">#91</a></p>
<p>As a result of the above complexity, this specification no longer includes the Opportunity API to retrieve aspects of the opportunity data, and relies on using RPDE feeds only to get the Customer to the point of selecting an item to begin the booking journey with.</p>
<p>Please comment here with specific use cases that would justify re-inclusion of the Opportunity API aspects here.</p></div></section><section id="request-and-response"><h3 id="x9-2-request-and-response"><span class="secno">9.2 </span>Request and Response<a class="self-link" aria-label="§" href="#request-and-response"></a></h3><p>This section includes request and response examples for each of the endpoints specified in this API.</p><section id="order-creation"><h4 id="x9-2-1-order-creation"><span class="secno">9.2.1 </span>Order Creation<a class="self-link" aria-label="§" href="#order-creation"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td>Order Creation</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Order</td>
<td>PUT</td>
<td><code>/orders/{uuid}</code></td>
</tr>
</tbody></table><p>The <dfn data-dfn-type="dfn" id="dfn-order-creation">Order Creation</dfn> is an essential part of the Booking Flow, allowing creation of an <code>Order</code> via an <code>OrderQuote</code>.</p><p>It is not possible for opportunities from different <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Sellers</a> or with different <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a> or on behalf of different <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customers</a> to be combined in the same <code>Order</code>.</p><p>Note that the <code>broker</code> property in the request body is to help the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to clarify who is making request and to help them in situations such as queries to allow reconciliation of payments. It is not designed as any part of an authentication which <em class="rfc2119" title="MUST">MUST</em> be performed outside of the JSON body of the request. Authentication tokens <em class="rfc2119" title="MUST NOT">MUST NOT</em> be present within the <code>broker</code> property of the submitted JSON.</p><p>In the situation where a middleware is used for various <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a>, independently of API key provisioning at the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> level (which in some systems is a lengthly and time-consuming process), the <code>broker</code> property <em class="rfc2119" title="SHOULD">SHOULD</em> contain the details of the end-user <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> rather than the middleware.</p><section id="orderquote"><h5 id="x9-2-1-1-orderquote"><span class="secno">9.2.1.1 </span><code>OrderQuote</code><a class="self-link" aria-label="§" href="#orderquote"></a></h5><p>A PUT request to the Order Creation endpoint of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> with an object of type <code>OrderQuote</code> will return a <code>OrderQuote</code> which represents a "dry run" of the booking, with the state of the <code>Order</code> identical to if request of type <code>Order</code> be made, without any side effects (with the exception of optional leasing).</p><p>Note that the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>&nbsp;<em class="rfc2119" title="MUST NOT">MUST NOT</em> store any personal information of the <code>customer</code> provided for the <code>OrderQuote</code> past the expiry of any associated lease created.</p><div class="example" id="example-8-order-creation-orderquote-example-request">
          <div class="marker">
      <a class="self-link" href="#example-8-order-creation-orderquote-example-request">Example 8</a><span class="example-title">: Order Creation: OrderQuote example request</span>
    </div>
          <pre class=""></pre>
        </div><p>If successful the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> will respond with an OrderQuote:</p><div class="example" id="example-9-order-creation-orderquote-example-success-response">
          <div class="marker">
      <a class="self-link" href="#example-9-order-creation-orderquote-example-success-response">Example 9</a><span class="example-title">: Order Creation: OrderQuote example success response</span>
    </div>
          <pre class=""></pre>
        </div><p>If there are any issues with the <code>orderedItem</code>s provided in the <code>OrderQuote</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond with a <code>409 Conflict</code> response, with <code>error</code> details provided against each offending <code>OrderItem</code>. Note that <code>totalPaymentDue</code> and <code>totalTaxSpecification</code> <em class="rfc2119" title="MUST">MUST</em> be calculated excluding any <code>OrderItem</code>s that include <code>error</code>s.</p><div class="example" id="example-10-order-creation-orderquote-example-failure-response">
          <div class="marker">
      <a class="self-link" href="#example-10-order-creation-orderquote-example-failure-response">Example 10</a><span class="example-title">: Order Creation: OrderQuote example failure response</span>
    </div>
          <pre class=""></pre>
        </div><p>If there are issues with other properties of the <code>OrderQuote</code> outside of <code>orderedItem</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond with a <code>400 Bad Request</code> response, which includes only the appropriate <code>Error</code>.</p></section><section id="order"><h5 id="x9-2-1-2-order"><span class="secno">9.2.1.2 </span><code>Order</code><a class="self-link" aria-label="§" href="#order"></a></h5><p>A PUT request to the Order Creation endpoint of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> with an object of type <code>Order</code> will create the <code>Order</code> and complete the booking from the point of the view of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</p><div class="example" id="example-11-order-creation-order-example-request">
          <div class="marker">
      <a class="self-link" href="#example-11-order-creation-order-example-request">Example 11</a><span class="example-title">: Order Creation: Order example request</span>
    </div>
          <pre class=""></pre>
        </div><p>If successful the server will respond with the location of a newly created <code>Order</code> resource:</p><div class="example" id="example-12-order-creation-order-example-minimal-response">
          <div class="marker">
      <a class="self-link" href="#example-12-order-creation-order-example-minimal-response">Example 12</a><span class="example-title">: Order Creation: Order example minimal response</span>
    </div>
          <pre class=""></pre>
        </div><p>Both <code>OrderQuote</code> and <code>Order</code> responses can optionally reflect back properties provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> for completeness, for example:</p><div class="example" id="example-13-order-creation-order-example-full-response">
          <div class="marker">
      <a class="self-link" href="#example-13-order-creation-order-example-full-response">Example 13</a><span class="example-title">: Order Creation: Order example full response</span>
    </div>
          <pre class=""></pre>
        </div><p>If there are issues any properties of the <code>Order</code>, including the <code>orderedItem</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> respond with a <code>400 Bad Request</code> response which includes only the appropriate <code>Error</code>. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> is expected to retry the <code>OrderQuote</code> to get specific <code>orderedItem</code> level errors.</p></section></section><section id="order-deletion"><h4 id="x9-2-2-order-deletion"><span class="secno">9.2.2 </span>Order Deletion<a class="self-link" aria-label="§" href="#order-deletion"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td>Order Deletion</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Order</td>
<td>DELETE</td>
<td><code>/orders/{uuid}</code></td>
</tr>
</tbody></table><p>Deleting an <code>Order</code> allows for the whole Booking Flow to be reversed for fatal error and testing scenarios.</p><p>When an <code>Order</code> is deleted the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> must soft delete it as if it was not created, rolling back the Booking Flow.</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> use Order Deletion for cancellation, but instead only use it in the unusual case of a fatal error or testing. An appropriate approach for cancellation is
defined elsewhere.</p><p>The corresponding <code>Order</code> <em class="rfc2119" title="MUST">MUST</em> be marked as <code>deleted</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>.</p><div class="example" id="example-14-order-deletion-example-request">
          <div class="marker">
      <a class="self-link" href="#example-14-order-deletion-example-request">Example 14</a><span class="example-title">: Order Deletion: example request</span>
    </div>
          <pre class=""></pre>
        </div><div class="example" id="example-15-order-deletion-example-response">
          <div class="marker">
      <a class="self-link" href="#example-15-order-deletion-example-response">Example 15</a><span class="example-title">: Order Deletion: example response</span>
    </div>
          <pre class=""></pre>
        </div></section><section id="orders-rpde-feed"><h4 id="x9-2-3-orders-rpde-feed"><span class="secno">9.2.3 </span>Orders RPDE Feed<a class="self-link" aria-label="§" href="#orders-rpde-feed"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td>Orders RPDE Feed</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Orders feed</td>
<td>GET</td>
<td><code>/orders-rpde</code></td>
</tr>
</tbody></table><div class="example" id="example-16-order-rpde-feed-example-request">
          <div class="marker">
      <a class="self-link" href="#example-16-order-rpde-feed-example-request">Example 16</a><span class="example-title">: Order RPDE Feed: example request</span>
    </div>
          <pre class=""></pre>
        </div><div class="example" id="example-17-order-rpde-feed-example-response">
          <div class="marker">
      <a class="self-link" href="#example-17-order-rpde-feed-example-response">Example 17</a><span class="example-title">: Order RPDE Feed: example response</span>
    </div>
          <pre class=""></pre>
        </div></section><section id="orderitem-cancellation"><h4 id="x9-2-4-orderitem-cancellation"><span class="secno">9.2.4 </span>OrderItem Cancellation<a class="self-link" aria-label="§" href="#orderitem-cancellation"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td>OrderItem Cancellation</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>OrderItem</td>
<td>PATCH</td>
<td><code>/orders/{uuid}/order-items/{order-item-id}</code></td>
</tr>
</tbody></table><div class="example" id="example-18-orderitem-cancellation-example-request">
          <div class="marker">
      <a class="self-link" href="#example-18-orderitem-cancellation-example-request">Example 18</a><span class="example-title">: OrderItem Cancellation: example request</span>
    </div>
          <pre class=""></pre>
        </div><div class="example" id="example-19-orderitem-cancellation-example-response">
          <div class="marker">
      <a class="self-link" href="#example-19-orderitem-cancellation-example-response">Example 19</a><span class="example-title">: OrderItem Cancellation: example response</span>
    </div>
          <pre class=""></pre>
        </div></section><section id="order-status"><h4 id="x9-2-5-order-status"><span class="secno">9.2.5 </span>Order Status<a class="self-link" aria-label="§" href="#order-status"></a></h4><p>A <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MAY">MAY</em> provide an endpoint to allow a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to retrieve complete <code>Order</code>s. In future versions of the specification, endpoints may be provided which permit a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to see all <code>Order</code>s created by a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>. In this current implementation, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> <em class="rfc2119" title="MUST">MUST</em> keep its own record of <code>Order</code>s as described elsewhere in this specification, and not rely on this <em class="rfc2119" title="OPTIONAL">OPTIONAL</em> Order Status endpoint.</p><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Example Path</th>
</tr>
</thead>
<tbody><tr>
<td>Order Status</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>Order</td>
<td>GET</td>
<td><code>/orders/{uuid}</code></td>
</tr>
</tbody></table><div class="example" id="example-20-order-status-example-request">
          <div class="marker">
      <a class="self-link" href="#example-20-order-status-example-request">Example 20</a><span class="example-title">: Order Status: example request</span>
    </div>
          <pre class=""></pre>
        </div><div class="example" id="example-21-order-status-example-response">
          <div class="marker">
      <a class="self-link" href="#example-21-order-status-example-response">Example 21</a><span class="example-title">: Order Status: example response</span>
    </div>
          <pre class=""></pre>
        </div></section><section id="url-discovery"><h4 id="x9-2-6-url-discovery"><span class="secno">9.2.6 </span>URL discovery<a class="self-link" aria-label="§" href="#url-discovery"></a></h4><p>The URL for the initial Order Creation action <em class="rfc2119" title="MUST">MUST</em> be discoverable by parsing the
<code>OpenBookingAction</code> defined in the <code>potentialAction</code> property of the published
<code>Dataset</code> embedded within dataset site.</p><p>The <code>EntryPoint</code> object <em class="rfc2119" title="MUST">MUST</em> state the <code>url</code> of the Order Creation endpoint, and <em class="rfc2119" title="MUST">MUST</em>
contain the <code>encodingType</code> and the <code>httpMethod</code> as <code>PUT</code>.</p><div class="example" id="example-22-example-of-a-potentialaction">
          <div class="marker">
      <a class="self-link" href="#example-22-example-of-a-potentialaction">Example 22</a><span class="example-title">: Example of a potentialAction</span>
    </div>
          <pre class=""></pre>
        </div><p>Since discovery of URLs is an implicit part of the specification, <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a>
<em class="rfc2119" title="SHOULD">SHOULD</em> avoid hard-coding URLs for specific actions into their applications and
client libraries. <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Brokers</a> <em class="rfc2119" title="SHOULD">SHOULD</em> use most applicable URL discovered at the
point in the workflow they are currently in - e.g. not use a cached URL that has
been previously successfully used. They should also not attempt to create URLs
for a specific action based on patterns within previously used URLs.</p><p>It is the responsibility of <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> to advertise the URL for
further activity in the booking workflow at the point of need. For example they
<em class="rfc2119" title="MUST">MUST</em> advertise the URL for the <code>OrderItem</code> resource in the Orders <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>
by including the <code>id</code> property within the <code>OrderItem</code>.</p><div class="issue" id="issue-container-number-94"><div role="heading" class="issue-title marker" id="h-issue-5" aria-level="5"><a href="https://github.com/openactive/open-booking-api/issues/94"><span class="issue-number">Issue 94</span></a><span class="issue-label" aria-label="This issue is labelled as Community Feedback Requested.">: URL Discovery using the Dataset Site <a class="respec-gh-label respec-label-light" href="https://github.com/openactive/open-booking-api/issues/?q=is%3Aissue+is%3Aopen+label%3A%22Community+Feedback+Requested%22" style="background-color: rgb(150, 224, 234);">Community Feedback Requested</a></span></div><p>The specification proposes to centralise URL discovery in the Dataset site, along with the feeds themselves.</p>
<p>Feedback on this approach welcome.</p></div><section id="example"><h5 id="x9-2-6-1-example"><span class="secno">9.2.6.1 </span>Example<a class="self-link" aria-label="§" href="#example"></a></h5><div class="example" id="example-23-example-of-dataset-site-embedded-json-ld">
          <div class="marker">
      <a class="self-link" href="#example-23-example-of-dataset-site-embedded-json-ld">Example 23</a><span class="example-title">: Example of Dataset site embedded JSON-LD</span>
    </div>
          <pre class=""></pre>
        </div></section></section></section></section><section class="normative" id="model"><!--OddPage--><h2 id="x10-model"><span class="secno">10. </span>Model<a class="self-link" aria-label="§" href="#model"></a></h2><p>These models are designed compatible with [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>], and includes conformance criteria that are both stricter and more relaxed when existing models are used in the context of this specification.</p><section id="order-model"><h3 id="x10-1-order-model"><span class="secno">10.1 </span>Order Model<a class="self-link" aria-label="§" href="#order-model"></a></h3><section id="schema-order"><h4 id="x10-1-1-schema-order"><span class="secno">10.1.1 </span><code>schema:Order</code><a class="self-link" aria-label="§" href="#schema-order"></a></h4><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Orders feed</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Order</code></td>
</tr>
<tr>
<td><code>@id</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>URI</td>
<td>A URI providing a unique identifier for the resource, which <em class="rfc2119" title="MUST">MUST</em> match the PUT URL containing the UUID</td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Integer"><code>schema:Integer</code></a>, <a href="https://schema.org/Text"><code>schema:Text</code></a>, <a href="https://schema.org/PropertyValue"><code>schema:PropertyValue</code></a> or an array of <a href="https://schema.org/PropertyValue"><code>schema:PropertyValue</code></a></td>
<td>A local identifier for the tax charge, used to identify the type of tax within the booking system. Note an array of <code>PropertyValue</code> can be used to provide multiple identifiers where available. -</td>
</tr>
<tr>
<td><a href="http://schema.org/seller"><code>schema:seller</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Organization"><code>schema:Organization</code></a></td>
<td>The organisation providing access to events or facilities via a booking system. e.g. a leisure provider running yoga classes.</td>
</tr>
<tr>
<td><a href="https://openactive.io/taxMode"><code>oa:taxMode</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://openactive.io/TaxMode"><code>oa:TaxMode</code></a></td>
<td>Either <code>https://openactive/TaxNet</code> or <code>https://openactive/TaxGross</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/broker"><code>oa:broker</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Organization"><code>schema:Organization</code></a></td>
<td>The organisation or developer providing an application that allows <strong>Customers</strong> to make bookings. Those applications will be clients of the API defined in this specification.</td>
</tr>
<tr>
<td><a href="https://openactive.io/brokerRole"><code>oa:brokerRole</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://openactive.io/BrokerType"><code>oa:BrokerType</code></a></td>
<td>Either <code>https://openactive/AgentBroker</code>, <code>https://openactive/ResellerBroker</code> or <code>https://openactive/NoBroker</code>.</td>
</tr>
<tr>
<td><a href="http://schema.org/orderNumber"><code>schema:orderNumber</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The Customer-facing identifier of the <code>Order</code>.</td>
</tr>
<tr>
<td><a href="http://schema.org/customer"><code>schema:customer</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td>-</td>
<td><a href="https://schema.org/Organization"><code>schema:Organization</code></a> or a <a href="https://schema.org/Person"><code>schema:Person</code></a></td>
<td>The person or organization purchasing the Order. <em class="rfc2119" title="MUST">MUST</em> be either an .</td>
</tr>
<tr>
<td><a href="https://openactive.io/bookingService"><code>oa:bookingService</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://openactive.io/BookingService"><code>oa:BookingService</code></a></td>
<td>Details about the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a></td>
</tr>
<tr>
<td><a href="http://schema.org/orderedItem"><code>schema:orderedItem</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Array of <a href="http://schema.org/OrderItem"><code>schema:OrderItem</code></a></td>
<td>The items that constitute the <code>Order</code></td>
</tr>
<tr>
<td><a href="http://schema.org/totalPaymentDue"><code>schema:totalPaymentDue</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="http://schema.org/PriceSpecification"><code>schema:PriceSpecification</code></a></td>
<td>The total price of the <code>Order</code>, which includes or excludes tax depending on the <code>taxMode</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/totalTaxSpecification"><code>oa:totalTaxSpecification</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Array of <a href="https://openactive.io/TaxChargeSpecification"><code>oa:TaxChargeSpecification</code></a></td>
<td>Breakdown of tax payable for the Order.</td>
</tr>
<tr>
<td><a href="https://openactive.io/payment"><code>oa:payment</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://openactive.io/Payment"><code>oa:Payment</code></a></td>
<td>The payment associated with the Order by the Broker</td>
</tr>
</tbody></table><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> is <em class="rfc2119" title="NOT REQUIRED">NOT REQUIRED</em> to reflect the properties provided at <strong>B</strong> back to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, so the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> must store any details sent alongside the <code>Order</code> response.</p></section><section id="oa-orderquote"><h4 id="x10-1-2-oa-orderquote"><span class="secno">10.1.2 </span><code>oa:OrderQuote</code><a class="self-link" aria-label="§" href="#oa-orderquote"></a></h4><p><code>OrderQuote</code> subclasses <code>Order</code>, and includes of the above properties as specified for <code>Order</code> with the addition of <code>oa:lease</code> and without <code>oa:payment</code>:</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>OrderQuote</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/lease"><code>oa:lease</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://openactive.io/Lease"><code>oa:Lease</code></a></td>
<td>The lease on the OrderItems which lasts for the duration specified by the booking system.</td>
</tr>
<tr>
<td><a href="https://openactive.io/payment"><code>oa:payment</code></a></td>
<td>-</td>
<td>-</td>
<td><a href="https://openactive.io/Payment"><code>oa:Payment</code></a></td>
<td>Payment is not expected for <code>OrderQuote</code></td>
</tr>
</tbody></table></section><section id="schema-organization-for-seller"><h4 id="x10-1-3-schema-organization-for-seller"><span class="secno">10.1.3 </span><code>schema:Organization</code> for <code>seller</code><a class="self-link" aria-label="§" href="#schema-organization-for-seller"></a></h4><p>The <code>seller</code> <em class="rfc2119" title="MUST">MUST</em> be a <code>schema:Organization</code> with the following properties, in order for tax receipts to be successfully generated.</p><p>The <code>seller</code> is specified with each <code>Order</code> to account for scenarios where multiple <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> brands are in use.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Organization</code></td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> used by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Trading name of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/legalName"><code>schema:legalName</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Legal name of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, used on tax receipts.</td>
</tr>
<tr>
<td><a href="http://schema.org/email"><code>schema:email</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Email address used to contact the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/taxMode"><code>oa:taxMode</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://openactive.io/TaxMode"><code>oa:TaxMode</code></a></td>
<td>Either <code>https://openactive/TaxNet</code> or <code>https://openactive/TaxGross</code></td>
</tr>
<tr>
<td><a href="http://schema.org/vatID"><code>schema:vatID</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The Value-added Tax ID of the of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/telephone"><code>schema:telephone</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Telephone number of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/url"><code>schema:url</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The URL of the website of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/logo"><code>schema:logo</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/ImageObject"><code>schema:ImageObject</code></a></td>
<td>Logo of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, used on tax receipts.</td>
</tr>
<tr>
<td><a href="http://schema.org/address"><code>schema:address</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/PostalAddress"><code>schema:PostalAddress</code></a></td>
<td>Address of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>, used on tax receipts.</td>
</tr>
<tr>
<td><a href="http://schema.org/termsOfService"><code>schema:termsOfService</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>Array of <a href="https://openactive.io/Terms"><code>oa:Terms</code></a></td>
<td>The terms of service of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a>.</td>
</tr>
</tbody></table></section><section id="schema-organization-for-broker"><h4 id="x10-1-4-schema-organization-for-broker"><span class="secno">10.1.4 </span><code>schema:Organization</code> for <code>broker</code><a class="self-link" aria-label="§" href="#schema-organization-for-broker"></a></h4><p>The <code>broker</code> <em class="rfc2119" title="MUST">MUST</em> be a <code>schema:Organization</code> with the following properties, in order for the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to represent the third-party booking.</p><p>The <code>broker</code> is specified with each <code>Order</code> to account for scenarios where multiple <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> brands are in use.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Organization</code></td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the brand used by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Name of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/email"><code>schema:email</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Support email address used to contact the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/telephone"><code>schema:telephone</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Support telephone number of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/url"><code>schema:url</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The URL of the website of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/logo"><code>schema:logo</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/ImageObject"><code>schema:ImageObject</code></a></td>
<td>Logo of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, used within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/termsOfService"><code>schema:termsOfService</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td>Array of <a href="https://openactive.io/Terms"><code>oa:Terms</code></a></td>
<td>The terms of service of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</td>
</tr>
</tbody></table></section><section id="schema-orderitem"><h4 id="x10-1-5-schema-orderitem"><span class="secno">10.1.5 </span><code>schema:OrderItem</code><a class="self-link" aria-label="§" href="#schema-orderitem"></a></h4><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>OrderItem</code></td>
</tr>
<tr>
<td><code>@id</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>A URI providing a unique identifier for the OrderItem</td>
</tr>
<tr>
<td><a href="http://schema.org/orderItemStatus"><code>schema:orderItemStatus</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/OrderStatus"><code>schema:OrderStatus</code></a></td>
<td>Either <code>https://openactive.io/SellerCancelled</code>, <code>https://openactive.io/CustomerCancelled</code>, or <code>https://openactive.io/OrderConfirmed</code></td>
</tr>
<tr>
<td><a href="http://schema.org/orderQuanity"><code>schema:orderQuanity</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Integer"><code>schema:Integer</code></a></td>
<td><em class="rfc2119" title="MUST NOT">MUST NOT</em> be used for <code>Order</code> responses.</td>
</tr>
<tr>
<td><a href="https://openactive.io/allowSimpleCancellation"><code>oa:allowSimpleCancellation</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Boolean"><code>schema:Boolean</code></a></td>
<td>Whether the event can be cancelled.</td>
</tr>
<tr>
<td><a href="https://openactive.io/unitTaxSpecification"><code>oa:unitTaxSpecification</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Array of <a href="https://openactive.io/TaxChargeSpecification"><code>oa:TaxChargeSpecification</code></a></td>
<td>Breakdown of tax payable for the OrderItem.</td>
</tr>
<tr>
<td><a href="http://schema.org/acceptedOffer"><code>schema:acceptedOffer</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Offer"><code>schema:Offer</code></a></td>
<td>The offer from the associated <code>orderedItem</code> that has been selected by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>. The price of which includes or excludes tax depending on the <code>taxMode</code> of the <code>Order</code>.</td>
</tr>
<tr>
<td><a href="http://schema.org/orderedItem"><code>schema:orderedItem</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://openactive.io/ScheduledSession"><code>oa:ScheduledSession</code></a>, <a href="https://openactive.io/Slot"><code>oa:Slot</code></a>, <a href="https://openactive.io/HeadlineEvent"><code>oa:HeadlineEvent</code></a>, <a href="https://schema.org/Event"><code>schema:Event</code></a> or <a href="https://schema.org/CourseInstance"><code>schema:CourseInstance</code></a></td>
<td>The specific bookable Thing that has been selected by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>. See the [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>] for more information on these types. Note that the Broker Request and Orders feed only requires <code>id</code> within these objects to be included, all other properties are ignored.</td>
</tr>
<tr>
<td><a href="https://openactive.io/accessToken"><code>oa:accessToken</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>Array of <a href="https://schema.org/Barcode"><code>schema:Barcode</code></a></td>
<td><code>Barcode</code> that contains reference to an asset (e.g. Barcode, QR code image or PDF) usable for entrance, not applicable for an <code>OrderQuote</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/error"><code>oa:error</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Array of <a href="https://openactive.io/Error"><code>oa:Error</code></a></td>
<td>Array of errors related to the OrderItem being included in the Order, only applicable for an <code>OrderQuote</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/cancellationMessage"><code>oa:cancellationMessage</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A message set by the Seller in the event of opportunity cancellation, only applicable for an <code>Order</code> and where the <code>OrderItem</code> has <code>orderItemStatus</code> set to <code>https://openactive.io/SellerCancelled</code></td>
</tr>
</tbody></table><p>Note that <a href="http://schema.org/orderQuantity"><code>schema:orderQuantity</code></a> is not supported in this version of the specification.</p></section><section id="schema-offer"><h4 id="x10-1-6-schema-offer"><span class="secno">10.1.6 </span><code>schema:Offer</code><a class="self-link" aria-label="§" href="#schema-offer"></a></h4><p>Use of properties of <code>Offer</code> defined in the [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>] are also encouraged.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Offer</code></td>
</tr>
<tr>
<td><code>@id</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>A URI providing a unique identifier for the Offer</td>
</tr>
<tr>
<td><a href="http://schema.org/price"><code>schema:price</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Float"><code>schema:Float</code></a></td>
<td>The offer price available to participants, which includes or excludes tax depending on the <code>taxMode</code> of the <code>Order</code>.</td>
</tr>
<tr>
<td><a href="http://schema.org/priceCurrency"><code>schema:priceCurrency</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The currency of the <code>price</code>. Specified as a 3-letter ISO 4217 value. If a <code>PriceSpecification</code> has a zero <code>price</code>, then this property is not required. Otherwise the <code>priceCurrency</code> <em class="rfc2119" title="MUST">MUST</em> be specified.</td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The name of the offer suitable for display to participants.</td>
</tr>
<tr>
<td><a href="https://openactive.io/availableChannel"><code>oa:availableChannel</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Array of <a href="https://openactive.io/AvailableChannelType"><code>oa:AvailableChannelType</code></a></td>
<td>Can include <code>https://openactive.io/OpenBookingPrepayment</code>, <code>https://openactive.io/TelephoneAdvanceBooking</code>, <code>https://openactive.io/TelephonePrepayment</code>, <code>https://openactive.io/OnlinePrepayment</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/validFromBeforeStartDate"><code>oa:validFromBeforeStartDate</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Duration"><code>schema:Duration</code></a></td>
<td>The duration before the <code>startDate</code> for which this Offer is valid, given in [ISO8601] format. This is a relative equivalent of <a href="http://schema.org/validFrom"><code>schema:validFrom</code></a>, to allow for Offer inheritance.</td>
</tr>
<tr>
<td><a href="https://openactive.io/latestCancellationBeforeStartDate"><code>oa:latestCancellationBeforeStartDate</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Duration"><code>schema:Duration</code></a></td>
<td>The duration before the <code>startDate</code> during which this Offer may <strong>not</strong> be cancelled, given in [ISO8601] format.</td>
</tr>
</tbody></table><p>Note that for an <code>Offer</code> to be bookable under this specification, <code>availableChannel</code> must include <code>https://openactive.io/OpenBookingPrepayment</code>.</p></section><section id="schema-person"><h4 id="x10-1-7-schema-person"><span class="secno">10.1.7 </span><code>schema:Person</code><a class="self-link" aria-label="§" href="#schema-person"></a></h4><p>For business-to-consumer transactions, the <code>customer</code> <em class="rfc2119" title="MUST">MUST</em> be a <code>schema:Person</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Person</code></td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> used by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and/or <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/email"><code>schema:email</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Email address used to uniquely identify the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/givenName"><code>schema:givenName</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Name of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/familyName"><code>schema:familyName</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Name of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/telephone"><code>schema:telephone</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Telephone number of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
</tbody></table><p>Note that the <code>Person</code> is not sent to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, only received by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, to avoid any inadvertent data sharing between <strong>Brokers</strong> when the properties of the <code>Person</code> are updated. It is strongly <em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em> that the personal data received by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> be treated as a "guest checkout" and is not used to create a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> record in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</p><p>In this current iteration of the Booking API specification, the programmatic creation of <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> records on the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> is considered to be out of scope.</p><p>For conformance with this specification the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST NOT">MUST NOT</em> require more data about the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> than is specified as <em class="rfc2119" title="REQUIRED">REQUIRED</em> properties above.</p><div class="issue" id="issue-container-number-99"><div role="heading" class="issue-title marker" id="h-issue-6" aria-level="5"><a href="https://github.com/openactive/open-booking-api/issues/99"><span class="issue-number">Issue 99</span></a><span class="issue-label" aria-label="This issue is labelled as Community Feedback Requested.">: Only require e-mail for b2c booking <a class="respec-gh-label respec-label-light" href="https://github.com/openactive/open-booking-api/issues/?q=is%3Aissue+is%3Aopen+label%3A%22Community+Feedback+Requested%22" style="background-color: rgb(150, 224, 234);">Community Feedback Requested</a></span></div><p>Following conventions of e-commerce guest checkouts that require only e-mail address (e.g. <a rel="nofollow" href="https://stripe.com/payments/checkout">https://stripe.com/payments/checkout</a>), and in the spirit of GDPR only requiring a minimum of personal data to be captured for provision of a service, this specification has only "e-mail address" as a required field.</p>
<p>This also removes complexity in some systems where an e-mail address may be shared by multiple family members, as the <code>Person</code> is not named.</p>
<p>Please comment with use cases that require the more than just "e-mail" to be captured for a guest checkout transaction.</p></div></section><section id="schema-organization-for-customer"><h4 id="x10-1-8-schema-organization-for-customer"><span class="secno">10.1.8 </span><code>schema:Organization</code> for <code>customer</code><a class="self-link" aria-label="§" href="#schema-organization-for-customer"></a></h4><p>For business-to-business transactions, the <code>customer</code> <em class="rfc2119" title="MUST">MUST</em> be a <code>schema:Organization</code> with the following properties.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Organization</code></td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> used by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and/or <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/email"><code>schema:email</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Email address used to uniquely identify the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Name of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/telephone"><code>schema:telephone</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Telephone number of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/address"><code>schema:address</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/PostalAddress"><code>schema:PostalAddress</code></a></td>
<td>Address of the business <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>.</td>
</tr>
</tbody></table></section><section id="schema-postaladdress"><h4 id="x10-1-9-schema-postaladdress"><span class="secno">10.1.9 </span><code>schema:PostalAddress</code><a class="self-link" aria-label="§" href="#schema-postaladdress"></a></h4><p>For <code>schema:Organization</code> when used for <code>customer</code> or <code>seller</code>, the following properties are required.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>PostalAddress</code></td>
</tr>
<tr>
<td><a href="http://schema.org/streetAddress"><code>schema:streetAddress</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Street address</td>
</tr>
<tr>
<td><a href="http://schema.org/addressLocality"><code>schema:addressLocality</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Town or other area</td>
</tr>
<tr>
<td><a href="http://schema.org/addressRegion"><code>schema:addressRegion</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Region</td>
</tr>
<tr>
<td><a href="http://schema.org/postalCode"><code>schema:postalCode</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Postcode</td>
</tr>
<tr>
<td><a href="http://schema.org/addressCountry"><code>schema:addressCountry</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>ISO 3166-1 alpha-2 country code.</td>
</tr>
</tbody></table></section><section id="oa-lease"><h4 id="x10-1-10-oa-lease"><span class="secno">10.1.10 </span><code>oa:Lease</code><a class="self-link" aria-label="§" href="#oa-lease"></a></h4><p>Used for <code>lease</code>. An object is provided for extensibility.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Lease</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/leaseExpires"><code>oa:leaseExpires</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/DateTime"><code>schema:DateTime</code></a></td>
<td>Expiry DateTime of the lease in [ISO8601] format</td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the payment held by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and/or <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>.</td>
</tr>
</tbody></table></section><section id="schema-pricespecification"><h4 id="x10-1-11-schema-pricespecification"><span class="secno">10.1.11 </span><code>schema:PriceSpecification</code><a class="self-link" aria-label="§" href="#schema-pricespecification"></a></h4><p>Used for <code>totalPaymentDue</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>PriceSpecification</code></td>
</tr>
<tr>
<td><a href="http://schema.org/price"><code>schema:price</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Float"><code>schema:Float</code></a></td>
<td>The total amount.</td>
</tr>
<tr>
<td><a href="http://schema.org/priceCurrency"><code>schema:priceCurrency</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The currency of the <code>price</code>. Specified as a 3-letter ISO 4217 value. If a <code>PriceSpecification</code> has a zero <code>price</code>, then this property is not required. Otherwise the <code>priceCurrency</code> <em class="rfc2119" title="MUST">MUST</em> be specified.</td>
</tr>
</tbody></table></section><section id="oa-taxchargespecification"><h4 id="x10-1-12-oa-taxchargespecification"><span class="secno">10.1.12 </span><code>oa:TaxChargeSpecification</code><a class="self-link" aria-label="§" href="#oa-taxchargespecification"></a></h4><p><code>TaxChargeSpecification</code> subclasses <code>PriceSpecification</code>, and so includes the same properties and a few additional ones. These are listed below.</p><p><code>TaxChargeSpecification</code> are intended to be rendered to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> as-is, and are not designed to be manipulated by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>TaxChargeSpecification</code></td>
</tr>
<tr>
<td><a href="http://schema.org/price"><code>schema:price</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Float"><code>schema:Float</code></a></td>
<td>The monetary value of the tax charge.</td>
</tr>
<tr>
<td><a href="http://schema.org/priceCurrency"><code>schema:priceCurrency</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The currency of the tax charge. Specified as a 3-letter ISO 4217 value. If an tax charge has a zero <code>price</code>, then this property is not required. Otherwise the <code>priceCurrency</code> <em class="rfc2119" title="MUST">MUST</em> be specified.</td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Integer"><code>schema:Integer</code></a>, <a href="https://schema.org/Text"><code>schema:Text</code></a>, <a href="https://schema.org/PropertyValue"><code>schema:PropertyValue</code></a> or an array of <a href="https://schema.org/PropertyValue"><code>schema:PropertyValue</code></a></td>
<td>A local identifier for the tax charge, used to identify the type of tax within the booking system. Note an array of <code>PropertyValue</code> can be used to provide multiple identifiers where available.</td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The name of the tax charge, e.g. "VAT at 0% for EU transactions"</td>
</tr>
<tr>
<td><a href="https://openactive.io/rate"><code>oa:rate</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Float"><code>schema:Float</code></a></td>
<td>The rate of VAT.</td>
</tr>
</tbody></table></section><section id="oa-payment"><h4 id="x10-1-13-oa-payment"><span class="secno">10.1.13 </span><code>oa:Payment</code><a class="self-link" aria-label="§" href="#oa-payment"></a></h4><p>Used for <code>payment</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Payment</code></td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Optional free text description of the payment method for the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>, to help the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn">Seller</a> in discussions with the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> (e.g. "AcmeBroker Points" or "AcmeBroker via Credit Card")</td>
</tr>
<tr>
<td><a href="http://schema.org/identifier"><code>schema:identifier</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the payment held by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and/or <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn">Payment Provider</a>.</td>
</tr>
</tbody></table><p>Note that <code>identifier</code> and are <em class="rfc2119" title="NOT REQUIRED">NOT REQUIRED</em> if <code>paymentMethod</code> is specified, to maximise flexibility of the payments extension point.</p></section><section id="oa-bookingservice"><h4 id="x10-1-14-oa-bookingservice"><span class="secno">10.1.14 </span><code>oa:BookingService</code><a class="self-link" aria-label="§" href="#oa-bookingservice"></a></h4><p><code>oa:BookingService</code> subclasses <code>schema:Service</code>.</p><p>Used for <code>bookingService</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>BookingService</code></td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The name of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a></td>
</tr>
<tr>
<td><a href="http://schema.org/url"><code>schema:url</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The URL of the website of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
</tr>
<tr>
<td><a href="http://schema.org/termsOfService"><code>schema:termsOfService</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>Array of <a href="https://openactive.io/Terms"><code>oa:Terms</code></a></td>
<td>The terms of service of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
</tr>
</tbody></table></section><section id="oa-terms"><h4 id="x10-1-15-oa-terms"><span class="secno">10.1.15 </span><code>oa:Terms</code><a class="self-link" aria-label="§" href="#oa-terms"></a></h4><p>Used for <code>termsOfService</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Terms</code></td>
</tr>
<tr>
<td><a href="http://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The name of the terms which must distinguish this from other terms provided, e.g. "Terms and Conditions" or "Privacy Policy"</td>
</tr>
<tr>
<td><a href="http://schema.org/url"><code>schema:url</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The URL of the webpage containing the contents of the terms.</td>
</tr>
</tbody></table></section></section><section id="discovery-model"><h3 id="x10-2-discovery-model"><span class="secno">10.2 </span>Discovery Model<a class="self-link" aria-label="§" href="#discovery-model"></a></h3><section id="oa-openbookingaction"><h4 id="x10-2-1-oa-openbookingaction"><span class="secno">10.2.1 </span><code>oa:OpenBookingAction</code><a class="self-link" aria-label="§" href="#oa-openbookingaction"></a></h4><p><code>oa:OpenBookingAction</code> subclasses <code>schema:OrderAction</code>.</p><p>Used for <code>potentialAction</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>OpenBookingAction</code></td>
</tr>
<tr>
<td><a href="http://schema.org/target"><code>schema:target</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/EntryPoint"><code>schema:EntryPoint</code></a></td>
<td>The Order Creation endpoint</td>
</tr>
<tr>
<td><a href="http://schema.org/supportingData"><code>schema:supportingData</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/DataFeed"><code>schema:DataFeed</code></a></td>
<td>The <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>.</td>
</tr>
</tbody></table></section><section id="schema-entrypoint"><h4 id="x10-2-2-schema-entrypoint"><span class="secno">10.2.2 </span><code>schema:EntryPoint</code><a class="self-link" aria-label="§" href="#schema-entrypoint"></a></h4><p>Used for <code>target</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>EntryPoint</code></td>
</tr>
<tr>
<td><a href="http://schema.org/urlTemplate"><code>schema:urlTemplate</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>An [<cite><a class="bibref" href="#bib-rfc6570">RFC6570</a></cite>] compliant URI template that can be used to generate a unique URL for the <code>Order</code> from a {uuid} parameter.</td>
</tr>
<tr>
<td><a href="http://schema.org/encodingType"><code>schema:encodingType</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Array of <a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The versions of Open Booking supported.</td>
</tr>
<tr>
<td><a href="http://schema.org/httpMethod"><code>schema:httpMethod</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Always <code>PUT</code></td>
</tr>
</tbody></table></section><section id="schema-datafeed-for-supportingdata"><h4 id="x10-2-3-schema-datafeed-for-supportingdata"><span class="secno">10.2.3 </span><code>schema:DataFeed</code> for <code>supportingData</code><a class="self-link" aria-label="§" href="#schema-datafeed-for-supportingdata"></a></h4><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>DataFeed</code></td>
</tr>
<tr>
<td><a href="http://schema.org/distribution"><code>schema:distribution</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Array of <a href="https://schema.org/DataDownload"><code>schema:DataDownload</code></a></td>
<td>Versions of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a> feed available</td>
</tr>
</tbody></table></section><section id="schema-datadownload"><h4 id="x10-2-4-schema-datadownload"><span class="secno">10.2.4 </span><code>schema:DataDownload</code><a class="self-link" aria-label="§" href="#schema-datadownload"></a></h4><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>DataDownload</code></td>
</tr>
<tr>
<td><a href="http://schema.org/contentUrl"><code>schema:contentUrl</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The base URL of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a></td>
</tr>
<tr>
<td><a href="http://schema.org/additionalType"><code>schema:additionalType</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>Always <code>https://schema.org/Order</code>.</td>
</tr>
<tr>
<td><a href="http://schema.org/encodingFormat"><code>schema:encodingFormat</code></a></td>
<td>-</td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Array of <a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The versions of Open Booking supported by this feed.</td>
</tr>
</tbody></table></section></section><section id="error-model"><h3 id="x10-3-error-model"><span class="secno">10.3 </span>Error Model<a class="self-link" aria-label="§" href="#error-model"></a></h3><section id="oa-error"><h4 id="x10-3-1-oa-error"><span class="secno">10.3.1 </span><code>oa:Error</code><a class="self-link" aria-label="§" href="#oa-error"></a></h4><table>
<thead>
<tr>
<th>Property</th>
<th>Status</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Error</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/error"><code>oa:error</code></a></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td>Array of <a href="https://openactive.io/OpenBookingError"><code>oa:OpenBookingError</code></a></td>
<td>An array of errors related to the request.</td>
</tr>
</tbody></table></section><section id="oa-openbookingerror"><h4 id="x10-3-2-oa-openbookingerror"><span class="secno">10.3.2 </span><code>oa:OpenBookingError</code><a class="self-link" aria-label="§" href="#oa-openbookingerror"></a></h4><table>
<thead>
<tr>
<th>Property</th>
<th>Status</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119" title="REQUIRED">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Error</code></td>
</tr>
<tr>
<td><a href="https://schema.org/name"><code>schema:name</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A short, human-readable summary of the problem type. It <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> change from occurrence to occurrence of the problem, except for purposes of localization</td>
</tr>
<tr>
<td><a href="https://openactive.io/detail"><code>schema:description</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A slightly longer, human-readable summary of the problem type. It largely <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> change from occurrence to occurrence of the problem, except for purposes of localization or to provide specific information about why the error occurred in that particular case.</td>
</tr>
<tr>
<td><a href="https://openactive.io/instance"><code>oa:instance</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The requested URL.</td>
</tr>
<tr>
<td><a href="https://openactive.io/method"><code>oa:method</code></a></td>
<td><em class="rfc2119" title="RECOMMENDED">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The method of the request (e.g. GET).</td>
</tr>
<tr>
<td><a href="https://openactive.io/status"><code>oa:status</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Integer"><code>schema:Integer</code></a></td>
<td>An integer representing the HTTP status code.</td>
</tr>
<tr>
<td><a href="https://openactive.io/invalidParams"><code>oa:invalidParams</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td>Array of <a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>An array of invalid parameters, if appropriate.</td>
</tr>
<tr>
<td><a href="https://openactive.io/requestId"><code>oa:requestId</code></a></td>
<td><em class="rfc2119" title="OPTIONAL">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Used by technical support for diagnostics purposes.</td>
</tr>
</tbody></table></section><section id="oa-openbookingerror-subclasses"><h4 id="x10-3-3-oa-openbookingerror-subclasses"><span class="secno">10.3.3 </span><code>oa:OpenBookingError</code> subclasses<a class="self-link" aria-label="§" href="#oa-openbookingerror-subclasses"></a></h4><p>A number of <code>OpenBookingError</code> subclasses are specified to identify the problem type.</p><section id="order-creation-orderquote-and-order-error-responses"><h5 id="x10-3-3-1-order-creation-orderquote-and-order-error-responses"><span class="secno">10.3.3.1 </span>Order Creation - <code>OrderQuote</code> and <code>Order</code> error responses<a class="self-link" aria-label="§" href="#order-creation-orderquote-and-order-error-responses"></a></h5><table>
<thead>
<tr>
<th>Error Type</th>
<th>Status Code</th>
<th>Use Case</th>
</tr>
</thead>
<tbody><tr>
<td><code>IncompleteCustomerDetailsError</code></td>
<td>400</td>
<td>If the <code>email</code> address of the customer is not supplied within a <code>schema:Person</code> object; or if the <code>customer</code> property supplied is not a valid <code>schema:Person</code> or <code>schema:Organization</code> object.</td>
</tr>
<tr>
<td><code>IncompleteBrokerDetailsError</code></td>
<td>400</td>
<td>If there is insufficient detail in the <code>schema:Organisation</code> object describing the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>; or if the <code>broker</code> property supplied is not a valid schema:Organisation object.</td>
</tr>
<tr>
<td><code>IncompletePaymentDetailsError</code></td>
<td>400</td>
<td>If the <code>payment</code> property of the <code>Order</code> is missing or does not include an <code>identifier</code> or <code>paymentMethod</code>.</td>
</tr>
</tbody></table></section><section id="order-creation-orderitem-errors"><h5 id="x10-3-3-2-order-creation-orderitem-errors"><span class="secno">10.3.3.2 </span>Order Creation - <code>OrderItem</code> errors<a class="self-link" aria-label="§" href="#order-creation-orderitem-errors"></a></h5><table>
<thead>
<tr>
<th>Error Type</th>
<th>Status Code</th>
<th>Use Case</th>
</tr>
</thead>
<tbody><tr>
<td><code>IncompleteOrderItemError</code></td>
<td>400</td>
<td>If there is a missing <code>acceptedOffer</code> or <code>orderedItem</code> property on the <code>schema:OrderItem</code>.</td>
</tr>
<tr>
<td><code>UnacceptableOfferError</code></td>
<td>400</td>
<td>If the <code>acceptedOffer</code> is not a URL which corresponds to an <a href="#dfn-applicable-offers" class="internalDFN" data-link-type="dfn">Applicable <code>Offer</code></a> for the opportunity.</td>
</tr>
<tr>
<td><code>UnknownOfferError</code></td>
<td>404</td>
<td>If the <code>acceptedOffer</code> is not a URL which corresponds to an <code>Offer</code> within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
</tr>
<tr>
<td><code>UnknownOpportunityDetailsError</code></td>
<td>404</td>
<td>If the <code>orderedItem</code> is not a URL which corresponds to an opportunity on the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a>.</td>
</tr>
<tr>
<td><code>UnavailableOpportunityError</code></td>
<td>400</td>
<td>If the <code>Offer</code> contained in the <code>acceptedOffer</code> property is not bookable</td>
</tr>
<tr>
<td><code>OpportunityIsFullError</code></td>
<td>400</td>
<td>If there are no available spaces for the opportunity contained in the <code>orderedItem</code> property</td>
</tr>
<tr>
<td><code>OpportunityHasInsufficientCapacityError</code></td>
<td>400</td>
<td>If there are not enough available spaces in the opportunity contained in the <code>orderedItem</code> property to fulfil the number requested by the <code>orderQuantity</code> property.</td>
</tr>
</tbody></table></section><section id="api-authentication"><h5 id="x10-3-3-3-api-authentication"><span class="secno">10.3.3.3 </span>API authentication<a class="self-link" aria-label="§" href="#api-authentication"></a></h5><table>
<thead>
<tr>
<th>Error Type</th>
<th>Status Code</th>
<th>Use Case</th>
</tr>
</thead>
<tbody><tr>
<td><code>UnauthenticatedError</code></td>
<td>403</td>
<td>If the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> did not supply any form of authentication.</td>
</tr>
<tr>
<td><code>NoAPITokenError</code></td>
<td>403</td>
<td>If the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> did not supply an API key.</td>
</tr>
<tr>
<td><code>InvalidAPITokenError</code></td>
<td>401</td>
<td>If the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> supplied an invalid API key, either malformed or expired.</td>
</tr>
<tr>
<td><code>InvalidAuthorizationDetailsError</code></td>
<td>401</td>
<td>If the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> supplied an invalid set of authorization details, either malformed or expired.</td>
</tr>
</tbody></table></section><section id="technical-errors"><h5 id="x10-3-3-4-technical-errors"><span class="secno">10.3.3.4 </span>Technical errors<a class="self-link" aria-label="§" href="#technical-errors"></a></h5><table>
<thead>
<tr>
<th>Error Type</th>
<th>Status Code</th>
<th>Use Case</th>
</tr>
</thead>
<tbody><tr>
<td><code>TemporarilyUnableToCreateOrderError</code></td>
<td>500</td>
<td>If the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> is unable for technical reasons to create an <code>Order</code> where the data provided to it is sufficient to allow it to do so.</td>
</tr>
<tr>
<td><code>TemporarilyUnableToUpdateOrderError</code></td>
<td>500</td>
<td>If the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> is unable for technical reasons to update an <code>Order</code> (which includes attempting to PATCH for cancellation) where the data provided to it is sufficient to allow it to do so.</td>
</tr>
<tr>
<td><code>TemporarilyUnableToDeleteOrderError</code></td>
<td>500</td>
<td>If the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> is unable for technical reasons to delete an <code>Order</code> where the data provided to it is sufficient to allow it to do so</td>
</tr>
</tbody></table></section><section id="generic-errors"><h5 id="x10-3-3-5-generic-errors"><span class="secno">10.3.3.5 </span>Generic errors<a class="self-link" aria-label="§" href="#generic-errors"></a></h5><table>
<thead>
<tr>
<th>Error Type</th>
<th>Status Code</th>
<th>Use Case</th>
</tr>
</thead>
<tbody><tr>
<td><code>UnknownOrderError</code></td>
<td>404</td>
<td>Where a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> has no <code>Order</code> matching the one requested.</td>
</tr>
<tr>
<td><code>UnknownOrIncorrectEndpointError</code></td>
<td>404</td>
<td>Where a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> has no endpoint matching the one requested.</td>
</tr>
<tr>
<td><code>NotFoundError</code></td>
<td>404</td>
<td>Where a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> does not have the generic resource specified.</td>
</tr>
<tr>
<td><code>MethodNotAllowed</code></td>
<td>405</td>
<td>Where a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> does not recognise a specific HTTP method for the endpoint requested with that specific HTTP verb.</td>
</tr>
<tr>
<td><code>GoneError</code></td>
<td>410</td>
<td>Where an <code>Order</code> has been soft-deleted by an Order Deletion request.</td>
</tr>
</tbody></table></section></section></section></section><section class="normative" id="common-requirements"><!--OddPage--><h2 id="x11-common-requirements"><span class="secno">11. </span>Common Requirements<a class="self-link" aria-label="§" href="#common-requirements"></a></h2><p>This section defines some common functionality that applies to the design of the
whole API.</p><section id="media-types"><h3 id="x11-1-media-types"><span class="secno">11.1 </span>Media types<a class="self-link" aria-label="§" href="#media-types"></a></h3><p>Custom media types are used in this API to allow clients to choose the format
of the data they receive, and for <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> to stipulate which versions
of the specification they support.</p><p><a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking Systems</a> <em class="rfc2119" title="MAY">MAY</em> choose to support additional media types but <em class="rfc2119" title="MUST">MUST</em> support the
media type(s) defined by this specification.</p><p>Media types will conform to the following pattern:</p><pre aria-busy="false" class="hljs">application/vnd.openactive+json; model=[m], booking=[b], rpde=[r]</pre><p>The current media type is:</p><pre aria-busy="false" class="hljs">application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0</pre><p><strong>Brokers</strong> specifying a media type without a version, such as:</p><pre aria-busy="false" class="hljs">application/vnd.openactive+json</pre><p>will receive data in in the most current format.</p><p>If you are building an application as a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> and care about the stability
of the response, or have a client application which is tied to a specific
version you should always try to use a media type containing the version number.</p><div class="issue" id="issue-container-number-93"><div role="heading" class="issue-title marker" id="h-issue-7" aria-level="4"><a href="https://github.com/openactive/open-booking-api/issues/93"><span class="issue-number">Issue 93</span></a><span class="issue-label" aria-label="This issue is labelled as Community Feedback Requested.">: Alignment media types <a class="respec-gh-label respec-label-light" href="https://github.com/openactive/open-booking-api/issues/?q=is%3Aissue+is%3Aopen+label%3A%22Community+Feedback+Requested%22" style="background-color: rgb(150, 224, 234);">Community Feedback Requested</a></span></div><p>The specification has been updated to use media types that follow this pattern:<br>
<code>application/vnd.openactive+json; model=2.0, booking=1.0, rpde=1.0</code></p>
<p>Instead of:<br>
<code>application/vnd.openactive.1.0+json</code></p>
<p>Rationalle:</p>
<ul>
<li>Separates versions of booking spec from the RPDE and model versions, so they may evolve separately.</li>
<li>It uses media type parameters, which simplifies IANA registration at a later date (IANA registered media types do not have versions baked in)</li>
</ul>
<p>Please comment on this issue if you can foresee any challenges with this.</p></div></section><section id="response-formats"><h3 id="x11-2-response-formats"><span class="secno">11.2 </span>Response formats<a class="self-link" aria-label="§" href="#response-formats"></a></h3><p>Requests and response documents exchanged via this API will all be valid
[<cite><a class="bibref" href="#bib-json-ld">JSON-LD</a></cite>] documents, with the exception of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn">Orders feed</a>, where only documents
included in the <code>data</code> property are valid [<cite><a class="bibref" href="#bib-json-ld">JSON-LD</a></cite>].</p><p>The [<cite><a class="bibref" href="#bib-json-ld">JSON-LD</a></cite>] documents <em class="rfc2119" title="MUST">MUST</em> include a [<cite><a class="bibref" href="#bib-json-ld">JSON-LD</a></cite>] <code>context</code> that refers
to the [<cite><a class="bibref" href="#bib-openactive-vocabulary">OpenActive-Vocabulary</a></cite>] as follows:</p><div class="example" id="example-24-minimal-json-ld-document">
          <div class="marker">
      <a class="self-link" href="#example-24-minimal-json-ld-document">Example 24</a><span class="example-title">: minimal JSON-LD document</span>
    </div>
          <pre class="hljs json" aria-busy="false">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>
}</pre>
        </div><p>Unless otherwise specified the request and response documents <em class="rfc2119" title="MUST">MUST</em> conform to
the [<cite><a class="bibref" href="#bib-modelling-opportunity-data">Modelling-Opportunity-Data</a></cite>] data model.</p></section><section id="errors"><h3 id="x11-3-errors"><span class="secno">11.3 </span>Errors<a class="self-link" aria-label="§" href="#errors"></a></h3><p>Error responses <em class="rfc2119" title="MUST">MUST</em> be served using an appropriate HTTP 4XX status code or HTTP
5XX status code specified in the model.</p><p>All error responses from this API <em class="rfc2119" title="MUST">MUST</em> be returned in a JSON-LD format using a
content type of <code>application/vnd.openactive+json</code> and include at least one
<code>OpenBookingError</code> object.</p><div class="example" id="example-25-error-response-format">
          <div class="marker">
      <a class="self-link" href="#example-25-error-response-format">Example 25</a><span class="example-title">: Error response format</span>
    </div>
          <pre class="hljs json" aria-busy="false">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Error"</span>,
  <span class="hljs-attr">"error"</span>: [
    <span class="hljs-string">"type"</span>: <span class="hljs-string">"IncompleteCustomerDetailsError"</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"No customer details supplied"</span>
  ]
}</pre>
        </div></section><section id="security"><h3 id="x11-4-security"><span class="secno">11.4 </span>Security<a class="self-link" aria-label="§" href="#security"></a></h3><p>All HTTP requests and responses <em class="rfc2119" title="SHOULD">SHOULD</em> be secured using SSL.</p></section><section id="authentication"><h3 id="x11-5-authentication"><span class="secno">11.5 </span>Authentication<a class="self-link" aria-label="§" href="#authentication"></a></h3><section id="api-level-authentication-and-data-security"><h4 id="x11-5-1-api-level-authentication-and-data-security"><span class="secno">11.5.1 </span>API level authentication and data security<a class="self-link" aria-label="§" href="#api-level-authentication-and-data-security"></a></h4><p>All of the API transactions described in this document <em class="rfc2119" title="MUST">MUST</em> require authentication.</p><p>The content and data available to all endpoints provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> be specific to the authentication credentials, to ensure that bookings are secure. It is the responsibility of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> to ensure that only authentication credentials that created an <code>Order</code> can amend and cancel the <code>Order</code>.</p><p>Note that a client using the same authentication credentials may represent more than one <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a>, and the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> <em class="rfc2119" title="MUST">MUST</em> make no assumptions regarding which <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> is being represented by a particular set of credentials. For the avoidance of doubt: the same <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> accessing a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn">Booking System</a> using two sets of credentials <em class="rfc2119" title="MUST">MUST</em> not be able to access <code>Order</code>'s created by one set of credentials when using the other.</p><p>In terms of implementation, all data partitioning and security <em class="rfc2119" title="MUST">MUST</em> be based on the authentication credentials; the <code>broker</code> property within the <code>Order</code> is for information only.</p><p>This specification does not mandate a particular authentication method, but its recommendation is that implementers <em class="rfc2119" title="SHOULD">SHOULD</em> consider using [<cite><a class="bibref" href="#bib-oauth2">OAuth2</a></cite>] as it is well-defined, widely supported and can be used in a variety of different application flows (e.g. via a Javascript web application or between servers).</p><p>Other server-to-server authentication mechanisms such as basic authentication, API key or bearer token based mechanisms are also appropriate.</p></section><section id="customer-level-authentication"><h4 id="x11-5-2-customer-level-authentication"><span class="secno">11.5.2 </span>Customer level authentication<a class="self-link" aria-label="§" href="#customer-level-authentication"></a></h4><p>OpenID Connect ([<cite><a class="bibref" href="#bib-openidconnect">OpenIdConnect</a></cite>]) is recommended as standard way of verifying the identity of customer. It is a thin layer that sits atop OAuth2.</p><p>One principle relating to authentication and the Booking API is that <code>Order</code>s created by a specific <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> <em class="rfc2119" title="SHOULD NOT">SHOULD NOT</em> be able to be changed by any other <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a>. It is the responsibility of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn">Broker</a> to ensure that subsequent requests to an <code>Order</code> should only be initiated by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn">Customer</a> which created the <code>Order</code>.</p></section></section></section><section class="normative" id="future-versions-of-this-api"><!--OddPage--><h2 id="x12-future-versions-of-this-api"><span class="secno">12. </span>Future versions of this API<a class="self-link" aria-label="§" href="#future-versions-of-this-api"></a></h2><p>Future iterations of the specification be shaped by the OpenActive community, and we encourage you to get involved.</p></section><section class="appendix informative" id="acknowledgements"><!--OddPage--><h2 id="a-acknowledgements"><span class="secno">A. </span>Acknowledgements<a class="self-link" aria-label="§" href="#acknowledgements"></a></h2><p><em>This section is non-normative.</em></p><p>The editors thank <a href="https://www.w3.org/community/openactive/participants">all members</a> of the OpenActive Community Group for their contributions.</p><p>Icons made by Freepik, Darius Dan, Eucalyp, smalllikeart, bqlqn from <a href="https://www.flaticon.com">www.flaticon.com</a>.</p></section><section id="references" class="appendix">
      <!--OddPage--><h2 id="b-references"><span class="secno">B. </span>References<a class="self-link" aria-label="§" href="#references"></a></h2>
      
    <section id="normative-references">
        <h3 id="b-1-normative-references"><span class="secno">B.1 </span>Normative references<a class="self-link" aria-label="§" href="#normative-references"></a></h3>
      <dl class="bibliography">
        <dt id="bib-json-ld">[JSON-LD]</dt><dd><a href="https://www.w3.org/TR/json-ld/"><cite>JSON-LD 1.0</cite></a>.  W3C. W3C Recommendation. URL: <a href="https://www.w3.org/TR/json-ld/">https://www.w3.org/TR/json-ld/</a></dd><dt id="bib-modelling-opportunity-data">[Modelling-Opportunity-Data]</dt><dd><a href="https://openactive.io/modelling-opportunity-data/"><cite>Modelling Opportunity Data</cite></a>.  OpenActive Community Group. URL: <a href="https://openactive.io/modelling-opportunity-data/">https://openactive.io/modelling-opportunity-data/</a></dd><dt id="bib-oauth2">[OAuth2]</dt><dd><a href="https://oauth.net/2/"><cite>OAuth 2.0</cite></a>. URL: <a href="https://oauth.net/2/">https://oauth.net/2/</a></dd><dt id="bib-openactive-vocabulary">[OpenActive-Vocabulary]</dt><dd><a href="https://openactive.io/ns/"><cite>OpenActive Vocabulary</cite></a>.  OpenActive Community Group. URL: <a href="https://openactive.io/ns/">https://openactive.io/ns/</a></dd><dt id="bib-openidconnect">[OpenIdConnect]</dt><dd><a href="https://openid.net/connect/"><cite>OpenID Connect</cite></a>. URL: <a href="https://openid.net/connect/">https://openid.net/connect/</a></dd><dt id="bib-rfc2119">[RFC2119]</dt><dd><a href="https://tools.ietf.org/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner. IETF. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a></dd><dt id="bib-rfc6570">[RFC6570]</dt><dd><a href="https://tools.ietf.org/html/rfc6570"><cite>URI Template</cite></a>. J. Gregorio; R. Fielding; M. Hadley; M. Nottingham; D. Orchard. IETF. March 2012. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc6570">https://tools.ietf.org/html/rfc6570</a></dd><dt id="bib-rpde">[RPDE]</dt><dd><a href="https://openactive.io/realtime-paged-data-exchange/"><cite>Realtime Paged Data Exchange</cite></a>.  OpenActive Community Group. URL: <a href="https://openactive.io/realtime-paged-data-exchange/">https://openactive.io/realtime-paged-data-exchange/</a></dd>
      </dl></section></section><p role="navigation" id="back-to-top"><a href="#title"><abbr title="Back to Top">↑</abbr></a></p><script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script></body></html>