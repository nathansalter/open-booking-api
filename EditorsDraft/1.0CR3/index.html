<!DOCTYPE html><html xmlns="https://www.w3.org/1999/xhtml" lang="en"><head>
<meta charset="utf-8">
<meta name="generator" content="ReSpec 26.0.2">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<style>
span.example-title{text-transform:none}
aside.example,div.example,div.illegal-example{padding:.5em;margin:1em 0;position:relative;clear:both}
div.illegal-example{color:red}
div.illegal-example p{color:#000}
aside.example,div.example{padding:.5em;border-left-width:.5em;border-left-style:solid;border-color:#e0cb52;background:#fcfaee}
aside.example div.example{border-left-width:.1em;border-color:#999;background:#fff}
aside.example div.example span.example-title{color:#999}
.example pre{background-color:rgba(0,0,0,.03)}
</style>
<style>
.issue-label{text-transform:initial}
.warning>p:first-child{margin-top:0}
.warning{padding:.5em;border-left-width:.5em;border-left-style:solid}
span.warning{padding:.1em .5em .15em}
.issue.closed span.issue-number{text-decoration:line-through}
.warning{border-color:#f11;border-width:.2em;border-style:solid;background:#fbe9e9}
.warning-title:before{content:"⚠";font-size:1.3em;float:left;padding-right:.3em;margin-top:-.3em}
li.task-list-item{list-style:none}
input.task-list-item-checkbox{margin:0 .35em .25em -1.6em;vertical-align:middle}
.issue a.respec-gh-label{padding:5px;margin:0 2px 0 2px;font-size:10px;text-transform:none;text-decoration:none;font-weight:700;border-radius:4px;position:relative;bottom:2px;border:none;display:inline-block}
</style>
<style>
dfn{cursor:pointer}
.dfn-panel{position:absolute;z-index:35;min-width:300px;max-width:500px;padding:.5em .75em;margin-top:.6em;font:small Helvetica Neue,sans-serif,Droid Sans Fallback;background:#fff;color:#000;box-shadow:0 1em 3em -.4em rgba(0,0,0,.3),0 0 1px 1px rgba(0,0,0,.05);border-radius:2px}
.dfn-panel:not(.docked)>.caret{position:absolute;top:-9px}
.dfn-panel:not(.docked)>.caret::after,.dfn-panel:not(.docked)>.caret::before{content:"";position:absolute;border:10px solid transparent;border-top:0;border-bottom:10px solid #fff;top:0}
.dfn-panel:not(.docked)>.caret::before{border-bottom:9px solid #a2a9b1}
.dfn-panel *{margin:0}
.dfn-panel b{display:block;color:#000;margin-top:.25em}
.dfn-panel ul a[href]{color:#333}
.dfn-panel>div{display:flex}
.dfn-panel a.self-link{font-weight:700;margin-right:auto}
.dfn-panel .marker{padding:.1em;margin-left:.5em;border-radius:.2em;text-align:center;white-space:nowrap;font-size:90%;color:#040b1c}
.dfn-panel .marker.dfn-exported{background:#d1edfd;box-shadow:0 0 0 .125em #1ca5f940}
.dfn-panel .marker.idl-block{background:#8ccbf2;box-shadow:0 0 0 .125em #0670b161}
.dfn-panel a:not(:hover){text-decoration:none!important;border-bottom:none!important}
.dfn-panel a[href]:hover{border-bottom-width:1px}
.dfn-panel ul{padding:0}
.dfn-panel li{margin-left:1em}
.dfn-panel.docked{position:fixed;left:.5em;top:unset;bottom:2em;margin:0 auto;max-width:calc(100vw - .75em * 2 - .5em - .2em * 2);max-height:30vh;overflow:auto}
</style>
    
    
<title>Open Booking API 1.0 CR3</title>

    

    

    
<style id="respec-mainstyle">
@keyframes pop{
0%{transform:scale(1,1)}
25%{transform:scale(1.25,1.25);opacity:.75}
100%{transform:scale(1,1)}
}
.hljs{background:0 0!important}
a abbr,h1 abbr,h2 abbr,h3 abbr,h4 abbr,h5 abbr,h6 abbr{border:none}
dfn{font-weight:700}
a.internalDFN{color:inherit;border-bottom:1px solid #99c;text-decoration:none}
a.externalDFN{color:inherit;border-bottom:1px dotted #ccc;text-decoration:none}
a.bibref{text-decoration:none}
.respec-offending-element:target{animation:pop .25s ease-in-out 0s 1}
.respec-offending-element,a[href].respec-offending-element{text-decoration:red wavy underline}
@supports not (text-decoration:red wavy underline){
.respec-offending-element:not(pre){display:inline-block}
.respec-offending-element{background:url(data:image/gif;base64,R0lGODdhBAADAPEAANv///8AAP///wAAACwAAAAABAADAEACBZQjmIAFADs=) bottom repeat-x}
}
#references :target{background:#eaf3ff;animation:pop .4s ease-in-out 0s 1}
cite .bibref{font-style:normal}
code{color:#c63501}
th code{color:inherit}
a[href].orcid{padding-left:4px;padding-right:4px}
a[href].orcid>svg{margin-bottom:-2px}
.toc a,.tof a{text-decoration:none}
a .figno,a .secno{color:#000}
ol.tof,ul.tof{list-style:none outside none}
.caption{margin-top:.5em;font-style:italic}
table.simple{border-spacing:0;border-collapse:collapse;border-bottom:3px solid #005a9c}
.simple th{background:#005a9c;color:#fff;padding:3px 5px;text-align:left}
.simple th a{color:#fff;padding:3px 5px;text-align:left}
.simple th[scope=row]{background:inherit;color:inherit;border-top:1px solid #ddd}
.simple td{padding:3px 10px;border-top:1px solid #ddd}
.simple tr:nth-child(even){background:#f0f6ff}
.section dd>p:first-child{margin-top:0}
.section dd>p:last-child{margin-bottom:0}
.section dd{margin-bottom:1em}
.section dl.attrs dd,.section dl.eldef dd{margin-bottom:0}
#issue-summary>ul{column-count:2}
#issue-summary li{list-style:none;display:inline-block}
details.respec-tests-details{margin-left:1em;display:inline-block;vertical-align:top}
details.respec-tests-details>*{padding-right:2em}
details.respec-tests-details[open]{z-index:999999;position:absolute;border:thin solid #cad3e2;border-radius:.3em;background-color:#fff;padding-bottom:.5em}
details.respec-tests-details[open]>summary{border-bottom:thin solid #cad3e2;padding-left:1em;margin-bottom:1em;line-height:2em}
details.respec-tests-details>ul{width:100%;margin-top:-.3em}
details.respec-tests-details>li{padding-left:1em}
a[href].self-link:hover{opacity:1;text-decoration:none;background-color:transparent}
h2,h3,h4,h5,h6{position:relative}
aside.example .marker>a.self-link{color:inherit}
h2>a.self-link,h3>a.self-link,h4>a.self-link,h5>a.self-link,h6>a.self-link{border:none;color:inherit;font-size:83%;height:2em;left:-1.6em;opacity:.5;position:absolute;text-align:center;text-decoration:none;top:0;transition:opacity .2s;width:2em}
h2>a.self-link::before,h3>a.self-link::before,h4>a.self-link::before,h5>a.self-link::before,h6>a.self-link::before{content:"§";display:block}
@media (max-width:767px){
dd{margin-left:0}
h2>a.self-link,h3>a.self-link,h4>a.self-link,h5>a.self-link,h6>a.self-link{left:auto;top:auto}
}
@media print{
.removeOnSave{display:none}
}
</style>

    
<style>

        table {
            border-collapse: collapse;
            border: 1px solid #bec9d9
        }

        td,
        th {
            padding: 3px 0.5em;
            border-left: 1px solid black;
            border-right: 1px solid black;
            border-bottom: 1px solid #E2EDFE;
        }

        tr th[colspan] {
            color: #005A9C;
            background-color: #FEEDE2;
            text-align: center
        }

        th {
            color: #005A9C;
            background-color: #E2EDFE;
            font-weight: normal;
            border-bottom: 1px solid #BEC9D9;
        }

        tbody tr th {
            text-align: left;
        }

        td.nb {
            font-size: smaller;
        }

        .rec,
        .pr {
            color: #005A9C;
            background-color: #99EE99
        }

        .ext {
            background-color: #FFFFFF
        }

        .cr,
        .lcwd {
            color: #005A9C;
            background-color: #EEEE99
        }

        .wd {
            color: #005A9C;
            background-color: #EE9999
        }

        .ed,
        .fpwd {
            color: #005A9C;
            background-color: #FF7777
        }

        code {
            white-space: pre;
        }

        html {
            background-image: none !important;
        }

        body {
            background: white top left fixed no-repeat !important;
            background-size: 25px auto !important;
            background-image:
                url('https://www.openactive.io/assets/openactive-label-specification.png') !important;
        }

        h1 {
            font-family: 'Open Sans', sans-serif !important;
            font-weight: 300 !important;
            color: #3B3089 !important;
            font-size: 220%;
        }

        #toc {
            padding-top: 0px !important;
        }

        .remove {
            background-color: yellow;
        }

        code {
            color: #C83500;
        }

        em.rfc2119 {
          text-transform:     lowercase;
          font-variant:       small-caps;
          font-style:         normal;
          color:              #900;
        }

        a.internalDFN[href] {
          color: #000;
          font-weight: 500;
        }
    
</style>


<meta name="description" content="This document specifies an HTTP API for placing bookings to participate in
physical activities, either by attending events or through the use of leisure
or sports facilities.">
<style>
.hljs{display:block;overflow-x:auto;padding:.5em;color:#383a42;background:#fafafa}
.hljs-comment,.hljs-quote{color:#717277;font-style:italic}
.hljs-doctag,.hljs-formula,.hljs-keyword{color:#a626a4}
.hljs-deletion,.hljs-name,.hljs-section,.hljs-selector-tag,.hljs-subst{color:#ca4706;font-weight:700}
.hljs-literal{color:#0b76c5}
.hljs-addition,.hljs-attribute,.hljs-meta-string,.hljs-regexp,.hljs-string{color:#42803c}
.hljs-built_in,.hljs-class .hljs-title{color:#9a6a01}
.hljs-attr,.hljs-number,.hljs-selector-attr,.hljs-selector-class,.hljs-selector-pseudo,.hljs-template-variable,.hljs-type,.hljs-variable{color:#986801}
.hljs-bullet,.hljs-link,.hljs-meta,.hljs-selector-id,.hljs-symbol,.hljs-title{color:#336ae3}
.hljs-emphasis{font-style:italic}
.hljs-strong{font-weight:700}
.hljs-link{text-decoration:underline}
</style>
<style>
var{position:relative;cursor:pointer}
var[data-type]::after,var[data-type]::before{position:absolute;left:50%;top:-6px;opacity:0;transition:opacity .4s;pointer-events:none}
var[data-type]::before{content:"";transform:translateX(-50%);border-width:4px 6px 0 6px;border-style:solid;border-color:transparent;border-top-color:#000}
var[data-type]::after{content:attr(data-type);transform:translateX(-50%) translateY(-100%);background:#000;text-align:center;font-family:"Dank Mono","Fira Code",monospace;font-style:normal;padding:6px;border-radius:3px;color:#daca88;text-indent:0;font-weight:400}
var[data-type]:hover::after,var[data-type]:hover::before{opacity:1}
</style>
<script id="initialUserConfig" type="application/json">{
  "specStatus": "CG-DRAFT",
  "shortName": "open-booking-api",
  "edDraftURI": "https://www.openactive.io/open-booking-api/EditorsDraft/",
  "copyrightStart": 2018,
  "editors": [
    {
      "name": "Nick Evans",
      "url": "http://nickevans.me/",
      "company": "Open Data Institute",
      "companyURL": "https://theodi.org",
      "w3cid": 87551
    },
    {
      "name": "Leigh Dodds",
      "url": "https://ldodds.com",
      "company": "Open Data Institute",
      "companyURL": "https://theodi.org",
      "w3cid": 55359
    }
  ],
  "formerEditors": [
    {
      "name": "Chris Thorpe",
      "url": "https://github.com/drchristhorpe",
      "company": "Open Data Institute",
      "companyURL": "https://theodi.org"
    }
  ],
  "otherLinks": [
    {
      "key": "Participate",
      "data": [
        {
          "value": "GitHub openactive/open-booking-api",
          "href": "https://github.com/openactive/open-booking-api/"
        },
        {
          "value": "File a bug",
          "href": "https://github.com/openactive/open-booking-api/issues/"
        },
        {
          "value": "Commit history",
          "href": "https://github.com/openactive/open-booking-api/commits/gh-pages"
        },
        {
          "value": "Pull requests",
          "href": "https://github.com/openactive/open-booking-api/pulls/"
        }
      ]
    },
    {
      "key": "Version",
      "value": "1.0 CR3",
      "href": "https://www.openactive.io/open-booking-api/EditorsDraft/1.0CR3/"
    }
  ],
  "logos": [
    {
      "src": "https://www.openactive.io/assets/openactive-logo-large.png",
      "href": "https://www.openactive.io",
      "alt": "openactive.io",
      "width": 255,
      "height": 43,
      "id": "logo"
    }
  ],
  "group": "openactive",
  "wgPublicList": "public-openactive",
  "maxTocLevel": 4,
  "preProcess": [],
  "noRecTrack": true,
  "isNoTrack": true,
  "github": "https://github.com/openactive/open-booking-api/",
  "format": "markdown",
  "localBiblio": {
    "JSON-LD": {
      "href": "https://www.w3.org/TR/json-ld/",
      "title": "JSON-LD 1.0",
      "status": "REC",
      "publisher": "W3C",
      "id": "json-ld"
    },
    "SCHEMA-ORG": {
      "href": "https://schema.org/",
      "title": "Schema.org"
    },
    "Modelling-Opportunity-Data": {
      "href": "https://www.openactive.io/modelling-opportunity-data/",
      "title": "Modelling Opportunity Data",
      "publisher": "OpenActive Community Group",
      "id": "modelling-opportunity-data"
    },
    "Dataset-API-Discovery": {
      "href": "https://www.openactive.io/dataset-api-discovery/EditorsDraft/",
      "title": "Dataset API Discovery",
      "publisher": "OpenActive Community Group",
      "id": "dataset-api-discovery"
    },
    "RPDE": {
      "href": "https://www.openactive.io/realtime-paged-data-exchange/",
      "title": "Realtime Paged Data Exchange",
      "publisher": "OpenActive Community Group",
      "id": "rpde"
    },
    "OpenActive-Vocabulary": {
      "href": "https://www.openactive.io/ns/",
      "title": "OpenActive Vocabulary",
      "publisher": "OpenActive Community Group",
      "id": "openactive-vocabulary"
    },
    "OAuth2": {
      "href": "https://oauth.net/2/",
      "title": "OAuth 2.0",
      "id": "oauth2"
    },
    "OpenIdConnect": {
      "href": "https://openid.net/connect/",
      "title": "OpenID Connect",
      "id": "openidconnect"
    },
    "OpenActive-Beta-Namespace": {
      "href": "https://www.openactive.io/ns-beta/",
      "title": "OpenActive Beta Namespace",
      "publisher": "OpenActive Community Group",
      "id": "openactive-beta-namespace"
    }
  },
  "publishISODate": "2021-03-01T00:00:00.000Z",
  "generatedSubtitle": "Draft Community Group Report 01 March 2021"
}</script>
<link rel="stylesheet" href="https://www.w3.org/StyleSheets/TR/2016/cg-draft"></head>

<body class="h-entry"><div class="head">
    <a class="logo" href=""><img id="logo" alt="openactive.io" width="255" height="43" src="https://www.openactive.io/assets/openactive-logo-large.png"></a> <h1 id="title" class="title">Open Booking API 1.0 CR3</h1>
    
    <h2>
      Draft Community Group Report
      <time class="dt-published" datetime="2021-03-01">01 March 2021</time>
    </h2>
    <dl>
      
      
      <dt>Latest editor's draft:</dt><dd><a href="https://www.openactive.io/open-booking-api/EditorsDraft/">https://www.openactive.io/open-booking-api/EditorsDraft/</a></dd>
      
      
      
      
      <dt>Editors:</dt>
      <dd class="p-author h-card vcard" data-editor-id="87551"><a class="u-url url p-name fn" href="http://nickevans.me/">Nick Evans</a>
            (<a class="p-org org h-org h-card" href="https://theodi.org">Open Data Institute</a>)
          </dd><dd class="p-author h-card vcard" data-editor-id="55359"><a class="u-url url p-name fn" href="https://ldodds.com">Leigh Dodds</a>
            (<a class="p-org org h-org h-card" href="https://theodi.org">Open Data Institute</a>)
          </dd>
      <dt>
              Former editor:
            </dt><dd class="p-author h-card vcard"><a class="u-url url p-name fn" href="https://github.com/drchristhorpe">Chris Thorpe</a>
            (<a class="p-org org h-org h-card" href="https://theodi.org">Open Data Institute</a>)
          </dd>
      
      <dt>Participate:</dt><dd>
    <a href="https://github.com/openactive/open-booking-api/">GitHub openactive/open-booking-api</a>
  </dd><dd>
    <a href="https://github.com/openactive/open-booking-api/issues/">File a bug</a>
  </dd><dd>
    <a href="https://github.com/openactive/open-booking-api/commits/gh-pages">Commit history</a>
  </dd><dd>
    <a href="https://github.com/openactive/open-booking-api/pulls/">Pull requests</a>
  </dd><dt>Version:</dt><dd>
    <a href="https://www.openactive.io/open-booking-api/EditorsDraft/1.0CR3/">1.0 CR3</a>
  </dd>
    </dl>
    
    <p class="copyright">
          <a href="https://www.w3.org/Consortium/Legal/ipr-notice#Copyright">Copyright</a>
          ©
          2018-2021
          
          the Contributors to the Open Booking API 1.0 CR3
          Specification, published by the
          <a href="https://www.w3.org/community/openactive/">OpenActive Community Group</a> under the
          <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>. A human-readable
                <a href="https://www.w3.org/community/about/agreements/cla-deed/">summary</a>
                is available.
              
        </p>
    <hr title="Separator for header">
  </div><style>

    body {
        background-size: 25px auto !important;
    }

    body.toc-sidebar #toc {
        background-size: 25px auto !important;
        background-attachment: fixed !important;
    }

</style><section id="abstract" class="introductory"><h2>Abstract</h2><p>This document specifies an HTTP API for placing bookings to participate in
physical activities, either by attending events or through the use of leisure
or sports facilities.</p></section><section id="sotd" class="introductory"><h2>Status of This Document</h2><p>
      This specification was published by the
      <a href="https://www.w3.org/community/openactive/">OpenActive Community Group</a>. It is not a W3C Standard nor is it
      on the W3C Standards Track.
      
            Please note that under the
            <a href="https://www.w3.org/community/about/agreements/cla/">W3C Community Contributor License Agreement (CLA)</a>
            there is a limited opt-out and other conditions apply.
          
      Learn more about
      <a href="https://www.w3.org/community/">W3C Community and Business Groups</a>.
    </p><p>Contributions to this document are not only welcomed but are actively solicited
and should be made via
<a href="https://github.com/openactive/open-booking-api/issues">GitHub Issues</a> and
pull requests. The source code is available
on <a href="https://github.com/openactive/open-booking-api">GitHub</a>.</p><div class="note" role="note" id="issue-container-generatedID"><div role="heading" class="note-title marker" id="h-note" aria-level="3"><span>Note</span></div><div class="">


<p>This document represents a published Candidate Release, including minor non-breaking clarifications that build on the version released at <a href="https://www.openactive.io/open-booking-api">https://www.openactive.io/open-booking-api</a>. This Candidate Release is published for the purposes of creating accompanying tooling and gathering implementation experience, and will be updated with further clarifications and minor technical improvements based on implementation feedback. We encourage developers to implement this API and share their experience.</p>
</div></div><p>
    <a href="https://github.com/openactive/open-booking-api/issues/">GitHub Issues</a> are preferred for
          discussion of this specification.
        
    Alternatively, you can send comments to our mailing list.
          Please send them to
          <a href="mailto:public-openactive@w3.org">public-openactive@w3.org</a>
          (<a href="mailto:public-openactive-request@w3.org?subject=subscribe">subscribe</a>,
          <a href="https://lists.w3.org/Archives/Public/public-openactive/">archives</a>).
        
  </p></section><nav id="toc"><h2 class="introductory" id="table-of-contents">Table of Contents</h2><ol class="toc"><li class="tocline"><a class="tocxref" href="#introduction"><bdi class="secno">1. </bdi>Introduction</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#scope-and-requirements"><bdi class="secno">1.1 </bdi>Scope and requirements</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#out-of-scope-in-this-version"><bdi class="secno">1.1.1 </bdi>Out of Scope in this version</a></li><li class="tocline"><a class="tocxref" href="#out-of-scope-by-design"><bdi class="secno">1.1.2 </bdi>Out of Scope by design</a></li></ol></li><li class="tocline"><a class="tocxref" href="#specification-dependencies"><bdi class="secno">1.2 </bdi>Specification dependencies</a></li><li class="tocline"><a class="tocxref" href="#audience"><bdi class="secno">1.3 </bdi>Audience</a></li></ol></li><li class="tocline"><a class="tocxref" href="#conformance"><bdi class="secno">2. </bdi>Conformance</a></li><li class="tocline"><a class="tocxref" href="#typographical-conventions"><bdi class="secno">3. </bdi>Typographical Conventions</a></li><li class="tocline"><a class="tocxref" href="#key-actors"><bdi class="secno">4. </bdi>Key Actors</a></li><li class="tocline"><a class="tocxref" href="#booking-flows"><bdi class="secno">5. </bdi>Booking Flows</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#booking-flow-overview"><bdi class="secno">5.1 </bdi>Booking flow overview</a></li><li class="tocline"><a class="tocxref" href="#booking-flow-modularity"><bdi class="secno">5.2 </bdi>Booking flow modularity</a></li><li class="tocline"><a class="tocxref" href="#booking-pre-conditions"><bdi class="secno">5.3 </bdi>Booking pre-conditions</a></li><li class="tocline"><a class="tocxref" href="#simple-booking-flow"><bdi class="secno">5.4 </bdi>Simple Booking Flow</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#customer-journey"><bdi class="secno">5.4.1 </bdi>Customer Journey</a></li><li class="tocline"><a class="tocxref" href="#high-level-api-flow"><bdi class="secno">5.4.2 </bdi>High-level API flow</a></li><li class="tocline"><a class="tocxref" href="#leasing"><bdi class="secno">5.4.3 </bdi>Leasing</a></li><li class="tocline"><a class="tocxref" href="#high-level-type-flow"><bdi class="secno">5.4.4 </bdi>High-level type flow</a></li><li class="tocline"><a class="tocxref" href="#order-statuses"><bdi class="secno">5.4.5 </bdi>Order statuses</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#order-statuses-in-the-booking-system"><bdi class="secno">5.4.5.1 </bdi>Order statuses in the Booking System</a></li><li class="tocline"><a class="tocxref" href="#order-statuses-in-the-broker"><bdi class="secno">5.4.5.2 </bdi>Order statuses in the Broker</a></li></ol></li><li class="tocline"><a class="tocxref" href="#step-by-step-process-description"><bdi class="secno">5.4.6 </bdi>Step-by-step process description</a></li><li class="tocline"><a class="tocxref" href="#booking-flow-rollback"><bdi class="secno">5.4.7 </bdi>Booking Flow Rollback</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#booking-halted-at-ordercreationpaymentcaptured"><bdi class="secno">5.4.7.1 </bdi>Booking halted at OrderCreationPaymentCaptured</a></li><li class="tocline"><a class="tocxref" href="#booking-halted-at-ordercreationpaymentdue"><bdi class="secno">5.4.7.2 </bdi>Booking halted at OrderCreationPaymentDue</a></li><li class="tocline"><a class="tocxref" href="#booking-halted-at-ordercreationpaymentauthorized"><bdi class="secno">5.4.7.3 </bdi>Booking halted at OrderCreationPaymentAuthorized</a></li></ol></li><li class="tocline"><a class="tocxref" href="#contracts"><bdi class="secno">5.4.8 </bdi>Contracts</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#broker-contract-with-booking-system"><bdi class="secno">5.4.8.1 </bdi>Broker contract with Booking System</a></li><li class="tocline"><a class="tocxref" href="#booking-system-contract-with-the-broker"><bdi class="secno">5.4.8.2 </bdi>Booking System contract with the Broker</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#booking-flow-with-approval"><bdi class="secno">5.5 </bdi>Booking Flow with Approval</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#customer-journey-0"><bdi class="secno">5.5.1 </bdi>Customer Journey</a></li><li class="tocline"><a class="tocxref" href="#high-level-api-flow-0"><bdi class="secno">5.5.2 </bdi>High-level API flow</a></li><li class="tocline"><a class="tocxref" href="#proposal-leasing"><bdi class="secno">5.5.3 </bdi>Proposal Leasing</a></li><li class="tocline"><a class="tocxref" href="#high-level-type-flow-0"><bdi class="secno">5.5.4 </bdi>High-level type flow</a></li><li class="tocline"><a class="tocxref" href="#orderproposal-statuses"><bdi class="secno">5.5.5 </bdi>OrderProposal statuses</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#minimal-proposal-implementation"><bdi class="secno">5.5.5.1 </bdi>Minimal Proposal Implementation</a><ol class="toc"></ol></li><li class="tocline"><a class="tocxref" href="#proposal-amendment"><bdi class="secno">5.5.5.2 </bdi>Proposal Amendment</a></li><li class="tocline"><a class="tocxref" href="#message-exchange"><bdi class="secno">5.5.5.3 </bdi>Message Exchange</a></li></ol></li><li class="tocline"><a class="tocxref" href="#step-by-step-process-description-0"><bdi class="secno">5.5.6 </bdi>Step-by-step process description</a></li><li class="tocline"><a class="tocxref" href="#contract"><bdi class="secno">5.5.7 </bdi>Contract</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#broker-contract-with-booking-system-0"><bdi class="secno">5.5.7.1 </bdi>Broker contract with Booking System</a></li><li class="tocline"><a class="tocxref" href="#booking-system-contract-with-the-broker-0"><bdi class="secno">5.5.7.2 </bdi>Booking System contract with the Broker</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#customer-details-and-additional-details-capture"><bdi class="secno">5.6 </bdi>Customer Details and Additional Details capture</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#customer-details-capture"><bdi class="secno">5.6.1 </bdi>Customer Details capture</a></li><li class="tocline"><a class="tocxref" href="#attendee-details-capture"><bdi class="secno">5.6.2 </bdi>Attendee Details capture</a></li><li class="tocline"><a class="tocxref" href="#additional-details-capture"><bdi class="secno">5.6.3 </bdi>Additional Details capture</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#text-fields"><bdi class="secno">5.6.3.1 </bdi>Text fields</a></li><li class="tocline"><a class="tocxref" href="#dropdown-fields"><bdi class="secno">5.6.3.2 </bdi>Dropdown fields</a></li><li class="tocline"><a class="tocxref" href="#checkbox-fields"><bdi class="secno">5.6.3.3 </bdi>Checkbox fields</a></li><li class="tocline"><a class="tocxref" href="#form-validation-and-auto-fill"><bdi class="secno">5.6.3.4 </bdi>Form validation and auto-fill</a></li></ol></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#broker-roles"><bdi class="secno">6. </bdi>Broker Roles</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#resellerbroker"><bdi class="secno">6.1 </bdi><code>ResellerBroker</code></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition"><bdi class="secno">6.1.1 </bdi>Definition</a></li><li class="tocline"><a class="tocxref" href="#contractual-relationships"><bdi class="secno">6.1.2 </bdi>Contractual Relationships</a></li><li class="tocline"><a class="tocxref" href="#taxation"><bdi class="secno">6.1.3 </bdi>Taxation</a></li><li class="tocline"><a class="tocxref" href="#scope-of-specification"><bdi class="secno">6.1.4 </bdi>Scope of Specification</a></li><li class="tocline"><a class="tocxref" href="#conformance-criteria"><bdi class="secno">6.1.5 </bdi>Conformance criteria</a></li></ol></li><li class="tocline"><a class="tocxref" href="#agentbroker"><bdi class="secno">6.2 </bdi><code>AgentBroker</code></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition-0"><bdi class="secno">6.2.1 </bdi>Definition</a></li><li class="tocline"><a class="tocxref" href="#contractual-relationships-0"><bdi class="secno">6.2.2 </bdi>Contractual Relationships</a></li><li class="tocline"><a class="tocxref" href="#taxation-0"><bdi class="secno">6.2.3 </bdi>Taxation</a></li><li class="tocline"><a class="tocxref" href="#scope-of-specification-0"><bdi class="secno">6.2.4 </bdi>Scope of Specification</a></li><li class="tocline"><a class="tocxref" href="#conformance-criteria-0"><bdi class="secno">6.2.5 </bdi>Conformance criteria</a></li><li class="tocline"><a class="tocxref" href="#informed-purchase"><bdi class="secno">6.2.6 </bdi>Informed purchase</a></li></ol></li><li class="tocline"><a class="tocxref" href="#nobroker"><bdi class="secno">6.3 </bdi><code>NoBroker</code></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition-1"><bdi class="secno">6.3.1 </bdi>Definition</a></li><li class="tocline"><a class="tocxref" href="#contractual-relationships-1"><bdi class="secno">6.3.2 </bdi>Contractual Relationships</a></li><li class="tocline"><a class="tocxref" href="#taxation-1"><bdi class="secno">6.3.3 </bdi>Taxation</a></li><li class="tocline"><a class="tocxref" href="#scope-of-specification-1"><bdi class="secno">6.3.4 </bdi>Scope of Specification</a></li><li class="tocline"><a class="tocxref" href="#conformance-criteria-1"><bdi class="secno">6.3.5 </bdi>Conformance criteria</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#systems-of-record"><bdi class="secno">7. </bdi>Systems of Record</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#roles-and-responsibilities-overview"><bdi class="secno">7.1 </bdi>Roles and responsibilities overview</a></li><li class="tocline"><a class="tocxref" href="#invoices-and-tax-receipts"><bdi class="secno">7.2 </bdi>Invoices and Tax receipts</a></li><li class="tocline"><a class="tocxref" href="#payments-and-refunds"><bdi class="secno">7.3 </bdi>Payments and Refunds</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#virtual-payments"><bdi class="secno">7.3.1 </bdi>Virtual payments</a></li><li class="tocline"><a class="tocxref" href="#basic-payment"><bdi class="secno">7.3.2 </bdi>Basic <code>Payment</code></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#payment-reconciliation-detail-validation"><bdi class="secno">7.3.2.1 </bdi>Payment reconciliation detail validation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#dynamicpayment"><bdi class="secno">7.3.3 </bdi><code>DynamicPayment</code></a></li><li class="tocline"><a class="tocxref" href="#payment-reconciliation-identifiers"><bdi class="secno">7.3.4 </bdi>Payment reconciliation identifiers</a></li></ol></li><li class="tocline"><a class="tocxref" href="#tax-calculation"><bdi class="secno">7.4 </bdi>Tax calculation</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#business-to-consumer-tax-calculation-by-booking-system-is-mandatory"><bdi class="secno">7.4.1 </bdi>Business-to-consumer tax calculation by Booking System is mandatory</a></li><li class="tocline"><a class="tocxref" href="#business-to-business-tax-calculation-by-booking-system-is-optional"><bdi class="secno">7.4.2 </bdi>Business-to-business tax calculation by Booking System is optional</a></li></ol></li><li class="tocline"><a class="tocxref" href="#tax-mode"><bdi class="secno">7.5 </bdi>Tax mode</a></li><li class="tocline"><a class="tocxref" href="#booking-without-payment"><bdi class="secno">7.6 </bdi>Booking without payment</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#free-opportunities"><bdi class="secno">7.6.1 </bdi>Free opportunities</a></li><li class="tocline"><a class="tocxref" href="#payment-error-conditions"><bdi class="secno">7.6.2 </bdi>Payment error conditions</a></li></ol></li><li class="tocline"><a class="tocxref" href="#offer-overrides"><bdi class="secno">7.7 </bdi>Offer overrides</a></li><li class="tocline"><a class="tocxref" href="#currency-support"><bdi class="secno">7.8 </bdi>Currency support</a></li></ol></li><li class="tocline"><a class="tocxref" href="#order-operations"><bdi class="secno">8. </bdi>Order Operations</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#definition-of-a-bookable-opportunity-and-offer-pair"><bdi class="secno">8.1 </bdi>Definition of a 'bookable' Opportunity and Offer pair</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#booking-restrictions"><bdi class="secno">8.1.1 </bdi>Booking restrictions</a></li><li class="tocline"><a class="tocxref" href="#opportunity-data-properties"><bdi class="secno">8.1.2 </bdi>Opportunity data properties</a></li><li class="tocline"><a class="tocxref" href="#acceptedoffer-properties"><bdi class="secno">8.1.3 </bdi><code>acceptedOffer</code> properties</a></li></ol></li><li class="tocline"><a class="tocxref" href="#amending-the-orderquote-before-b"><bdi class="secno">8.2 </bdi>Amending the OrderQuote before <span class="formerLink" data-link-type="dfn"><b>B</b></span></a></li><li class="tocline"><a class="tocxref" href="#cancellation-after-b"><bdi class="secno">8.3 </bdi>Cancellation after <span class="formerLink" data-link-type="dfn"><b>B</b></span></a><ol class="toc"><li class="tocline"><a class="tocxref" href="#refund-after-the-opportunity-has-occurred"><bdi class="secno">8.3.1 </bdi>Refund after the opportunity has occurred</a></li><li class="tocline"><a class="tocxref" href="#customer-requested-cancellation"><bdi class="secno">8.3.2 </bdi>Customer requested cancellation</a></li><li class="tocline"><a class="tocxref" href="#seller-requested-cancellation"><bdi class="secno">8.3.3 </bdi>Seller requested cancellation</a></li></ol></li><li class="tocline"><a class="tocxref" href="#orders-feed-notifications-updates-and-refunds"><bdi class="secno">8.4 </bdi>Orders feed: Notifications, updates and refunds</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#orders-feed-inconsistencies"><bdi class="secno">8.4.1 </bdi>Orders Feed Inconsistencies</a></li><li class="tocline"><a class="tocxref" href="#order-stores-with-eventual-consistency"><bdi class="secno">8.4.2 </bdi>Order stores with eventual consistency</a></li><li class="tocline"><a class="tocxref" href="#booking-system-updating-the-orders-feed"><bdi class="secno">8.4.3 </bdi>Booking System: Updating the Orders feed</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#totalpaymentdue-invariant"><bdi class="secno">8.4.3.1 </bdi><code>totalPaymentDue</code> invariant</a></li></ol></li><li class="tocline"><a class="tocxref" href="#broker-processing-the-orders-feed"><bdi class="secno">8.4.4 </bdi>Broker: Processing the Orders feed</a></li><li class="tocline"><a class="tocxref" href="#new-orders-and-orderproposals"><bdi class="secno">8.4.5 </bdi>New <code>Order</code>s and <code>OrderProposal</code>s</a></li><li class="tocline"><a class="tocxref" href="#cancellation-replacement-refund-calculation-and-notification"><bdi class="secno">8.4.6 </bdi>Cancellation, replacement, refund calculation and notification</a></li><li class="tocline"><a class="tocxref" href="#partial-refunds-and-out-of-band-arrangements"><bdi class="secno">8.4.7 </bdi>Partial Refunds and out-of-band arrangements</a></li><li class="tocline"><a class="tocxref" href="#customer-notice-notifications"><bdi class="secno">8.4.8 </bdi>Customer notice notifications</a></li><li class="tocline"><a class="tocxref" href="#change-of-logistics-notifications"><bdi class="secno">8.4.9 </bdi>Change of logistics notifications</a></li><li class="tocline"><a class="tocxref" href="#opportunity-attendance-updates"><bdi class="secno">8.4.10 </bdi>Opportunity attendance updates</a></li><li class="tocline"><a class="tocxref" href="#other-notifications"><bdi class="secno">8.4.11 </bdi>Other notifications</a></li></ol></li><li class="tocline"><a class="tocxref" href="#amending-the-order-after-b"><bdi class="secno">8.5 </bdi>Amending the Order after <span class="formerLink" data-link-type="dfn"><b>B</b></span></a></li><li class="tocline"><a class="tocxref" href="#delivery-of-terms-and-conditions-and-privacy-policy"><bdi class="secno">8.6 </bdi>Delivery of Terms and Conditions and Privacy Policy</a></li><li class="tocline"><a class="tocxref" href="#access-control"><bdi class="secno">8.7 </bdi>Access control</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#text-based-access-control"><bdi class="secno">8.7.1 </bdi>Text-based access control</a></li><li class="tocline"><a class="tocxref" href="#image-based-access-control"><bdi class="secno">8.7.2 </bdi>Image-based access control</a></li><li class="tocline"><a class="tocxref" href="#extension-point-for-barcode-based-access-control"><bdi class="secno">8.7.3 </bdi>Extension point for barcode-based access control</a></li><li class="tocline"><a class="tocxref" href="#remote-access-control"><bdi class="secno">8.7.4 </bdi>Remote access control</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#endpoints"><bdi class="secno">9. </bdi>Endpoints</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#paths-and-verbs"><bdi class="secno">9.1 </bdi>Paths and Verbs</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#order-endpoint-restful-semantics"><bdi class="secno">9.1.1 </bdi>Order Endpoint RESTful Semantics</a></li></ol></li><li class="tocline"><a class="tocxref" href="#request-and-response"><bdi class="secno">9.2 </bdi>Request and Response</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#orderquote-creation-c1"><bdi class="secno">9.2.1 </bdi>OrderQuote Creation C1</a></li><li class="tocline"><a class="tocxref" href="#orderquote-creation-c2"><bdi class="secno">9.2.2 </bdi>OrderQuote Creation C2</a></li><li class="tocline"><a class="tocxref" href="#orderquote-deletion"><bdi class="secno">9.2.3 </bdi>OrderQuote Deletion</a></li><li class="tocline"><a class="tocxref" href="#orderproposal-creation-p"><bdi class="secno">9.2.4 </bdi>OrderProposal Creation P</a></li><li class="tocline"><a class="tocxref" href="#orderproposal-update"><bdi class="secno">9.2.5 </bdi>OrderProposal Update</a></li><li class="tocline"><a class="tocxref" href="#order-creation-b"><bdi class="secno">9.2.6 </bdi>Order Creation B</a></li><li class="tocline"><a class="tocxref" href="#order-deletion"><bdi class="secno">9.2.7 </bdi>Order Deletion</a></li><li class="tocline"><a class="tocxref" href="#order-cancellation"><bdi class="secno">9.2.8 </bdi>Order Cancellation</a></li><li class="tocline"><a class="tocxref" href="#orders-rpde-feed"><bdi class="secno">9.2.9 </bdi>Orders RPDE feed</a></li><li class="tocline"><a class="tocxref" href="#order-status"><bdi class="secno">9.2.10 </bdi>Order Status</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#model"><bdi class="secno">10. </bdi>Model</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#order-model"><bdi class="secno">10.1 </bdi>Order Model</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#schema-order"><bdi class="secno">10.1.1 </bdi><code>schema:Order</code></a></li><li class="tocline"><a class="tocxref" href="#oa-orderquote"><bdi class="secno">10.1.2 </bdi><code>oa:OrderQuote</code></a></li><li class="tocline"><a class="tocxref" href="#oa-orderproposal"><bdi class="secno">10.1.3 </bdi><code>oa:OrderProposal</code></a></li><li class="tocline"><a class="tocxref" href="#schema-organization-or-schema-person-for-seller"><bdi class="secno">10.1.4 </bdi><code>schema:Organization</code> or <code>schema:Person</code> for <code>seller</code></a></li><li class="tocline"><a class="tocxref" href="#schema-organization-for-broker"><bdi class="secno">10.1.5 </bdi><code>schema:Organization</code> for <code>broker</code></a></li><li class="tocline"><a class="tocxref" href="#schema-orderitem"><bdi class="secno">10.1.6 </bdi><code>schema:OrderItem</code></a></li><li class="tocline"><a class="tocxref" href="#schema-offer"><bdi class="secno">10.1.7 </bdi><code>schema:Offer</code></a></li><li class="tocline"><a class="tocxref" href="#schema-offeroverride"><bdi class="secno">10.1.8 </bdi><code>schema:OfferOverride</code></a></li><li class="tocline"><a class="tocxref" href="#schema-person-for-customer-or-attendee"><bdi class="secno">10.1.9 </bdi><code>schema:Person</code> for <code>customer</code> or <code>attendee</code></a></li><li class="tocline"><a class="tocxref" href="#schema-organization-for-customer"><bdi class="secno">10.1.10 </bdi><code>schema:Organization</code> for <code>customer</code></a></li><li class="tocline"><a class="tocxref" href="#schema-postaladdress"><bdi class="secno">10.1.11 </bdi><code>schema:PostalAddress</code></a></li><li class="tocline"><a class="tocxref" href="#oa-lease"><bdi class="secno">10.1.12 </bdi><code>oa:Lease</code></a></li><li class="tocline"><a class="tocxref" href="#schema-pricespecification"><bdi class="secno">10.1.13 </bdi><code>schema:PriceSpecification</code></a></li><li class="tocline"><a class="tocxref" href="#oa-taxchargespecification"><bdi class="secno">10.1.14 </bdi><code>oa:TaxChargeSpecification</code></a></li><li class="tocline"><a class="tocxref" href="#oa-payment"><bdi class="secno">10.1.15 </bdi><code>oa:Payment</code></a></li><li class="tocline"><a class="tocxref" href="#oa-dynamicpayment"><bdi class="secno">10.1.16 </bdi><code>oa:DynamicPayment</code></a></li><li class="tocline"><a class="tocxref" href="#oa-bookingservice"><bdi class="secno">10.1.17 </bdi><code>oa:BookingService</code></a></li><li class="tocline"><a class="tocxref" href="#oa-terms"><bdi class="secno">10.1.18 </bdi><code>oa:Terms</code></a></li><li class="tocline"><a class="tocxref" href="#oa-privacypolicy"><bdi class="secno">10.1.19 </bdi><code>oa:PrivacyPolicy</code></a></li><li class="tocline"><a class="tocxref" href="#oa-termsofuse"><bdi class="secno">10.1.20 </bdi><code>oa:TermsOfUse</code></a></li><li class="tocline"><a class="tocxref" href="#schema-propertyvaluespecification"><bdi class="secno">10.1.21 </bdi><code>schema:PropertyValueSpecification</code></a></li><li class="tocline"><a class="tocxref" href="#oa-shortanswerformfieldspecification"><bdi class="secno">10.1.22 </bdi><code>oa:ShortAnswerFormFieldSpecification</code></a></li><li class="tocline"><a class="tocxref" href="#oa-paragraphformfieldspecification"><bdi class="secno">10.1.23 </bdi><code>oa:ParagraphFormFieldSpecification</code></a></li><li class="tocline"><a class="tocxref" href="#oa-dropdownformfieldspecification"><bdi class="secno">10.1.24 </bdi><code>oa:DropdownFormFieldSpecification</code></a></li><li class="tocline"><a class="tocxref" href="#oa-booleanformfieldspecification"><bdi class="secno">10.1.25 </bdi><code>oa:BooleanFormFieldSpecification</code></a></li><li class="tocline"><a class="tocxref" href="#schema-propertyvalue"><bdi class="secno">10.1.26 </bdi><code>schema:PropertyValue</code></a></li></ol></li><li class="tocline"><a class="tocxref" href="#error-model"><bdi class="secno">10.2 </bdi>Error Model</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#oa-openbookingerror"><bdi class="secno">10.2.1 </bdi><code>oa:OpenBookingError</code></a></li><li class="tocline"><a class="tocxref" href="#oa-openbookingerror-subclasses"><bdi class="secno">10.2.2 </bdi><code>oa:OpenBookingError</code> subclasses</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#order-creation-orderquote-orderproposal-and-order-error-responses"><bdi class="secno">10.2.2.1 </bdi>Order Creation - <code>OrderQuote</code>, <code>OrderProposal</code> and <code>Order</code> error responses</a></li><li class="tocline"><a class="tocxref" href="#order-cancellation-orderquote-orderproposal-and-order-error-responses"><bdi class="secno">10.2.2.2 </bdi>Order Cancellation - <code>OrderQuote</code>, <code>OrderProposal</code> and <code>Order</code> error responses</a></li><li class="tocline"><a class="tocxref" href="#order-creation-orderitem-errors"><bdi class="secno">10.2.2.3 </bdi>Order Creation - <code>OrderItem</code> errors</a></li><li class="tocline"><a class="tocxref" href="#api-authentication"><bdi class="secno">10.2.2.4 </bdi>API authentication</a></li><li class="tocline"><a class="tocxref" href="#technical-errors"><bdi class="secno">10.2.2.5 </bdi>Technical errors</a></li><li class="tocline"><a class="tocxref" href="#generic-errors"><bdi class="secno">10.2.2.6 </bdi>Generic errors</a></li></ol></li><li class="tocline"><a class="tocxref" href="#oa-internalopenbookingerror-subclasses"><bdi class="secno">10.2.3 </bdi><code>oa:InternalOpenBookingError</code> subclasses</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#common-requirements"><bdi class="secno">11. </bdi>Common Requirements</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#versioning-policy"><bdi class="secno">11.1 </bdi>Versioning Policy</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#media-types"><bdi class="secno">11.1.1 </bdi>Media types</a></li></ol></li><li class="tocline"><a class="tocxref" href="#handling-specification-dependencies-and-extensions"><bdi class="secno">11.2 </bdi>Handling Specification Dependencies and Extensions</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#realtime-paged-data-exchange-1-0"><bdi class="secno">11.2.1 </bdi>Realtime Paged Data Exchange 1.0</a></li><li class="tocline"><a class="tocxref" href="#modelling-opportunity-data-2-x-where-x-0"><bdi class="secno">11.2.2 </bdi>Modelling Opportunity Data 2.x (where x &gt;= 0)</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#opportunity-data-extensions"><bdi class="secno">11.2.2.1 </bdi>Opportunity data extensions</a></li><li class="tocline"><a class="tocxref" href="#booking-functionality-extensions"><bdi class="secno">11.2.2.2 </bdi>Booking functionality extensions</a></li></ol></li><li class="tocline"><a class="tocxref" href="#general-extension-mechanism"><bdi class="secno">11.2.3 </bdi>General extension mechanism</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#extension-example-member-booking"><bdi class="secno">11.2.3.1 </bdi>Extension example: Member booking</a></li><li class="tocline"><a class="tocxref" href="#extension-example-additional-information-during-the-ordering-process"><bdi class="secno">11.2.3.2 </bdi>Extension example: Additional information during the ordering process</a></li><li class="tocline"><a class="tocxref" href="#extension-example-integrated-payments"><bdi class="secno">11.2.3.3 </bdi>Extension example: Integrated Payments</a></li><li class="tocline"><a class="tocxref" href="#extension-example-waiting-list-endpoint"><bdi class="secno">11.2.3.4 </bdi>Extension example: Waiting list endpoint</a></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#response-formats"><bdi class="secno">11.3 </bdi>Response formats</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#globally-unique-identifiers"><bdi class="secno">11.3.1 </bdi>Globally unique identifiers</a></li></ol></li><li class="tocline"><a class="tocxref" href="#errors"><bdi class="secno">11.4 </bdi>Errors</a></li><li class="tocline"><a class="tocxref" href="#rate-limiting"><bdi class="secno">11.5 </bdi>Rate Limiting</a></li><li class="tocline"><a class="tocxref" href="#security"><bdi class="secno">11.6 </bdi>Security</a></li><li class="tocline"><a class="tocxref" href="#authentication"><bdi class="secno">11.7 </bdi>Authentication</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#api-level-authentication-and-data-security"><bdi class="secno">11.7.1 </bdi>API level authentication and data security</a></li><li class="tocline"><a class="tocxref" href="#middleware-as-a-catalyst"><bdi class="secno">11.7.2 </bdi>Middleware as a catalyst</a></li><li class="tocline"><a class="tocxref" href="#customer-level-authentication"><bdi class="secno">11.7.3 </bdi>Customer level authentication</a></li><li class="tocline"><a class="tocxref" href="#openid-connect-booking-partner-authentication-for-multiple-seller-systems"><bdi class="secno">11.7.4 </bdi>OpenID Connect Booking Partner Authentication for Multiple Seller Systems</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#oauth-flows-and-scopes"><bdi class="secno">11.7.4.1 </bdi>OAuth Flows and Scopes</a><ol class="toc"></ol></li><li class="tocline"><a class="tocxref" href="#custom-claims"><bdi class="secno">11.7.4.2 </bdi>Custom Claims</a><ol class="toc"></ol></li></ol></li></ol></li></ol></li><li class="tocline"><a class="tocxref" href="#future-versions-of-this-api"><bdi class="secno">12. </bdi>Future versions of this API</a></li><li class="tocline"><a class="tocxref" href="#acknowledgements"><bdi class="secno">A. </bdi>Acknowledgements</a></li><li class="tocline"><a class="tocxref" href="#references"><bdi class="secno">B. </bdi>References</a><ol class="toc"><li class="tocline"><a class="tocxref" href="#normative-references"><bdi class="secno">B.1 </bdi>Normative references</a></li></ol></li></ol></nav><section class="informative" id="introduction"><h2 id="x1-introduction"><bdi class="secno">1. </bdi>Introduction<a class="self-link" aria-label="§" href="#introduction"></a></h2><p><em>This section is non-normative.</em></p><p>The document is an output of the <a href="https://www.w3.org/community/openactive/">OpenActive W3C Community Group</a>. As part of the <a href="https://www.openactive.io">OpenActive</a> initiative, the community group is developing standards that will promote the publication and use of <a href="https://www.openactive.io/modelling-opportunity-data/#categories-of-physical-activity-data">open opportunity data</a> in helping people to become more physically active.</p><p>The Community Group have already published specifications that define standard data models ([<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>]) and support the publication and harvesting of data in standard formats ([<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>]). This existing work helps increase the discovery of opportunities for people to get more active.</p><p>An <dfn data-plurals="opportunities" id="dfn-opportunity">Opportunity</dfn> (e.g. "Yoga Tuesday 14th March at 7pm") in the context of this specification is a specific instance of an <a href="https://www.openactive.io/modelling-opportunity-data/#describing-events-code-schema-event-code-"><code>Event</code></a> (or subclass of <code>Event</code>) that a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-1">Customer</a> can attend to participate in physical activity: a <code>ScheduledSession</code> within a <code>SessionSeries</code>, a <code>Slot</code> within a <code>FacilityUse</code>, a <code>HeadlineEvent</code> or a <code>CourseInstance</code> (or an <code>Event</code> within a <code>HeadlineEvent</code> or <code>CourseInstance</code>). Each <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-1">Opportunity</a> has associated <a href="https://www.openactive.io/modelling-opportunity-data/#describing-offers-code-schema-offer-code-"><code>Offer</code></a>s (e.g. "Junior (8-18) £9"), which may be free, and describe the commercial means of accessing the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-2">Opportunity</a>.</p><p><dfn id="dfn-opportunity-data">Opportunity Data</dfn> in the context of this specification is openly published data pertaining to <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-3">Opportunities</a>, 
accessible via [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] feed(s).</p><p>This specification builds on the previous work of the Community Group by defining an HTTP API that can be implemented by <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-1">Booking Systems</a> that are publishing <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-1">Opportunity Data</a>. By
allowing third-party applications ("<a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-1">Brokers</a>") to place bookings in their systems, it becomes possible for more people to participate in events or make use of leisure and sporting facilities.</p><p>The specification defines the flow of HTTP requests and responses between the
<a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-2">Booking System</a> (server) and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-2">Broker</a> (client). This includes
definitions of the overall application flow, detailed request and response
formats and the potential error conditions that applications may encounter. A high-level summary of these and their relationship to each other is provided in the <a href="#booking-flow-overview">Booking Flow overview</a>, below.</p><section id="scope-and-requirements"><h3 id="x1-1-scope-and-requirements"><bdi class="secno">1.1 </bdi>Scope and requirements<a class="self-link" aria-label="§" href="#scope-and-requirements"></a></h3><p>The focus of the initial versions of this specification will be on the simplest use cases that support guest checkout bookings via a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-3">Broker</a>.</p><p>The core functionality includes:</p><ul>
<li><strong>Guest checkout</strong> – making a booking on behalf of a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-2">Customer</a> who is assumed to be unknown to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-3">Booking System</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-1">Seller</a>, and who does not expect a persistent account to be created for them with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-2">Seller</a>.</li>
<li><strong>Pricing and availability</strong> – checking the price and current availabilty of an event or for the use of a facility.</li>
<li><strong>Booking</strong> – recording bookings in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-4">Booking System</a>.</li>
<li><strong>Tax</strong> – tax calculation by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-5">Booking System</a> exposed to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-4">Broker</a>.</li>
<li><strong>Multiple order items</strong> - bookings for multiple events and for groups of attendees.</li>
<li><strong>Child booking</strong> - booking on behalf of a child.</li>
<li><strong>Dynamic pricing</strong> – allowing the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-5">Broker</a> to vary pricing, where agreed with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-3">Seller</a>.</li>
<li><strong>Cancellation</strong> – <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-3">Customer</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-4">Seller</a> initiated cancellation .</li>
<li><strong>Access control</strong> - text, images and barcodes that can be used by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-4">Customer</a> to access the activity.</li>
</ul><p>Additional optional functionality includes:</p><ul>
<li><strong>Leasing</strong> – temporarily reserving spaces for a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-5">Customer</a> to attend an event or
make use of a facility, whilst they are placing a booking.</li>
<li><strong>Booking approval</strong> – for <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-6">Booking Systems</a> that support or require approval for bookings, including proposal negotiation and message exchange.</li>
<li><strong>Attendee Details capture</strong> – optional capturing of attendee details.</li>
<li><strong>Additional Details capture</strong> – optional capturing of additional details per-attendee for a booking.</li>
</ul><section id="out-of-scope-in-this-version"><h4 id="x1-1-1-out-of-scope-in-this-version"><bdi class="secno">1.1.1 </bdi>Out of Scope in this version<a class="self-link" aria-label="§" href="#out-of-scope-in-this-version"></a></h4><p>A number of additional requirements that relate to the booking of events and facilities are currently out of scope:</p><ul>
<li>Creating and managing accounts for <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-6">Customers</a></li>
<li>More complex pricing options, e.g. membership-based pricing</li>
<li>Waiting lists for events</li>
<li>Collecting marketing preferences from the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-7">Customer</a></li>
<li>Mandatory business-to-business tax calculation</li>
<li>Cancellation fees</li>
<li>"Subscriptions" to allow a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-8">Customer</a> to participate ad-hoc in a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-5">Seller</a>'s activity, with such participation recorded for later reconciliation</li>
<li>Refunds/cancellations after the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-4">Opportunity</a> has occurred </li>
<li>Back-office systems between <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-6">Broker</a> and <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-7">Booking System</a>, such as for payment reconciliation</li>
<li>Fine-grained control of <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-5">Opportunity</a> <a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-1">bookability</a> in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-8">Booking System</a></li>
<li>The ability to restrict specific API functionality for a particular <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-7">Broker</a> </li>
</ul><p>It is possible that future versions of this specification may include support
for these or other features. Revisions will be driven by the needs of the
community, please raise feature requests via <a href="https://github.com/openactive/open-booking-api">GitHub</a>.</p></section><section id="out-of-scope-by-design"><h4 id="x1-1-2-out-of-scope-by-design"><bdi class="secno">1.1.2 </bdi>Out of Scope by design<a class="self-link" aria-label="§" href="#out-of-scope-by-design"></a></h4><p>By design this specification will not define some types of functionality.</p><p>These have been declared as permanently out of scope because they are either
adequately covered by existing specifications, or will be covered by future
work of the OpenActive W3C Community Group.</p><p>The functionality that is currently defined as out of scope includes:</p><ul>
<li><strong>API authentication and security</strong> – while the specification recommends some best practices relating to authentication and security it does not mandate a specific means of securing an API. Implementers are free to choose the system that offers the best security for their platform and users.</li>
<li><strong>Payment processing</strong> – the design assumes that all payment handling will be coordinated by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-8">Broker</a>, in a separate payment flow. <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-9">Brokers</a> are able to use the payment and reconciliation mechanisms that provide the best options for their <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-6">Sellers</a> and <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-9">Customers</a>.</li>
<li><strong>API business models</strong> – the design is agnostic to any business models that might govern the use or provision of the API, e.g. revenue-sharing or transaction processing fees.</li>
<li><strong>Opportunity discovery</strong>  – finding, filtering and searching for <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-2">Opportunity Data</a>. This specification assumes that the client and server applications have already shared data about the relevant <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-6">Opportunities</a>, e.g. via an [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] feed containing [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] data.</li>
<li><strong>API endpoint discovery</strong>  – the means for a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-10">Broker</a> to discover the API endpoints included in this specification are included in the [<cite><a class="bibref" data-link-type="biblio" href="#bib-dataset-api-discovery" title="Dataset API Discovery">Dataset-API-Discovery</a></cite>] specification.</li>
</ul></section></section><section id="specification-dependencies"><h3 id="x1-2-specification-dependencies"><bdi class="secno">1.2 </bdi>Specification dependencies<a class="self-link" aria-label="§" href="#specification-dependencies"></a></h3><p>Version 1.0 of the Open Booking specification depends on the following:</p><ul>
<li>[<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] Version 1.0</li>
<li>[<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] Version 2.x (where x &gt;= 0)</li>
</ul><p>Note that the dependency on the [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] specification is only constrained to the major version release, and that the flexibility provided by supporting minor versions (which do not include breaking changes) enables implementors to take advantage of additional features as the specification evolves.</p></section><section id="audience"><h3 id="x1-3-audience"><bdi class="secno">1.3 </bdi>Audience<a class="self-link" aria-label="§" href="#audience"></a></h3><p>The document is primarily intended for the following audiences:</p><ul>
<li>Software developers who want to implement the API, e.g. as part of a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-9">Booking System</a></li>
<li>Software developers building client libraries or tools</li>
<li>Software developers writing applications that will use the API ("<a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-11">Brokers</a>") </li>
</ul><p>The following sections introduce terminology, concepts and requirements that
underpin the design of the API. This content might also be useful for a wider
audience, e.g. business analysts or product managers looking for a high-level
overview of the API functionality.</p></section></section><section id="conformance"><h2 id="x2-conformance"><bdi class="secno">2. </bdi>Conformance<a class="self-link" aria-label="§" href="#conformance"></a></h2><p>As well as sections marked as non-normative, all authoring guidelines, diagrams, examples, and notes in this specification are non-normative. Everything else in this specification is normative.</p><p>
        The key words <em class="rfc2119">MAY</em>, <em class="rfc2119">MUST</em>, <em class="rfc2119">MUST NOT</em>, <em class="rfc2119">NOT RECOMMENDED</em>, <em class="rfc2119">NOT REQUIRED</em>, <em class="rfc2119">OPTIONAL</em>, <em class="rfc2119">RECOMMENDED</em>, <em class="rfc2119">REQUIRED</em>, <em class="rfc2119">SHOULD</em>, and <em class="rfc2119">SHOULD NOT</em> in this document
        are to be interpreted as described in
        <a href="https://tools.ietf.org/html/bcp14">BCP 14</a>
        [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">RFC2119</a></cite>] [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc8174" title="Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words">RFC8174</a></cite>]
        when, and only when, they appear in all capitals, as shown here.
      </p><p>This specification makes use of the compact IRI Syntax; please refer to the
<a href="https://www.w3.org/TR/json-ld/#compact-iris">Compact IRIs</a> section from [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>].</p></section><section id="typographical-conventions"><h2 id="x3-typographical-conventions"><bdi class="secno">3. </bdi>Typographical Conventions<a class="self-link" aria-label="§" href="#typographical-conventions"></a></h2><p>The following typographic conventions are used in this specification:</p><dl class="typography">
    <dt><code>markup</code></dt>
    <dd>Markup (elements, attributes, properties), machine processable
        values (string, characters, media types), property name, or a
        file name is in a monospace font.</dd>
    <dt><a href="" class="internalDFN">Definition</a></dt>
    <dd>A definition of a term, to be used elsewhere in this or other
        specifications, is underlined and in black.</dd>
    <dt><a href="">hyperlink</a></dt>
    <dd>A hyperlink is underlined and in blue.</dd>
    <dt>[<a href="">reference</a>]</dt>
    <dd>A document reference (normative or informative) is enclosed in
        square brackets and links to the references section.</dd>
</dl><div class="note" role="note" id="issue-container-generatedID-0"><div role="heading" class="note-title marker" id="h-note-0" aria-level="3"><span>Note</span></div><div class="">


<p>Notes are in light green boxes with a green left border and with a "Note"
header in green. Notes are normative or informative depending on the whether
they are in a normative or informative section, respectively.</p>
</div></div><div class="example" id="example-1">
        <div class="marker">
    <a class="self-link" href="#example-1">Example<bdi> 1</bdi></a>
  </div> <pre aria-busy="false"><code class="hljs css">Examples are in light khaki boxes, with khaki <span class="hljs-attribute">left</span> <span class="hljs-attribute">border</span>, and with <span class="hljs-selector-tag">a</span>
numbered "Example" <span class="hljs-selector-tag">header</span> in khaki. Examples are always informative.
The <span class="hljs-attribute">content</span> of the example is in monospace <span class="hljs-attribute">font</span> and may be syntax colored.</code></pre>
      </div></section><section id="key-actors"><h2 id="x4-key-actors"><bdi class="secno">4. </bdi>Key Actors<a class="self-link" aria-label="§" href="#key-actors"></a></h2><p>Of all the organisations and systems involved in a transaction, the API defined
by this specification is scoped tightly to only specify interactions between the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-12">Broker</a> and
<a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-10">Booking System</a>, with high level prompts for interactions with <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-10">Customers</a>, <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-7">Sellers</a> and <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-1">Payment Providers</a>.</p><figure id="fig-illustration-of-actors-and-systems-involved-in-a-transaction-and-the-focus-of-this-specification-being-between-broker-and-booking-system">
 <img src="actors.png" alt="Actors in scope" height="314" width="696">
 <figcaption>Figure <bdi class="figno">1</bdi> <span class="fig-title">Illustration of actors and systems involved in a transaction, and the focus
 of this specification being between <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-13">Broker</a> and <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-11">Booking System</a>.</span></figcaption>
</figure><dl class="typography">
    <dt><dfn data-plurals="customers" id="dfn-customer">Customer</dfn></dt>
    <dd>The user who places a booking using an application provided by a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-14">Broker</a>. The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-11">Customer</a> is not necessarily the attendee, e.g. a parent may book on behalf of their child.</dd>
    <dt><dfn data-plurals="brokers" id="dfn-broker">Broker</dfn></dt>
    <dd>The organisation, independent of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-8">Seller</a>, that provides an application allowing <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-12">Customers</a> to make bookings. For simplicity the API client is referred to as the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-15">Broker</a> throughout this specification, however other API clients are permissible, and "<a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-1">Booking Partner</a>" is the collective term for different types of clients of this API.</dd>
    <dt><dfn data-plurals="booking systems" id="dfn-booking-system">Booking System</dfn></dt>
    <dd>The organisation providing an application that maintains bookable inventory on behalf of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-9">Seller</a>. The platform or service that provides a server-side implementation of this API.</dd>
    <dt><dfn data-plurals="sellers" id="dfn-seller">Seller</dfn></dt>
    <dd>The organisation providing access to events or facilities via a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-12">Booking System</a> e.g. a leisure provider running yoga classes.</dd>
    <dt><dfn data-plurals="payment providers" id="dfn-payment-provider">Payment Provider</dfn></dt>
    <dd>The notional service providing payment processing between the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-13">Customer</a>, <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-16">Broker</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-10">Seller</a>. Although this specification refers to the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-2">Payment Provider</a> as a single notional service, it may in reality be composed of multiple connected services providing the same functionality to allow for the widest variety of business models.</dd>
</dl></section><section class="normative" id="booking-flows"><h2 id="x5-booking-flows"><bdi class="secno">5. </bdi>Booking Flows<a class="self-link" aria-label="§" href="#booking-flows"></a></h2><p>This specification includes two main booking flows: a <a href="#simple-booking-flow">Simple Booking Flow</a>, and a <a href="#booking-flow-with-approval">Booking Flow with Approval</a> that builds on the <a href="#simple-booking-flow">Simple Booking Flow</a>. The two flows are largely identical, with the addition of a (possibly iterative) approval step in the <a href="#booking-flow-with-approval">Booking Flow with Approval</a>.</p><section id="booking-flow-overview"><h3 id="x5-1-booking-flow-overview"><bdi class="secno">5.1 </bdi>Booking flow overview<a class="self-link" aria-label="§" href="#booking-flow-overview"></a></h3><p>Described in the broadest possible terms, the Open Booking API defined by this specification supplies the technical means whereby a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-17">Broker</a> can book a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-14">Customer</a> into an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-7">Opportunity</a> for a physical activity, by means of an <code>Offer</code> provided by a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-11">Seller</a>. Typically, although not always, a <a href="#dfn-payment" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-1">Payment</a> will have to be made for this <code>Order</code>.</p><p>While this process is intuitively clear, some of its implications may be less so, and a number of common use-cases introduce a degree of additional complexity into the flow. For instance, a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-15">Customer</a> will typically want to have an idea of how much a given <code>Offer</code> will cost before committing to attending an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-8">Opportunity</a>. This means that before an <code>Order</code> can be created, an <code>OrderQuote</code> (a subclass of <code>Order</code>) needs to be provided. In addition, many <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-12">Seller</a>s will need to review their <code>Order</code>s before deciding to approve them because, for instance, they need to allocate shared resources such as caretakers to a number of <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-16">Customers</a>. This is the motivation for the <a href="#booking-flow-with-approval">Booking Flow with Approval</a> sequence, and introduces to the flow the concept of <code>OrderProposal</code>s - another subclass of <code>Order</code>, which allows (re)modification by both parties and that requires explicit consent from both <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-17">Customer</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-13">Seller</a> before a new <code>Order</code> is created.</p><p>The process of creating an <code>Order</code> online takes time, and for this reason some <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-14">Sellers</a> and <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-18">Brokers</a> may optionally offer their users a <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-1">Lease</a> - a provisional reservation of an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-9">Opportunity</a>  that prevents it from being sold while the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-18">Customer</a> is in the process of booking it.</p><p>Typically <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-15">Sellers</a> keep track of bookings by means of an automated <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-13">Booking System</a>. This raises the problem of ensuring consistency in the state of information between the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-14">Booking System</a> and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-19">Broker</a>. This difficulty is bridged by the concept of <code>Order</code> feeds, which publish all changes made to an <code>Order</code> by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-15">Booking System</a> after its initial successful response to the client's request to create it, and which is intended for consumption only by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-20">Broker</a>.</p><p>The process of creating an <code>Order</code> will normally involve the processing of a <a href="#dfn-payment" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-2">Payment</a>. While <a href="#dfn-payment" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-3">Payments</a> are normally fixed, some approaches to pricing also allow for the possibility of a <code>DynamicPayment</code>, whereby the price may fluctuate based on external conditions. In addition, differences in approaches to taxation - whether because of regional variation, or because of the legal and commercial status of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-21">Broker</a>  - result in a need for some nuances in the modelling of <code>TaxChargeSpecification</code>s.</p><p>Additionally, transactions between <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-19">Customers</a>, <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-22">Brokers</a>, and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-16">Sellers</a> may be subject to various legal and regulatory <code>Terms</code>, such as a <code>PrivacyPolicy</code> and <code>TermsOfUse</code>.</p></section><section id="booking-flow-modularity"><h3 id="x5-2-booking-flow-modularity"><bdi class="secno">5.2 </bdi>Booking flow modularity<a class="self-link" aria-label="§" href="#booking-flow-modularity"></a></h3><p>This specification is designed to provide a minimal core <a href="#simple-booking-flow">Simple Booking Flow</a>, which should be straightforward to implement.</p><p>This specification also provides optional features, which allows the minimal core implementation to be augmented depending on the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-16">Booking System</a>'s requirements:</p><ul>
<li><a href="#leasing">Leasing</a> (<code>Lease</code>)</li>
<li><a href="#attendee-details-capture">Attendee Details capture</a> (<code>https://openactive.io/OpenBookingAttendeeDetails</code>)</li>
<li><a href="#additional-details-capture">Additional Details capture</a> (<code>https://openactive.io/OpenBookingIntakeForm</code>)</li>
<li><a href="#minimal-proposal-implementation">Minimal Proposal Implementation</a> (<code>https://openactive.io/OpenBookingApproval</code>)</li>
<li><a href="#proposal-amendment">Proposal Amendment</a> (<code>https://openactive.io/OpenBookingNegotiation</code>)</li>
<li><a href="#message-exchange">Message Exchange</a> (<code>https://openactive.io/OpenBookingMessageExchange</code>)</li>
</ul></section><section id="booking-pre-conditions"><h3 id="x5-3-booking-pre-conditions"><bdi class="secno">5.3 </bdi>Booking pre-conditions<a class="self-link" aria-label="§" href="#booking-pre-conditions"></a></h3><p>In order to enter either of the booking flows described in this specification, the following pre-conditions must be met:</p><ul>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-23">Broker</a> <em class="rfc2119">MUST</em> obtain <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-3">Opportunity Data</a> that includes descriptions of <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-10">Opportunities</a>, by frequently harvesting data via <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-4">Opportunity Data</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] open feeds provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-17">Booking System</a>.</p>
</li>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-24">Broker</a> <em class="rfc2119">MUST</em> present an up-to-date view of availability data for the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-20">Customer</a> to select items to book, as this data may change over time.</p>
</li>
<li><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-18">Booking System</a> <em class="rfc2119">MUST</em> ensure that the <code>remainingAttendeeCapacity</code> and <code>remainingUses</code> properties in the <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-5">Opportunity Data</a> are up-to-date.</p>
</li>
<li><p>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-21">Customer</a> <em class="rfc2119">MUST</em> have selected at least one <a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-2">bookable</a> pair of an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-11">Opportunity</a> ("Yoga Tuesday 14th 7pm") with an associated <code>Offer</code> ("Junior (8-18) £9"). These pairs populate the <code>orderedItem</code> and <code>acceptedOffer</code> properties within the submitted <code>OrderItem</code>s, respectively.</p>
</li>
<li><p>It is not possible for <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-12">Opportunities</a> from different <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-17">Sellers</a> or with different <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-25">Brokers</a> or on behalf of different <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-22">Customers</a> to be combined in the same <code>Order</code>.</p>
</li>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-26">Broker</a> <em class="rfc2119">MUST</em> generate an <dfn id="dfn-order-uuid">Order UUID</dfn>, which is a unique UUID string representation strictly as defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc4122" title="A Universally Unique IDentifier (UUID) URN Namespace">RFC4122</a></cite>].</p>
</li>
</ul></section><section id="simple-booking-flow"><h3 id="x5-4-simple-booking-flow"><bdi class="secno">5.4 </bdi>Simple Booking Flow<a class="self-link" aria-label="§" href="#simple-booking-flow"></a></h3><section id="customer-journey"><h4 id="x5-4-1-customer-journey"><bdi class="secno">5.4.1 </bdi>Customer Journey<a class="self-link" aria-label="§" href="#customer-journey"></a></h4><p>The booking journey of a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-23">Customer</a> is generalised into the following logical steps:</p><figure id="fig-illustration-of-a-typical-customer-journey">
 <img src="userjourney.png" alt="High level customer journey" height="141" width="939">
 <figcaption>Figure <bdi class="figno">2</bdi> <span class="fig-title">Illustration of a typical <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-24">Customer</a> journey.</span></figcaption>
</figure><ol>
<li><strong>Select</strong>: <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-25">Customer</a> selects at least one <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-13">Opportunity</a> (e.g. <code>ScheduledSession</code> or <code>Slot</code>) and an associated <code>Offer</code> ("Junior (8-18) £9")</li>
<li><strong>Identify</strong>: <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-26">Customer</a> submits personal details and other requested details</li>
<li><strong>Book and Pay</strong>: <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-27">Customer</a> submits payment details</li>
</ol><p>Note that some or all steps may be skipped, or may not be presented to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-28">Customer</a>, e.g. if their registration or payment details are already known, or they are using a voice interface. These steps are not indicative of the user experience, and simply provide a common language around the flow.</p></section><section id="high-level-api-flow"><h4 id="x5-4-2-high-level-api-flow"><bdi class="secno">5.4.2 </bdi>High-level API flow<a class="self-link" aria-label="§" href="#high-level-api-flow"></a></h4><figure id="fig-illustration-of-high-level-booking-flow">
 <img src="bookingflow.png" alt="High level booking flow" height="667" width="866">
 <figcaption>Figure <bdi class="figno">3</bdi> <span class="fig-title">Illustration of high level booking flow.</span></figcaption>
</figure><ul>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-27">Broker</a> generates an <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-1">Order UUID</a>, which is used to uniquely identify the <code>OrderQuote</code> / <code>Order</code> throughout the process.</p>
</li>
<li><p>After "<strong>1. Select</strong>" the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-28">Broker</a> calls the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-19">Booking System</a> to confirm an indicative price and the availability of the selected items using an <code>OrderQuote</code>, and retrieve a total order price. Any details that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-29">Customer</a> needs to supply to complete the booking are also specified. This is checkpoint <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-1"><b>C1</b></a> on the diagram above.</p>
</li>
<li><p>After "<strong>2. Identify</strong>" the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-29">Broker</a> calls the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-20">Booking System</a> to reconfirm the price and availability of the selected items using an <code>OrderQuote</code>, using all personal details required, and retrieve a total order price. Explicit consent for any terms and conditions is also captured at this stage if required. This is checkpoint <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-1"><b>C2</b></a> on the diagram above.</p>
</li>
<li><p>After "<strong>3. Book and Pay</strong>", the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-30">Broker</a> first <em>pre-authorizes</em> the payment for the total order price (if required by the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-3">Payment Provider</a>), then confirms the booking with the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-21">Booking System</a> using an <code>Order</code> (<a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-1"><b>B</b></a> on the diagram above), and finally <em>captures</em> the payment. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-31">Broker</a> then generates invoices, and sends the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-30">Customer</a> notifications.</p>
</li>
<li><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-22">Booking System</a> adds the <code>Order</code> to an <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-1">Orders feed</a> specific to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-32">Broker</a>, which the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-33">Broker</a> reads to update its internal state, including those updates resulting from cancellations.</p>
</li>
</ul></section><section id="leasing"><h4 id="x5-4-3-leasing"><bdi class="secno">5.4.3 </bdi>Leasing<a class="self-link" aria-label="§" href="#leasing"></a></h4><p>Customers may simultaneously attempt to book the same <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-14">Opportunity</a> (e.g. space in an event or <code>Slot</code> of a facility), and hence contend with one another for a limited number of <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-15">Opportunities</a>. In order to ensure that items cannot be "stolen" from a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-31">Customer</a>'s "shopping basket" by another <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-32">Customer</a>, some <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-23">Booking Systems</a> use the concept of a <dfn data-plurals="leases" id="dfn-lease">Lease</dfn>, a temporary reservation that provides a window during which a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-33">Customer</a> can complete their customer journey and improves the user experience overall.</p><p>The design of this API supports the use of time-bound <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-2">Leases</a>. Using <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-3">Leases</a> is <em class="rfc2119">RECOMMENDED</em>, however they are not required, in order to ensure a low barrier of entry for implementors of the specification.</p><p>Individually at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-2"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-2"><b>C2</b></a>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-24">Booking System</a> can opt to create (or extend) a <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-4">Lease</a> for the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-34">Broker</a>. Whether they opt to do so may depend on the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-25">Booking System</a>'s capability to support <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-5">Leases</a>, or on the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-18">Seller</a>'s configuration of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-26">Booking System</a>. </p><p>At <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-3"><b>C1</b></a> an <dfn id="dfn-anonymous-lease">Anonymous Lease</dfn> <em class="rfc2119">MAY</em> be created i.e. a <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-6">Lease</a> for a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-34">Customer</a> that has not yet provided any personal details.</p><p>At <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-3"><b>C2</b></a> a <dfn id="dfn-named-lease">Named Lease</dfn> <em class="rfc2119">MAY</em> be created i.e. a <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-7">Lease</a> for a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-35">Customer</a> who has identified themselves via personal details and other additional details. Any existing <a href="#dfn-anonymous-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-anonymous-lease-1">Anonymous Lease</a> becomes a <a href="#dfn-named-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-named-lease-1">Named Lease</a> when the customer's personal details are provided (even if the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-27">Booking System</a> does not store them at this stage).</p><p>If a <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-8">Lease</a> is created at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-4"><b>C1</b></a> and/or <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-4"><b>C2</b></a> it is used during <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-2"><b>B</b></a>. However, if no <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-9">Lease</a> is created, or if it had expires prior to the transaction being completed, the booking completes anyway provided sufficient inventory is available.</p><p>It is <em class="rfc2119">RECOMMENDED</em> that if the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-28">Booking System</a> supports leasing, it also guarantees the price of each leased item for the duration of the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-10">Lease</a>, so that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-36">Customer</a> is guaranteed to pay the price they have seen during <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-5"><b>C2</b></a>.</p><p>The specification is designed to allow <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-35">Brokers</a> to be agnostic to <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-11">Leases</a>: should a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-29">Booking System</a> be upgraded to support these, it can do so without affecting the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-36">Broker</a>'s implementation.</p><p>By design, then, the use of <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-12">Leases</a> is largely transparent to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-37">Broker</a>. However, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-30">Booking System</a> <em class="rfc2119">MUST</em> provide information on the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-13">Lease</a> to help improve the user experience of the customer journey as follows: when a <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-14">Lease</a> is created, a <code>Lease</code> object <em class="rfc2119">MUST</em> be returned in the <code>OrderQuote</code>.</p><div class="example" id="example-2-example-of-lease">
        <div class="marker">
    <a class="self-link" href="#example-2-example-of-lease">Example<bdi> 2</bdi></a><span class="example-title">: Example of lease</span>
  </div> <pre aria-busy="false"><code class="hljs css">"lease": {
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"Lease"</span>,
  <span class="hljs-string">"leaseExpires"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>
}</code></pre>
      </div><p>The <code>leaseExpires</code> <em class="rfc2119">MAY</em> be used to inform the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-37">Customer</a> of the time they have remaining.</p></section><section id="high-level-type-flow"><h4 id="x5-4-4-high-level-type-flow"><bdi class="secno">5.4.4 </bdi>High-level type flow<a class="self-link" aria-label="§" href="#high-level-type-flow"></a></h4><figure id="fig-illustration-of-types-used-during-the-api-flow">
 <img src="typeflow.png" alt="High level type flow" height="181" width="731">
 <figcaption>Figure <bdi class="figno">4</bdi> <span class="fig-title">Illustration of types used during the API flow.</span></figcaption>
</figure><p>The <code>OrderQuote</code> is an ephemeral draft of the <code>Order</code> while it is being constructed by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-38">Customer</a>.</p><ul>
<li><a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-5"><b>C1</b></a> - <code>OrderQuote</code> without enough personal details or additional details to be accepted as an <code>Order</code>.</li>
<li><a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-6"><b>C2</b></a> - <code>OrderQuote</code> with complete and validated detail, enough to be created successfully as an <code>Order</code>.</li>
<li><a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-3"><b>B</b></a> - <code>Order</code> exists in an instantly successful state in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-31">Booking System</a>, though it transitions through <code>orderCreationStatus</code> states in the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-38">Broker</a>.</li>
</ul></section><section id="order-statuses"><h4 id="x5-4-5-order-statuses"><bdi class="secno">5.4.5 </bdi>Order statuses<a class="self-link" aria-label="§" href="#order-statuses"></a></h4><p>To simplify the implementation for the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-32">Booking System</a>, the creation of an <code>Order</code> is considered atomic to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-33">Booking System</a> (it succeeds or fails at once in <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-4"><b>B</b></a>), and by contrast is considered to consist of steps to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-39">Broker</a>. </p><section id="order-statuses-in-the-booking-system"><h5 id="x5-4-5-1-order-statuses-in-the-booking-system"><bdi class="secno">5.4.5.1 </bdi>Order statuses in the Booking System<a class="self-link" aria-label="§" href="#order-statuses-in-the-booking-system"></a></h5><p>In this version of the specification the <code>Order</code> within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-34">Booking System</a> <em class="rfc2119">MUST NOT</em> have a status, it exists atomically in a successfully created state. Although <code>OrderItem</code>s may be cancelled by either the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-39">Customer</a> or the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-19">Seller</a>, the <code>Order</code> itself within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-35">Booking System</a> is simply a container. The <code>orderStatus</code> property of the <code>Order</code> <em class="rfc2119">MUST NOT</em> be used and is reserved for future evolution of the specification.</p><p>The <code>orderCreationStatus</code> is maintained by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-40">Broker</a> only during this flow, and <em class="rfc2119">MUST NOT</em> be sent to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-36">Booking System</a>.</p></section><section id="order-statuses-in-the-broker"><h5 id="x5-4-5-2-order-statuses-in-the-broker"><bdi class="secno">5.4.5.2 </bdi>Order statuses in the Broker<a class="self-link" aria-label="§" href="#order-statuses-in-the-broker"></a></h5><p>Throughout "Book and Pay" section of this flow the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-41">Broker</a> maintains the <code>orderCreationStatus</code> property in its copy of the <code>Order</code>, which is not sent to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-37">Booking System</a>. This allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-42">Broker</a> to consistently rollback in the case of failure.</p><p>The <code>orderCreationStatus</code> statuses are defined as follows:</p><ol>
<li><a href="https://openactive.io/OrderCreationPaymentAuthorized">https://openactive.io/OrderCreationPaymentAuthorized</a> - after successful <a href="#dfn-payment-authorisation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-authorisation-1">Payment Authorisation</a></li>
<li><a href="https://openactive.io/OrderCreationPaymentDue">https://openactive.io/OrderCreationPaymentDue</a> - after successful <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-5"><b>B</b></a></li>
<li><a href="https://openactive.io/OrderCreationPaymentCaptured">https://openactive.io/OrderCreationPaymentCaptured</a> - after successful <a href="#dfn-payment-capture" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-capture-1">Payment Capture</a></li>
<li><a href="https://openactive.io/OrderCreationComplete">https://openactive.io/OrderCreationComplete</a> - after successful <a href="#dfn-invoice-generation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-generation-1">Invoice Generation</a> and <a href="#dfn-customer-notification" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-notification-1">Customer Notification</a></li>
</ol><p>An <code>Order</code> <em class="rfc2119">MUST NOT</em> be communicated externally by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-43">Broker</a> and other operations such as cancellation <em class="rfc2119">MUST NOT</em> be possible until it has reached the <code>orderCreationStatus</code> of <code>https://openactive.io/OrderCreationComplete</code>, after which the <code>orderCreationStatus</code> can be ignored.</p></section></section><section id="step-by-step-process-description"><h4 id="x5-4-6-step-by-step-process-description"><bdi class="secno">5.4.6 </bdi>Step-by-step process description<a class="self-link" aria-label="§" href="#step-by-step-process-description"></a></h4><figure id="fig-sequence-diagram-showing-api-interactions">
 <img src="sequencediagram.png" alt="Sequence diagram" height="720" width="767">
 <figcaption>Figure <bdi class="figno">5</bdi> <span class="fig-title">Sequence diagram showing API interactions</span></figcaption>
</figure><p>i) "<strong>1. Select</strong>" - <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-40">Customer</a> browses <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-44">Broker</a> site anonymously and adds something to basket</p><ul>
<li><a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-45">Broker</a> <em class="rfc2119">MUST</em> have determined at least one Open Booking <a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-3">bookable</a> <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-16">Opportunity</a> each with an associated applicable <code>Offer</code> from the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-41">Customer</a>'s browsing, using the most up-to-date <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-6">Opportunity Data</a>.</li>
<li><a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-46">Broker</a> generates an <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-2">Order UUID</a>.</li>
<li>If any catastrophic failure occurs during the booking flow (any error with status code 500, or when the request consistently returns status code 503 after a number of retries) the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-3">Order UUID</a> <em class="rfc2119">MUST</em> be regenerated to allow for a clean retry of the booking. The <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-4">Order UUID</a> <em class="rfc2119">MUST NOT</em> be regenerated for expected errors (status code 4xx).</li>
</ul><p>ii) <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-6"><b>C1</b></a> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-47">Broker</a> call with <code>OrderQuote</code> including the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-5">Order UUID</a>, without a <code>customer</code> object, to check availability and that the combination of items requested can be purchased, <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-38">Booking System</a> responds with an <code>OrderQuote</code> including any <code>error</code>s against each <code>OrderItem</code>.</p><ul>
<li><a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-39">Booking System</a> creates <a href="#dfn-anonymous-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-anonymous-lease-2">Anonymous Lease</a> for that <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-6">Order UUID</a> if it is supported, otherwise it provides a simple availability and <code>totalPaymentDue</code> confirmation. An <code>OrderQuote</code> response with HTTP Status 200 <em class="rfc2119">MUST</em> be returned if the all requested items are available.</li>
<li>If a <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-15">Lease</a> has been created, then the <code>OrderQuote</code> in the response <em class="rfc2119">MUST</em> include a <code>lease</code> property containing a valid <code>Lease</code> object.</li>
<li>The <code>OrderQuote</code> response <em class="rfc2119">MUST</em> include <code>totalPaymentDue</code>, which allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-48">Broker</a> to update any UI with the total.</li>
<li>The <code>OrderQuote</code> response <em class="rfc2119">MUST</em> include a list of <code>OrderItem</code>s which contain their respective <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-17">Opportunity</a> objects, including enough detail to allow the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-49">Broker</a> to communicate key information about the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-18">Opportunity</a> to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-42">Customer</a> (rather than relying on the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-50">Broker</a> having the most up-to-date <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-19">Opportunity</a> data from the open feeds at the point of purchase).</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-40">Booking System</a> <em class="rfc2119">MUST</em> ensure that the data returned to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-51">Broker</a> in the <code>remainingAttendeeCapacity</code> and <code>remainingUses</code> properties are up-to-date, including places already booked and those currently reserved by any <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-16">Leases</a> from competing <code>OrderQuote</code>s, but excluding those places already reserved for this <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-7">Order UUID</a> by previous calls to <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-7"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-7"><b>C2</b></a>.</li>
<li>The <code>OrderQuote</code> response <em class="rfc2119">MUST</em> specify any additional details required to complete the booking for the selected <code>OrderItem</code>s via an <code>orderItemIntakeForm</code>.</li>
<li>If there are any issues with the <code>OrderItem</code>s requested in the <code>OrderQuote</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-41">Booking System</a> <em class="rfc2119">MUST</em> respond with a <code>409 Conflict</code> response, with <code>error</code> details provided against each offending <code>OrderItem</code>. </li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-42">Booking System</a> <em class="rfc2119">MUST</em> reflect back all properties defined by this specification that are supplied by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-52">Broker</a>'s request in its response, including <code>broker</code> and <code>brokerRole</code>, to acknowledge they have been recognised (even if they have not actually been stored by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-43">Booking System</a>). The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-44">Booking System</a> <em class="rfc2119">MUST NOT</em> reflect back extension properties outside of this specification unless it explicitly supports them.</li>
<li>If a viable payment reconciliation route is available between the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-53">Broker</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-20">Seller</a> that requires more than just the <code>identifier</code> property of the <code>Payment</code> to be included in <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-6"><b>B</b></a>, the <code>payment</code> property <em class="rfc2119">MUST</em> be included at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-8"><b>C1</b></a>, as per <a href="#payment-reconciliation-detail-validation">Payment reconciliation detail validation</a>. This ensures that a viable payment reconciliation route is available before the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-43">Customer</a> starts to enter their data.</li>
<li><code>OrderItem</code>s have no <code>orderItemStatus</code>.</li>
</ul><p>iii) "<strong>2. Identify</strong>" - <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-44">Customer</a> submits personal details and any other additional details requested</p><ul>
<li>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-45">Customer</a> <em class="rfc2119">MUST</em> have been informed that their personal information is being submitted to the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-21">Seller</a>.</li>
<li>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-46">Customer</a> <em class="rfc2119">MUST</em> have been made aware of any relevant <code>termsOfService</code>, for example by displaying a link to them prominently, before submitting their personal details.</li>
<li>If <code>requiresExplicitConsent</code> is <code>true</code> for any <code>termsOfService</code> then the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-47">Customer</a> <em class="rfc2119">MUST</em> only be allowed to proceed if they have explicitly acted to consent to the most recently modified version of such terms. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-54">Broker</a> <em class="rfc2119">MAY</em> remember the consent previously given by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-48">Customer</a> based on the <code>url</code> and <code>dateModified</code> of the <code>Terms</code>, only if <code>dateModified</code> is provided, and if consent for storing such preferences is given by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-49">Customer</a>.</li>
<li><code>attendee</code> and <code>orderItemIntakeFormResponse</code> data is be captured at this stage if specified via <code>attendeeDetailsRequired</code> and <code>orderItemIntakeForm</code> in the <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-9"><b>C1</b></a> response, respectively.</li>
<li>If <a href="#booking-without-payment">payment initiation is optional</a>, the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-50">Customer</a> <em class="rfc2119">MAY</em> be given the option to prepay or simply reserve a space without payment. Providing optionality of payment to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-51">Customer</a> is at the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-55">Broker</a>'s discretion.</li>
</ul><p>iv) <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-8"><b>C2</b></a> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-56">Broker</a> call with <code>OrderQuote</code> including the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-8">Order UUID</a>, with a <code>customer</code> object, and any <code>orderItemIntakeFormResponse</code> required, <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-45">Booking System</a> responds with an <code>OrderQuote</code> including any <code>error</code>s against each <code>OrderItem</code>.</p><ul>
<li><a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-46">Booking System</a> creates <a href="#dfn-named-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-named-lease-2">Named Lease</a> for that <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-9">Order UUID</a> if it is supported, otherwise it provides a simple availability and <code>totalPaymentDue</code> confirmation. Works exactly as <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-10"><b>C1</b></a>, except validates <code>payment</code> details, <code>customer</code> details, any <code>attendee</code> details, and the <code>orderItemIntakeFormResponse</code>.</li>
<li><a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-57">Broker</a> presents the contents of the <code>OrderQuote</code> to the <code>Customer</code> to ensure they have the most up-to-date price and availability before proceeding with the purchase.</li>
<li>If there are any issues with the <code>OrderItem</code>s requested in the <code>OrderQuote</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-47">Booking System</a> <em class="rfc2119">MUST</em> respond with a <code>409 Conflict</code> response, with <code>error</code> details provided against each offending <code>OrderItem</code> - including if an <code>OrderItem</code> is no longer available, cannot be purchased in combination with another <code>OrderItem</code>, or does not contain a sufficient <code>orderItemIntakeFormResponse</code>.</li>
<li>Any <code>error</code>s must be resolved by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-52">Customer</a> or <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-58">Broker</a> before proceeding, by amending the <code>OrderItem</code>s included in the <code>OrderQuote</code> and resubmitting until an <code>OrderQuote</code> is returned without <code>error</code>s.</li>
<li>If a viable payment reconciliation route is available between the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-59">Broker</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-22">Seller</a> that requires more than just the <code>identifier</code> property of the <code>Payment</code> to be included in <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-7"><b>B</b></a>, the <code>payment</code> property <em class="rfc2119">MUST</em> be included at <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-9"><b>C2</b></a>, as per <a href="#payment-reconciliation-detail-validation">Payment reconciliation detail validation</a>.</li>
<li><code>OrderItem</code>s have no <code>orderItemStatus</code>.</li>
</ul><p>v) "<strong>3. Book and Pay</strong>" - <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-53">Customer</a> submits payment details and clicks Book</p><ul>
<li><p>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-54">Customer</a> <em class="rfc2119">MUST</em> only be allowed to proceed if no <code>OrderItem</code>s in the <code>OrderQuote</code> contain any <code>error</code>s.</p>
</li>
<li><p>If <a href="#booking-without-payment">payment is not to be initiated</a> or <code>totalPaymentDue</code> is <code>0</code>, payment details <em class="rfc2119">MUST NOT</em> be captured.</p>
</li>
</ul><p>vi) <dfn id="dfn-payment-authorisation">Payment Authorisation</dfn> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-60">Broker</a> pre-authorises <code>totalPaymentDue</code> from <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-4">Payment Provider</a></p><ul>
<li><p>The <code>Order</code> <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-1"><code><code>@id</code></code></a>, which includes the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-10">Order UUID</a>, and will be generated by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-61">Broker</a> to make the PUT call at <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-8"><b>B</b></a> (the <code>Order</code> <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-2"><code><code>@id</code></code></a> is also the PUT endpoint URL), <em class="rfc2119">SHOULD</em> be used as a reference in the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-5">Payment Provider</a>, if possible.</p>
</li>
<li><p>If <a href="#booking-without-payment">payment was not initiated</a> or <code>totalPaymentDue</code> is <code>0</code>, pre-authorisation <em class="rfc2119">MUST NOT</em> be taken.</p>
</li>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-62">Broker</a> <em class="rfc2119">MUST</em> store the <code>Order</code> request with an <code>orderCreationStatus</code> of <code>https://openactive.io/OrderCreationPaymentAuthorized</code> at this point, even if pre-authorisation is not taken, in order to ensure that the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-11">Order UUID</a> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-2">Orders feed</a> is recognised without a race condition. Such a condition might arise in the (admittedly unlikely) event of, e.g., an <code>Order</code> that is created at <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-9"><b>B</b></a> and then immediately cancelled by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-48">Booking System</a>, which could result in the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-63">Broker</a> receiving an unrecognised <code>Order</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-3">Orders feed</a> if it was retrieved before the call to <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-10"><b>B</b></a> returned.</p>
</li>
</ul><p>vii) <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-11"><b>B</b></a> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-64">Broker</a> call with an <code>Order</code> including the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-12">Order UUID</a>, with a <code>customer</code> object, and any <code>orderItemIntakeFormResponse</code> required, and <code>totalPaymentDue</code> including the total amount pre-authed; the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-49">Booking System</a> responds with an <code>Order</code>.</p><ul>
<li><p>If <a href="#booking-without-payment">payment was not initiated</a> or <code>totalPaymentDue</code> is <code>0</code>, the <code>payment</code> property <em class="rfc2119">MUST NOT</em> be included in the <code>Order</code> request or response, and the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-50">Booking System</a> <em class="rfc2119">MUST</em> proceed to create a payment-free <code>Order</code>. </p>
</li>
<li><p>Error responses <em class="rfc2119">MUST</em> be returned for any <a href="#payment-error-conditions">Payment Error Conditions</a>.</p>
</li>
<li><p>The <code>identifier</code> of the <code>Payment</code> is taken from the payment pre-authorization, which must be able to be matched against any payment reports produced by the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-6">Payment Provider</a> for the purposes of audit and/or reconciliation.</p>
</li>
<li><p>If the <code>totalPaymentDue</code> included in the <code>Order</code> object is different to the current <code>totalPaymentDue</code> (which might have changed since <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-10"><b>C2</b></a>, e.g. if the headline price is changed in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-51">Booking System</a> between these two steps), <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-12"><b>B</b></a> returns an <code>TotalPaymentDueMismatchError</code> with associated status code, but the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-17">Lease</a> is sustained so that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-55">Customer</a> can be prompted whether they want to continue with the new amount.</p>
</li>
<li><p>If the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-18">Lease</a> has expired, or if <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-19">Leases</a> are not supported, then the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-52">Booking System</a> attempts to make the booking anyway. If there are insufficient spaces available for <code>OrderItem</code>s the <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-13"><b>B</b></a> returns an <code>OpportunityHasInsufficientCapacityError</code> with associated status code.</p>
</li>
<li><p>If the booking succeeds only for some <code>OrderItem</code>s, the whole transaction to create the <code>Order</code> within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-53">Booking System</a> is rolled back and <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-14"><b>B</b></a> returns an <code>OrderCreationFailedError</code> with associated status code.</p>
</li>
<li><p>If there's a network failure, e.g. no response from server, then the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-65">Broker</a> can resubmit with same <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-13">Order UUID</a>. As the call is idempotent, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-54">Booking System</a> will need to track the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-14">Order UUID</a> supplied by <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-66">Broker</a> against any successfully created <code>Order</code>s, to ensure that it can return the same <code>Order</code> for subsequent requests. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-67">Broker</a> <em class="rfc2119">MUST NOT</em> reuse UUIDs across multiple <code>Order</code>s.</p>
</li>
<li><p>If the call is successful (returns a 200 response), the booking is considered as complete and paid by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-55">Booking System</a> at this point.</p>
</li>
<li><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-56">Booking System</a> <em class="rfc2119">MUST</em> reflect back all properties defined by this specification that are supplied by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-68">Broker</a>'s request in the <code>Order</code> returned from this call, including <code>broker</code> and <code>brokerRole</code>, to acknowledge they have been recognised (even if they have not actually been stored by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-57">Booking System</a>). The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-58">Booking System</a> <em class="rfc2119">MUST NOT</em> reflect back extension properties outside of this specification unless it explicitly supports them.</p>
</li>
<li><p>The <code>Order</code> returned from this call <em class="rfc2119">MUST</em> be stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-69">Broker</a>, to be subsequently updated by the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-4">Orders feed</a>. The <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-5">Orders feed</a> contains only partial-updates of the <code>Order</code> stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-70">Broker</a>, and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-71">Broker</a> is the only actor guaranteed to maintain a complete view of the <code>Order</code>. The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-59">Booking System</a> <em class="rfc2119">MAY</em> store the full <code>Order</code> if desired.</p>
</li>
<li><p>It is the responsibility of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-72">Broker</a> to store any additional state it requires that is not included in the <code>Order</code> returned from this call, and <em class="rfc2119">RECOMMENDED</em> that such state is stored alongside the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-73">Broker</a>'s persisted <code>Order</code>.</p>
</li>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-74">Broker</a> <em class="rfc2119">MUST</em> store the <code>Order</code> response in with an <code>orderCreationStatus</code> of <code>https://openactive.io/OrderCreationPaymentDue</code> at this point (or <code>https://openactive.io/OrderCreationPaymentCaptured</code> if no payment is due).</p>
</li>
<li><p>This call is idempotent, and hence if the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-15">Order UUID</a> used for an <code>Order</code> already represents a completed <code>Order</code> with the same set of <code>OrderItem</code>s for the same <code>customer</code> as those specified, the success response is returned as normal. If any differences exist in the <code>Order</code>s, an <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-16">Order UUID</a> clash is assumed, a 500 response of with <code>OrderAlreadyExistsError</code> is returned by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-60">Booking System</a>, and a new <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-17">Order UUID</a> must be generated by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-75">Broker</a> to retry the call.</p>
</li>
<li><p>As this call is idempotent, it can be safely retried in the case of an temporary unexpected error (any error that returns status code 503) or rate limiting (any error that returns status code 429).</p>
</li>
<li><p>When the request still returns status code 503 after a number of retries the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-18">Order UUID</a> <em class="rfc2119">MUST</em> be regenerated to allow for a clean retry of the booking. The <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-19">Order UUID</a> <em class="rfc2119">MUST NOT</em> be regenerated for expected errors (status code 4xx).</p>
</li>
<li><p><code>OrderItem</code>s returned by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-61">Booking System</a> have an <code>orderItemStatus</code> of <code>https://openactive.io/OrderItemConfirmed</code>.</p>
</li>
</ul><p>viii) <dfn id="dfn-payment-capture">Payment Capture</dfn> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-76">Broker</a> captures <code>totalPaymentDue</code> from <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-7">Payment Provider</a></p><ul>
<li><p>It is the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-77">Broker</a>'s responsibility to ensure that payment has been captured if required.</p>
</li>
<li><p>If payment is required, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-78">Broker</a> <em class="rfc2119">MUST</em> update its stored <code>Order</code> with an <code>orderCreationStatus</code> of <code>https://openactive.io/OrderCreationPaymentCaptured</code> after payment is successfully captured.</p>
</li>
<li><p>If <a href="#booking-without-payment">payment was not initiated</a> or <code>totalPaymentDue</code> is <code>0</code>, payment <em class="rfc2119">MUST NOT</em> be captured.</p>
</li>
</ul><p>ix) <dfn id="dfn-invoice-generation">Invoice Generation</dfn> and <dfn id="dfn-customer-notification">Customer Notification</dfn> - Upon successful <a href="#dfn-payment-capture" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-capture-2">Payment Capture</a> (or completing <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-15"><b>B</b></a> in the case of payment capture not being required), the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-79">Broker</a> generates invoices, sends the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-56">Customer</a> notifications, and stores the <code>Order</code> in a success state based on the response from <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-16"><b>B</b></a>.</p><ul>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-80">Broker</a> <em class="rfc2119">MUST</em> update its stored <code>Order</code> in with an <code>orderCreationStatus</code> of <code>https://openactive.io/OrderDelivered</code> after invoices have been created and notifications successfully sent.</li>
</ul><p>x) <dfn id="dfn-refunds-and-cancellation">Refunds and Cancellation</dfn> - The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-81">Broker</a> subscribes to updates from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-62">Booking System</a> to process cancellations and refunds.</p><ul>
<li>A secure <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-6">Orders feed</a> of <code>Order</code>s <em class="rfc2119">MUST</em> be provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-63">Booking System</a>, with the contents of the feed specific to the <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-1">Authentication Credentials</a>. This allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-82">Broker</a> to maintain an updated state of all their bookings across a number of <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-64">Booking Systems</a>, even when changes are made outside of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-83">Broker</a>. This also allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-84">Broker</a> to handle refunds for cancellations, and process notifications to <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-57">Customers</a> in a consistent way.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-65">Booking System</a> must ensure that the <code>Order</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-7">Orders feed</a> represent the current state of <code>OrderItem</code>s within the system, for the properties included in the feed. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-85">Broker</a> <em class="rfc2119">MUST</em> use these <code>Order</code>s to process refunds and send update notifications to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-58">Customer</a>.</li>
</ul></section><section id="booking-flow-rollback"><h4 id="x5-4-7-booking-flow-rollback"><bdi class="secno">5.4.7 </bdi>Booking Flow Rollback<a class="self-link" aria-label="§" href="#booking-flow-rollback"></a></h4><p>To ensure catastrophic errors are detected and resolved the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-86">Broker</a> <em class="rfc2119">MUST</em> periodically check its own store for any <code>Order</code>s that have not been updated in over a 2 minutes, and have an <code>orderCreationStatus</code> other than <code>https://openactive.io/OrderCreationComplete</code>.</p><p>Note that due to the ordering of the Booking Flow, no notifications will have been sent to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-59">Customer</a>, so no notifications regarding the rollback are required assuming it is performed promptly.</p><section id="booking-halted-at-ordercreationpaymentcaptured"><h5 id="x5-4-7-1-booking-halted-at-ordercreationpaymentcaptured"><bdi class="secno">5.4.7.1 </bdi>Booking halted at OrderCreationPaymentCaptured<a class="self-link" aria-label="§" href="#booking-halted-at-ordercreationpaymentcaptured"></a></h5><p>If the <code>orderCreationStatus</code> is <code>https://openactive.io/OrderCreationPaymentCaptured</code>, <a href="#dfn-invoice-generation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-generation-2">Invoice Generation</a> and <a href="#dfn-customer-notification" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-notification-2">Customer Notification</a> should simply be retried, and the <code>orderCreationStatus</code> set to <code>https://openactive.io/OrderCreationComplete</code> on success with no further rollback steps taken.</p></section><section id="booking-halted-at-ordercreationpaymentdue"><h5 id="x5-4-7-2-booking-halted-at-ordercreationpaymentdue"><bdi class="secno">5.4.7.2 </bdi>Booking halted at OrderCreationPaymentDue<a class="self-link" aria-label="§" href="#booking-halted-at-ordercreationpaymentdue"></a></h5><p>If an error occurs during <a href="#dfn-payment-capture" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-capture-3">Payment Capture</a>, which is very unlikely but possible due to system failure, and detectable where the <code>orderCreationStatus</code> is <code>https://openactive.io/OrderCreationPaymentDue</code>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-87">Broker</a> <em class="rfc2119">MUST</em> either:</p><ul>
<li>Initiate manual capture via e.g. the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-8">Payment Provider</a>'s admin console. Note the pre-auth will typically last for 7 days, so manual capture is still possible after the event.</li>
<li>Capture the payment from the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-60">Customer</a> manually.</li>
<li>Absorb the loss and make a new payment for the same amount with the same <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-20">Order UUID</a> in the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-9">Payment Provider</a> (better for UX / customer service, if manual capture not possible).</li>
<li>Acknowledge that payment cannot be successfully captured.</li>
</ul><p>After payment has been successfully captured via one of the above methods, the <code>orderCreationStatus</code> <em class="rfc2119">MUST</em> be set to <code>https://openactive.io/OrderCreationPaymentCaptured</code>, which will cause <a href="#dfn-invoice-generation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-generation-3">Invoice Generation</a> and <a href="#dfn-customer-notification" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-notification-3">Customer Notification</a> to be retried as per the previous section.</p><p>If the payment cannot be captured successfully:</p><ul>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-88">Broker</a> <em class="rfc2119">MUST</em> issue an <a href="#order-deletion">Order Deletion (DELETE)</a> request for the <code>Order</code> to remove it from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-66">Booking System</a>.</li>
<li>The <code>orderCreationStatus</code> <em class="rfc2119">MUST</em> be set to <code>https://openactive.io/OrderCreationPaymentAuthorized</code>, to trigger the rollback step in the next section. </li>
</ul></section><section id="booking-halted-at-ordercreationpaymentauthorized"><h5 id="x5-4-7-3-booking-halted-at-ordercreationpaymentauthorized"><bdi class="secno">5.4.7.3 </bdi>Booking halted at OrderCreationPaymentAuthorized<a class="self-link" aria-label="§" href="#booking-halted-at-ordercreationpaymentauthorized"></a></h5><p>If the <code>orderCreationStatus</code> is <code>https://openactive.io/OrderCreationPaymentAuthorized</code>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-89">Broker</a> <em class="rfc2119">MUST</em>:</p><ul>
<li>Cancel the associated Payment Authorisation from the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-10">Payment Provider</a>.</li>
<li>Soft delete the contents of the <code>Order</code> from the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-90">Broker</a> (deleting any personal data, while retaining data required for audit), retaining the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-21">Order UUID</a>.</li>
</ul><p>Note that the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-22">Order UUID</a> is retained by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-91">Broker</a> so that any related entries in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-8">Orders feed</a> can be appropriately assigned and ignored.</p><p>The <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-23">Order UUID</a> associated with the failed <code>Order</code> <em class="rfc2119">MUST NOT</em> be reused by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-92">Broker</a> for any subsequent booking attempt.</p></section></section><section id="contracts"><h4 id="x5-4-8-contracts"><bdi class="secno">5.4.8 </bdi>Contracts<a class="self-link" aria-label="§" href="#contracts"></a></h4><p>A summary of the key conformance criteria for the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-93">Broker</a> and <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-67">Booking System</a> is included here.</p><section id="broker-contract-with-booking-system"><h5 id="x5-4-8-1-broker-contract-with-booking-system"><bdi class="secno">5.4.8.1 </bdi>Broker contract with Booking System<a class="self-link" aria-label="§" href="#broker-contract-with-booking-system"></a></h5><ul>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-94">Broker</a> <em class="rfc2119">MUST</em> call <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-11"><b>C1</b></a> (without <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-61">Customer</a> details)</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-95">Broker</a> <em class="rfc2119">MUST</em> call <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-11"><b>C2</b></a> (with <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-62">Customer</a> details), to retrieve the total order, providing all required details and resulting in no errors before calling <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-17"><b>B</b></a>.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-96">Broker</a> <em class="rfc2119">MUST</em> call <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-18"><b>B</b></a> (with payment identifier if relevant), and <em class="rfc2119">MUST</em> store the resulting <code>Order</code>.</li>
<li>If <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-19"><b>B</b></a> fails, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-97">Broker</a> <em class="rfc2119">MUST</em> cancel the payment authorisation without any consequence to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-63">Customer</a> or <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-23">Seller</a>.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-98">Broker</a> <em class="rfc2119">MUST</em> process all updates to the <code>Order</code> from the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-9">Orders feed</a>, specifically monitoring the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-10">Orders feed</a> for cancellations.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-99">Broker</a> <em class="rfc2119">MUST</em> generate an <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-24">Order UUID</a>, and use it consistently during the booking flow.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-100">Broker</a> <em class="rfc2119">MUST NOT</em> reuse <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-25">Order UUID</a>s across complete or incomplete <code>Order</code>s.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-101">Broker</a> <em class="rfc2119">MUST</em> make the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-64">Customer</a> aware of any relevant <code>termsOfService</code>, for example by displaying a link to them prominently, before they commit to the booking.</li>
<li>If <code>requiresExplicitConsent</code> is <code>true</code> for any <code>termsOfService</code> then the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-65">Customer</a> <em class="rfc2119">MUST</em> only be allowed to proceed if they have explicitly acted to consent to the most recently modified version of such terms, identified by <code>dateModified</code> and the <code>url</code>.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-102">Broker</a> <em class="rfc2119">MUST</em> handle payments and reconciliation with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-24">Seller</a> and the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-11">Payment Provider</a>.</li>
<li>Calls to <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-12"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-12"><b>C2</b></a>, and <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-20"><b>B</b></a> <em class="rfc2119">MUST</em> include the <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-3"><code><code>@id</code></code></a> of the <code>seller</code> to which requested <code>OrderItem</code>s pertain, noting that it is not possible for <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-20">Opportunities</a> from different <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-25">Sellers</a> to be combined in the same <code>Order</code>.</li>
</ul></section><section id="booking-system-contract-with-the-broker"><h5 id="x5-4-8-2-booking-system-contract-with-the-broker"><bdi class="secno">5.4.8.2 </bdi>Booking System contract with the Broker<a class="self-link" aria-label="§" href="#booking-system-contract-with-the-broker"></a></h5><ul>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-68">Booking System</a> <em class="rfc2119">MUST</em> respond to <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-13"><b>C1</b></a> (without <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-66">Customer</a> details) with an <code>OrderQuote</code> that includes an indicative total order price, or a relevant error. It must also include the specification of any additional details to captured from the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-67">Customer</a> to be provided to <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-13"><b>C2</b></a>.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-69">Booking System</a> <em class="rfc2119">MUST</em> respond to <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-14"><b>C2</b></a> (with <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-68">Customer</a> details) with an <code>OrderQuote</code> that includes an exact total order price, or a relevant error. It must also produce a relevant error if the additional details specified are not sufficient.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-70">Booking System</a> <em class="rfc2119">MUST</em> respond to <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-21"><b>B</b></a> with a completed <code>Order</code>, or a relevant error. The whole booking <em class="rfc2119">MUST</em> succeed or fails as one.</li>
<li>Upon any cancellations or updates to the <code>Order</code> or any <code>OrderItem</code> within it, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-71">Booking System</a> <em class="rfc2119">MUST</em> include the updated <code>Order</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-11">Orders feed</a>.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-72">Booking System</a> <em class="rfc2119">MUST</em> store the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-26">Order UUID</a> as part of the <code>Order</code> (and <code>OrderQuote</code> if leasing is enabled).</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-73">Booking System</a> <em class="rfc2119">MUST</em> refuse attempts to create new orders with a previously used <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-27">Order UUID</a>.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-74">Booking System</a> <em class="rfc2119">MUST</em> check availability and confirm pricing during <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-14"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-15"><b>C2</b></a>, and <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-22"><b>B</b></a> to ensure booking can complete.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-75">Booking System</a> <em class="rfc2119">MUST</em> provide an authenticated <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-12">Orders feed</a> specific to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-103">Broker</a>. The contents of this feed will consist of all <a href="#dfn-order" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-1"><code>Orders</code></a> updated by the Booking System.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-76">Booking System</a> <em class="rfc2119">MUST</em> provide [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] open feeds of <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-7">Opportunity Data</a>, including pricing and availability.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-77">Booking System</a> <em class="rfc2119">MUST</em> ensure that all endpoints defined in this specification are idempotent.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-78">Booking System</a> <em class="rfc2119">MUST</em> include the full <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-26">Seller</a> details in the <code>seller</code> property of the response at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-15"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-16"><b>C2</b></a>, and <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-23"><b>B</b></a>, as such details are not included within the <a href="#opportunity-data-properties">opportunity data properties</a>.</li>
</ul><p>With the exception of leasing, <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-16"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-17"><b>C2</b></a> <em class="rfc2119">MUST NOT</em> have any side effects.</p></section></section></section><section id="booking-flow-with-approval"><h3 id="x5-5-booking-flow-with-approval"><bdi class="secno">5.5 </bdi>Booking Flow with Approval<a class="self-link" aria-label="§" href="#booking-flow-with-approval"></a></h3><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-79">Booking System</a> <em class="rfc2119">MAY</em> optionally support review and approval of bookings by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-27">Seller</a>. As the approval processes is initiated by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-80">Booking System</a>, implementation of this section by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-81">Booking System</a> is only required if this flow is supported. Otherwise this section can be ignored.</p><section id="customer-journey-0"><h4 id="x5-5-1-customer-journey"><bdi class="secno">5.5.1 </bdi>Customer Journey<a class="self-link" aria-label="§" href="#customer-journey-0"></a></h4><p>The booking journey of a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-69">Customer</a> is generalised into the following logical steps:</p><figure id="fig-illustration-of-a-typical-customer-journey-with-an-approval-step">
 <img src="userjourneywithapproval.png" alt="High level customer journey with approval" height="325" width="939">
 <figcaption>Figure <bdi class="figno">6</bdi> <span class="fig-title">Illustration of a typical <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-70">Customer</a> journey, with an approval step.</span></figcaption>
</figure><p>The steps exactly mirror the <a href="#simple-booking-flow">Simple Booking Flow</a>, with two additions in the 'Identify' step:</p><ol>
<li><p><strong>Select</strong>: <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-71">Customer</a> selects at least one <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-21">Opportunity</a> (e.g. <code>ScheduledSession</code> or <code>Slot</code>) and an associated <code>Offer</code> ("Junior (8-18) £9")</p>
</li>
<li><p><strong>Identify</strong>: <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-72">Customer</a> submits personal details and other requested details</p>
</li>
</ol><ol>

<ol>
<li><p><strong>Propose</strong>: <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-73">Customer</a> submits payment details, and submits a proposed booking</p>
</li>
<li><p><strong>Approve</strong>: <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-28">Seller</a> approves the booking, after a period of time</p>
</li>
</ol>
</ol><ol start="3">
<li><strong>Book and Pay</strong>: <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-74">Customer</a> confirms they are happy to proceed</li>
</ol><p>Note that some or all steps may be skipped, or may not be presented to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-75">Customer</a>, e.g. if their registration or payment details are already known, or they are using a voice interface. These steps are not indicative of the user experience, and simply provide a common language around the flow.</p></section><section id="high-level-api-flow-0"><h4 id="x5-5-2-high-level-api-flow"><bdi class="secno">5.5.2 </bdi>High-level API flow<a class="self-link" aria-label="§" href="#high-level-api-flow-0"></a></h4><figure id="fig-illustration-of-high-level-booking-flow-including-approval">
 <img src="bookingflowwithapproval.png" alt="High level booking flow with approval" height="713" width="894">
 <figcaption>Figure <bdi class="figno">7</bdi> <span class="fig-title">Illustration of high level booking flow, including approval.</span></figcaption>
</figure><p>The flow exactly mirrors the <a href="#simple-booking-flow">Simple Booking Flow</a>, with two additions:</p><ul>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-104">Broker</a> generates an <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-28">Order UUID</a>, which is used to uniquely identify the <code>OrderQuote</code> / <code>OrderProposal</code> / <code>Order</code> throughout the process.</p>
</li>
<li><p>After "<strong>1. Select</strong>" the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-105">Broker</a> calls the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-82">Booking System</a> to confirm an indicative price and availability of the selected items using an <code>OrderQuote</code>, and retrieve a total order price. Any details that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-76">Customer</a> needs to supply to complete the booking are also specified. This is checkpoint <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-17"><b>C1</b></a> on the diagram above.</p>
</li>
<li><p>After "<strong>2. Identify</strong>" the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-106">Broker</a> calls the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-83">Booking System</a> to reconfirm the price and availability of the selected items using an <code>OrderQuote</code>, using all details required, and retrieve a total order price. Explicit consent for any terms and conditions is also captured at this stage if required. This is checkpoint <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-18"><b>C2</b></a> on the diagram above.</p>
</li>
<li><p>After "<strong>2.1. Propose</strong>", the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-107">Broker</a> first <em>pre-authorizes</em> the payment for the total order price (if required by the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-12">Payment Provider</a>), then submits the proposed booking to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-84">Booking System</a> using an <code>OrderProposal</code> (<a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-1"><b>P</b></a> on the diagram above), and sends the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-77">Customer</a> a notification that the proposal is under consideration. The <code>OrderProposal</code> may be negotiated between the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-78">Customer</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-29">Seller</a> via the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-108">Broker</a> at this stage.</p>
</li>
<li><p>After "<strong>2.2. Approve</strong>" the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-30">Seller</a> approves the <code>OrderProposal</code> and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-109">Broker</a> is notified of this by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-85">Booking System</a> (<a href="#dfn-a" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-a-1"><b>A</b></a> on the diagram above). The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-110">Broker</a> can seek <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-79">Customer</a> permission to proceed, or simply complete the booking automatically, depending on the desired user experience.</p>
</li>
<li><p>After "<strong>3. Book and Pay</strong>", if necessary the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-111">Broker</a> <em>re-authorizes</em> the payment for the total order price (if it has changed, and if required by the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-13">Payment Provider</a>), then confirms the booking with <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-86">Booking System</a> using an <code>Order</code> (<a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-24"><b>B</b></a> on the diagram above), and finally <em>captures</em> the payment. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-112">Broker</a> then generates invoices, and sends <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-80">Customer</a> notifications.</p>
</li>
<li><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-87">Booking System</a> adds the <code>Order</code> to an <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-13">Orders feed</a> specific to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-113">Broker</a>, which the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-114">Broker</a> reads to update its internal state, including those updates resulting from cancellations.</p>
</li>
</ul><p>Note that the <code>OrderProposal</code> at stages 2.1 and 2.2 does not constitute a booking. The whole flow <em class="rfc2119">MUST</em> be completed before the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-81">Customer</a> is considered "booked" onto an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-22">Opportunity</a>.</p></section><section id="proposal-leasing"><h4 id="x5-5-3-proposal-leasing"><bdi class="secno">5.5.3 </bdi>Proposal Leasing<a class="self-link" aria-label="§" href="#proposal-leasing"></a></h4><p>Leasing works as specified in the <a href="#simple-booking-flow">Simple Booking Flow</a>, and if a <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-20">Lease</a> was acquired at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-18"><b>C1</b></a> or <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-19"><b>C2</b></a> it <em class="rfc2119">SHOULD</em> be carried over to the <code>OrderProposal</code> and the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-21">Lease</a> extended for a duration sufficient to cover the lifetime of the <code>OrderProposal</code>.</p><p>A <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-22">Lease</a> is <em class="rfc2119">NOT REQUIRED</em> for this flow, as in some cases <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-31">Sellers</a> may prefer to manage contention for spaces manually via the approval process instead of leasing.</p><p>If an <code>OrderProposal</code> is in an <code>orderProposalStatus</code> other than <code>https://openactive.io/CustomerRejected</code> or <code>https://openactive.io/SellerRejected</code>, regardless of whether or not the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-23">Lease</a> has expired, it <em class="rfc2119">MUST</em> be possible for the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-82">Customer</a> to still complete the booking if they attain approval. If at any point this is not the case, it is the responsibility of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-88">Booking System</a> to set the <code>orderProposalStatus</code> to <code>https://openactive.io/SellerRejected</code>, or if the <code>openBookingFlowRequirement</code> of any <code>Offer</code> referenced in the <code>OrderProposal</code> request includes <code>https://openactive.io/OpenBookingNegotiation</code> within the open data, to update the <code>OrderProposal</code> to remove or replace the offending <code>OrderItem</code>(s) with an appropriate <code>orderSellerNote</code>. For example, if an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-23">Opportunity</a> becomes full or is cancelled and no substitute <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-24">Opportunities</a> are available, then all remaining outstanding <code>OrderProposal</code>s related to that <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-25">Opportunity</a> would need to be automatically rejected or updated.</p><p>If the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-24">Lease</a> expires the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-89">Booking System</a> could, for example, automatically reject the <code>OrderProposal</code> on behalf of the <code>Seller</code>, automatically renew the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-25">Lease</a>, or allow the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-32">Seller</a> to manually deal with the contention for spaces as part of the approval process and hence do nothing.</p></section><section id="high-level-type-flow-0"><h4 id="x5-5-4-high-level-type-flow"><bdi class="secno">5.5.4 </bdi>High-level type flow<a class="self-link" aria-label="§" href="#high-level-type-flow-0"></a></h4><figure id="fig-illustration-of-types-used-during-the-api-flow-with-approval">
 <img src="typeflowwithapproval.png" alt="High level type flow with approval" height="178" width="953">
 <figcaption>Figure <bdi class="figno">8</bdi> <span class="fig-title">Illustration of types used during the API flow, with approval.</span></figcaption>
</figure><p>As specified in the <a href="#simple-booking-flow">Simple Booking Flow</a>, with one addition:</p><ul>
<li><strong>P/A</strong> - <code>OrderProposal</code> exists in a number of states, as described in the next section, and contains enough detail to successfully create an <code>Order</code>.</li>
</ul></section><section id="orderproposal-statuses"><h4 id="x5-5-5-orderproposal-statuses"><bdi class="secno">5.5.5 </bdi>OrderProposal statuses<a class="self-link" aria-label="§" href="#orderproposal-statuses"></a></h4><figure id="fig-state-transition-diagram-showing-orderproposal-states">
 <img src="order-proposal-states.png" alt="OrderProposal states" height="562" width="728">
 <figcaption>Figure <bdi class="figno">9</bdi> <span class="fig-title">State transition diagram showing OrderProposal states</span></figcaption>
</figure><p><code>OrderProposal</code> has an <code>orderProposalStatus</code> which is initially set by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-90">Booking System</a> to <code>https://openactive.io/AwaitingSellerConfirmation</code>.</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-115">Broker</a> <em class="rfc2119">MUST</em> only proceed to <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-25"><b>B</b></a> when <code>orderProposalStatus</code> is set to <code>https://openactive.io/SellerAccepted</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-14">Orders feed</a>.</p><p>An <code>OrderProposal</code> <em class="rfc2119">MUST</em> be approved or rejected atomically; partial approval is not supported in this version of the specification (though <a href="#proposal-amendment">Proposal Amendment</a> is supported).</p><p>To reach the criteria to proceed to <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-26"><b>B</b></a>, or rejection, <code>OrderProposal</code> <em class="rfc2119">MUST</em> be transitioned through states as follows:</p><ul>
<li><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-91">Booking System</a> <em class="rfc2119">MUST</em> transition the <code>OrderProposal</code> to a new <code>orderProposalStatus</code> by updating the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-15">Orders feed</a>.</p>
</li>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-116">Broker</a> <em class="rfc2119">MUST</em> transition the <code>OrderProposal</code> to a new <code>orderProposalStatus</code> by submitting a PATCH to the <code>OrderProposal</code> using the OrderProposal Update endpoint.</p>
<p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-92">Booking System</a> <em class="rfc2119">MUST</em> generate a new <dfn id="dfn-orderproposal-version-uuid">OrderProposal Version UUID</dfn>, which is a unique UUID string representation strictly as defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc4122" title="A Universally Unique IDentifier (UUID) URN Namespace">RFC4122</a></cite>], separate to the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-29">Order UUID</a>, for the initial <code>OrderProposal</code>, and subsequently for each amendment made (if <a href="#proposal-amendment">Proposal Amendment</a> is supported).</p>
</li>
</ul><section id="minimal-proposal-implementation"><h5 id="x5-5-5-1-minimal-proposal-implementation"><bdi class="secno">5.5.5.1 </bdi>Minimal Proposal Implementation<a class="self-link" aria-label="§" href="#minimal-proposal-implementation"></a></h5><p>In the <strong>Minimal Proposal Implementation</strong> the <code>OrderProposal</code> can either be accepted or rejected by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-33">Seller</a>, or aborted by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-83">Customer</a>.</p><p>If an <code>Offer</code> requires this <strong>Minimal Proposal Implementation</strong>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-93">Booking System</a> <em class="rfc2119">MUST</em> include the <code>openBookingFlowRequirement</code> of <code>https://openactive.io/OpenBookingApproval</code> in the <code>Offer</code>s within its open data. This allows <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-117">Brokers</a> that do not support approval to easily filter out such offers from their experience.</p><p>Note that when <code>Offer</code>s that require approval are mixed with <code>Offer</code>s that do not require approval in a single <code>OrderQuote</code>, the whole <code>OrderQuote</code> <em class="rfc2119">MUST</em> always require approval. It is at the discretion of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-118">Broker</a> whether to issue two separate <code>OrderQuote</code>s (and hence complete two separate booking flows) that batch those <code>OrderItem</code>s that require approval separately to those that do not, or whether to instead combine them together into a single <code>OrderQuote</code> and hence complete a single <a href="#booking-flow-with-approval">Booking Flow with Approval</a>.</p><section id="proposal-approval"><h6 id="x5-5-5-1-1-proposal-approval"><bdi class="secno">5.5.5.1.1 </bdi>Proposal Approval<a class="self-link" aria-label="§" href="#proposal-approval"></a></h6><ul>
<li>If <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-34">Seller</a> approval is given, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-94">Booking System</a> <em class="rfc2119">MUST</em> set <code>orderProposalStatus</code> to <code>https://openactive.io/SellerAccepted</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-16">Orders feed</a>, which will give the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-119">Broker</a> permission to proceed to <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-27"><b>B</b></a>.</li>
<li>For the <a href="#minimal-proposal-implementation">Minimal Proposal Implementation</a>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-120">Broker</a> must check that the <code>orderProposalVersion</code> received in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-17">Orders feed</a> matches the original <code>orderProposalVersion</code> returned at <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-2"><b>P</b></a>. If this is the case the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-121">Broker</a> may seek <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-84">Customer</a> confirmation to proceed, or may simply proceed with <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-28"><b>B</b></a> automatically, depending on the desired user experience. If this is not the case, the scenario <em class="rfc2119">MUST</em> be handled via the <a href="#proposal-amendment">Proposal Amendment</a> process.</li>
</ul></section><section id="proposal-rejection"><h6 id="x5-5-5-1-2-proposal-rejection"><bdi class="secno">5.5.5.1.2 </bdi>Proposal Rejection<a class="self-link" aria-label="§" href="#proposal-rejection"></a></h6><ul>
<li>If the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-35">Seller</a> rejects the proposal, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-95">Booking System</a> <em class="rfc2119">MUST</em> set <code>orderProposalStatus</code> to <code>https://openactive.io/SellerRejected</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-18">Orders feed</a>, optionally including an <code>orderSellerNote</code> containing any reason for rejection.</li>
<li>If the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-85">Customer</a> aborts the proposal, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-122">Broker</a> <em class="rfc2119">MUST</em> PATCH the <code>OrderProposal</code> to set the <code>orderProposalStatus</code> to <code>https://openactive.io/CustomerRejected</code>, optionally including an <code>orderCustomerNote</code> containing any associated reason. The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-96">Booking System</a> will then update this in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-19">Orders feed</a>,</li>
</ul><p>Following any type of rejection, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-123">Broker</a> <em class="rfc2119">MUST</em> immediately withdraw any payment authorisation.</p></section></section><section id="proposal-amendment"><h5 id="x5-5-5-2-proposal-amendment"><bdi class="secno">5.5.5.2 </bdi>Proposal Amendment<a class="self-link" aria-label="§" href="#proposal-amendment"></a></h5><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-97">Booking System</a> <em class="rfc2119">MAY</em> optionally support <strong>Proposal Amendment</strong>. If this is not supported by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-98">Booking System</a>, the simple Approval/Rejection workflow described in the <a href="#minimal-proposal-implementation">Minimal Proposal Implementation</a> may be used without needing to consider this (as the amendments are initiated by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-99">Booking System</a>).</p><p>If an <code>Offer</code> may require <strong>Proposal Amendment</strong>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-100">Booking System</a> <em class="rfc2119">MUST</em> include the <code>openBookingFlowRequirement</code> of <code>https://openactive.io/OpenBookingNegotiation</code> in the <code>Offer</code>s within its open data. This allows <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-124">Brokers</a> that do not support such negotiation to easily filter out such offers from their experience.</p><p><strong>Proposal Amendment</strong> allows the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-36">Seller</a> to suggest amendments to the <code>OrderProposal</code> (which need to be accepted by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-86">Customer</a>) as follows:</p><ul>
<li>If the <code>orderProposalVersion</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-20">Orders feed</a> has changed compared with the <code>orderProposalVersion</code> in the <code>OrderProposal</code> stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-125">Broker</a>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-126">Broker</a> <em class="rfc2119">MUST</em> notify the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-87">Customer</a> that their booking requires confirmation before it can proceed. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-127">Broker</a> <em class="rfc2119">MUST</em> detect and highlight any changes from their stored <code>OrderProposal</code> in the notification, based on the difference between the <code>OrderItem</code>s stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-128">Broker</a> and those in the feed.</li>
<li>When the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-88">Customer</a> confirms, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-129">Broker</a> <em class="rfc2119">MUST</em> re-authorise the <code>totalPaymentDue</code>, if it has increased, with the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-14">Payment Provider</a>, then proceed to <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-29"><b>B</b></a> using the <code>orderProposalVersion</code> the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-89">Customer</a> has agreed to.</li>
<li>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-90">Customer</a> or <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-37">Seller</a> <em class="rfc2119">MAY</em> also choose to abort at any point as per <a href="#minimal-proposal-implementation">Minimal Proposal Implementation</a>.</li>
</ul><p>Note that this specification does not support <code>OrderProposal</code> amendment by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-91">Customer</a>, and that <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-92">Customer</a> requests for changes to an existing proposal may be done via messages communicated via <a href="#message-exchange">Message Exchange</a>.</p></section><section id="message-exchange"><h5 id="x5-5-5-3-message-exchange"><bdi class="secno">5.5.5.3 </bdi>Message Exchange<a class="self-link" aria-label="§" href="#message-exchange"></a></h5><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-101">Booking System</a> and <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-130">Broker</a> <em class="rfc2119">MAY</em> support a basic level of <strong>Message Exchange</strong> while the <code>OrderProposal</code> is in-flight. </p><p>If an <code>Offer</code> requires <strong>Message Exchange</strong>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-102">Booking System</a> <em class="rfc2119">MUST</em> include the <code>openBookingFlowRequirement</code> of <code>https://openactive.io/OpenBookingMessageExchange</code> in the <code>Offer</code>s within its open data. This allows <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-131">Brokers</a> that do not support such negotiation to easily filter out such offers from their experience.</p><p><strong>Message Exchange</strong> is achieved using the two properties <code>orderSellerNote</code> and <code>orderCustomerNote</code>, and does not have any impact on the <code>orderProposalVersion</code>.</p><p>The <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-38">Seller</a> <em class="rfc2119">MAY</em> send a message to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-93">Customer</a> by setting <code>orderSellerNote</code> in the <code>OrderProposal</code>, and updating the <code>OrderProposal</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-21">Orders feed</a>. Any change detected in the <code>orderSellerNote</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-22">Orders feed</a> <em class="rfc2119">MUST</em> promptly trigger a notification from the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-132">Broker</a> to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-94">Customer</a>, so that the value of <code>orderSellerNote</code> can be safely overwritten with another message. To ensure that messages are not lost in the [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] feed, the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-39">Seller</a> <em class="rfc2119">MAY</em> send no more than one message every 5 minutes per <code>OrderProposal</code>.</p><p>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-95">Customer</a> <em class="rfc2119">MAY</em> send a message to the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-40">Seller</a> by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-133">Broker</a> making a PATCH call to the OrderProposal Update endpoint to set <code>orderCustomerNote</code> in the <code>OrderProposal</code>. Any such <code>orderCustomerNote</code> updates via PATCH calls <em class="rfc2119">MUST</em> either trigger a notification from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-103">Booking System</a> to the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-41">Seller</a>, or be stored in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-104">Booking System</a> for later reference by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-42">Seller</a>, so that the value of <code>orderCustomerNote</code> can be safely overwritten with another message.</p><p>Note that the <code>orderCustomerNote</code> property <em class="rfc2119">MUST NOT</em> be available in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-23">Orders feed</a>, to remove unnecessary [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] updates.</p></section></section><section id="step-by-step-process-description-0"><h4 id="x5-5-6-step-by-step-process-description"><bdi class="secno">5.5.6 </bdi>Step-by-step process description<a class="self-link" aria-label="§" href="#step-by-step-process-description-0"></a></h4><figure id="fig-sequence-diagram-showing-api-interactions-with-approval">
 <img src="sequencediagramwithapproval.png" alt="Sequence diagram with approval" height="720" width="960">
 <figcaption>Figure <bdi class="figno">10</bdi> <span class="fig-title">Sequence diagram showing API interactions with approval</span></figcaption>
</figure><p>For an <code>Order</code> that requires approval, the flow differs from the <a href="#simple-booking-flow">Simple Booking Flow</a>, and proceeds as follows:</p><p>i-iv) The steps <strong>1. Select</strong>; <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-19"><b>C1</b></a>; <strong>2. Identify</strong>; and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-20"><b>C2</b></a> of this flow are exactly the same as <a href="#simple-booking-flow">Simple Booking Flow</a> steps i-iv, except that <code>OrderQuote</code> is returned at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-20"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-21"><b>C2</b></a> with <code>orderRequiresApproval</code> set to <code>true</code> if any <code>OrderItem</code>s require approval. In this case, the next step after <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-22"><b>C2</b></a> <em class="rfc2119">MUST</em> be to follow the <a href="#booking-flow-with-approval">Booking Flow with Approval</a>. </p><ul>
<li><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-105">Booking System</a> <em class="rfc2119">MUST</em> include the <code>openBookingFlowRequirement</code> of <code>https://openactive.io/OpenBookingApproval</code> within its open data for any <code>Offer</code>s that require this flow. This allows <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-134">Brokers</a> that do not support approval to easily filter out such offers from their experience.</p>
</li>
<li><p>For the avoidance of doubt, as in the <a href="#simple-booking-flow">Simple Booking Flow</a>:</p>
</li>
</ul><ul>

<ul>
<li><p>Additional data is supplied at <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-23"><b>C2</b></a>  to satisfy the <code>orderItemIntakeForm</code> for all <code>OrderItem</code>s in <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-21"><b>C1</b></a>.</p>
</li>
<li><p>The <code>totalPaymentDue</code> from <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-24"><b>C2</b></a> is used for initial Payment Authorisation.</p>
</li>
</ul>
</ul><p>v) "<strong>2.1. Propose</strong>" - <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-96">Customer</a> submits payment details, and submits an initial booking in the form of an <code>OrderQuote</code>.</p><ul>
<li>For the avoidance of doubt, as in the <a href="#simple-booking-flow">Simple Booking Flow</a>:</li>
</ul><ul>

<ul>
<li><p>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-97">Customer</a> <em class="rfc2119">MUST</em> only be allowed to proceed if no <code>OrderItem</code>s in the <code>OrderQuote</code> contain any <code>error</code>s.</p>
</li>
<li><p>If <a href="#booking-without-payment">payment is not to be initiated</a> or <code>totalPaymentDue</code> is <code>0</code>, payment details <em class="rfc2119">MUST NOT</em> be captured.</p>
</li>
</ul>
</ul><p>vi) <a href="#dfn-payment-authorisation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-authorisation-2"><b>Payment Authorisation</b></a> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-135">Broker</a> pre-authorises <code>totalPaymentDue</code> from <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-15">Payment Provider</a>.</p><p>This proceeds almost exactly as in the <a href="#simple-booking-flow">Simple Booking Flow</a>, except that instead of an <code>Order</code>, an <code>OrderProposal</code> (subclassing <code>Order</code>) is created by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-136">Broker</a>.    </p><ul>
<li><p>As in the <a href="#simple-booking-flow">Simple Booking Flow</a>, the <code>OrderProposal</code> <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-4"><code><code>@id</code></code></a>, which includes the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-30">Order UUID</a> and is generated by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-137">Broker</a> to make the PUT call at <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-30"><b>B</b></a> (the <code>OrderProposal</code> <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-5"><code><code>@id</code></code></a> is also the PUT endpoint URL), <em class="rfc2119">SHOULD</em> be used as a reference in the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-16">Payment Provider</a>, if possible.</p>
</li>
<li><p>As in the <a href="#simple-booking-flow">Simple Booking Flow</a>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-138">Broker</a> <em class="rfc2119">MUST</em> store the <code>OrderProposal</code> at this point even if pre-authorisation is not taken, in order to prevent the possibility of a race condition. However, note that <code>orderCreationStatus</code> <em class="rfc2119">MUST NOT</em> be set on the <code>OrderProposal</code>.</p>
</li>
</ul><p>vii) <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-3"><b>P</b></a> - The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-139">Broker</a> makes a request containing its newly-created <code>OrderProposal</code>, including its <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-31">Order UUID</a>, a <code>customer</code> object, any <code>orderItemIntakeFormResponse</code> required, and <code>totalPaymentDue</code> including the total amount pre-authed. The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-106">Booking System</a> responds in turn with an <code>OrderProposal</code> with <code>orderProposalStatus</code> set to <code>https://openactive.io/AwaitingSellerConfirmation</code>.</p><ul>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-140">Broker</a> <em class="rfc2119">MUST</em> store this returned <code>OrderProposal</code>.</p>
</li>
<li><p>The call <em class="rfc2119">MUST</em> be atomic.</p>
</li>
<li><p>The returned <code>OrderProposal</code> also <em class="rfc2119">MUST</em> contain an <code>orderProposalVersion</code>, which is constructed from the <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-6"><code><code>@id</code></code></a> of the <code>OrderProposal</code>, combined with an additional <a href="#dfn-orderproposal-version-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orderproposal-version-uuid-1">OrderProposal Version UUID</a>.</p>
</li>
<li><p><code>OrderItem</code>s returned <em class="rfc2119">MUST</em> have an <code>orderItemStatus</code> of <code>https://openactive.io/OrderItemProposed</code>.</p>
</li>
<li><p>If the call is successful (returns a 200 response), the booking <em class="rfc2119">MUST NOT</em> be considered as complete by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-107">Booking System</a> at this point, and instead <em class="rfc2119">MUST</em> be considered in a 'proposed' state.</p>
</li>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-141">Broker</a> <em class="rfc2119">MUST NOT</em> store an <code>orderCreationStatus</code> against the <code>OrderProposal</code>.</p>
</li>
<li><p>The <code>OrderProposal</code> request <em class="rfc2119">MAY</em> include an <code>orderCustomerNote</code> in order to allow the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-98">Customer</a> to ask a question about this <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-26">Opportunity</a>, as the beginning of a <a href="#message-exchange">Message Exchange</a>. This is only permissible if the any <code>Offer</code> referenced in the <code>OrderProposal</code> includes an <code>openBookingFlowRequirement</code> property within the open data that contains <code>https://openactive.io/OpenBookingMessageExchange</code>.</p>
</li>
<li><p>To match much of the behaviour of <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-31"><b>B</b></a> in the <a href="#simple-booking-flow">Simple Booking Flow</a>, the following also apply:</p>
</li>
</ul><ul>

<ul>
<li><p>The <code>OrderProposal</code> from <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-4"><b>P</b></a> <em class="rfc2119">MUST NOT</em> be present in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-24">Orders feed</a> until it is updated at least once.</p>
</li>
<li><p><code>totalPaymentDue</code> <em class="rfc2119">MUST</em> be submitted to <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-5"><b>P</b></a> and <em class="rfc2119">MUST</em> match the value calculated by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-108">Booking System</a> to ensure that the <code>totalPaymentDue</code> has not changed.</p>
</li>
<li><p>If <a href="#booking-without-payment">payment was not initiated</a> or <code>totalPaymentDue</code> is <code>0</code>, the <code>payment</code> property <em class="rfc2119">MUST NOT</em> be included in the <code>OrderProposal</code> request or response. </p>
</li>
<li><p>Error responses <em class="rfc2119">MUST</em> be returned for any <a href="#payment-error-conditions">Payment Error Conditions</a>.</p>
</li>
<li><p>The <code>identifier</code> of the <code>Payment</code> is taken from the payment pre-authorization, which must be able to be matched against any payment reports produced by the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-17">Payment Provider</a> for the purposes of audit and/or reconciliation.</p>
</li>
<li><p>If the <code>totalPaymentDue</code> included in the <code>Order</code> object is different to the current <code>totalPaymentDue</code> (which might have changed since <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-25"><b>C2</b></a>, e.g. if the headline price is changed in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-109">Booking System</a> between these two steps), <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-6"><b>P</b></a> returns an <code>TotalPaymentDueMismatchError</code> with associated status code, but the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-26">Lease</a> is sustained so that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-99">Customer</a> can be prompted whether they want to continue with the new amount.</p>
</li>
<li><p>If the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-27">Lease</a> has expired, or if <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-28">Leases</a> are not supported, then the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-110">Booking System</a> attempts to create the <code>OrderProposal</code> anyway. If there are insufficient spaces available for <code>OrderItem</code>s the <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-7"><b>P</b></a> returns an <code>OpportunityHasInsufficientCapacityError</code> with associated status code.</p>
</li>
<li><p>If the booking succeeds only for some <code>OrderItem</code>s, the whole transaction to create the <code>OrderProposal</code> within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-111">Booking System</a> is rolled back and <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-8"><b>P</b></a> returns an <code>OrderCreationFailedError</code> with associated status code.</p>
</li>
<li><p>If there's a network failure, e.g. no response from server, then the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-142">Broker</a> can resubmit with same <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-32">Order UUID</a>. As the call is idempotent, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-112">Booking System</a> will need to track the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-33">Order UUID</a> supplied by <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-143">Broker</a> against any successfully created <code>OrderProposal</code>s, to ensure that it can return the same <code>OrderProposal</code> for subsequent requests. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-144">Broker</a> <em class="rfc2119">MUST NOT</em> reuse UUIDs across multiple <code>OrderProposal</code>s.</p>
</li>
<li><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-113">Booking System</a> <em class="rfc2119">MUST</em> reflect back all properties defined by this specification that are supplied by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-145">Broker</a>'s request in the <code>OrderProposal</code> returned from this call, including <code>broker</code> and <code>brokerRole</code>, to acknowledge they have been recognised (even if they have not actually been stored by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-114">Booking System</a>). The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-115">Booking System</a> <em class="rfc2119">MUST NOT</em> reflect back extension properties outside of this specification unless it explicitly supports them.</p>
</li>
<li><p>The <code>OrderProposal</code> returned from this call <em class="rfc2119">MUST</em> be stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-146">Broker</a>, to be subsequently updated by the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-25">Orders feed</a>. The <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-26">Orders feed</a> contains only partial-updates of the <code>OrderProposal</code> stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-147">Broker</a>, and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-148">Broker</a> is the only actor guaranteed to maintain a complete view of the <code>OrderProposal</code>. The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-116">Booking System</a> <em class="rfc2119">MAY</em> store the full <code>OrderProposal</code> if desired.</p>
</li>
<li><p>It is the responsibility of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-149">Broker</a> to store any additional state it requires that is not included in the <code>OrderProposal</code> returned from this call, and <em class="rfc2119">RECOMMENDED</em> that such state is stored alongside the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-150">Broker</a>'s persisted <code>Order</code>.</p>
</li>
<li><p>This call is idempotent, and hence if the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-34">Order UUID</a> used for an <code>OrderProposal</code> already represents a completed <code>OrderProposal</code> with the same set of <code>OrderItem</code>s for the same <code>customer</code> as those specified, the success response is returned as normal. If any differences exist in the <code>OrderProposal</code>s, a <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-35">Order UUID</a> clash is assumed, a 500 response of with <code>OrderAlreadyExistsError</code> is returned by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-117">Booking System</a>, and a new <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-36">Order UUID</a> must be generated by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-151">Broker</a> to retry the call.</p>
</li>
<li><p>As this call is idempotent, it can be safely retried in the case of an temporary unexpected error (any error that returns status code 503) or rate limiting (any error that returns status code 429).</p>
</li>
<li><p>When the request still returns status code 503 after a number of retries the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-37">Order UUID</a> <em class="rfc2119">MUST</em> be regenerated to allow for a clean retry of the booking. The <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-38">Order UUID</a> <em class="rfc2119">MUST NOT</em> be regenerated for expected errors (status code 4xx).</p>
</li>
</ul>
</ul><p>viii) "<strong>2.2. Approve</strong>" -  <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-43">Seller</a> approves the booking after automated or manual review.</p><ul>
<li><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-118">Booking System</a> must ensure that the <code>OrderProposal</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-27">Orders feed</a> represent the current state of <code>OrderProposal</code> within the system. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-152">Broker</a> <em class="rfc2119">MUST</em> use these <code>OrderProposal</code>s to process <code>orderProposalStatus</code> changes and send update notifications to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-100">Customer</a>, including any new values for <code>orderSellerNote</code>.</p>
</li>
<li><p>Once approved, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-119">Booking System</a> puts the updated <code>OrderProposal</code> onto the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-28">Orders feed</a> (<dfn id="dfn-a"><b>A</b></dfn>), with either an unchanged <code>orderProposalVersion</code> (see <a href="#minimal-proposal-implementation">Minimal Proposal Implementation</a>) or a new <code>orderProposalVersion</code> (see <a href="#proposal-amendment">Proposal Amendment</a>).</p>
</li>
<li><p>If the <code>orderProposalVersion</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-29">Orders feed</a> has changed compared with the <code>orderProposalVersion</code> in the <code>OrderProposal</code> stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-153">Broker</a>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-154">Broker</a> <em class="rfc2119">MUST</em> notify the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-101">Customer</a> that their booking requires confirmation before it can proceed. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-155">Broker</a> <em class="rfc2119">MUST</em> detect and highlight any changes from their stored <code>OrderProposal</code> in the notification, based on the difference between the <code>OrderItem</code>s stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-156">Broker</a> and those in the feed.</p>
</li>
</ul><p>ix) "<strong>3. Book and Pay</strong>" - <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-102">Customer</a> confirms booking</p><ul>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-157">Broker</a> <em class="rfc2119">MUST</em> only proceed when <code>orderProposalStatus</code> is set to <code>https://openactive.io/SellerAccepted</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-30">Orders feed</a>, and the <code>orderProposalVersion</code> is set to a value the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-103">Customer</a> has agreed to (see <a href="#proposal-amendment">Proposal Amendment</a>).</p>
</li>
<li><p>If in the revised <code>OrderProposal</code>, <a href="#booking-without-payment">payment initiation is now optional</a>, the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-104">Customer</a> <em class="rfc2119">MAY</em> be given the option to prepay or simply reserve a space without payment. Providing optionality of payment to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-105">Customer</a> is at the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-158">Broker</a>'s discretion.</p>
</li>
<li><p>If payment details were not previously captured and <a href="#booking-without-payment">payment is now to be initiated</a>, due to the revised <code>OrderProposal</code>, they <em class="rfc2119">MUST</em> be captured. If <code>totalPaymentDue</code> is <code>0</code>, payment details <em class="rfc2119">MUST NOT</em> be captured.</p>
</li>
</ul><p>x) <dfn id="dfn-payment-re-authorisation">Payment Re-authorisation</dfn> - <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-159">Broker</a> re-authorises <code>totalPaymentDue</code> from <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-18">Payment Provider</a> as necessary</p><ul>
<li><p>If <a href="#booking-without-payment">payment is still appropriate</a> given the latest <code>orderProposalVersion</code> that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-106">Customer</a> has agreed to (see <a href="#proposal-amendment">Proposal Amendment</a>), and if <code>totalPaymentDue</code> has increased or if the previous Payment Authorisation has expired, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-160">Broker</a> <em class="rfc2119">MUST</em> re-authorise the total amount with the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-19">Payment Provider</a>.</p>
</li>
<li><p>As with the <a href="#simple-booking-flow">Simple Booking Flow</a>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-161">Broker</a> <em class="rfc2119">MUST</em> store the <code>Order</code> request with an <code>orderCreationStatus</code> of <code>https://openactive.io/OrderCreationPaymentAuthorized</code> at this point, even if pre-authorisation is not taken, in order to ensure that the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-39">Order UUID</a> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-31">Orders feed</a> is recognised without a race condition.</p>
</li>
</ul><p>xi) <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-32"><b>B</b></a> - The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-162">Broker</a> makes a minimal call with an <code>Order</code> consisting of only the <code>orderProposalVersion</code> and any additional <code>payment</code> data from the re-authorisation step if necessary; the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-120">Booking System</a> responds with a full <code>Order</code> as per the <a href="#simple-booking-flow">Simple Booking Flow</a>.</p><ul>
<li><p>If the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-29">Lease</a> has expired, or if <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-30">Leases</a> are not supported, then the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-121">Booking System</a> attempts to make the booking anyway. If there are insufficient spaces available for <code>OrderItem</code>s then <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-33"><b>B</b></a> returns an <code>OpportunityHasInsufficientCapacityError</code> with associated status code and the original <code>OrderProposal</code> <em class="rfc2119">MUST</em> be rejected by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-44">Seller</a> as per <a href="#proposal-leasing">Proposal Leasing</a>. Note that this is unlikely to occur as in such cases the <code>OrderProposal</code> <em class="rfc2119">SHOULD</em> have already been rejected when it could no longer be fulfilled.</p>
</li>
<li><p>If a newer version of the <code>OrderProposal</code> is available compared with the <code>orderProposalVersion</code> provided by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-163">Broker</a>, then <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-34"><b>B</b></a> <em class="rfc2119">MUST</em> return an <code>OrderProposalVersionOutdatedError</code> with associated status code.</p>
</li>
<li><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-122">Booking System</a> <em class="rfc2119">MUST</em> reflect back all properties defined by this specification that were supplied in the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-164">Broker</a>'s original <code>OrderProposal</code> request (with amendments if <a href="#proposal-amendment">Proposal Amendment</a> has occurred), to acknowledge they have been recognised. The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-123">Booking System</a> <em class="rfc2119">MUST NOT</em> reflect back extension properties outside of this specification unless it explicitly supports them. The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-124">Booking System</a> <em class="rfc2119">MUST NOT</em> reflect back the <code>orderProposalVersion</code> in its response to <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-35"><b>B</b></a>.</p>
</li>
<li><p>All other behaviour is identical to the <a href="#simple-booking-flow">Simple Booking Flow</a> step vii. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-165">Broker</a> stores the response to <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-36"><b>B</b></a> to completely replace their previously stored <code>OrderProposal</code>, and the previous <code>OrderProposal</code> is set to <code>"state": "deleted"</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-32">Orders feed</a>. The <code>orderProposalVersion</code> <em class="rfc2119">MUST NOT</em> be included in the new <code>Order</code>.</p>
</li>
</ul><p>xii-xiv) The <a href="#dfn-payment-capture" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-capture-4">Payment Capture</a>, <a href="#dfn-invoice-generation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-generation-4">Invoice Generation</a>, <a href="#dfn-customer-notification" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-notification-4">Customer Notification</a>, and <a href="#dfn-refunds-and-cancellation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-refunds-and-cancellation-1">Refunds and Cancellation</a> steps of this flow are exactly the same as <a href="#simple-booking-flow">Simple Booking Flow</a> steps viii-x.</p><p><a href="#booking-flow-rollback">Booking Flow Rollback</a> also applies to this flow exactly as in the <a href="#simple-booking-flow">Simple Booking Flow</a>.</p></section><section id="contract"><h4 id="x5-5-7-contract"><bdi class="secno">5.5.7 </bdi>Contract<a class="self-link" aria-label="§" href="#contract"></a></h4><p>A summary of the key conformance criteria is included here. These apply for the <a href="#booking-flow-with-approval">Booking Flow with Approval</a> <em>in addition to</em> the contract specified in the <a href="#simple-booking-flow">Simple Booking Flow</a>.</p><section id="broker-contract-with-booking-system-0"><h5 id="x5-5-7-1-broker-contract-with-booking-system"><bdi class="secno">5.5.7.1 </bdi>Broker contract with Booking System<a class="self-link" aria-label="§" href="#broker-contract-with-booking-system-0"></a></h5><ul>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-166">Broker</a> <em class="rfc2119">MUST</em> call <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-9"><b>P</b></a> with <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-107">Customer</a> details as they would for <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-37"><b>B</b></a> in the <a href="#simple-booking-flow">Simple Booking Flow</a>, and <em class="rfc2119">MUST</em> store the resulting <code>OrderProposal</code>.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-167">Broker</a> <em class="rfc2119">MUST</em> process updates to the <code>OrderProposal</code> from the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-33">Orders feed</a>, including <a href="#dfn-a" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-a-2"><b>A</b></a>.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-168">Broker</a> <em class="rfc2119">MAY</em> negotiate on the <code>OrderProposal</code> using a OrderProposal Update call.</li>
<li>Calls to <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-10"><b>P</b></a> <em class="rfc2119">MUST</em> include the <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-7"><code><code>@id</code></code></a> of the <code>seller</code> to which requested <code>OrderItem</code>s pertain.</li>
</ul></section><section id="booking-system-contract-with-the-broker-0"><h5 id="x5-5-7-2-booking-system-contract-with-the-broker"><bdi class="secno">5.5.7.2 </bdi>Booking System contract with the Broker<a class="self-link" aria-label="§" href="#booking-system-contract-with-the-broker-0"></a></h5><ul>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-125">Booking System</a> <em class="rfc2119">MUST</em> respond to <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-11"><b>P</b></a> with an <code>OrderProposal</code>, or a relevant error. The whole creation of the <code>OrderProposal</code> <em class="rfc2119">MUST</em> succeed or fails as one.</li>
<li>Upon approval or updates to the <code>OrderProposal</code> or any <code>OrderItem</code> within it, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-126">Booking System</a> <em class="rfc2119">MUST</em> include the updated <code>OrderProposal</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-34">Orders feed</a>, including <a href="#dfn-a" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-a-3"><b>A</b></a>.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-127">Booking System</a> <em class="rfc2119">MAY</em> negotiate on the <code>OrderProposal</code> using the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-35">Orders feed</a>.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-128">Booking System</a> <em class="rfc2119">MUST</em> include the full <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-45">Seller</a> details in the <code>seller</code> property of the response at <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-12"><b>P</b></a>.</li>
</ul></section></section></section><section id="customer-details-and-additional-details-capture"><h3 id="x5-6-customer-details-and-additional-details-capture"><bdi class="secno">5.6 </bdi>Customer Details and Additional Details capture<a class="self-link" aria-label="§" href="#customer-details-and-additional-details-capture"></a></h3><section id="customer-details-capture"><h4 id="x5-6-1-customer-details-capture"><bdi class="secno">5.6.1 </bdi>Customer Details capture<a class="self-link" aria-label="§" href="#customer-details-capture"></a></h4><p>The specification includes provision to capture of the following details related to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-108">Customer</a> (the actor who is booking), with only the e-mail address being required.</p><ul>
<li>E-mail address (<code>email</code>)</li>
<li>Forename (<code>givenName</code>)</li>
<li>Surname (<code>familyName</code>)</li>
<li>Telephone (<code>telephone</code>)</li>
</ul><p>Note that these are <em>not</em> the details of attendees, and that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-109">Customer</a> is not guaranteed to participate in the activity. This facilitates child booking as the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-110">Customer</a> can easily book on behalf of a child, without supplying the child's own personal details.</p></section><section id="attendee-details-capture"><h4 id="x5-6-2-attendee-details-capture"><bdi class="secno">5.6.2 </bdi>Attendee Details capture<a class="self-link" aria-label="§" href="#attendee-details-capture"></a></h4><p>If attendee details in scope of the <code>Person</code> type are captured, they <em class="rfc2119">MUST</em> be captured via the <code>attendee</code> property of the <code>OrderItem</code> (and not using the <code>orderItemIntakeForm</code>). This allows attendee details to be stored and reused by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-169">Broker</a>.</p><p>If the same <code>attendee</code> is used across multiple <code>OrderItem</code>s, a duplicate <code>Person</code> <em class="rfc2119">MUST</em> be provided for each of these <code>OrderItem</code>s. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-170">Broker</a> may choose to design their user interface to minimise repeat data entry (e.g. by allowing the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-111">Customer</a> to enter attendee details first, then later assigning them to <code>OrderItem</code>s), however this is outside the scope of the specification.</p><p>Note that conformance with this specification requires that the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-129">Booking System</a> <em class="rfc2119">MUST NOT</em> <em>require</em> attendee data to be submitted in all cases, and that configuration of which attendee details are required (if any) <em class="rfc2119">MUST</em> be available to the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-46">Seller</a>.</p><p>If an <code>Offer</code> requires attendee details capture, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-130">Booking System</a> <em class="rfc2119">MUST</em> include the <code>openBookingFlowRequirement</code> of <code>https://openactive.io/OpenBookingAttendeeDetails</code> in the <code>Offer</code> within its open data. This allows <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-171">Brokers</a> that do not support attendee details capture to easily filter out such <code>Offer</code>s from their experience.</p><div class="example" id="example-3-example-of-attendeedetailsrequired-provided-by-booking-system-at-c1">
        <div class="marker">
    <a class="self-link" href="#example-3-example-of-attendeedetailsrequired-provided-by-booking-system-at-c1">Example<bdi> 3</bdi></a><span class="example-title">: Example of attendeeDetailsRequired provided by Booking System at C1</span>
  </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"attendeeDetailsRequired"</span>: [
    <span class="hljs-string">"https://schema.org/givenName"</span>,
    <span class="hljs-string">"https://schema.org/familyName"</span>
  ],
}</code></pre>
      </div><div class="example" id="example-4-example-of-attendee-details-provided-with-each-orderitem-at-c2">
        <div class="marker">
    <a class="self-link" href="#example-4-example-of-attendee-details-provided-with-each-orderitem-at-c2">Example<bdi> 4</bdi></a><span class="example-title">: Example of attendee details provided with each OrderItem at C2</span>
  </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"attendee"</span>: {
    <span class="hljs-string">"@type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-string">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-string">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-string">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-string">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  }
}</code></pre>
      </div><p>If a required property within <code>Person</code> is not supplied by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-172">Broker</a> the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-131">Booking System</a> <em class="rfc2119">MUST</em> include an <code>IncompleteAttendeeDetailsError</code> against the offending <code>OrderItem</code> at <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-26"><b>C2</b></a> which includes an <code>instance</code> that references the <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-8"><code><code>@id</code></code></a> of the missing or invalid <code>Property</code>.</p><div class="example" id="example-5-example-of-an-error-for-missing-attendee-property-data">
        <div class="marker">
    <a class="self-link" href="#example-5-example-of-an-error-for-missing-attendee-property-data">Example<bdi> 5</bdi></a><span class="example-title">: Example of an error for missing attendee property data</span>
  </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"error"</span>: [
    {
      <span class="hljs-string">"@type"</span>: <span class="hljs-string">"IncompleteAttendeeDetailsError"</span>,
      <span class="hljs-string">"instance"</span>: <span class="hljs-string">"https://schema.org/givenName"</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"Missing attendee first name"</span>
    }
  ]
}</code></pre>
      </div><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-173">Broker</a> <em class="rfc2119">MAY</em> remember the attendee data previously submitted by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-112">Customer</a>, if consent is provided.</p></section><section id="additional-details-capture"><h4 id="x5-6-3-additional-details-capture"><bdi class="secno">5.6.3 </bdi>Additional Details capture<a class="self-link" aria-label="§" href="#additional-details-capture"></a></h4><p>This version of the specification does not provide comprehensive support for construction of a complex additional details capture form. However, it does facilitate the use of simple text fields, dropdowns and checkboxes to capture additional details. These can be used for both the <a href="#simple-booking-flow">Simple Booking Flow</a> and the <a href="#booking-flow-with-approval">Booking Flow with Approval</a>.</p><p>If an <code>Offer</code> requires additional details capture, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-132">Booking System</a> <em class="rfc2119">MUST</em> include the <code>openBookingFlowRequirement</code> of <code>https://openactive.io/OpenBookingIntakeForm</code> in the <code>Offer</code> within its open data. This allows <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-174">Brokers</a> that do not support such additional details capture to easily filter out such <code>Offer</code>s from their experience.</p><p>Four types of form element are available, all of which sub-class <code>PropertyValueSpecification</code>:</p><ul>
<li><code>ShortAnswerFormFieldSpecification</code></li>
<li><code>ParagraphFormFieldSpecification</code></li>
<li><code>DropdownFormFieldSpecification</code></li>
<li><code>BooleanFormFieldSpecification</code></li>
</ul><section id="text-fields"><h5 id="x5-6-3-1-text-fields"><bdi class="secno">5.6.3.1 </bdi>Text fields<a class="self-link" aria-label="§" href="#text-fields"></a></h5><p><code>ShortAnswerFormFieldSpecification</code> and <code>ParagraphFormFieldSpecification</code> are identical except that they represent a single-line text box and a multi-line text box, respectively.</p><div class="example" id="example-6-example-of-orderitemintakeform-with-shortanswerformspecification-provided-by-booking-system-at-c1">
        <div class="marker">
    <a class="self-link" href="#example-6-example-of-orderitemintakeform-with-shortanswerformspecification-provided-by-booking-system-at-c1">Example<bdi> 6</bdi></a><span class="example-title">: Example of orderItemIntakeForm with ShortAnswerFormSpecification provided by Booking System at C1</span>
  </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"orderItemIntakeForm"</span>: [
    {
      <span class="hljs-string">"@type"</span>: <span class="hljs-string">"ShortAnswerFormSpecification"</span>,
      <span class="hljs-string">"@id"</span>: <span class="hljs-string">"https://example.com/experience"</span>,
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"Level of experience"</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"Have you played before? Are you a complete beginner or seasoned pro?"</span>,
      <span class="hljs-string">"valueRequired"</span>: <span class="hljs-literal">true</span>
    }
  ]
}</code></pre>
      </div><div class="example" id="example-7-example-of-orderitemintakeformresponse-for-shortanswerformspecification-provided-by-broker-at-c2">
        <div class="marker">
    <a class="self-link" href="#example-7-example-of-orderitemintakeformresponse-for-shortanswerformspecification-provided-by-broker-at-c2">Example<bdi> 7</bdi></a><span class="example-title">: Example of orderItemIntakeFormResponse for ShortAnswerFormSpecification provided by Broker at C2</span>
  </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"orderItemIntakeFormResponse"</span>: [
    {
      <span class="hljs-string">"@type"</span>: <span class="hljs-string">"PropertyValue"</span>,
      <span class="hljs-string">"propertyID"</span>: <span class="hljs-string">"https://example.com/experience"</span>,
      <span class="hljs-string">"value"</span>: <span class="hljs-string">"I've played twice before, but I'm a quick learner so I hope to keep up!"</span>
    }
  ]
}</code></pre>
      </div></section><section id="dropdown-fields"><h5 id="x5-6-3-2-dropdown-fields"><bdi class="secno">5.6.3.2 </bdi>Dropdown fields<a class="self-link" aria-label="§" href="#dropdown-fields"></a></h5><p><code>DropdownFormFieldSpecification</code> provides a list of options in a dropdown format.</p><p><code>valueOption</code>s are provided as an array of simple strings containing display values, and are supplied back to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-133">Booking System</a> using these display values in the <code>orderItemIntakeFormResponse</code>.</p><div class="example" id="example-8-example-of-orderitemintakeform-with-dropdownformfieldspecification-provided-by-booking-system-at-c1">
        <div class="marker">
    <a class="self-link" href="#example-8-example-of-orderitemintakeform-with-dropdownformfieldspecification-provided-by-booking-system-at-c1">Example<bdi> 8</bdi></a><span class="example-title">: Example of orderItemIntakeForm with DropdownFormFieldSpecification provided by Booking System at C1</span>
  </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"orderItemIntakeForm"</span>: [
    {
      <span class="hljs-string">"@type"</span>: <span class="hljs-string">"DropdownFormFieldSpecification"</span>,
      <span class="hljs-string">"@id"</span>: <span class="hljs-string">"https://example.com/age"</span>,
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"Age"</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"Your age is useful for us to place you in the correct group on the day"</span>,
      <span class="hljs-string">"valueOption"</span>: [<span class="hljs-string">"0-18"</span>, <span class="hljs-string">"18-30"</span>, <span class="hljs-string">"30+"</span>],
      <span class="hljs-string">"valueRequired"</span>: <span class="hljs-literal">true</span>
    }
  ]
}</code></pre>
      </div><div class="example" id="example-9-example-of-orderitemintakeformresponse-for-dropdownformfieldspecification-provided-by-broker-at-c2">
        <div class="marker">
    <a class="self-link" href="#example-9-example-of-orderitemintakeformresponse-for-dropdownformfieldspecification-provided-by-broker-at-c2">Example<bdi> 9</bdi></a><span class="example-title">: Example of orderItemIntakeFormResponse for DropdownFormFieldSpecification provided by Broker at C2</span>
  </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"orderItemIntakeFormResponse"</span>: [
    {
      <span class="hljs-string">"@type"</span>: <span class="hljs-string">"PropertyValue"</span>,
      <span class="hljs-string">"propertyID"</span>: <span class="hljs-string">"https://example.com/age"</span>,
      <span class="hljs-string">"value"</span>: <span class="hljs-string">"0-18"</span>
    }
  ]
}</code></pre>
      </div></section><section id="checkbox-fields"><h5 id="x5-6-3-3-checkbox-fields"><bdi class="secno">5.6.3.3 </bdi>Checkbox fields<a class="self-link" aria-label="§" href="#checkbox-fields"></a></h5><p><code>BooleanFormFieldSpecification</code> accepts either a <code>true</code> or <code>false</code> response, and <em class="rfc2119">MUST NOT</em> be specified as <code>valueRequired</code>.</p><div class="example" id="example-10-example-of-orderitemintakeform-with-booleanformfieldspecification-provided-by-booking-system-at-c1">
        <div class="marker">
    <a class="self-link" href="#example-10-example-of-orderitemintakeform-with-booleanformfieldspecification-provided-by-booking-system-at-c1">Example<bdi> 10</bdi></a><span class="example-title">: Example of orderItemIntakeForm with BooleanFormFieldSpecification provided by Booking System at C1</span>
  </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"orderItemIntakeForm"</span>: [
    {
      <span class="hljs-string">"@type"</span>: <span class="hljs-string">"BooleanFormFieldSpecification"</span>,
      <span class="hljs-string">"@id"</span>: <span class="hljs-string">"https://example.com/photoconsent"</span>,
      <span class="hljs-string">"name"</span>: <span class="hljs-string">"Photo Consent"</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"Are you happy for us to include photos of you in our marketing materials?"</span>
    }
  ]
}</code></pre>
      </div><p>The <code>value</code> in the <code>PropertyValue</code> response <em class="rfc2119">MUST</em> be either <code>true</code> or <code>false</code>.</p><div class="example" id="example-11-example-of-orderitemintakeformresponse-for-booleanformfieldspecification-provided-by-broker-at-c2">
        <div class="marker">
    <a class="self-link" href="#example-11-example-of-orderitemintakeformresponse-for-booleanformfieldspecification-provided-by-broker-at-c2">Example<bdi> 11</bdi></a><span class="example-title">: Example of orderItemIntakeFormResponse for BooleanFormFieldSpecification provided by Broker at C2</span>
  </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"orderItemIntakeFormResponse"</span>: [
    {
      <span class="hljs-string">"@type"</span>: <span class="hljs-string">"PropertyValue"</span>,
      <span class="hljs-string">"propertyID"</span>: <span class="hljs-string">"https://example.com/photoconsent"</span>,
      <span class="hljs-string">"value"</span>: <span class="hljs-literal">true</span>
    }
  ]
}</code></pre>
      </div></section><section id="form-validation-and-auto-fill"><h5 id="x5-6-3-4-form-validation-and-auto-fill"><bdi class="secno">5.6.3.4 </bdi>Form validation and auto-fill<a class="self-link" aria-label="§" href="#form-validation-and-auto-fill"></a></h5><p>If a field with <code>valueRequired</code> is not supplied by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-175">Broker</a>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-134">Booking System</a> <em class="rfc2119">MUST</em> include an <code>IncompleteIntakeFormError</code> against the offending <code>OrderItem</code> at <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-27"><b>C2</b></a> which includes an <code>instance</code> that references the <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-9"><code><code>@id</code></code></a> of the specific <code>PropertyValueSpecification</code>.</p><div class="example" id="example-12-example-of-an-error-for-missing-additional-details-field-data">
        <div class="marker">
    <a class="self-link" href="#example-12-example-of-an-error-for-missing-additional-details-field-data">Example<bdi> 12</bdi></a><span class="example-title">: Example of an error for missing additional details field data</span>
  </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"error"</span>: [
    {
      <span class="hljs-string">"@type"</span>: <span class="hljs-string">"IncompleteIntakeFormError"</span>,
      <span class="hljs-string">"instance"</span>: <span class="hljs-string">"https://example.com/experience"</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"Incomplete additional details supplied"</span>
    }
  ]
}</code></pre>
      </div><p>If the contents of a field supplied by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-176">Broker</a> are present but invalid, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-135">Booking System</a> <em class="rfc2119">MUST</em> include an <code>InvalidIntakeFormError</code> against the offending <code>OrderItem</code> at <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-28"><b>C2</b></a> which includes both an <code>instance</code> that references the <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-10"><code><code>@id</code></code></a> of the specific <code>PropertyValueSpecification</code>, and a human-readable <code>description</code> of the validation constraint to allow the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-113">Customer</a> to correct it.</p><p>In this version of the specification, any field value validation <em class="rfc2119">MUST</em> be implemented by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-136">Booking System</a> via <code>InvalidIntakeFormError</code>, for example if integer values are required.</p><div class="example" id="example-13-example-of-an-error-for-invalid-additional-details-field-data">
        <div class="marker">
    <a class="self-link" href="#example-13-example-of-an-error-for-invalid-additional-details-field-data">Example<bdi> 13</bdi></a><span class="example-title">: Example of an error for invalid additional details field data</span>
  </div> <pre aria-busy="false"><code class="hljs javascript">{
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
  ...
  <span class="hljs-string">"error"</span>: [
    {
      <span class="hljs-string">"@type"</span>: <span class="hljs-string">"InvalidIntakeFormError"</span>,
      <span class="hljs-string">"instance"</span>: <span class="hljs-string">"https://example.com/shoesize"</span>,
      <span class="hljs-string">"description"</span>: <span class="hljs-string">"The provided shoe size is not a number"</span>
    }
  ]
}</code></pre>
      </div><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-177">Broker</a> <em class="rfc2119">MAY</em> remember the values previously submitted by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-114">Customer</a> based on the <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-11"><code><code>@id</code></code></a> of the <code>PropertyValueSpecification</code>, if consent for such storage is provided.</p><p>It is expected that future versions of the specification will support more complex field types.</p></section></section></section></section><section class="normative" id="broker-roles"><h2 id="x6-broker-roles"><bdi class="secno">6. </bdi>Broker Roles<a class="self-link" aria-label="§" href="#broker-roles"></a></h2><p>A <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-178">Broker</a> is an actor that arranges transactions between a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-47">Seller</a> and <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-115">Customer</a>, either directly or indirectly.</p><p>From a contractual and taxation perspective, there are two types of <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-179">Broker</a>: agents (<code>AgentBroker</code>), and resellers (<code>ResellerBroker</code>). In addition, situations in which the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-116">customer</a> contracts directly with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-48">seller</a> without a third party are represented by the <code>brokerRole</code> value of <code>NoBroker</code>.</p><p>Note that this specification does not deal with contractual relationships, and simply provides a mechanism to record bookings.</p><section id="resellerbroker"><h3 id="x6-1-resellerbroker"><bdi class="secno">6.1 </bdi><code>ResellerBroker</code><a class="self-link" aria-label="§" href="#resellerbroker"></a></h3><section id="definition"><h4 id="x6-1-1-definition"><bdi class="secno">6.1.1 </bdi>Definition<a class="self-link" aria-label="§" href="#definition"></a></h4><p>A reseller is a company or individual that purchases goods or services with the intention of selling them rather than consuming or using them. This is usually done for profit (but could be resold at a loss).</p></section><section id="contractual-relationships"><h4 id="x6-1-2-contractual-relationships"><bdi class="secno">6.1.2 </bdi>Contractual Relationships<a class="self-link" aria-label="§" href="#contractual-relationships"></a></h4><p>In the context of OpenActive, a <code>ResellerBroker</code> contracts directly with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-49">Seller</a> as a business-to-business relationship to purchase access to the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-27">Opportunity</a>. It then, at a later point in time (which may only be milliseconds later), separately forms a contractual relationship with the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-117">Customer</a>, who purchases access to the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-28">Opportunity</a> from the <code>ResellerBroker</code>.</p><figure id="fig-contractual-relationships-in-resellerbroker-mode">
 <img src="ResellerBroker.png" alt="ResellerBroker relationships" height="303" width="577">
 <figcaption>Figure <bdi class="figno">11</bdi> <span class="fig-title">Contractual relationships in ResellerBroker mode</span></figcaption>
</figure></section><section id="taxation"><h4 id="x6-1-3-taxation"><bdi class="secno">6.1.3 </bdi>Taxation<a class="self-link" aria-label="§" href="#taxation"></a></h4><p>The <code>ResellerBroker</code>'s purchase from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-50">Seller</a> is business-to-business, which is subject to the appropriate taxation based on the <code>ResellerBroker</code> as the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-118">Customer</a>.
The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-119">Customer</a>'s purchase from the <code>ResellerBroker</code> is business-to-consumer, which is subject to the appropriate taxation based on the <code>ResellerBroker</code> as the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-51">Seller</a>.</p><p>Hence any tax exemption that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-120">Customer</a> may enjoy when purchasing directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-52">Seller</a> (e.g. in UK law, if the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-53">Seller</a> is a <a href="https://www.gov.uk/guidance/sport-supplies-that-are-vat-exempt-notice-70145">VAT exempt eligible body</a>) is not relevant here, as no direct contractual relationship is formed between <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-54">Seller</a> and <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-121">Customer</a>.</p></section><section id="scope-of-specification"><h4 id="x6-1-4-scope-of-specification"><bdi class="secno">6.1.4 </bdi>Scope of Specification<a class="self-link" aria-label="§" href="#scope-of-specification"></a></h4><p>This specification is designed to govern the interaction between the <code>ResellerBroker</code> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-55">Seller</a>. It does not include provision for the interaction between the <code>ResellerBroker</code> and <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-122">Customer</a> explicitly, though it may be repurposed by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-180">Broker</a> to perform this function by treating the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-181">Broker</a> as a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-137">Booking System</a>. This specification also does not include provision for the recording of the execution of the contractual relationship with any <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-20">Payment Provider</a> (e.g. for payment processing fees). Such relationships <em class="rfc2119">MUST</em> be handled separately.
When the <code>brokerRole</code> is set to <code>ResellerBroker</code>, this indicates that the payee for accounting and tax purposes is the <code>broker</code> specified in the <code>Order</code>.
Note that the <code>customer</code> may still optionally be included in the Order, for example to help front-of-house staff identify the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-123">Customer</a>.</p></section><section id="conformance-criteria"><h4 id="x6-1-5-conformance-criteria"><bdi class="secno">6.1.5 </bdi>Conformance criteria<a class="self-link" aria-label="§" href="#conformance-criteria"></a></h4><p>When the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-182">Broker</a> generates the <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-1">Invoice</a>, it must be made payable to <code>Order.broker</code>, <code>Order.broker</code> <em class="rfc2119">MUST</em> be provided and <code>Order.customer</code> is optional.</p></section></section><section id="agentbroker"><h3 id="x6-2-agentbroker"><bdi class="secno">6.2 </bdi><code>AgentBroker</code><a class="self-link" aria-label="§" href="#agentbroker"></a></h3><section id="definition-0"><h4 id="x6-2-1-definition"><bdi class="secno">6.2.1 </bdi>Definition<a class="self-link" aria-label="§" href="#definition-0"></a></h4><p>An agent is authorized to act on behalf of another (the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-56">Seller</a>, or "principal") to create legal relations with a third party (the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-124">Customer</a>). Succinctly, it may be referred to as the equal relationship between a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-57">Seller</a> and an agent whereby the principal, expressly or implicitly, authorizes the agent to work under his or her control and on his or her behalf. The agent is required to negotiate on behalf of the principal (<a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-58">Seller</a>) and/or bring them and third parties (<a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-125">Customers</a>) into contractual relationship.</p></section><section id="contractual-relationships-0"><h4 id="x6-2-2-contractual-relationships"><bdi class="secno">6.2.2 </bdi>Contractual Relationships<a class="self-link" aria-label="§" href="#contractual-relationships-0"></a></h4><p>There are three separate types of contractual relationship involved:
<code>AgentBroker</code> with <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-59">Seller</a>, known as the principal-agent relationship or "internal" relationship;
<code>AgentBroker</code> with <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-126">Customer</a> with whom they deal on their <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-60">Seller</a>'s behalf ("external relationship"); and
<a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-61">Seller</a> with <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-127">Customer</a> when arranged by an <code>AgentBroker</code>.</p><figure id="fig-contractual-relationships-in-agentbroker-mode">
 <img src="AgentBroker.png" alt="AgentBroker relationships" height="293" width="558">
 <figcaption>Figure <bdi class="figno">12</bdi> <span class="fig-title">Contractual relationships in AgentBroker mode</span></figcaption>
</figure></section><section id="taxation-0"><h4 id="x6-2-3-taxation"><bdi class="secno">6.2.3 </bdi>Taxation<a class="self-link" aria-label="§" href="#taxation-0"></a></h4><p>While facilitated by the <code>AgentBroker</code>, the primary purchase is made by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-128">Customer</a> directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-62">Seller</a>, as would be the case if the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-129">Customer</a> was to purchase from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-63">Seller</a> independently.
Hence any tax exemption that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-130">Customer</a> may enjoy when purchasing directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-64">Seller</a> (e.g. in UK law, if the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-65">Seller</a> is an <a href="https://www.gov.uk/guidance/sport-supplies-that-are-vat-exempt-notice-70145">VAT exempt eligible body</a>) is relevant here.</p><p>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-131">Customer</a>'s relationship with <code>AgentBroker</code> is business-to-consumer. Hence any additional services (e.g. customer-facing booking fees) are subject to the appropriate taxation based on the <code>AgentBroker</code> as the <code>seller</code>.</p><p>The <code>AgentBroker</code>'s relationship with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-66">Seller</a> is business-to-business. Hence any additional services (e.g. booking commission) are subject to the appropriate taxation.</p></section><section id="scope-of-specification-0"><h4 id="x6-2-4-scope-of-specification"><bdi class="secno">6.2.4 </bdi>Scope of Specification<a class="self-link" aria-label="§" href="#scope-of-specification-0"></a></h4><p>This specification is designed to govern the recording of the execution of the contractual relationship between the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-132">Customer</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-67">Seller</a>.
The scope of this specification does not include the contractual relationship between the <code>AgentBroker</code> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-68">Seller</a> (e.g. for booking commission), between the <code>AgentBroker</code> and the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-133">Customer</a> (e.g. for booking fees) or with any <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-21">Payment Provider</a> (e.g. for payment processing fees). Such relationships and the reconciliation of associated invoices <em class="rfc2119">MUST</em> be handled separately.
When the <code>brokerRole</code> is set to <code>AgentBroker</code>, this indicates that the payee for accounting and tax purposes is the <code>customer</code> specified in the <code>Order</code>.</p></section><section id="conformance-criteria-0"><h4 id="x6-2-5-conformance-criteria"><bdi class="secno">6.2.5 </bdi>Conformance criteria<a class="self-link" aria-label="§" href="#conformance-criteria-0"></a></h4><p>When the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-183">Broker</a> generates the <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-2">Invoice</a>, it must be made payable to <code>Order.customer</code>, <code>Order.broker</code> <em class="rfc2119">MUST</em> be provided and <code>Order.customer</code> <em class="rfc2119">MUST</em> be provided.</p></section><section id="informed-purchase"><h4 id="x6-2-6-informed-purchase"><bdi class="secno">6.2.6 </bdi>Informed purchase<a class="self-link" aria-label="§" href="#informed-purchase"></a></h4><p>When using a <code>brokerRole</code> of <code>AgentBroker</code>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-184">Broker</a> <em class="rfc2119">MUST</em> make the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-134">Customer</a> aware that they are purchasing directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-69">Seller</a> via the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-185">Broker</a>, and not directly from the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-186">Broker</a>.</p></section></section><section id="nobroker"><h3 id="x6-3-nobroker"><bdi class="secno">6.3 </bdi><code>NoBroker</code><a class="self-link" aria-label="§" href="#nobroker"></a></h3><section id="definition-1"><h4 id="x6-3-1-definition"><bdi class="secno">6.3.1 </bdi>Definition<a class="self-link" aria-label="§" href="#definition-1"></a></h4><p>This specification supports direct purchase by a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-135">Customer</a> (for example in the context of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-70">Seller</a>'s own website, or for businesses that purchase large volumes of FacilityUse slots to run leagues).</p></section><section id="contractual-relationships-1"><h4 id="x6-3-2-contractual-relationships"><bdi class="secno">6.3.2 </bdi>Contractual Relationships<a class="self-link" aria-label="§" href="#contractual-relationships-1"></a></h4><p>The contractual relationship is a simple one between the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-71">Seller</a> and the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-136">Customer</a>.</p><figure id="fig-contractual-relationships-in-nobroker-mode">
 <img src="NoBroker.png" alt="NoBroker relationships" height="132" width="564">
 <figcaption>Figure <bdi class="figno">13</bdi> <span class="fig-title">Contractual relationships in NoBroker mode</span></figcaption>
</figure></section><section id="taxation-1"><h4 id="x6-3-3-taxation"><bdi class="secno">6.3.3 </bdi>Taxation<a class="self-link" aria-label="§" href="#taxation-1"></a></h4><p>The purchase is made by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-137">Customer</a> directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-72">Seller</a>, as would be the case if the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-138">Customer</a> was to purchase from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-73">Seller</a> outside of this specification.
Hence any tax exemption that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-139">Customer</a> may enjoy when purchasing directly from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-74">Seller</a> (e.g. in UK law, if the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-75">Seller</a> is an VAT exempt eligible body) is relevant here.</p></section><section id="scope-of-specification-1"><h4 id="x6-3-4-scope-of-specification"><bdi class="secno">6.3.4 </bdi>Scope of Specification<a class="self-link" aria-label="§" href="#scope-of-specification-1"></a></h4><p>This specification is designed to govern the recording of the execution of the contractual relationship between the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-140">Customer</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-76">Seller</a>.
The scope of this specification does not include the contractual relationship with any <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-22">Payment Provider</a> (e.g. for payment processing fees). Such relationships <em class="rfc2119">MUST</em> be handled separately.</p><p>When the <code>brokerRole</code> is set to <code>NoBroker</code>, this indicates that the payee for accounting and tax purposes is the <code>customer</code> specified in the <code>Order</code>.</p></section><section id="conformance-criteria-1"><h4 id="x6-3-5-conformance-criteria"><bdi class="secno">6.3.5 </bdi>Conformance criteria<a class="self-link" aria-label="§" href="#conformance-criteria-1"></a></h4><p>When an <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-3">Invoice</a> is generated, it must be made payable to <code>Order.customer</code>, <code>Order.broker</code> <em class="rfc2119">MUST NOT</em> be provided and <code>Order.customer</code> <em class="rfc2119">MUST</em> be provided.</p></section></section></section><section class="normative" id="systems-of-record"><h2 id="x7-systems-of-record"><bdi class="secno">7. </bdi>Systems of Record<a class="self-link" aria-label="§" href="#systems-of-record"></a></h2><section id="roles-and-responsibilities-overview"><h3 id="x7-1-roles-and-responsibilities-overview"><bdi class="secno">7.1 </bdi>Roles and responsibilities overview<a class="self-link" aria-label="§" href="#roles-and-responsibilities-overview"></a></h3><p>For the purposes of this specification, the key components of a booking are: <code>Order</code>, <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-4">Invoice</a>, <a href="#dfn-payment" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-4">Payment</a> and <a href="#dfn-refund" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-refund-1">Refund</a>.</p><p>Note that <code>OrderQuote</code> is a subclass of <code>Order</code> used during the <code>Order</code> creation process, and is not explicitly persisted.</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-187">Broker</a> has visibility of all components, while for simplicity of implementation the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-138">Booking System</a> only has visibility of the <code>Order</code>, as shown below:</p><figure id="fig-roles-and-responsibilities">
 <img src="roles.png" alt="Roles and responsibilities" height="316" width="814">
 <figcaption>Figure <bdi class="figno">14</bdi> <span class="fig-title">Roles and responsibilities</span></figcaption>
</figure><p><code>Order</code>s are the basis of the exchange between the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-139">Booking System</a> and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-188">Broker</a>, with <code>OrderQuote</code>s used as part of the <code>Order</code> creation process. This specification describes a detailed model and API to allow <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-189">Brokers</a> to manipulate <code>Order</code>s, and only high level functional requirements for the expected behaviour of <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-5">Invoices</a>, <a href="#dfn-payment" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-5">Payments</a>, and <a href="#dfn-refund" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-refund-2">Refunds</a>.</p><table>
<thead>
<tr>
<th>Component</th>
<th>Description</th>
<th>Owner</th>
<th>Audit</th>
</tr>
</thead>
<tbody><tr>
<td><dfn data-plurals="orders" id="dfn-order"><code>Order</code></dfn></td>
<td>A mutable object that encompasses the live state of the bookable <code>Event</code>s within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-140">Booking System</a>. An <code>Order</code> has a <code>orderItem</code>s, a <code>totalPaymentDue</code>, and all tax details, but is not itself a legal representation of a purchase from the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-77">Seller</a>.</td>
<td><a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-141">Booking System</a>.</td>
<td>Mutable</td>
</tr>
<tr>
<td><dfn data-plurals="invoices" id="dfn-invoice">Invoice</dfn></td>
<td>An immutable object that is a legal representation of the purchase, which <em class="rfc2119">MUST</em> be rendered to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-141">Customer</a> as a legally permissible tax receipt, and exist as a tax point. A new <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-6">Invoice</a> <em class="rfc2119">MUST</em> be generated for the <code>Order</code> to replace the previous <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-7">Invoice</a> on each occasion that a set of <code>orderItem</code>s within an <code>Order</code> are cancelled.</td>
<td><a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-190">Broker</a></td>
<td>Immutable</td>
</tr>
<tr>
<td><dfn data-plurals="payments" id="dfn-payment">Payment</dfn></td>
<td>A immutable object that represents the original payment to the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-78">Seller</a> for the initial <code>Order</code>. Although modelling the <a href="#dfn-payment" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-6">Payment</a> is outside the scope of this specification, it is recommended that one payment exists for each <code>Order</code>.</td>
<td><a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-23">Payment Provider</a></td>
<td>Immutable</td>
</tr>
<tr>
<td><dfn data-plurals="refunds" id="dfn-refund">Refund</dfn></td>
<td>An immutable object that represents each refund made against the <a href="#dfn-payment" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-7">Payment</a>, up to the <a href="#dfn-payment" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-8">Payment</a>'s total amount</td>
<td><a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-24">Payment Provider</a></td>
<td>Immutable</td>
</tr>
</tbody></table></section><section id="invoices-and-tax-receipts"><h3 id="x7-2-invoices-and-tax-receipts"><bdi class="secno">7.2 </bdi>Invoices and Tax receipts<a class="self-link" aria-label="§" href="#invoices-and-tax-receipts"></a></h3><p>Due to the variety of business models in use in OpenActive, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-142">Booking System</a> <em class="rfc2119">MUST NOT</em> send receipts directly to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-142">Customer</a> for <code>AgentBroker</code> and <code>ResellerBroker</code> bookings.</p><p>For each successful booking operation, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-191">Broker</a> <em class="rfc2119">MUST</em> generate a new <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-8">Invoice</a> in the form of a tax receipt, on the basis of the response from <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-38"><b>B</b></a>. To ensure that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-143">Customer</a> is provided with the correct tax receipt, if <code>totalPaymentTax</code> is provided in an <code>Order</code> from <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-39"><b>B</b></a> or subsequently in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-36">Orders feed</a>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-192">Broker</a> <em class="rfc2119">MUST</em> generate a new or updated <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-9">Invoice</a> and either (a) send a tax receipt representation of the <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-10">Invoice</a> to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-144">Customer</a> and/or (b) offer a means to allow the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-145">Customer</a> to easily retrieve a full tax receipt representation of the specific version of the  <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-11">Invoice</a> at any future date for any previous booking made. As it is ultimately the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-79">Seller</a>'s responsibility to send tax receipts, they need to be confident that the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-193">Broker</a> is making tax information available to its <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-146">Customers</a> in an accurate and timely manner.</p><p>The tax receipt sent by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-194">Broker</a> <em class="rfc2119">MUST</em> comply with any legal requirements of the jurisdiction of operation.</p><p>Note that if the specification is followed correctly, for all <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-195">Broker</a> modes where a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-80">Seller</a> may need to supply a tax receipt manually for any reason, the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-81">Seller</a> will have sufficient details of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-147">Customer</a> and of the transaction to generate the most recent tax receipt.</p></section><section id="payments-and-refunds"><h3 id="x7-3-payments-and-refunds"><bdi class="secno">7.3 </bdi>Payments and Refunds<a class="self-link" aria-label="§" href="#payments-and-refunds"></a></h3><p>Due to the variety of business models available in the OpenActive ecosystem, conformance to this specification requires that the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-25">Payment Provider</a> be distinct from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-143">Booking System</a> for which this API is defined. The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-144">Booking System</a> <em class="rfc2119">MAY</em> separately expose its own native payment functionality as if it were a <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-26">Payment Provider</a>, however its use <em class="rfc2119">MUST</em> be <em class="rfc2119">OPTIONAL</em>.</p><p>Although the details of <a href="#dfn-payment" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-9">Payments</a> and <a href="#dfn-refund" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-refund-3">Refunds</a> are not in the scope of this specification, a single <code>Payment</code> object is included in the <code>Order</code> in the <code>payment</code> property to ensure payments are fully traceable in case of audit.</p><section id="virtual-payments"><h4 id="x7-3-1-virtual-payments"><bdi class="secno">7.3.1 </bdi>Virtual payments<a class="self-link" aria-label="§" href="#virtual-payments"></a></h4><p>Note that this <code>Payment</code> is permitted to represent a virtual <a href="#dfn-payment" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-10">Payment</a> consolidating a number of actual <strong>Payments</strong> to allow for a wide variety of payment methods. In the case where the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-82">Seller</a> is paid monthly, the <a href="#dfn-payment" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-11">Payment</a> may refer to a future invoice against which the <a href="#dfn-payment" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-12">Payment</a> will eventually be paid. </p></section><section id="basic-payment"><h4 id="x7-3-2-basic-payment"><bdi class="secno">7.3.2 </bdi>Basic <code>Payment</code><a class="self-link" aria-label="§" href="#basic-payment"></a></h4><p>A unique reference to this <a href="#dfn-payment" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-13">Payment</a> <em class="rfc2119">MUST</em> be included in the <code>Payment</code> <code>identifier</code> of the <code>Order</code> sent to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-145">Booking System</a>. This <code>Payment</code> <code>identifier</code> <em class="rfc2119">MUST</em> be uniquely resolvable for audit purposes.</p><p>The <code>accountId</code> of the <code>Payment</code> <em class="rfc2119">SHOULD</em> be provided to reference the specific account within the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-27">Payment Provider</a> that is used for reconciliation purposes.</p><p>The <code>paymentProviderId</code> of the <code>Payment</code> <em class="rfc2119">SHOULD</em> be provided to reference the specific <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-28">Payment Provider</a> that is used.</p><p>The <code>name</code> of the <code>Payment</code> <em class="rfc2119">SHOULD</em> be used to provide information about the source of the payment that can be stored in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-146">Booking System</a>, to help the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-83">Seller</a> in discussions with the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-148">Customer</a> (e.g. "AcmeBroker Points" or "AcmeBroker via Credit Card").</p><div class="example" id="example-14-example-of-payment">
        <div class="marker">
    <a class="self-link" href="#example-14-example-of-payment">Example<bdi> 14</bdi></a><span class="example-title">: Example of Payment</span>
  </div> <pre aria-busy="false"><code class="hljs css">"payment": {
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"Payment"</span>,
  <span class="hljs-string">"identifier"</span>: <span class="hljs-string">"12345678ABCD"</span>,
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"Big Media Services"</span>,
  <span class="hljs-string">"accountId"</span>: <span class="hljs-string">"SN1593"</span>,
  <span class="hljs-string">"paymentProviderId"</span>: <span class="hljs-string">"STRIPE"</span>
},</code></pre>
      </div><section id="payment-reconciliation-detail-validation"><h5 id="x7-3-2-1-payment-reconciliation-detail-validation"><bdi class="secno">7.3.2.1 </bdi>Payment reconciliation detail validation<a class="self-link" aria-label="§" href="#payment-reconciliation-detail-validation"></a></h5><p>Payment reconciliation detail validation is required if any viable payment reconciliation route exists between the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-196">Broker</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-84">Seller</a> that necessitates more than just the <code>identifier</code> property of the <code>Payment</code> being included in <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-40"><b>B</b></a>. For simplicity of implementation, such validation is required even if the <code>totalPaymentDue</code> is likely to be <code>0</code> or the <code>prepayment</code> value of the selected <code>Offer</code>s indicates no payment.</p><p>This ensures that a viable payment reconciliation route is available before the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-149">Customer</a> starts to enter their data.</p><p>To achieve such validation, the <code>payment</code> property <em class="rfc2119">MUST</em> be included at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-22"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-29"><b>C2</b></a> by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-197">Broker</a> in the <code>OrderQuote</code> request, including all relevant properties of <code>Payment</code> except the <code>identifier</code>.</p><p>If the <code>payment</code> details supplied (e.g. <code>accountId</code>) are not considered valid for reconciliation by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-147">Booking System</a> then a <code>InvalidPaymentDetailsError</code> <em class="rfc2119">MUST</em> be returned at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-23"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-30"><b>C2</b></a>.</p><p>For the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-148">Booking System</a>, the <code>payment</code> property at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-24"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-31"><b>C2</b></a> is always considered optional, as a payment reconciliation route may not exist.</p><p>At <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-41"><b>B</b></a> and <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-13"><b>P</b></a> the <code>payment</code> property <em class="rfc2119">MUST</em> only be included if a payment is actually being processed. If payment details were not captured due to the <code>prepayment</code> value of the selected <code>Offer</code>, or if <code>totalPaymentDue</code> is <code>0</code> due to all <code>OrderItem</code>s being free of charge, the <code>payment</code> property <em class="rfc2119">MUST NOT</em> be included in the <code>Order</code> at <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-42"><b>B</b></a>. In all other cases <code>payment</code> property <em class="rfc2119">MUST</em> be included in the <code>Order</code> at <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-43"><b>B</b></a>.</p><p>For the simple case, if the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-149">Booking System</a> does not implement properties other than the <code>identifier</code> property of the <code>Payment</code>, the <code>Payment</code> <em class="rfc2119">MUST</em> simply be reflected back in the response to <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-25"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-32"><b>C2</b></a>, <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-44"><b>B</b></a> and <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-14"><b>P</b></a> with only the <code>identifier</code> property included, and no implementation of the <code>InvalidPaymentDetailsError</code> response is required.</p></section></section><section id="dynamicpayment"><h4 id="x7-3-3-dynamicpayment"><bdi class="secno">7.3.3 </bdi><code>DynamicPayment</code><a class="self-link" aria-label="§" href="#dynamicpayment"></a></h4><p>For fully dynamic pricing, where price is not known at the point of purchase, a <code>DynamicPayment</code> <em class="rfc2119">MUST</em> be used. Example use cases include volume-based pricing, where the price of items are calculated at the end of the month depending on the total volume booked during that period.</p><p>To use the <code>DynamicPayment</code> the following preconditions must be met:</p><ul>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-198">Broker</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-85">Seller</a> <em class="rfc2119">MUST</em> have agreed an arrangement for dynamic pricing out-of-band, including which <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-29">Opportunities</a> and <code>Offer</code>s it applies to.</li>
<li>Dynamic pricing cannot be mixed with standard pricing behaviour within the same <code>Order</code>, so all <code>OrderItem</code>s selected <em class="rfc2119">MUST</em> be applicable for dynamic pricing based on such agreements.</li>
<li>The <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-30">Opportunities</a> that are selected for booking <em class="rfc2119">MUST</em> be <a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-4">bookable</a> as in the standard flow.</li>
</ul><p>To use <code>DynamicPayment</code> the booking flow <em class="rfc2119">MUST</em> be completed as normal with the following additional requirements:</p><ul>
<li>The <code>OrderQuote</code>, <code>OrderProposal</code> and <code>Order</code> in request, response, and in the subsequent <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-37">Orders feed</a> <em class="rfc2119">MUST NOT</em> include <code>totalPaymentDue</code> or <code>totalPaymentTax</code>, and <code>OrderItem</code>s <em class="rfc2119">MUST NOT</em> include <code>acceptedOffer</code> or <code>unitTaxSpecification</code>.</li>
<li>The booking flow <em class="rfc2119">MUST</em> be completed <em>as if</em> <code>prepayment</code> was set to <code>https://openactive.io/Unavailable</code> for the <code>acceptedOffer</code> for all <code>OrderItem</code>s.</li>
<li>The <code>OrderQuote</code> / <code>OrderProposal</code> / <code>Order</code> submitted to <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-26"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-33"><b>C2</b></a> and <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-45"><b>B</b></a> (and <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-15"><b>P</b></a> if using approval) <em class="rfc2119">MUST</em> have a <code>payment</code> property that contains a <code>DynamicPayment</code>, which is consistent throughout the calls.</li>
<li>If the <code>DynamicPayment</code> details supplied (e.g. <code>accountId</code>) are not considered either sufficient or <a href="#payment-reconciliation-detail-validation">valid for reconciliation</a> by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-150">Booking System</a> then either <code>IncompletePaymentDetailsError</code> or <code>InvalidPaymentDetailsError</code> <em class="rfc2119">MUST</em> be returned by all calls, respectively.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-151">Booking System</a> <em class="rfc2119">MUST NOT</em> record any price against the <code>Order</code> or <code>OrderItem</code>s for reconciliation, as such reconciliation <em class="rfc2119">MUST</em> occur completely out-of-band.</li>
</ul><p>The <code>accountId</code> of the <code>DynamicPayment</code> <em class="rfc2119">MUST</em> be used consistently in order to allow the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-86">Seller</a> to reconcile <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-31">Opportunities</a> booked using a particular account.</p><p>The <code>name</code> of the <code>DynamicPayment</code> <em class="rfc2119">SHOULD</em> be used to provide information about the source of the payment that can be stored in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-152">Booking System</a>,  to help the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-87">Seller</a> in discussions with the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-150">Customer</a> (e.g. "AcmeBroker Points" or "AcmeBroker Membership").</p><p>Note that the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-153">Booking System</a> <em class="rfc2119">MAY</em> choose to validate the <code>DynamicPayment</code> details, as above, though this is not a requirement - it could simply accept any values provided.</p><div class="example" id="example-15-example-of-dynamicpayment">
        <div class="marker">
    <a class="self-link" href="#example-15-example-of-dynamicpayment">Example<bdi> 15</bdi></a><span class="example-title">: Example of DynamicPayment</span>
  </div> <pre aria-busy="false"><code class="hljs css">"payment": {
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"DynamicPayment"</span>,
  <span class="hljs-string">"identifier"</span>: <span class="hljs-string">"12345678ABCD"</span>,
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"MoveGB Membership"</span>,
  <span class="hljs-string">"accountId"</span>: <span class="hljs-string">"MOVE"</span>
},</code></pre>
      </div></section><section id="payment-reconciliation-identifiers"><h4 id="x7-3-4-payment-reconciliation-identifiers"><bdi class="secno">7.3.4 </bdi>Payment reconciliation identifiers<a class="self-link" aria-label="§" href="#payment-reconciliation-identifiers"></a></h4><p>Although automated payment reconciliation is outside the current scope of this specification, a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-154">Booking System</a> <em class="rfc2119">MAY</em> include identifiers suitable for payment reconciliation to be handled out-of-band with each <code>OrderItem</code> using the <code>additionalProperty</code> property.</p><p>In keeping with the Schema.org definition of <code>PropertyValue</code>, the <code>name</code> and <code>value</code> properties <em class="rfc2119">MUST</em> be provided within any given <code>PropertyValue</code>, and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-199">Broker</a> <em class="rfc2119">SHOULD</em> include these in any reconciliation process with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-88">Seller</a>.</p><div class="example" id="example-16-example-of-additionalproperty-for-orderitem">
        <div class="marker">
    <a class="self-link" href="#example-16-example-of-additionalproperty-for-orderitem">Example<bdi> 16</bdi></a><span class="example-title">: Example of additionalProperty for OrderItem</span>
  </div> <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"additionalProperty"</span>: [
  {
    <span class="hljs-string">"@type"</span>: <span class="hljs-string">"PropertyValue"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"SiteID"</span>,
    <span class="hljs-string">"value"</span>: <span class="hljs-string">"ABC1234"</span>
  },
  {
    <span class="hljs-string">"@type"</span>: <span class="hljs-string">"PropertyValue"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"DeptID"</span>,
    <span class="hljs-string">"value"</span>: <span class="hljs-string">"D89"</span>
  }
],</code></pre>
      </div></section></section><section id="tax-calculation"><h3 id="x7-4-tax-calculation"><bdi class="secno">7.4 </bdi>Tax calculation<a class="self-link" aria-label="§" href="#tax-calculation"></a></h3><section id="business-to-consumer-tax-calculation-by-booking-system-is-mandatory"><h4 id="x7-4-1-business-to-consumer-tax-calculation-by-booking-system-is-mandatory"><bdi class="secno">7.4.1 </bdi>Business-to-consumer tax calculation by Booking System is mandatory<a class="self-link" aria-label="§" href="#business-to-consumer-tax-calculation-by-booking-system-is-mandatory"></a></h4><p>For <code>AgentBroker</code> and <code>NoBroker</code> modes, where the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-151">Customer</a> is of type <code>Person</code> and a tax receipt is usually generated by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-155">Booking System</a>, the tax calculation and associated properties this specification <em class="rfc2119">MUST</em> be implemented by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-156">Booking System</a> (even if the resulting tax amount is zero).</p></section><section id="business-to-business-tax-calculation-by-booking-system-is-optional"><h4 id="x7-4-2-business-to-business-tax-calculation-by-booking-system-is-optional"><bdi class="secno">7.4.2 </bdi>Business-to-business tax calculation by Booking System is optional<a class="self-link" aria-label="§" href="#business-to-business-tax-calculation-by-booking-system-is-optional"></a></h4><p>Tax calculation at the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-157">Booking System</a> is <em class="rfc2119">OPTIONAL</em> when the <code>brokerRole</code> of <code>ResellerBroker</code> is specified, or when a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-152">Customer</a> of type <code>Organization</code> is specified. If tax calculation is not supported for a <code>ResellerBroker</code>, <code>unitTaxSpecification</code> and <code>totalPaymentTax</code> <em class="rfc2119">MUST NOT</em> be included, and the <code>taxCalculationExcluded</code> property <em class="rfc2119">MUST</em> be returned as <code>true</code> in the <code>OrderQuote</code> and <code>Order</code> (i.e. explicitly not including tax).</p><p>When <code>taxCalculationExcluded</code> is <code>true</code>, all <code>Offer</code>s <em class="rfc2119">MUST</em> include net <code>price</code>s (i.e. without tax included), regardless of the <code>taxMode</code>. This allows tax to be calculated by the <code>ResellerBroker</code> or business <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-153">Customer</a> and reconciled outside of this specification.</p><p>Note that for business-to-business sales for a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-89">Seller</a> with <code>taxMode</code> of the <code>organizer</code> or <code>provider</code> set to <code>https://openactive.io/TaxGross</code>, the <code>Offer</code>s available in the <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-8">Opportunity Data</a> will still be calculated as tax-inclusive for a business-to-consumer sale, and so <em class="rfc2119">MUST</em> be presented by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-200">Broker</a> as such, with the business-to-business tax calculation occurring during the booking flow. If the usecase of presenting the correct price up-front gains traction, additional price data must be made available as part of the openly published <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-9">Opportunity Data</a> to resolve this shortcoming.</p></section></section><section id="tax-mode"><h3 id="x7-5-tax-mode"><bdi class="secno">7.5 </bdi>Tax mode<a class="self-link" aria-label="§" href="#tax-mode"></a></h3><p>The <code>taxMode</code> (<code>https://openactive.io/TaxNet</code> or <code>https://openactive.io/TaxGross</code>) is <em class="rfc2119">REQUIRED</em> to be specified at the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-90">Seller</a> level. It <em class="rfc2119">MUST</em> be reflected within the <code>Organization</code> or <code>Person</code> that is included in the <em class="rfc2119">REQUIRED</em> <code>organizer</code> or <code>provider</code> properties within <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-10">Opportunity Data</a> specified in [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>], and within the <em class="rfc2119">REQUIRED</em> <code>seller</code> property in the responses from <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-27"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-34"><b>C2</b></a>, <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-16"><b>P</b></a> and <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-46"><b>B</b></a>. It <em class="rfc2119">MUST</em> also be consistent for all <code>Order</code>s originating from that <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-91">Seller</a>.</p><p>Note that <code>taxMode</code> only affects the interpretation of the <code>price</code> of the <code>Offer</code>. <code>totalPaymentDue</code> is always Gross (tax inclusive), and <code>unitTaxSpecification</code> and <code>totalPaymentTax</code> include only the taxes themselves so are unaffected.</p><table>
<thead>
<tr>
<th><code>taxMode</code></th>
<th><code>https://openactive.io/TaxNet</code></th>
<th><code>https://openactive.io/TaxGross</code></th>
</tr>
</thead>
<tbody><tr>
<td>Price displayed</td>
<td>Excludes tax</td>
<td>Includes all applicable taxes assuming a <code>Person</code> as a <code>customer</code></td>
</tr>
<tr>
<td>Currencies usually associated</td>
<td>USD, CAD</td>
<td>EUR, AUD, GBP</td>
</tr>
<tr>
<td>Example price of <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-32">Opportunity</a> before tax</td>
<td>10.00</td>
<td>10.00</td>
</tr>
<tr>
<td>Example tax rate</td>
<td>0.2</td>
<td>0.2</td>
</tr>
<tr>
<td>Price displayed to <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-154">Customer</a> during browsing (<code>Offer</code>)</td>
<td>10.00</td>
<td>12.00</td>
</tr>
<tr>
<td>Total paid by <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-155">Customer</a> (<code>totalPaymentDue</code>)</td>
<td>12.00</td>
<td>12.00</td>
</tr>
</tbody></table></section><section id="booking-without-payment"><h3 id="x7-6-booking-without-payment"><bdi class="secno">7.6 </bdi>Booking without payment<a class="self-link" aria-label="§" href="#booking-without-payment"></a></h3><p>If the <em class="rfc2119">OPTIONAL</em> <code>prepayment</code> feature of this specification is supported by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-158">Booking System</a>, the following logic <em class="rfc2119">MUST</em> be applied by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-159">Booking System</a> to populate the <code>prepayment</code> value of <code>totalPaymentDue</code> in the <code>OrderQuote</code> response of <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-28"><b>C1</b></a> or <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-35"><b>C2</b></a>:</p><table>
<thead>
<tr>
<th><code>acceptedOffer</code>s across <code>OrderItem</code>s</th>
<th><a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-160">Booking System</a> sets <code>prepayment</code> value of <code>totalPaymentDue</code></th>
</tr>
</thead>
<tbody><tr>
<td><em>Any</em> <code>prepayment</code> values are either <code>https://openactive.io/Required</code> or omitted where <code>price</code> values are also not <code>0</code></td>
<td><code>https://openactive.io/Required</code></td>
</tr>
<tr>
<td><em>At least one</em> <code>prepayment</code> value is <code>https://openactive.io/Optional</code> and the rest are either <code>https://openactive.io/Unavailable</code> or omitted where <code>price</code> values are also <code>0</code></td>
<td><code>https://openactive.io/Optional</code></td>
</tr>
<tr>
<td><em>In all cases</em> either <code>prepayment</code> value is <code>https://openactive.io/Unavailable</code> or <code>price</code> value is <code>0</code></td>
<td><code>https://openactive.io/Unavailable</code></td>
</tr>
</tbody></table><p>If the <code>prepayment</code> property is not supported by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-161">Booking System</a>, the <code>prepayment</code> property <em class="rfc2119">MUST</em> simply be omitted in all cases, however the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-162">Booking System</a> <em class="rfc2119">MUST</em> still handle the <a href="#payment-error-conditions">payment error conditions</a>.</p><p>The following logic <em class="rfc2119">MUST</em> be applied by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-201">Broker</a> to determine whether to initiate taking payment from the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-156">Customer</a>, and applies whether or not the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-163">Booking System</a> supports <code>prepayment</code>:</p><table>
<thead>
<tr>
<th><code>totalPaymentDue</code></th>
<th><a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-202">Broker</a> initiates payment</th>
</tr>
</thead>
<tbody><tr>
<td><code>prepayment</code> is <code>https://openactive.io/Required</code>, or omitted and <code>price</code> is not <code>0</code></td>
<td>Always</td>
</tr>
<tr>
<td><code>prepayment</code> is <code>https://openactive.io/Optional</code></td>
<td>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-157">Customer</a> <em class="rfc2119">MAY</em> be given the option, at the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-203">Broker</a>'s discretion</td>
</tr>
<tr>
<td><code>prepayment</code> is <code>https://openactive.io/Unavailable</code> or <code>price</code> is <code>0</code></td>
<td>Never</td>
</tr>
</tbody></table><p>If payment is not to be initiated based on the above:</p><ul>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-204">Broker</a> <em class="rfc2119">MUST</em> communicate to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-158">Customer</a> that they are simply reserving a space without payment.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-205">Broker</a> <em class="rfc2119">MUST NOT</em> accept payment details, attempt payment pre-authorisation, or attempt payment capture.</li>
<li>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-206">Broker</a> <em class="rfc2119">MUST NOT</em> include the <code>payment</code> property in the request to <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-47"><b>B</b></a> or <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-17"><b>P</b></a>.</li>
<li>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-164">Booking System</a> therefore <em class="rfc2119">MUST NOT</em> include the <code>payment</code> property in the response from <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-48"><b>B</b></a> or <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-18"><b>P</b></a>, and <em class="rfc2119">MUST</em> proceed to create a payment-free <code>Order</code> or <code>OrderProposal</code>.</li>
</ul><section id="free-opportunities"><h4 id="x7-6-1-free-opportunities"><bdi class="secno">7.6.1 </bdi>Free opportunities<a class="self-link" aria-label="§" href="#free-opportunities"></a></h4><p><dfn id="dfn-free-opportunities">Free Opportunities</dfn>, defined as those with at least one applicable <code>Offer</code> with a <code>price</code> of <code>0</code>, <em class="rfc2119">MUST</em> follow the same workflow as paid <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-33">Opportunities</a>.</p><p>For <code>Offer</code>s with a <code>price</code> of <code>0</code>:</p><ul>
<li>The <code>prepayment</code> property of the <code>Offer</code> <em class="rfc2119">MUST</em> be either <code>https://openactive.io/Unavailable</code> or unspecified.</li>
<li>The <code>Offer</code> <em class="rfc2119">MAY</em> not include <code>priceCurrency</code>.</li>
<li>If a <code>priceCurrency</code> is not available then <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-207">Brokers</a> <em class="rfc2119">SHOULD</em> communicate "Free" or equivalent when referencing a zero price.</li>
</ul><p>When an <code>Order</code> or <code>OrderProposal</code> involves exclusively <a href="#dfn-free-opportunities" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-free-opportunities-1">Free Opportunities</a> the <code>totalPaymentDue</code> will be <code>0</code> regardless of the <code>prepayment</code> property values. In this case, no interaction with a <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-29">Payment Provider</a> is required, the <code>payment</code> property <em class="rfc2119">MAY</em> be omitted at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-29"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-36"><b>C2</b></a> (depending on <a href="#payment-reconciliation-detail-validation">Payment Reconciliation Detail Validation</a>), and <em class="rfc2119">MUST</em> be omitted at <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-49"><b>B</b></a> or <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-19"><b>P</b></a>.</p></section><section id="payment-error-conditions"><h4 id="x7-6-2-payment-error-conditions"><bdi class="secno">7.6.2 </bdi>Payment error conditions<a class="self-link" aria-label="§" href="#payment-error-conditions"></a></h4><p>At <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-50"><b>B</b></a> or <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-20"><b>P</b></a> the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-165">Booking System</a> <em class="rfc2119">MUST</em> produce an error response in the following cases:</p><ul>
<li>If the <code>payment</code> property is expected in the request (as within <code>totalPaymentDue</code>: <code>prepayment</code> is <code>https://openactive.io/Required</code>, or if <code>prepayment</code> not supported, <code>price</code> is not <code>0</code>) but not provided, then a <code>MissingPaymentDetailsError</code> <em class="rfc2119">MUST</em> be returned .</li>
<li>If the <code>payment</code> property is provided but not expected in the request (as within <code>totalPaymentDue</code>: <code>prepayment</code> is <code>https://openactive.io/Unavailable</code> or <code>price</code> is <code>0</code>), then an <code>UnnecessaryPaymentDetailsError</code> <em class="rfc2119">MUST</em> be returned.</li>
<li>If the <code>payment</code> property does not include <code>identifier</code>, then an <code>IncompletePaymentDetailsError</code> <em class="rfc2119">MUST</em> be returned.</li>
<li>If the <code>payment</code> details supplied (e.g. <code>accountId</code>) are not considered <a href="#payment-reconciliation-detail-validation">valid for reconciliation</a> by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-166">Booking System</a> then an <code>InvalidPaymentDetailsError</code> <em class="rfc2119">MUST</em> be returned.</li>
</ul></section></section><section id="offer-overrides"><h3 id="x7-7-offer-overrides"><bdi class="secno">7.7 </bdi>Offer overrides<a class="self-link" aria-label="§" href="#offer-overrides"></a></h3><p>The unit price of an <code>OrderItem</code> <em class="rfc2119">MAY</em> be overridden to allow for business models with variable pricing (where price differs from list price).</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-208">Broker</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-92">Seller</a> <em class="rfc2119">MUST</em> have agreed an arrangement for offer overrides out-of-band, including which <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-34">Opportunities</a> and <code>Offer</code>s they may be applied to.</p><p>An <code>OfferOverride</code> type may be supplied by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-209">Broker</a> to the <code>acceptedOffer</code> property at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-30"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-37"><b>C2</b></a> and <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-21"><b>P</b></a> or <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-51"><b>B</b></a>. When an <code>OfferOverride</code> is used, it <em class="rfc2119">MUST</em> be used consistently between <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-31"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-38"><b>C2</b></a> and <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-22"><b>P</b></a> or <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-52"><b>B</b></a>, it <em class="rfc2119">MUST</em> be used by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-167">Booking System</a> instead of <code>acceptedOffer</code> to calculate the tax and totals. It <em class="rfc2119">MAY</em> be used for any <code>brokerRole</code>.</p><p>The <code>unitTaxSpecification</code> is calculated by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-168">Booking System</a> exactly as it would be for a standard <code>Offer</code>. The <code>price</code> of the <code>OfferOverride</code> may be zero, and also may be higher or lower than the available <code>Offer</code>s that exist in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-169">Booking System</a>.</p><p><code>OfferOverride</code> <em class="rfc2119">MUST NOT</em> be used when <code>isAccessibleForFree</code> is <code>true</code>, as free events cannot be overridden. Note that <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-170">Booking Systems</a> that <em>only</em> offer <a href="#dfn-free-opportunities" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-free-opportunities-2">Free Opportunities</a> <em class="rfc2119">MUST NOT</em> implement <code>OfferOverride</code> support, and must always throw an error when it is used.</p><p>The use of <code>OfferOverride</code> always creates the behaviour equivalent to <code>advanceBooking</code> and <code>prepayment</code> both being set to <code>https://openactive.io/Required</code>, and <code>availableChannel</code> having the value of <code>https://openactive.io/OpenBookingPrepayment</code>.</p><p><code>allowCustomerCancellationFullRefund</code> and <code>latestCancellationBeforeStartDate</code> do not apply to <code>OfferOverride</code>, and hence the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-159">Customer</a> may always <a href="#customer-requested-cancellation">request</a> cancellation.</p><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-171">Booking System</a> <em class="rfc2119">MUST</em> document the most comprehensive expected equivalent value of <code>openBookingFlowRequirement</code> that is applicable when an <code>OfferOverride</code> is requested by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-210">Broker</a>. This allows such <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-211">Brokers</a> to understand the features of this specification that may be used by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-172">Booking System</a>, and hence assess whether they are capable of completing the booking flow using <code>OfferOverride</code>.</p><div class="example" id="example-17-example-of-offeroverride">
        <div class="marker">
    <a class="self-link" href="#example-17-example-of-offeroverride">Example<bdi> 17</bdi></a><span class="example-title">: Example of OfferOverride</span>
  </div> <pre aria-busy="false"><code class="hljs css">"acceptedOffer": {
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"OfferOverride"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
  <span class="hljs-string">"price"</span>: <span class="hljs-number">10.00</span>,
  <span class="hljs-string">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
}</code></pre>
      </div></section><section id="currency-support"><h3 id="x7-8-currency-support"><bdi class="secno">7.8 </bdi>Currency support<a class="self-link" aria-label="§" href="#currency-support"></a></h3><p>This version of the specification does not support mixed currencies.</p><p>All <code>priceCurrency</code> values within an <code>Order</code>, <code>OrderQuote</code>, or <code>OrderProposal</code> must be identical.</p></section></section><section class="normative" id="order-operations"><h2 id="x8-order-operations"><bdi class="secno">8. </bdi>Order Operations<a class="self-link" aria-label="§" href="#order-operations"></a></h2><section id="definition-of-a-bookable-opportunity-and-offer-pair"><h3 id="x8-1-definition-of-a-bookable-opportunity-and-offer-pair"><bdi class="secno">8.1 </bdi>Definition of a 'bookable' Opportunity and Offer pair<a class="self-link" aria-label="§" href="#definition-of-a-bookable-opportunity-and-offer-pair"></a></h3><p>Before entering into the Booking Flow, the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-160">Customer</a> <em class="rfc2119">MUST</em> have selected at least one <a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-5">bookable</a> pair of an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-35">Opportunity</a> ("Yoga Tuesday 14th 7pm") with an associated <code>Offer</code> ("Junior (8-18) £9"), from the <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-11">Opportunity Data</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] open feeds. These pairs populate the <code>acceptedOffer</code> and <code>orderedItem</code> properties within the <code>OrderItem</code>s.</p><p>The pairing of an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-36">Opportunity</a> of type <code>Event</code>, <code>ScheduledSession</code>, <code>HeadlineEvent</code>, <code>Slot</code> or <code>CourseInstance</code> with an <code>Offer</code> is deemed to be <dfn data-lt="bookability|bookable" id="dfn-bookability">bookable</dfn> via the Open Booking API if the <code>Offer</code> is applicable to the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-37">Opportunity</a> following the principles of <code>Offer</code> inheritance contained in [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>], and if both the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-38">Opportunity</a> and <code>Offer</code> meet the criteria specified below.</p><p><a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-6">Bookable</a> <code>Offer</code>s:</p><ul>
<li><p>Include an <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-12"><code><code>@id</code></code></a>.</p>
</li>
<li><p><code>availableChannel</code> of the <code>Offer</code> includes <code>https://openactive.io/OpenBookingPrepayment</code>.</p>
</li>
<li><p><code>advanceBooking</code> of the <code>Offer</code> is not equal to <code>https://openactive.io/Unavailable</code>.</p>
</li>
<li><p>The <code>Offer</code> is current based on <code>validFromBeforeStartDate</code>.</p>
</li>
</ul><p><a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-7">Bookable</a> <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-39">Opportunities</a>:</p><ul>
<li><p>Include an <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-13"><code><code>@id</code></code></a>.</p>
</li>
<li><p>Include an <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-14"><code><code>@id</code></code></a> of an <code>Organization</code> or <code>Person</code> within the <code>organizer</code> or <code>provider</code> properties (i.e. the ID of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-93">Seller</a>).</p>
</li>
<li><p>The <code>endDate</code> is not already in the past (note that bookings are still possible after the <code>startDate</code>).</p>
</li>
<li><p>The <code>eventStatus</code> of the <code>Event</code>, <code>ScheduledSession</code>, or <code>Slot</code> is not <code>https://schema.org/EventCancelled</code> or <code>https://schema.org/EventPostponed</code>.</p>
</li>
<li><p>The <code>remainingAttendeeCapacity</code> or <code>remainingUses</code> is greater than the number required.</p>
</li>
<li><p>The <code>validFromBeforeStartDate</code> duration (if provided) subtracted from the <code>startDate</code> is in the past. This allows for a "bookahead" window to be specified.</p>
</li>
<li><p>The <code>taxMode</code> (<code>https://openactive.io/TaxNet</code> or <code>https://openactive.io/TaxGross</code>) is specified within the <code>Organization</code> or <code>Person</code> that is included in the <em class="rfc2119">REQUIRED</em> <code>organizer</code> or <code>provider</code> properties.</p>
</li>
<li><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-212">Broker</a> has machine readable permission to access the relevant instance of a compliant Open Booking API provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-173">Booking System</a> via an API key or similar token.</p>
</li>
</ul><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-213">Broker</a> <em class="rfc2119">MUST NOT</em> attempt to book an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-40">Opportunity</a> that is not <a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-8">bookable</a> by the above criteria. The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-174">Booking System</a> <em class="rfc2119">MUST</em> include an <code>error</code> of value <code>OpportunityOfferPairNotBookableError</code> against each <code>OrderItem</code> in the <code>OrderQuote</code> that is not <a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-9">bookable</a>.</p><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-175">Booking System</a> <em class="rfc2119">MUST</em> include the <code>openBookingFlowRequirement</code> property within the <code>Offer</code>s in the <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-12">Opportunity Data</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] open feeds, only if any features of the specification covered by this property are required to book the <code>Offer</code>. This allows <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-214">Brokers</a> that do not support the specified features to easily filter out such <code>Offer</code>s from their experience. The <code>openBookingFlowRequirement</code> property <em class="rfc2119">MUST NOT</em> be included in the request or response of any of the <a href="#endpoints">endpoints</a> defined within this specification. </p><section id="booking-restrictions"><h4 id="x8-1-1-booking-restrictions"><bdi class="secno">8.1.1 </bdi>Booking restrictions<a class="self-link" aria-label="§" href="#booking-restrictions"></a></h4><p>Note that although the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-161">Customer</a> may be ineligible to attend a <a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-10">bookable</a> <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-41">Opportunity</a> via an associated <a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-11">bookable</a> <code>Offer</code> based on the <code>genderRestriction</code> or <code>ageRestriction</code> of either the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-42">Opportunity</a> or <code>Offer</code>, this specification encourages the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-215">Broker</a> NOT to capture additional personal data about the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-162">Customer</a> (e.g. gender and date of birth) and NOT to enforce validation of these restrictions using such data, but instead to prominently communicate clear messaging regarding such restrictions throughout the booking process to ensure that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-163">Customer</a> is aware of these and able to make an informed decision.</p><p>There may be additional restrictions placed on an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-43">Opportunity</a> by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-94">Seller</a>. For example, it may be that one of the party must be over a certain age as a supervising adult if some of the party are minors. It is the responsibility of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-176">Booking System</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-95">Seller</a> to make such restrictions available as an array of <code>oa:additionalAdmissionRestriction</code> on the <code>SessionSeries</code>, <code>FacilityUse</code>, <code>Event</code>, <code>HeadlineEvent</code> or <code>CourseInstance</code>, and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-216">Broker</a> <em class="rfc2119">MUST</em> communicate these restrictions clearly during the booking process.</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-217">Broker</a> <em class="rfc2119">MAY</em> filter the <code>Offer</code>s it makes available to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-164">Customer</a>, for example based on <code>ageRestriction</code> of the <code>Offer</code>.</p></section><section id="opportunity-data-properties"><h4 id="x8-1-2-opportunity-data-properties"><bdi class="secno">8.1.2 </bdi>Opportunity data properties<a class="self-link" aria-label="§" href="#opportunity-data-properties"></a></h4><p>For requests to <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-32"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-39"><b>C2</b></a>, <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-23"><b>P</b></a>, and <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-53"><b>B</b></a>, and for items in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-38">Orders feed</a>, the <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-13">Opportunity Data</a> within the <code>orderedItem</code> property of an <code>OrderItem</code> <em class="rfc2119">MUST</em> only include the properties <code>@type</code> and <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-15"><code><code>@id</code></code></a>. The <code>orderedItem</code> property of all <code>OrderItem</code>s <em class="rfc2119">MAY</em> be excluded from the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-39">Orders feed</a> if the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-177">Booking System</a> does not support <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-1">Replacement</a>.</p><p>For responses from <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-33"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-40"><b>C2</b></a>, <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-24"><b>P</b></a>, and <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-54"><b>B</b></a>, and from the <a href="#dfn-order-status" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-status-1">Order Status</a> endpoint, the <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-14">Opportunity Data</a> within the <code>orderedItem</code> property of an <code>OrderItem</code> <em class="rfc2119">MUST</em> correspond exactly with the model used within the <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-15">Opportunity Data</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] open feeds. For example if properties within a <code>SessionSeries</code> and <code>ScheduledSession</code> are used in the open feeds, corresponding properties must be used within objects of the same types within the <code>orderedItem</code>.</p><p>See the [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] specification for more information on these types.</p><p>For such responses, the <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-16">Opportunity Data</a> <em class="rfc2119">MUST</em> include the following properties:</p><ul>
<li><code>@type</code></li>
<li><a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-16"><code><code>@id</code></code></a> and <code>name</code> of the <a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-12">bookable</a> <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-44">Opportunity</a></li>
<li><code>url</code></li>
<li><code>location</code> (including <code>name</code>, and either or ideally both of <code>address</code> or <code>geo</code>)</li>
<li><code>activity</code></li>
<li><code>startDate</code></li>
</ul><p>For such responses, the following properties are <em class="rfc2119">RECOMMENDED</em>:</p><ul>
<li><code>endDate</code></li>
<li><code>duration</code></li>
<li><code>ageRange</code></li>
<li><code>genderRestriction</code></li>
<li><code>eventStatus</code></li>
<li><code>maximumAttendeeCapacity</code> or <code>maximumUses</code></li>
<li><code>remainingAttendeeCapacity</code> or <code>remainingUses</code></li>
</ul><p>For such responses, the <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-17">Opportunity Data</a> <em class="rfc2119">MUST NOT</em> include the following properties:</p><ul>
<li><code>offers</code> (as the relevant <code>Offer</code> will be returned in <code>acceptedOffer</code>)</li>
<li><code>subEvent</code> or <code>event</code> (as the opportunity should be <a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-13">bookable</a>, and therefore of sufficient granularity)</li>
<li><code>organizer</code> or <code>provider</code> (as this is provided by the <code>seller</code> property of the <code>Order</code>)</li>
</ul><p>Where relevant it is expected that the <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-18">Opportunity Data</a> for such responses includes <code>superEvent</code> or <code>facilityUse</code> to allow for a <code>SessionSeries</code> or <code>FacilityUse</code> to be referenced from a <code>SessionSeries</code> or <code>Slot</code>, for example.</p></section><section id="acceptedoffer-properties"><h4 id="x8-1-3-acceptedoffer-properties"><bdi class="secno">8.1.3 </bdi><code>acceptedOffer</code> properties<a class="self-link" aria-label="§" href="#acceptedoffer-properties"></a></h4><p>With the exception of <code>openBookingFlowRequirement</code>, the <code>Offer</code> properties present in the Opportunity Data [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] open feeds <em class="rfc2119">MUST</em> exactly match those in the <code>acceptedOffer</code> consistently in responses to <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-34"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-41"><b>C2</b></a>, <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-25"><b>P</b></a>, and <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-55"><b>B</b></a>. <code>acceptedOffer</code> <em class="rfc2119">MUST</em> also include the same properties in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-40">Orders feed</a>, unless the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-178">Booking System</a> does not support <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-2">Replacement</a>.</p></section></section><section id="amending-the-orderquote-before-b"><h3 id="x8-2-amending-the-orderquote-before-b"><bdi class="secno">8.2 </bdi>Amending the OrderQuote before <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-56"><b>B</b></a><a class="self-link" aria-label="§" href="#amending-the-orderquote-before-b"></a></h3><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-218">Broker</a> <em class="rfc2119">MAY</em> call <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-35"><b>C1</b></a> and <em class="rfc2119">MUST</em> call <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-42"><b>C2</b></a> when the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-165">Customer</a> updates their basket to add and remove items.</p><p>When repeated calls to <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-36"><b>C1</b></a> or <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-43"><b>C2</b></a> are made with the same <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-40">Order UUID</a>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-179">Booking System</a> <em class="rfc2119">MUST</em> update any associated <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-31">Lease</a> to match the latest set of <code>OrderItem</code>s by removing those <code>OrderItem</code> that are not present in the request from the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-32">Lease</a>, and adding those <code>OrderItem</code> that have been added since the last call to the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-33">Lease</a>.</p><p><a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-34">Leases</a> may be cancelled by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-219">Broker</a> as a courtesy by submitting an OrderQuote Deletion request using the same <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-41">Order UUID</a>. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-220">Broker</a> <em class="rfc2119">SHOULD</em> make a reasonable attempt to cancel all <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-35">Leases</a> when it is aware that a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-166">Customer</a> has abandoned their journey, or if an error occurs and a new <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-42">Order UUID</a> is to be generated for the same customer. This increases the likelihood of an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-45">Opportunity</a> being booked with one space remaining.</p><p>For <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-180">Booking Systems</a> that have not implemented leasing, an OrderQuote Deletion request <em class="rfc2119">MUST</em> simply return a 204 success status in all cases.</p></section><section id="cancellation-after-b"><h3 id="x8-3-cancellation-after-b"><bdi class="secno">8.3 </bdi>Cancellation after <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-57"><b>B</b></a><a class="self-link" aria-label="§" href="#cancellation-after-b"></a></h3><p>Either the whole <code>Order</code> or individual <code>OrderItem</code>s within the <code>Order</code> may be cancelled after <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-58"><b>B</b></a>, however <code>OrderItem</code>s cannot be added or removed inside an existing <code>Order</code> past this point, within this version of the specification.</p><p>The cancellation may be requested by either the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-167">Customer</a> or the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-96">Seller</a>, and results in an updated <code>Order</code> item on the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-41">Orders feed</a>. Once a cancellation status is placed on an <code>OrderItem</code> within an <code>Order</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-42">Orders feed</a> it is assumed by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-181">Booking System</a> to have been processed, and it <em class="rfc2119">MUST NOT</em> be reversed. A new <code>Order</code> will need to created to reinstate the booking.</p><section id="refund-after-the-opportunity-has-occurred"><h4 id="x8-3-1-refund-after-the-opportunity-has-occurred"><bdi class="secno">8.3.1 </bdi>Refund after the opportunity has occurred<a class="self-link" aria-label="§" href="#refund-after-the-opportunity-has-occurred"></a></h4><p>Although a cancellation may be requested before the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-46">Opportunity</a> has occurred in order to trigger a refund, cancellation and refund after an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-47">Opportunity</a> has occurred, or when an <code>OrderItem</code> has <code>orderItemStatus</code> set to <code>https://openactive.io/CustomerAttended</code> (e.g. when an attendee arrives early), is currently outside the scope of this specification.</p><p>Hence within this version of the specification any <code>OrderItem</code> <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-17"><code><code>@id</code></code></a> submitted to the <a href="#dfn-order-cancellation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-cancellation-1">Order Cancellation</a> endpoint <em class="rfc2119">MUST</em> reference an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-48">Opportunity</a> with a <code>startDate</code> in the future.</p><p>Full and partial refunds after an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-49">Opportunity</a> has occurred <em class="rfc2119">MUST</em> be handled out-of-band directly between the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-221">Broker</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-97">Seller</a>.</p></section><section id="customer-requested-cancellation"><h4 id="x8-3-2-customer-requested-cancellation"><bdi class="secno">8.3.2 </bdi>Customer requested cancellation<a class="self-link" aria-label="§" href="#customer-requested-cancellation"></a></h4><figure id="fig-customer-requested-cancellation">
 <img src="customercancelled.png" alt="Customer requested cancellation" height="529" width="767">
 <figcaption>Figure <bdi class="figno">15</bdi> <span class="fig-title">Customer requested cancellation</span></figcaption>
</figure><p>To cancel an existing <code>OrderItem</code>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-222">Broker</a> <em class="rfc2119">MUST</em>:</p><ol>
<li><p>Use the latest state of the <code>Order</code> stored during the booking flow and updated via the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-43">Orders feed</a> to determine which <code>OrderItem</code>s may be cancelled and refunded. If <code>orderItemStatus</code> is not yet set to <code>https://openactive.io/CustomerAttended</code>, and <code>allowCustomerCancellationFullRefund</code> is <code>true</code>, and either <code>latestCancellationBeforeStartDate</code> is unspecified and <code>startDate</code> is in the future, or <code>latestCancellationBeforeStartDate</code> subtracted from the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-50">Opportunity</a> <code>startDate</code> is in the future, a PATCH against the <code>Order</code> including the <code>OrderItem</code> with <code>"orderItemStatus": "https://openactive.io/CustomerCancelled"</code> <em class="rfc2119">SHOULD</em> succeed.</p>
</li>
<li><p>Offer the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-168">Customer</a> an interface to "Request Cancellation". Cancellation requested by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-169">Customer</a> cannot be guaranteed due to potentially opaque cancellation rules within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-182">Booking System</a> for exceptional cases, therefore it is important that expectations are set accordingly.</p>
</li>
<li><p>Inform the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-170">Customer</a> of the refund being requested before they commit to cancellation, using the existing data available in the stored <code>Order</code> to communicate the <code>OrderItem</code>s that are included in the full refund request. </p>
</li>
<li><p>Submit a PATCH to the <a href="#dfn-order-cancellation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-cancellation-2">Order Cancellation</a> endpoint for the <code>Order</code> including only the <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-18"><code><code>@id</code></code></a> for each of the <code>OrderItem</code>s to be cancelled, with an <code>"orderItemStatus": "https://openactive.io/CustomerCancelled"</code> set on each. On success, a status code 204 response <em class="rfc2119">MUST</em> be returned, without any body. On failure due to opaque cancellation rules, a status code 400 response <em class="rfc2119">MUST</em> be returned, containing a <code>CancellationNotPermittedError</code> error including a <code>description</code> of the reason, which <em class="rfc2119">MUST</em> be communicated to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-171">Customer</a>. The PATCH request is atomic, and therefore the cancellation succeeds or fails entirely.</p>
</li>
<li><p>Process any refunds based on the resulting updates to the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-44">Orders feed</a>, based on the updated <code>totalPaymentDue</code>. Successfully cancelled <code>OrderItem</code>s will have <code>orderItemStatus</code> set to <code>https://openactive.io/CustomerCancelled</code>. Note refunds <em class="rfc2119">MUST NOT</em> be processed except in response to updates in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-45">Orders feed</a>.</p>
</li>
</ol><p>To cancel an entire <code>Order</code>, the PATCH request <em class="rfc2119">MUST</em> include <code>"orderItemStatus": "https://openactive.io/CustomerCancelled"</code> for each <code>OrderItem</code> within it.</p><p>Note that there is no provision for a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-172">Customer</a> to cancel an <code>Order</code> after the cancellation window specified by <code>latestCancellationBeforeStartDate</code>. They may wish to do this out of politeness even though no refund is possible, with the benefit that their place may be taken by another <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-173">Customer</a>, which can be included in future versions of this specification.</p></section><section id="seller-requested-cancellation"><h4 id="x8-3-3-seller-requested-cancellation"><bdi class="secno">8.3.3 </bdi>Seller requested cancellation<a class="self-link" aria-label="§" href="#seller-requested-cancellation"></a></h4><figure id="fig-seller-requested-cancellation">
 <img src="sellercancelled.png" alt="Seller requested cancellation" height="317" width="653">
 <figcaption>Figure <bdi class="figno">16</bdi> <span class="fig-title">Seller requested cancellation</span></figcaption>
</figure><p><code>OrderItem</code>s cancelled by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-98">Seller</a> will have <code>orderItemStatus</code> set to <code>https://openactive.io/SellerCancelled</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-46">Orders feed</a>, and will optionally include a <code>cancellationMessage</code>. Refunds <em class="rfc2119">MUST</em> be processed in response to the resulting updates in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-47">Orders feed</a>, and the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-174">Customer</a> <em class="rfc2119">MUST</em> be notified with the <code>cancellationMessage</code> if provided.</p></section></section><section id="orders-feed-notifications-updates-and-refunds"><h3 id="x8-4-orders-feed-notifications-updates-and-refunds"><bdi class="secno">8.4 </bdi>Orders feed: Notifications, updates and refunds<a class="self-link" aria-label="§" href="#orders-feed-notifications-updates-and-refunds"></a></h3><p>An <dfn id="dfn-orders-feed">Orders feed</dfn>, which is a secure [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] feed of <code>Order</code>s and <code>OrderProposal</code>s, <em class="rfc2119">MUST</em> be provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-183">Booking System</a>, with the contents of the feed specific to the authenticating <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-223">Broker</a>. As noted in <a href="#new-orders-and-orderproposals">New Orders and OrderProposals</a>, this list must include all, and only, <code>Order</code>s and <code>OrderProposal</code>s that have been updated by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-184">Booking System</a> subsequent to successful completion of <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-59"><b>B</b></a> or <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-26"><b>P</b></a>, respectively. This allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-224">Broker</a> to maintain an updated state of all their bookings across a number of <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-185">Booking Systems</a>, even when changes are made outside of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-225">Broker</a>.</p><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-186">Booking System</a> <em class="rfc2119">MUST NOT</em> communicate directly with the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-175">Customer</a> using the personal details supplied by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-226">Broker</a>, and <em class="rfc2119">MUST</em> instead update the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-48">Orders feed</a> and <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-19">Opportunity data</a> to instruct the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-227">Broker</a> to send appropriate notifications. This allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-228">Broker</a> to handle refunds to cancellations, and process notifications to <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-176">Customers</a> in a consistent way.</p><section id="orders-feed-inconsistencies"><h4 id="x8-4-1-orders-feed-inconsistencies"><bdi class="secno">8.4.1 </bdi>Orders Feed Inconsistencies<a class="self-link" aria-label="§" href="#orders-feed-inconsistencies"></a></h4><p>An error condition exists where an unrecognised <code>Order</code> or <code>OrderProposal</code> item is found by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-229">Broker</a> on the feed. Due to the <code>Order</code> or <code>OrderProposal</code> being stored during the <a href="#dfn-payment-authorisation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-authorisation-3">Payment Authorisation</a> stage, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-230">Broker</a> should always have a matching <code>Order</code> or <code>OrderProposal</code> for any <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-43">Order UUID</a> on the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-49">Orders feed</a> even if it has been soft-deleted. This would make an unrecognised <code>Order</code> or <code>OrderProposal</code> an impossible scenario, and hence an unrecognised <code>Order</code> or <code>OrderProposal</code> should be logged as a serious error within the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-231">Broker</a> and promptly investigated.</p><p>The RPDE <code>id</code> of an <code>OrderProposal</code> <em class="rfc2119">MUST</em> differ from the RPDE <code>id</code> of its related <code>Order</code>. The <code>OrderProposal</code> is marked as <code>deleted</code> at <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-60"><b>B</b></a>, and the related <code>Order</code> will not appear in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-50">Orders feed</a> until it is next updated.</p><p>An <code>Order</code> <em class="rfc2119">MUST NOT</em> be set to <code>"state": "deleted"</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-51">Orders feed</a> by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-187">Booking System</a>, except as a result of <a href="#order-deletion">Order Deletion</a>, or when authorisation to access a particular <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-99">Seller</a> has been revoked. An <code>Order</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-52">Orders feed</a> marked as <code>deleted</code> outside of <a href="#order-deletion">Order Deletion</a> should be logged as a serious error within the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-232">Broker</a> and promptly investigated, and <em class="rfc2119">SHOULD NOT</em> trigger an immediate deletion of the <code>Order</code> by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-233">Broker</a>, to allow for the issue to be resolved.</p></section><section id="order-stores-with-eventual-consistency"><h4 id="x8-4-2-order-stores-with-eventual-consistency"><bdi class="secno">8.4.2 </bdi>Order stores with eventual consistency<a class="self-link" aria-label="§" href="#order-stores-with-eventual-consistency"></a></h4><p>It is important that the storage used by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-234">Broker</a> for <code>Order</code>s provides a <a href="https://aphyr.com/posts/313-strong-consistency-models">linearisability</a> guarantee when <code>Order</code>s are retrieved by ID, due to the partial updates that are applied to it from the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-53">Orders feed</a> and the creation of the initial <code>Order</code> being synchronous.</p></section><section id="booking-system-updating-the-orders-feed"><h4 id="x8-4-3-booking-system-updating-the-orders-feed"><bdi class="secno">8.4.3 </bdi>Booking System: Updating the Orders feed<a class="self-link" aria-label="§" href="#booking-system-updating-the-orders-feed"></a></h4><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-188">Booking System</a> must ensure that the <code>Order</code>s and <code>OrderProposal</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-54">Orders feed</a> represent the current state of <code>OrderItem</code>s within the system, for the properties included in the feed. Hence any change to any property within an <code>Order</code> or <code>OrderProposal</code> in the feed <em class="rfc2119">MUST</em> result in a change to the RPDE <code>modified</code> property associated with it.</p><section id="totalpaymentdue-invariant"><h5 id="x8-4-3-1-totalpaymentdue-invariant"><bdi class="secno">8.4.3.1 </bdi><code>totalPaymentDue</code> invariant<a class="self-link" aria-label="§" href="#totalpaymentdue-invariant"></a></h5><p>In this version of the specification, the following constraints exist around the stored <code>Order</code> that are shared by both the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-235">Broker</a> and the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-189">Booking System</a>:</p><ul>
<li><code>OrderItem</code>s <em class="rfc2119">MUST NOT</em> be added or removed inside an existing <code>Order</code> after <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-61"><b>B</b></a>.</li>
<li>The <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-51">Opportunity</a> (<code>orderedItem</code>) and <code>Offer</code> (<code>acceptedOffer</code>) of an <code>OrderItem</code> referenced within an <code>Order</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-55">Orders feed</a> <em class="rfc2119">MAY</em> be updated to reference a different <a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-14">bookable</a> <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-52">Opportunity</a> and <code>Offer</code> pair via <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-3">Replacement</a>, only if the <code>price</code> is less than or equal the previous <code>Offer</code> <code>price</code>, and if the <code>prepayment</code> value is the same.</li>
<li>The <code>acceptedOffer</code> and <code>unitTaxSpecification</code> properties of an <code>OrderItem</code> referenced within an <code>Order</code> <em class="rfc2119">MUST</em> always represent a snapshot of the <code>Offer</code> at the point it was booked, or the last <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-4">Replacement</a>.</li>
<li><code>OrderItem</code> cancellation <em class="rfc2119">MUST NOT</em> be reversed.</li>
</ul><p>Hence an invariant exists whereby the <code>totalPaymentDue</code> of an <code>Order</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-56">Orders feed</a> <em class="rfc2119">MUST</em> only ever decrease or remain unchanged due to <code>OrderItem</code> <a href="#dfn-cancellation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-cancellation-1">Cancellation</a> or <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-5">Replacement</a>, and <em class="rfc2119">MUST NOT</em> otherwise change or increase.</p><p>These constraints and invariant do not apply to <code>OrderProposal</code>s.</p></section></section><section id="broker-processing-the-orders-feed"><h4 id="x8-4-4-broker-processing-the-orders-feed"><bdi class="secno">8.4.4 </bdi>Broker: Processing the Orders feed<a class="self-link" aria-label="§" href="#broker-processing-the-orders-feed"></a></h4><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-236">Broker</a> <em class="rfc2119">MUST</em> maintain an up-to-date store of <code>Order</code>s and <code>OrderProposal</code>s received from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-190">Booking System</a>. Each <code>Order</code> or <code>OrderProposal</code> received is compared to the last version stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-237">Broker</a>, and any differences between the old and new content can trigger notifications and refunds to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-177">Customer</a>, as well as updating the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-238">Broker</a>'s store.</p><p>Hence it is important for the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-239">Broker</a> to consider their store of <code>Order</code>s and <code>OrderProposal</code>s as durable, and not simply a cache, to ensure their <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-178">Customers</a> always get relevant notifications.</p><p>The <code>Order</code>/<code>OrderProposal</code> properties included in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-57">Orders feed</a> <em class="rfc2119">MUST</em> be a subset of the <code>Order</code>/<code>OrderProposal</code> properties returned in the response from <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-62"><b>B</b></a> or <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-27"><b>P</b></a> as specified below (effectively making the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-58">Orders feed</a> a series of partial update requests for the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-240">Broker</a>). It is the responsibility of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-241">Broker</a> to process the contents of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-59">Orders feed</a> in a manner that maintains a complete view of the <code>Order</code> state.</p><p>The following properties of the <code>Order</code> or <code>OrderProposal</code> <em class="rfc2119">MUST</em> be included in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-60">Orders feed</a>, and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-242">Broker</a> <em class="rfc2119">MUST</em> overwrite its previous copy of each property when processed:</p><ul>
<li><code>totalPaymentTax</code> (if at least one <code>TaxChargeSpecification</code> exists for <code>totalPaymentTax</code>, and <code>taxCalculationExcluded</code> is not <code>true</code>)</li>
<li><code>totalPaymentDue</code></li>
<li><code>orderProposalStatus</code> (<code>OrderProposal</code> only)</li>
<li><code>orderProposalVersion</code> (<code>OrderProposal</code> only)</li>
</ul><p>Additionally, the <code>orderedItem</code> property of the <code>Order</code> or <code>OrderProposal</code> <em class="rfc2119">MUST</em> be included in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-61">Orders feed</a>. Noting the exceptions outlined in this section, all other properties of the <code>OrderItem</code>s <em class="rfc2119">MUST</em> overwrite the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-243">Broker</a>'s previous copy of each when processed, and if a property is no longer present the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-244">Broker</a> must remove it. This includes the following properties, and any additional supported <a href="#booking-functionality-extensions">extensions</a>:</p><p>For <code>OrderItem</code> in both <code>Order</code> and <code>OrderProposal</code>:</p><ul>
<li><code>orderItemStatus</code></li>
<li><code>accessPass</code></li>
<li><code>accessCode</code></li>
<li><code>accessChannel</code></li>
<li><code>additionalProperty</code></li>
<li><code>cancellationMessage</code></li>
<li><code>customerNotice</code></li>
<li><code>acceptedOffer</code></li>
<li><code>unitTaxSpecification</code></li>
<li><code>orderedItem</code> (including only <code>@type</code> and <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-19"><code><code>@id</code></code></a> properties)</li>
</ul><p>And for <code>OrderItem</code> in <code>OrderProposal</code> it additionally includes:</p><ul>
<li><code>attendeeDetailsRequired</code></li>
<li><code>attendee</code></li>
<li><code>orderItemIntakeForm</code></li>
<li><code>orderItemIntakeFormResponse</code></li>
</ul><p>As an exception to the above for <code>Order</code>s, if the <code>orderedItem</code> property is not present in the <code>OrderItem</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-62">Orders feed</a> (in the case that the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-191">Booking System</a> does not support <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-6">Replacement</a>), the following properties are assumed to be immutable for that <code>Order</code>, and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-245">Broker</a> <em class="rfc2119">MUST NOT</em> overwrite their previous copy of each (taken at <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-63"><b>B</b></a>) when processing the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-63">Orders feed</a>:</p><ul>
<li><code>acceptedOffer</code></li>
<li><code>unitTaxSpecification</code></li>
<li><code>orderedItem</code></li>
</ul><p>The following properties <em class="rfc2119">MUST</em> always be included in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-64">Orders feed</a> for the convenience of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-246">Broker</a>, and <em class="rfc2119">MUST</em> be immutable:</p><ul>
<li><code>@type</code>, <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-20"><code><code>@id</code></code></a> and <code>identifier</code> (the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-44">Order UUID</a>) of the <code>Order</code> or <code>OrderProposal</code></li>
<li><code>@type</code> and <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-21"><code><code>@id</code></code></a> of the <code>OrderItem</code></li>
<li><code>taxCalculationExcluded</code> (only included if its value is <code>true</code>)</li>
</ul><p>Additionally any properties within objects included in the properties above that were included in the original response from <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-64"><b>B</b></a> or <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-28"><b>P</b></a> <em class="rfc2119">MUST</em> be included in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-65">Orders feed</a>, with the exception of the following.</p><p>The following properties <em class="rfc2119">MUST NOT</em> be included in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-66">Orders feed</a> and <em class="rfc2119">MUST</em> always be maintained by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-247">Broker</a> and not overwritten; hence changes to these properties <em class="rfc2119">MUST NOT</em> be permitted after <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-65"><b>B</b></a>:</p><p>Properties in <code>Order</code> and <code>OrderProposal</code>:</p><ul>
<li><code>bookingService</code></li>
<li><code>broker</code></li>
<li><code>brokerRole</code></li>
<li><code>seller</code></li>
<li><code>customer</code></li>
<li><code>orderNumber</code></li>
<li><code>payment</code></li>
</ul><p>Properties in <code>OrderItem</code> within <code>Order</code> only:</p><ul>
<li><code>attendeeDetailsRequired</code></li>
<li><code>attendee</code></li>
<li><code>orderItemIntakeForm</code></li>
<li><code>orderItemIntakeFormResponse</code></li>
</ul><p><a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-20">Opportunity Data</a> updates for <code>Order</code>s <em class="rfc2119">MUST NOT</em> be read from the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-67">Orders feed</a>, and must instead be updated using the <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-21">Opportunity Data</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] open feeds as specified in <a href="#change-of-logistics-notifications">Change of logistics notification</a>.</p><p><a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-248">Brokers</a> reading <code>OrderItem</code>s in <code>OrderProposal</code>s, or <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-7">Replacements</a>, from the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-68">Orders feed</a> <em class="rfc2119">MUST</em> look up the <code>@type</code> and <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-22"><code><code>@id</code></code></a> of each <code>orderedItem</code> against the <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-22">Opportunity Data</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] open feeds to retrieve the most up-to-date full <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-53">Opportunity</a>.</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-249">Broker</a> is expected to fully replace properties at the <code>Order</code>/<code>OrderProposal</code> level, in their entirety, as specified above, and <em class="rfc2119">MUST NOT</em> perform a granular PATCH of nested properties within these. The rationale for this is that both <a href="#model">this specification</a> and the [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] specification on which this specification is based do not allow for explicit null values to exist within the model, which impedes property removal, and hinders any straightforward implementation of a granular PATCH.</p><p>Note that in this version of the specification, once an <code>Order</code> or <code>OrderProposal</code> has been created, only properties that are present in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-69">Orders feed</a> <em class="rfc2119">MAY</em> be updated.</p><p>Note also that the representation of <code>Order</code>s within the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-70">Orders feed</a> is designed specifically such that it does not include any personal data, except for that which is already available from the <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-23">Opportunity Data</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] open feeds provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-192">Booking System</a>.</p><p><a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-250">Brokers</a> <em class="rfc2119">MUST</em> harvest the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-71">Orders feed</a> with a frequency of at least once every 60 seconds to ensure expediency of updates and notifications to <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-179">Customers</a>.</p></section><section id="new-orders-and-orderproposals"><h4 id="x8-4-5-new-orders-and-orderproposals"><bdi class="secno">8.4.5 </bdi>New <code>Order</code>s and <code>OrderProposal</code>s<a class="self-link" aria-label="§" href="#new-orders-and-orderproposals"></a></h4><p>A new <code>Order</code> <em class="rfc2119">MUST NOT</em> be communicated externally by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-251">Broker</a> and other operations such as cancellation <em class="rfc2119">MUST NOT</em> be possible until it has reached the <code>orderCreationStatus</code> of <code>https://openactive.io/OrderCreationComplete</code>, after which the <code>orderCreationStatus</code> can be completely ignored.</p><p><code>OrderProposal</code>s <em class="rfc2119">MUST</em> be stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-252">Broker</a> based on a successful response to <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-29"><b>P</b></a>, and <code>Order</code>s <em class="rfc2119">MUST</em> be stored by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-253">Broker</a> based on a successful response to <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-66"><b>B</b></a>.</p><p>New <code>Order</code>s and <code>OrderProposal</code>s <em class="rfc2119">MUST NOT</em> be included in the feed until they have been updated at least once. This minimises the volume of updates in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-72">Orders feed</a>, and allows the polling frequency of the feed to be greatly reduced, which reduces the overall load on the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-193">Booking System</a>.</p><p>Hence all <code>Order</code>s and <code>OrderProposal</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-73">Orders feed</a> will always be recognised by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-254">Broker</a> as updates to an existing stored <code>Order</code> or <code>OrderProposal</code>, and the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-255">Broker</a> should treat any unrecognised <code>Order</code>s or <code>OrderProposal</code>s in the feed as a serious implementation error.</p></section><section id="cancellation-replacement-refund-calculation-and-notification"><h4 id="x8-4-6-cancellation-replacement-refund-calculation-and-notification"><bdi class="secno">8.4.6 </bdi>Cancellation, replacement, refund calculation and notification<a class="self-link" aria-label="§" href="#cancellation-replacement-refund-calculation-and-notification"></a></h4><p>Regardless of the source of the cancellation, the process for refunding, notifying the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-180">Customer</a>, and updating the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-256">Broker</a>'s records is exactly the same.</p><p>There are two scenarios that can update the effective <code>OrderItem</code> composition of an <code>Order</code> found in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-74">Orders feed</a>:</p><ul>
<li><dfn data-plurals="cancellations" id="dfn-cancellation">Cancellation</dfn>: Updated <code>https://openactive.io/CustomerCancelled</code> or <code>https://openactive.io/SellerCancelled</code> values for <code>orderItemStatus</code>, indicating the item is cancelled and a refund due if necessary.</li>
<li><dfn data-plurals="replacements" id="dfn-replacement">Replacement</dfn>: Updated <code>@type</code> and <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-23"><code><code>@id</code></code></a> within the <code>orderedItem</code>, and associated updates to <code>acceptedOffer</code> and <code>unitTaxSpecification</code>, indicating the item has been replaced by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-100">Seller</a> with an equivalent item of the same or lower <code>price</code>.</li>
</ul><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-257">Broker</a> <em class="rfc2119">MUST</em> process refunds for each new <a href="#dfn-cancellation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-cancellation-2">Cancellation</a> or <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-8">Replacement</a> found in the feed, and it is the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-258">Broker</a>'s responsibility to continually retry failed refund processing and escalate any processing failure to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-181">Customer</a> accordingly. Note that the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-75">Orders feed</a> is "fire and forget" for the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-194">Booking System</a>: once an <code>OrderItem</code> is updated with a cancellation status in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-76">Orders feed</a>, the status <em class="rfc2119">MUST NOT</em> be reversed, and is assumed by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-195">Booking System</a> to be processed.</p><p>For a <a href="#dfn-cancellation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-cancellation-3">Cancellation</a>, the snapshot contents of <code>acceptedOffer</code> (and <code>unitTaxSpecification</code>, if relevant) within the <code>OrderItem</code>s <em class="rfc2119">MUST</em> remain unchanged by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-196">Booking System</a> after <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-67"><b>B</b></a>, and new <code>totalPaymentDue</code> (and <code>totalPaymentTax</code>, if relevant) values <em class="rfc2119">MUST</em> be calculated excluding <code>OrderItem</code>s with an <code>orderItemStatus</code> of either <code>https://openactive.io/CustomerCancelled</code> or <code>https://openactive.io/SellerCancelled</code>.</p><p>For a <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-9">Replacement</a>, an updated <code>acceptedOffer</code> (and <code>unitTaxSpecification</code>, if relevant) <em class="rfc2119">MAY</em> be included in the <code>OrderItem</code>, and <em class="rfc2119">MUST</em> then constitute a snapshot and <em class="rfc2119">MUST</em> remain unchanged by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-197">Booking System</a> except for in the case of a further <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-10">Replacement</a>. The value of <code>prepayment</code> within the <code>acceptedOffer</code> <em class="rfc2119">MUST NOT</em> be change through <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-11">Replacement</a>.</p><p>If the <code>totalPaymentDue</code> value of the <code>Order</code> has decreased (it is <a href="#totalpaymentdue-invariant">not permitted to increase</a>) following one or more <a href="#dfn-cancellation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-cancellation-4">Cancellations</a> or <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-12">Replacements</a> within an <code>Order</code>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-259">Broker</a> <em class="rfc2119">MUST</em> instruct the <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-30">Payment Provider</a> to issue a new <a href="#dfn-refund" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-refund-4">Refund</a> such that the new <code>totalPaymentDue</code> value of the <code>Order</code> is equal to the value of the associated <a href="#dfn-payment" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-14">Payment</a> less all <a href="#dfn-refund" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-refund-5">Refunds</a> including the new one.</p><p>In all cases of the <code>Order</code> composition changing, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-260">Broker</a> <em class="rfc2119">MUST</em> generate a new <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-12">Invoice</a> for the <code>Order</code> to replace the previous <a href="#dfn-invoice" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-invoice-13">Invoice</a>.</p><p>The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-182">Customer</a> <em class="rfc2119">MUST</em> be notified after a refund is successfully processed, with the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-261">Broker</a> using the <code>orderItemStatus</code> or updated <code>orderedItem</code> to indicate the source of the refund.</p><p>If refund processing takes longer than 1 minute, then the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-183">Customer</a> must be notified immediately of a <a href="#dfn-cancellation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-cancellation-5">Cancellation</a> or <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-13">Replacement</a> ahead of the notification of the completed refund. This ensures the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-101">Seller</a> can rely on the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-262">Broker</a> as a notification channel. The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-184">Customer</a> <em class="rfc2119">MUST</em> be notified with the <code>cancellationMessage</code> (for <a href="#dfn-cancellation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-cancellation-6">Cancellation</a>) or <code>customerNotice</code> (for <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-14">Replacement</a>) for the <code>OrderItem</code>, if provided.</p><p>Note that the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-185">Customer</a> <em class="rfc2119">MUST</em> be notified in the event of all <a href="#dfn-cancellation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-cancellation-7">Cancellations</a> or <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-15">Replacements</a>, even if no refund is due (e.g. for <a href="#dfn-free-opportunities" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-free-opportunities-3">Free Opportunities</a>).</p><p>If the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-198">Booking System</a> does not support <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-16">Replacement</a>, it <em class="rfc2119">MAY</em> consistently exclude all three of the properties <code>orderedItem</code>, <code>acceptedOffer</code> and <code>unitTaxSpecification</code> from all <code>OrderItem</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-77">Orders feed</a>.</p></section><section id="partial-refunds-and-out-of-band-arrangements"><h4 id="x8-4-7-partial-refunds-and-out-of-band-arrangements"><bdi class="secno">8.4.7 </bdi>Partial Refunds and out-of-band arrangements<a class="self-link" aria-label="§" href="#partial-refunds-and-out-of-band-arrangements"></a></h4><p>This version of the specification does not allow a refund to be processed (in full or in part) by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-199">Booking System</a> without going via the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-263">Broker</a> for any <code>Order</code> that has been placed via the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-264">Broker</a>. <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-200">Booking Systems</a> <em class="rfc2119">MUST</em> disable their own refund functionality for <code>Order</code>s placed via a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-265">Broker</a> - only allowing Seller requested cancellations which trigger the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-266">Broker</a> to provide full item refunds - to ensure that the book keeping and invoices of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-267">Broker</a> are not invalidated.</p><p>Partial refunds <em class="rfc2119">MAY</em> be handled by out-of-band arrangements between the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-268">Broker</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-102">Seller</a> provided they do not have any affect on the Open Booking API interface. For example, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-269">Broker</a> could issue a partial refund and then reassign the remaining funds as a cancellation penalty via a new invoice handled and reconciled directly with the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-103">Seller</a> outside the scope of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-201">Booking System</a> and this specification.</p></section><section id="customer-notice-notifications"><h4 id="x8-4-8-customer-notice-notifications"><bdi class="secno">8.4.8 </bdi>Customer notice notifications<a class="self-link" aria-label="§" href="#customer-notice-notifications"></a></h4><p>The <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-104">Seller</a> may provide a notice to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-186">Customer</a> ahead of an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-54">Opportunity</a>, for example to inform <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-187">Customers</a> that they are still short of a player in case any friends are interested in attending.</p><p>An <code>orderedItem</code> within the <code>OrderItem</code> of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-78">Orders feed</a> <em class="rfc2119">MAY</em> be updated to include a <code>customerNotice</code>. The <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-188">Customer</a> <em class="rfc2119">MUST</em> be notified with the contents of the <code>customerNotice</code> for the <code>OrderItem</code> if it differs from the value of <code>customerNotice</code> for that specific <code>orderedItem</code> that the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-270">Broker</a> had previously stored (or if a new <code>Order</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-79">Orders feed</a> includes a <code>customerNotice</code>).</p><p>Note that notifications that inform the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-189">Customer</a> of substantive changes to the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-55">Opportunity</a> <em class="rfc2119">MUST</em> be triggered by updating the <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-24">Opportunity Data</a>, which will trigger a <a href="#change-of-logistics-notifications">Change of logistics notification</a>, instead of using the <code>customerNotice</code> mechanism.</p></section><section id="change-of-logistics-notifications"><h4 id="x8-4-9-change-of-logistics-notifications"><bdi class="secno">8.4.9 </bdi>Change of logistics notifications<a class="self-link" aria-label="§" href="#change-of-logistics-notifications"></a></h4><p>The <code>orderedItem</code> within the <code>OrderItem</code> includes an <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-24"><code><code>@id</code></code></a> reference to an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-56">Opportunity</a>, which <em class="rfc2119">MUST</em> be able to be cross-referenced with other sources of <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-25">Opportunity Data</a>, for example an [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] open feed.</p><p>This specification requires the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-80">Orders feed</a> to not include the full contents of the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-57">Opportunities</a> within the <code>orderedItem</code>, and instead only includes the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-58">Opportunity</a> properties <code>@type</code> and <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-25"><code><code>@id</code></code></a>. Additionally the <code>orderedItem</code> property of the <code>OrderItem</code> is only required within the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-81">Orders feed</a> if <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-17">Replacement</a> is supported.</p><p>Hence the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-271">Broker</a> <em class="rfc2119">MUST</em> store the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-59">Opportunity</a> references <code>@type</code> and <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-26"><code><code>@id</code></code></a> at <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-68"><b>B</b></a>, <em class="rfc2119">MUST</em> monitor the <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-26">Opportunity Data</a> open feeds for updates to the referenced information, and <em class="rfc2119">MUST</em> provide a notification to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-190">Customer</a> for substantive changes to the same <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-60">Opportunity</a>; specifically: any changes to the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-61">Opportunity</a> <code>name</code>, <code>startDate</code>, <code>endDate</code>, <code>duration</code> or <code>meetingPoint</code> properties, and any changes to the <code>name</code>, <code>address</code> or <code>geo</code> properties within <code>location</code>.</p></section><section id="opportunity-attendance-updates"><h4 id="x8-4-10-opportunity-attendance-updates"><bdi class="secno">8.4.10 </bdi>Opportunity attendance updates<a class="self-link" aria-label="§" href="#opportunity-attendance-updates"></a></h4><p>When a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-191">Customer</a> has been confirmed as attending an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-62">Opportunity</a> that was booked via an <code>Order</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-202">Booking System</a> <em class="rfc2119">SHOULD</em> update the <code>Order</code> within the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-82">Orders feed</a> by setting <code>orderItemStatus</code> for the relevant <code>OrderItem</code> to <code>https://openactive.io/CustomerAttended</code>.</p></section><section id="other-notifications"><h4 id="x8-4-11-other-notifications"><bdi class="secno">8.4.11 </bdi>Other notifications<a class="self-link" aria-label="§" href="#other-notifications"></a></h4><p>The following properties within <code>Order</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-83">Orders feed</a> <em class="rfc2119">MAY</em> also be updated by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-203">Booking System</a>, and <em class="rfc2119">MUST</em> trigger the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-272">Broker</a> to notify the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-192">Customer</a>: </p><ul>
<li><code>accessCode</code>, <code>accessPass</code> and/or <code>accessChannel</code> - A notification that the access details for the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-63">Opportunity</a> have changed</li>
</ul><p>The following properties within <code>Order</code>s in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-84">Orders feed</a> <em class="rfc2119">MAY</em> also be updated by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-204">Booking System</a>, and <em class="rfc2119">MUST</em> be used subsequently by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-273">Broker</a> for their internal operations:</p><ul>
<li><code>additionalProperty</code> - The details to use for payment reconciliation have changed</li>
</ul></section></section><section id="amending-the-order-after-b"><h3 id="x8-5-amending-the-order-after-b"><bdi class="secno">8.5 </bdi>Amending the Order after <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-69"><b>B</b></a><a class="self-link" aria-label="§" href="#amending-the-order-after-b"></a></h3><p><code>OrderItem</code>s cannot be added or removed within an existing <code>Order</code> under any circumstances in this version of the specification, and are not permitted to be replaced by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-274">Broker</a> (only the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-105">Seller</a> may provide a <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-18">Replacement</a>). Hence to make such changes, a new <code>Order</code> must be created, and the old <code>Order</code> cancelled.</p><p>For the common case of rescheduling a <code>SessionSeries</code> or <code>FacilityUse</code> booking, the following steps are <em class="rfc2119">RECOMMENDED</em> for the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-275">Broker</a>:</p><ol>
<li><p>Request an <code>OrderQuote</code> for the new <code>orderItem</code>s with a newly generated <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-45">Order UUID</a>, using <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-44"><b>C2</b></a>.</p>
</li>
<li><p>Check the latest stored state of <code>Order</code>s from the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-85">Orders feed</a> to ensure that the <code>acceptedOffer</code> of the old <code>OrderItem</code> has <code>allowCustomerCancellationFullRefund</code> set to <code>true</code>, as this may have been updated in the case of a <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-19">Replacement</a>.</p>
</li>
<li><p>Clearly communicate messaging to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-193">Customer</a> that explains that this transaction will involve a refund and new purchase, and so they will expect a refund for the old item and a new transaction for the new one. Information should be communicated to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-194">Customer</a> if any price difference exists between the two <code>Order</code>s, for the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-195">Customer</a> to confirm.</p>
</li>
<li><p>Request new payment details from the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-196">Customer</a> and Authorise the amount specified by <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-45"><b>C2</b></a>, then PATCH the old <code>Order</code> via the <a href="#dfn-order-cancellation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-cancellation-3">Order Cancellation</a> endpoint, and if successful, complete <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-70"><b>B</b></a> as normal.</p>
</li>
</ol><p>The new <code>Order</code> is completed as described in the <a href="#simple-booking-flow">Simple Booking Flow</a>, and the existing <code>OrderItem</code> is cancelled with the refund processed as described elsewhere.</p></section><section id="delivery-of-terms-and-conditions-and-privacy-policy"><h3 id="x8-6-delivery-of-terms-and-conditions-and-privacy-policy"><bdi class="secno">8.6 </bdi>Delivery of Terms and Conditions and Privacy Policy<a class="self-link" aria-label="§" href="#delivery-of-terms-and-conditions-and-privacy-policy"></a></h3><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-276">Broker</a> <em class="rfc2119">MUST</em> make the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-197">Customer</a> aware of any <code>termsOfService</code> provided within the <code>seller</code>, <code>broker</code>, and <code>bookingService</code> (which may include Terms and Conditions and Privacy Policy) before the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-198">Customer</a> confirms their purchase.</p><p>If <code>requiresExplicitConsent</code> is <code>true</code> for any <code>termsOfService</code> then the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-199">Customer</a> <em class="rfc2119">MUST</em> only be allowed to proceed if they have explicitly acted to consent to the most recently modified version of such terms, identified by <code>dateModified</code> and the <code>url</code>, before the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-200">Customer</a> completes <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-71"><b>B</b></a>.</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-277">Broker</a> <em class="rfc2119">MAY</em> remember the consent previously given by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-201">Customer</a> based on the <code>url</code> and <code>dateModified</code> of the <code>Terms</code>, only if <code>dateModified</code> is provided, and if consent for storing such preferences is given by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-202">Customer</a>.</p><p>Since, during booking, the details of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-203">Customer</a> are provided to the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-205">Booking System</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-106">Seller</a>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-278">Broker</a> <em class="rfc2119">MUST</em> inform the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-204">Customer</a> of any implications with respect to the GDPR or other data protection legislation.</p><p>Note that <code>termsOfService</code> may only be specified at the <code>seller</code>, <code>broker</code> or <code>bookingService</code> level within the <code>Order</code>, and may not be provided for a specific <code>Offer</code> or <code>OrderItem</code>.</p><div class="example" id="example-18-properties-for-terms-and-conditions-and-privacy-policy">
        <div class="marker">
    <a class="self-link" href="#example-18-properties-for-terms-and-conditions-and-privacy-policy">Example<bdi> 18</bdi></a><span class="example-title">: Properties for Terms and Conditions and Privacy Policy</span>
  </div> <pre aria-busy="false"><code class="hljs javascript"><span class="hljs-string">"termsOfService"</span>: [
  {
    <span class="hljs-string">"@type"</span>: <span class="hljs-string">"Terms"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>,
    <span class="hljs-string">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
  },
  {
    <span class="hljs-string">"@type"</span>: <span class="hljs-string">"Terms"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>,
    <span class="hljs-string">"dateModified"</span>: <span class="hljs-string">"2020-02-16T20:31:13Z"</span>,
    <span class="hljs-string">"requiresExplicitConsent"</span>: <span class="hljs-literal">true</span>
  }
]</code></pre>
      </div><p>The URLs in the example are only illustrative.</p></section><section id="access-control"><h3 id="x8-7-access-control"><bdi class="secno">8.7 </bdi>Access control<a class="self-link" aria-label="§" href="#access-control"></a></h3><p>For <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-64">Opportunities</a> that require entry into a restricted building or area to participate, it is <em class="rfc2119">REQUIRED</em> that <code>OrderItem</code> include unique access control data within <code>accessCode</code> and <code>accessPass</code>. An <code>accessCode</code> <em class="rfc2119">SHOULD</em> be provided for manual use in the event that an <code>accessPass</code> fails.</p><p>Each <code>accessCode</code> and <code>accessPass</code> <em class="rfc2119">MUST</em> represent unique methods of entry, and <em class="rfc2119">MUST NOT</em> be duplicated in different formats. For example, multiple formats (e.g. PNG, JPEG) of the same <code>accessPass</code> <em class="rfc2119">MUST NOT</em> be supplied.</p><p>For remotely accessible <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-65">Opportunities</a>, an <code>accessChannel</code> <em class="rfc2119">MUST</em> be provided.</p><p>A <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-279">Broker</a> <em class="rfc2119">MUST</em> make all supplied <code>accessPass</code>es, <code>accessCode</code>s and <code>accessChannel</code>s available to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-205">Customer</a>, with the exception of <code>Barcode</code>s that do not have fallback image <code>url</code>. <code>Barcode</code>s without a <code>url</code> <em class="rfc2119">MAY</em> be ignored if the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-280">Broker</a> is unable to process them. </p><section id="text-based-access-control"><h4 id="x8-7-1-text-based-access-control"><bdi class="secno">8.7.1 </bdi>Text-based access control<a class="self-link" aria-label="§" href="#text-based-access-control"></a></h4><p>PIN codes, Order identifiers, or simply the e-mail address of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-206">Customer</a> are all permissible for the purposes of access control.</p><p>In keeping with the Schema.org definition of <code>PropertyValue</code>, the <code>name</code> property <em class="rfc2119">SHOULD</em> be used for the name of the property, and the <code>description</code> property <em class="rfc2119">SHOULD</em> be used for any human-readable access control code(s). </p><div class="example" id="example-19-example-of-accesscode-used-for-a-pin-code">
        <div class="marker">
    <a class="self-link" href="#example-19-example-of-accesscode-used-for-a-pin-code">Example<bdi> 19</bdi></a><span class="example-title">: Example of accessCode used for a PIN Code</span>
  </div> <pre aria-busy="false"><code class="hljs css">"accessCode": [
  {
    <span class="hljs-string">"@type"</span>: <span class="hljs-string">"PropertyValue"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"PIN Code"</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"1234"</span>
  }
],</code></pre>
      </div><div class="example" id="example-20-example-of-accesscode-used-for-a-booking-reference">
        <div class="marker">
    <a class="self-link" href="#example-20-example-of-accesscode-used-for-a-booking-reference">Example<bdi> 20</bdi></a><span class="example-title">: Example of accessCode used for a booking reference</span>
  </div> <pre aria-busy="false"><code class="hljs css">"accessCode": [
  {
    <span class="hljs-string">"@type"</span>: <span class="hljs-string">"PropertyValue"</span>,
    <span class="hljs-string">"name"</span>: <span class="hljs-string">"Booking Reference"</span>,
    <span class="hljs-string">"description"</span>: <span class="hljs-string">"123456789"</span>
  }
],</code></pre>
      </div></section><section id="image-based-access-control"><h4 id="x8-7-2-image-based-access-control"><bdi class="secno">8.7.2 </bdi>Image-based access control<a class="self-link" aria-label="§" href="#image-based-access-control"></a></h4><p>Images to be displayed to provide access, for example access tickets rendered by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-206">Booking System</a>, <em class="rfc2119">MAY</em> be included as an <code>ImageObject</code> within the <code>accessPass</code> array.</p><p><code>ImageObject</code> <em class="rfc2119">MUST NOT</em> be used for fallback images of a <code>Barcode</code>; the <code>url</code> property of the <code>Barcode</code> <em class="rfc2119">MUST</em> be used for this purpose.</p><div class="example" id="example-21-example-of-imageobject-in-accesspass">
        <div class="marker">
    <a class="self-link" href="#example-21-example-of-imageobject-in-accesspass">Example<bdi> 21</bdi></a><span class="example-title">: Example of ImageObject in accessPass</span>
  </div> <pre aria-busy="false"><code class="hljs css">"accessPass": [
  {
    <span class="hljs-string">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://access.example.com/476ac24c694da79c5e33731ebbb5f1"</span>
  }
],</code></pre>
      </div></section><section id="extension-point-for-barcode-based-access-control"><h4 id="x8-7-3-extension-point-for-barcode-based-access-control"><bdi class="secno">8.7.3 </bdi>Extension point for barcode-based access control<a class="self-link" aria-label="§" href="#extension-point-for-barcode-based-access-control"></a></h4><p>Access barcodes to be rendered by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-281">Broker</a> <em class="rfc2119">MAY</em> be included as a <code>Barcode</code> within the <code>accessPass</code> array. Note that <code>Barcode</code> subclasses <code>ImageObject</code>, allowing it to contain a fallback rendered barcode image <code>url</code> in addition to the raw barcode details. <code>Barcode</code>s <em class="rfc2119">SHOULD</em> include a fallback image <code>url</code>.</p><p>Due to the variety of barcode formats available, the specification expects the <code>Barcode</code> to include additional properties using a custom namespace (as specified in the [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] specification), enough to allow the barcode to be reproduced by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-282">Broker</a>. This will help inform future versions of the specification.</p><p>Additionally where use of an existing barcode is desirable (for example, the barcode on a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-283">Broker</a>'s own membership card) the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-284">Broker</a> <em class="rfc2119">MAY</em> include a <code>Barcode</code> in the <code>accessPass</code> property against individual <code>OrderItem</code>s in the request to <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-72"><b>B</b></a>. If the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-207">Booking System</a> is able to accept such existing barcodes, it <em class="rfc2119">MUST</em> reflect back the specified <code>Barcode</code> in the <code>accessPass</code> array in the response along with any other valid access control options.</p><div class="example" id="example-22-example-of-barcode-in-accesspass">
        <div class="marker">
    <a class="self-link" href="#example-22-example-of-barcode-in-accesspass">Example<bdi> 22</bdi></a><span class="example-title">: Example of Barcode in accessPass</span>
  </div> <pre aria-busy="false"><code class="hljs css">"accessPass": [
  {
    <span class="hljs-string">"@type"</span>: <span class="hljs-string">"Barcode"</span>,
    <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://fallback.image.example.com/476ac24c694da79c5e33731ebbb5f1"</span>,
    <span class="hljs-string">"text"</span>: <span class="hljs-string">"0123456789"</span>,
    <span class="hljs-string">"beta:codeType"</span>: <span class="hljs-string">"code128"</span>
  }
],</code></pre>
      </div></section><section id="remote-access-control"><h4 id="x8-7-4-remote-access-control"><bdi class="secno">8.7.4 </bdi>Remote access control<a class="self-link" aria-label="§" href="#remote-access-control"></a></h4><p>A <code>VirtualLocation</code> provides remote participants with a means of attending an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-66">Opportunity</a>. The <code>url</code> <em class="rfc2119">SHOULD</em> include encoded access credentials where possible. Manual access credentials <code>name</code>, <code>accessId</code> and <code>accessCode</code> <em class="rfc2119">SHOULD</em> also be supplied to ensure the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-207">Customer</a> can access the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-67">Opportunity</a> from any device. <code>description</code> <em class="rfc2119">SHOULD</em> include any other information necessary for the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-208">Customer</a> to easily access the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-68">Opportunity</a>.</p><p>For <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-69">Opportunities</a> that are accessible remotely, the <code>attendeeInstructions</code> of the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-70">Opportunity</a> <em class="rfc2119">SHOULD</em> include instructions that explain the remote set up, including how the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-209">Customer</a> should participate in the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-71">Opportunity</a>.</p><p>If an <code>accessChannel</code> is not available to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-210">Customer</a> immediately upon booking via the <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-73"><b>B</b></a> response, and only accessible via <a href="#other-notifications">notification</a>, a <code>customerNotice</code> <em class="rfc2119">MUST</em> be included in <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-74"><b>B</b></a> that includes details of when the means of access will be shared with the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-211">Customer</a>, for example "Details of a Zoom room will be sent 1 hour prior to the class starting".</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-285">Broker</a> <em class="rfc2119">MUST</em> send an automatic reminder to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-212">Customer</a> that includes the details of the <code>accessChannel</code> 30 minutes prior to the class starting.</p><div class="example" id="example-23-example-of-virtuallocation-in-accesschannel">
        <div class="marker">
    <a class="self-link" href="#example-23-example-of-virtuallocation-in-accesschannel">Example<bdi> 23</bdi></a><span class="example-title">: Example of VirtualLocation in accessChannel</span>
  </div> <pre aria-busy="false"><code class="hljs css">"accessChannel": {
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"VirtualLocation"</span>,
  <span class="hljs-string">"url"</span>: <span class="hljs-string">"https://zoom.us/j/1234567890?pwd=SlBzaVpJaGY0UGJVMX"</span>,
  <span class="hljs-string">"name"</span>: <span class="hljs-string">"Zoom Video Chat"</span>,
  <span class="hljs-string">"accessId"</span> : <span class="hljs-string">"1234567890"</span>,
  <span class="hljs-string">"accessCode"</span> : <span class="hljs-string">"211277"</span>,
  <span class="hljs-string">"description"</span>: <span class="hljs-string">"Please log into Zoom a few minutes before the event"</span>
},</code></pre>
      </div></section></section></section><section class="normative" id="endpoints"><h2 id="x9-endpoints"><bdi class="secno">9. </bdi>Endpoints<a class="self-link" aria-label="§" href="#endpoints"></a></h2><p>This API has been defined around the concept of API discovery, using the [<cite><a class="bibref" data-link-type="biblio" href="#bib-dataset-api-discovery" title="Dataset API Discovery">Dataset-API-Discovery</a></cite>] specification as a basis. This allows a <dfn id="dfn-base-uri">Base URI</dfn>, as defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>], to be discovered by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-286">Broker</a>, and for such a <a href="#dfn-base-uri" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-base-uri-1">Base URI</a> to vary based on the naming conventions of each <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-208">Booking System</a>.</p><p>All <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-209">Booking System</a> endpoints defined in this specification <em class="rfc2119">MUST</em> be idempotent.</p><section id="paths-and-verbs"><h3 id="x9-1-paths-and-verbs"><bdi class="secno">9.1 </bdi>Paths and Verbs<a class="self-link" aria-label="§" href="#paths-and-verbs"></a></h3><p>Due to API discovery, the paths specified are relative to the <a href="#dfn-base-uri" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-base-uri-2">Base URI</a>. This <a href="#dfn-base-uri" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-base-uri-3">Base URI</a> must be used consistently within an implementation. It is the responsibility of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-210">Booking System</a> to advertise the <a href="#dfn-base-uri" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-base-uri-4">Base URI</a> via the [<cite><a class="bibref" data-link-type="biblio" href="#bib-dataset-api-discovery" title="Dataset API Discovery">Dataset-API-Discovery</a></cite>] specification.</p><p>The absolute URL of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-86">Orders feed</a> <em class="rfc2119">MAY</em> be separately discoverable, independently of the <a href="#dfn-base-uri" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-base-uri-5">Base URI</a>, provided that such discovery is consistent with the [<cite><a class="bibref" data-link-type="biblio" href="#bib-dataset-api-discovery" title="Dataset API Discovery">Dataset-API-Discovery</a></cite>] specification. If such an absolute URL is available, it <em class="rfc2119">MUST</em> be used instead of the relative path defined within this specification.</p><p>With the exception of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-87">Orders feed</a>, all endpoints <em class="rfc2119">MUST</em> accept an <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-46">Order UUID</a> as the final segment of their path. This is indicated by the placeholder <code>{uuid}</code> in the relative paths in the table below. The value of this <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-47">Order UUID</a> is supplied by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-287">Broker</a>, as described throughout this specification.</p><p><a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-288">Brokers</a> <em class="rfc2119">MUST</em> only access the endpoints using the paths described in this specification, with the exception of the absolute URL of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-88">Orders feed</a>, if available.</p><p>A summary of endpoints defined by this specification is provided:</p><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Relative Path</th>
</tr>
</thead>
<tbody><tr>
<td>OrderQuote Creation <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-37"><b>C1</b></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>Yes</td>
<td>OrderQuote</td>
<td>PUT</td>
<td><code>/order-quote-templates/{uuid}</code></td>
</tr>
<tr>
<td>OrderQuote Creation <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-46"><b>C2</b></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>Yes</td>
<td>OrderQuote</td>
<td>PUT</td>
<td><code>/order-quotes/{uuid}</code></td>
</tr>
<tr>
<td><a href="#dfn-orderquote-deletion" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orderquote-deletion-1">OrderQuote Deletion</a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td></td>
<td>OrderQuote</td>
<td>DELETE</td>
<td><code>/order-quotes/{uuid}</code></td>
</tr>
<tr>
<td>OrderProposal Creation <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-30"><b>P</b></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>Yes</td>
<td>OrderProposal</td>
<td>PUT</td>
<td><code>/order-proposals/{uuid}</code></td>
</tr>
<tr>
<td><a href="#dfn-orderproposal-update" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orderproposal-update-1">OrderProposal Update</a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td></td>
<td>OrderProposal</td>
<td>PATCH</td>
<td><code>/order-proposals/{uuid}</code></td>
</tr>
<tr>
<td>Order Creation <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-75"><b>B</b></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>Yes</td>
<td>Order</td>
<td>PUT</td>
<td><code>/orders/{uuid}</code></td>
</tr>
<tr>
<td><a href="#dfn-order-deletion" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-deletion-1">Order Deletion</a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td></td>
<td>Order</td>
<td>DELETE</td>
<td><code>/orders/{uuid}</code></td>
</tr>
<tr>
<td><a href="#dfn-order-cancellation" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-cancellation-4">Order Cancellation</a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td></td>
<td>Order</td>
<td>PATCH</td>
<td><code>/orders/{uuid}</code></td>
</tr>
<tr>
<td><a href="#orders-rpde-feed">Orders RPDE Feed</a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>Yes</td>
<td>Orders feed</td>
<td>GET</td>
<td><code>/orders-rpde</code></td>
</tr>
<tr>
<td><a href="#dfn-order-status" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-status-2">Order Status</a></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td>Yes</td>
<td>Order</td>
<td>GET</td>
<td><code>/orders/{uuid}</code></td>
</tr>
</tbody></table><p>Note that for simple implementations, <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-38"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-47"><b>C2</b></a> can be handled by same underlying code.</p><section id="order-endpoint-restful-semantics"><h4 id="x9-1-1-order-endpoint-restful-semantics"><bdi class="secno">9.1.1 </bdi>Order Endpoint RESTful Semantics<a class="self-link" aria-label="§" href="#order-endpoint-restful-semantics"></a></h4><p>Note that practically all <code>Order</code> endpoints above (those that relate to <code>Order</code> or its subclasses <code>OrderQuote</code> and <code>OrderProposal</code>) share the same <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-48">Order UUID</a> namespace, and can be successfully implemented with a single underlying <code>Order</code> record behind them all. These endpoints are distinct purely to reduce the logic required in each and to increase testability and maintainability.</p><p>An <code>Order</code> with a particular <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-49">Order UUID</a> <em class="rfc2119">MUST</em> only exist as either an <code>Order</code>, <code>OrderQuote</code> or <code>OrderProposal</code> at a single point in time.</p><p>Hence the Order Status endpoint <em class="rfc2119">SHOULD</em> return any stored <code>Order</code>, <code>OrderQuote</code> or <code>OrderProposal</code> with that <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-50">Order UUID</a>, and the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-89">Orders feed</a> <em class="rfc2119">MUST</em> return both <code>Order</code> and <code>OrderProposal</code> items (noting that <code>OrderQuote</code> are not included in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-90">Orders feed</a>).</p><p>To aid the reader in their semantic reasoning, from a REST perspective, there are four resources:</p><ul>
<li><code>/order-quote-templates</code> and <code>/order-quotes</code> - both are a collection resource of <code>OrderQuote</code>s. These are always ephemeral, so are created only for the duration of the PUT request, unless the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-211">Booking System</a> chooses to persist them, in which case they exist until the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-36">Lease</a> expires or an <code>OrderProposal</code> or <code>Order</code> is created. If persisted, <code>/order-quote-templates</code> appear immediately in <code>/order-quotes</code>, in order that they can be deleted via <a href="#orderquote-deletion">OrderQuote Deletion</a>.</li>
<li><code>/order-proposals</code> - a collection resource of <code>OrderProposal</code>s, which are deleted when a corresponding <code>Order</code> is created.</li>
<li><code>/orders</code> - a collection resource of <code>Order</code>s which includes its subclasses <code>OrderQuote</code>s and <code>OrderProposal</code>s</li>
</ul></section></section><section id="request-and-response"><h3 id="x9-2-request-and-response"><bdi class="secno">9.2 </bdi>Request and Response<a class="self-link" aria-label="§" href="#request-and-response"></a></h3><p>This section includes request and response examples for each of the endpoints specified in this API.</p><section id="orderquote-creation-c1"><h4 id="x9-2-1-orderquote-creation-c1"><bdi class="secno">9.2.1 </bdi>OrderQuote Creation C1<a class="self-link" aria-label="§" href="#orderquote-creation-c1"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Relative Path</th>
</tr>
</thead>
<tbody><tr>
<td>OrderQuote Creation <dfn id="dfn-c1"><b>C1</b></dfn></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>Yes</td>
<td>OrderQuote</td>
<td>PUT</td>
<td><code>/order-quote-templates/{uuid}</code></td>
</tr>
</tbody></table><p>The <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-39"><b>C1</b></a> is an endpoint that accepts an <code>OrderQuote</code> without a <code>customer</code> object to check availability and confirm that the specific combination of <code>OrderItem</code>s requested can be purchased.</p><p>A PUT request to this endpoint of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-212">Booking System</a> with an object of type <code>OrderQuote</code> will return an <code>OrderQuote</code> which represents a "dry run" of the booking, with the state of the <code>Order</code> nearly identical to the result of <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-76"><b>B</b></a> (except it excludes <code>customer</code>, <code>attendee</code>, <code>orderItemIntakeFormResponse</code> and the <code>payment</code> <code>identifier</code>), without any side effects (with the exception of optional leasing).</p><p>Note that in a simple implementation that does not manage <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-37">Lease</a> state, attendee details, or additional details, <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-40"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-48"><b>C2</b></a> can be handled by the same underlying code that simply validates the <code>email</code> of the <code>customer</code> only if a <code>customer</code> value is supplied. Even for complex implementations, given the similarities between <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-41"><b>C1</b></a> and <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-49"><b>C2</b></a>, much of the business logic can be shared between both.</p><div class="example" id="example-24-orderquote-creation-c1-example-request">
        <div class="marker">
    <a class="self-link" href="#example-24-orderquote-creation-c1-example-request">Example<bdi> 24</bdi></a><span class="example-title">: OrderQuote Creation C1: example request</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/api/order-quote-templates/e11429ea-467f-4270-ab62-e47368996fe8</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>example.com
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderQuote"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/AgentBroker"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/organisations/123"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>
      }
    }
  ]
}</span></code></pre>
      </div><p>If successful the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-213">Booking System</a> will respond with an OrderQuote:</p><div class="example" id="example-25-orderquote-creation-c1-example-success-response">
        <div class="marker">
    <a class="self-link" href="#example-25-orderquote-creation-c1-example-success-response">Example<bdi> 25</bdi></a><span class="example-title">: OrderQuote Creation C1: example success response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderQuote"</span>,
  <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/order-quotes/e11429ea-467f-4270-ab62-e47368996fe8"</span>,
  <span class="hljs-attr">"orderRequiresApproval"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/AgentBroker"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/organisations/123"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Better"</span>,
    <span class="hljs-attr">"taxMode"</span>: <span class="hljs-string">"https://openactive.io/TaxGross"</span>,
    <span class="hljs-attr">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A charitable social enterprise for all the community"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.better.org.uk"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.better.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 3457 8700"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"customerservices@gll.org"</span>,
    <span class="hljs-attr">"vatID"</span>: <span class="hljs-string">"GB 789 1234 56"</span>,
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    },
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PrivacyPolicy"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
      },
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TermsOfUse"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>,
        <span class="hljs-attr">"dateModified"</span>: <span class="hljs-string">"2019-04-16T20:31:13Z"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">true</span>
      }
    ]
  },
  <span class="hljs-attr">"bookingService"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"BookingService"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Playwaze"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.playwaze.com"</span>,
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms of Service"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://brokerexample.com/terms.html"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
      }
    ]
  },
  <span class="hljs-attr">"lease"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Lease"</span>,
    <span class="hljs-attr">"leaseExpires"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">"unitTaxSpecification"</span>: [
        {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
          <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
        }
      ],
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
        <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
        <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
        <span class="hljs-attr">"maximumAttendeeCapacity"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-attr">"remainingAttendeeCapacity"</span>: <span class="hljs-number">20</span>,
        <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
        <span class="hljs-attr">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
        <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
        <span class="hljs-attr">"superEvent"</span>: {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"SessionSeries"</span>,
          <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://api.example.com/events/452"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bodypump"</span>,
          <span class="hljs-attr">"activity"</span>: [
            {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Concept"</span>,
              <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://openactive.io/activity-list#5e78bcbe-36db-425a-9064-bf96d09cc351"</span>,
              <span class="hljs-attr">"prefLabel"</span>: <span class="hljs-string">"Bodypump™"</span>,
              <span class="hljs-attr">"inScheme"</span>: <span class="hljs-string">"https://openactive.io/activity-list"</span>
            }
          ],
          <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
          <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
          <span class="hljs-attr">"location"</span>: {
            <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Place"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.everyoneactive.com/centres/Middlesbrough-Sports-Village"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Middlesbrough Sports Village"</span>,
            <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"0140"</span>,
            <span class="hljs-attr">"address"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
              <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
              <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
              <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
              <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
              <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
            },
            <span class="hljs-attr">"geo"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"GeoCoordinates"</span>,
              <span class="hljs-attr">"latitude"</span>: <span class="hljs-number">54.543964</span>,
              <span class="hljs-attr">"longitude"</span>: <span class="hljs-number">-1.20978500000001</span>
            }
          }
        }
      }
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"totalPaymentTax"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
      <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
      <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
    }
  ]
}</span></code></pre>
      </div><p>If there are any issues with the <code>OrderItem</code>s requested in the <code>OrderQuote</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-214">Booking System</a> <em class="rfc2119">MUST</em> respond with a <code>409 Conflict</code> response (as the error is expected to be resolved, and the request resubmitted, as per [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2616" title="Hypertext Transfer Protocol -- HTTP/1.1">RFC2616</a></cite>]), with <code>error</code> details provided against each offending <code>OrderItem</code>. Note that <code>totalPaymentDue</code> and <code>totalPaymentTax</code> <em class="rfc2119">MUST</em> be calculated <em>including</em> any <code>OrderItem</code>s that exclusively contain <code>IncompleteAttendeeDetailsError</code> or <code>IncompleteIntakeFormError</code> <code>error</code>s, and <em>excluding</em> any <code>OrderItem</code>s that include any other <code>error</code>s.</p><div class="example" id="example-26-orderquote-creation-c1-example-orderitem-error-response">
        <div class="marker">
    <a class="self-link" href="#example-26-orderquote-creation-c1-example-orderitem-error-response">Example<bdi> 26</bdi></a><span class="example-title">: OrderQuote Creation C1: example OrderItem error response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">409</span> Conflict
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderQuote"</span>,
  <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/order-quotes/e11429ea-467f-4270-ab62-e47368996fe8"</span>,
  <span class="hljs-attr">"orderRequiresApproval"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/AgentBroker"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/organisations/123"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Better"</span>,
    <span class="hljs-attr">"taxMode"</span>: <span class="hljs-string">"https://openactive.io/TaxGross"</span>,
    <span class="hljs-attr">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A charitable social enterprise for all the community"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.better.org.uk"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.better.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 3457 8700"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"customerservices@gll.org"</span>,
    <span class="hljs-attr">"vatID"</span>: <span class="hljs-string">"GB 789 1234 56"</span>,
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    },
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PrivacyPolicy"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
      },
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TermsOfUse"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>,
        <span class="hljs-attr">"dateModified"</span>: <span class="hljs-string">"2019-04-16T20:31:13Z"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">true</span>
      }
    ]
  },
  <span class="hljs-attr">"bookingService"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"BookingService"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Playwaze"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.playwaze.com"</span>,
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms of Service"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://brokerexample.com/terms.html"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
      }
    ]
  },
  <span class="hljs-attr">"lease"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Lease"</span>,
    <span class="hljs-attr">"leaseExpires"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderItemConfirmed"</span>,
      <span class="hljs-attr">"unitTaxSpecification"</span>: [
        {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
          <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
        }
      ],
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
        <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
        <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
        <span class="hljs-attr">"maximumAttendeeCapacity"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-attr">"remainingAttendeeCapacity"</span>: <span class="hljs-number">20</span>,
        <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
        <span class="hljs-attr">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
        <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
        <span class="hljs-attr">"superEvent"</span>: {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"SessionSeries"</span>,
          <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://api.example.com/events/452"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bodypump"</span>,
          <span class="hljs-attr">"activity"</span>: [
            {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Concept"</span>,
              <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://openactive.io/activity-list#5e78bcbe-36db-425a-9064-bf96d09cc351"</span>,
              <span class="hljs-attr">"prefLabel"</span>: <span class="hljs-string">"Bodypump™"</span>,
              <span class="hljs-attr">"inScheme"</span>: <span class="hljs-string">"https://openactive.io/activity-list"</span>
            }
          ],
          <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
          <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
          <span class="hljs-attr">"location"</span>: {
            <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Place"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.everyoneactive.com/centres/Middlesbrough-Sports-Village"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Middlesbrough Sports Village"</span>,
            <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"0140"</span>,
            <span class="hljs-attr">"address"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
              <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
              <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
              <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
              <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
              <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
            },
            <span class="hljs-attr">"geo"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"GeoCoordinates"</span>,
              <span class="hljs-attr">"latitude"</span>: <span class="hljs-number">54.543964</span>,
              <span class="hljs-attr">"longitude"</span>: <span class="hljs-number">-1.20978500000001</span>
            }
          }
        }
      },
      <span class="hljs-attr">"error"</span>: [
        {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OpportunityIsFullError"</span>,
          <span class="hljs-attr">"description"</span>: <span class="hljs-string">"There are no spaces remaining in this opportunity"</span>
        }
      ]
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"totalPaymentTax"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
      <span class="hljs-attr">"price"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
      <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
    }
  ]
}</span></code></pre>
      </div><p>If there are issues with other properties of the <code>OrderQuote</code> outside of <code>orderedItem</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-215">Booking System</a> <em class="rfc2119">MUST</em> respond with a JSON-LD response which includes only the appropriate <code>OpenBookingError</code> and the appropriate status code.</p><div class="example" id="example-27-orderquote-creation-c1-example-failure-response">
        <div class="marker">
    <a class="self-link" href="#example-27-orderquote-creation-c1-example-failure-response">Example<bdi> 27</bdi></a><span class="example-title">: OrderQuote Creation C1: example failure response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">500</span> Internal Server Error
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TemporarilyUnableToProduceOrderQuoteError"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Temporary error occurred in the database"</span>
}</span></code></pre>
      </div></section><section id="orderquote-creation-c2"><h4 id="x9-2-2-orderquote-creation-c2"><bdi class="secno">9.2.2 </bdi>OrderQuote Creation C2<a class="self-link" aria-label="§" href="#orderquote-creation-c2"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Relative Path</th>
</tr>
</thead>
<tbody><tr>
<td>OrderQuote Creation <dfn id="dfn-c2"><b>C2</b></dfn></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>Yes</td>
<td>OrderQuote</td>
<td>PUT</td>
<td><code>/order-quotes/{uuid}</code></td>
</tr>
</tbody></table><p>The <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-50"><b>C2</b></a> is PUT endpoint that accepts an <code>OrderQuote</code> with a <code>customer</code> object to check availability and confirm that the specific combination of <code>OrderItem</code>s requested can be purchased. </p><p>A PUT request to this endpoint of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-216">Booking System</a> with an object of type <code>OrderQuote</code> will return an <code>OrderQuote</code> which represents a "dry run" of the booking, with the state of the <code>Order</code> nearly identical to the result of <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-77"><b>B</b></a> (except it excludes <code>payment</code> <code>identifier</code>), without any side effects (with the exception of optional leasing).</p><p>Note that the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-217">Booking System</a>&nbsp;<em class="rfc2119">MUST NOT</em> store any personal information of the <code>customer</code> provided for the <code>OrderQuote</code> past the expiry of any associated <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-38">Lease</a> created.</p><div class="example" id="example-28-orderquote-creation-c2-example-request">
        <div class="marker">
    <a class="self-link" href="#example-28-orderquote-creation-c2-example-request">Example<bdi> 28</bdi></a><span class="example-title">: OrderQuote Creation C2: example request</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/api/order-quotes/e11429ea-467f-4270-ab62-e47368996fe8</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>example.com
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderQuote"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/AgentBroker"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/organisations/123"</span>
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>
      }
    }
  ]
}</span></code></pre>
      </div><p>If successful the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-218">Booking System</a> will respond with an OrderQuote:</p><div class="example" id="example-29-orderquote-creation-c2-example-success-response">
        <div class="marker">
    <a class="self-link" href="#example-29-orderquote-creation-c2-example-success-response">Example<bdi> 29</bdi></a><span class="example-title">: OrderQuote Creation C2: example success response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderQuote"</span>,
  <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/order-quotes/e11429ea-467f-4270-ab62-e47368996fe8"</span>,
  <span class="hljs-attr">"orderRequiresApproval"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/AgentBroker"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/organisations/123"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Better"</span>,
    <span class="hljs-attr">"taxMode"</span>: <span class="hljs-string">"https://openactive.io/TaxGross"</span>,
    <span class="hljs-attr">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A charitable social enterprise for all the community"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.better.org.uk"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.better.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 3457 8700"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"customerservices@gll.org"</span>,
    <span class="hljs-attr">"vatID"</span>: <span class="hljs-string">"GB 789 1234 56"</span>,
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    },
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PrivacyPolicy"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
      },
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TermsOfUse"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>,
        <span class="hljs-attr">"dateModified"</span>: <span class="hljs-string">"2019-04-16T20:31:13Z"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">true</span>
      }
    ]
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"bookingService"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"BookingService"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Playwaze"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.playwaze.com"</span>,
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms of Service"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://brokerexample.com/terms.html"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
      }
    ]
  },
  <span class="hljs-attr">"lease"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Lease"</span>,
    <span class="hljs-attr">"leaseExpires"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">"unitTaxSpecification"</span>: [
        {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
          <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
        }
      ],
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
        <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
        <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
        <span class="hljs-attr">"maximumAttendeeCapacity"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-attr">"remainingAttendeeCapacity"</span>: <span class="hljs-number">20</span>,
        <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
        <span class="hljs-attr">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
        <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
        <span class="hljs-attr">"superEvent"</span>: {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"SessionSeries"</span>,
          <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://api.example.com/events/452"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bodypump"</span>,
          <span class="hljs-attr">"activity"</span>: [
            {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Concept"</span>,
              <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://openactive.io/activity-list#5e78bcbe-36db-425a-9064-bf96d09cc351"</span>,
              <span class="hljs-attr">"prefLabel"</span>: <span class="hljs-string">"Bodypump™"</span>,
              <span class="hljs-attr">"inScheme"</span>: <span class="hljs-string">"https://openactive.io/activity-list"</span>
            }
          ],
          <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
          <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
          <span class="hljs-attr">"location"</span>: {
            <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Place"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.everyoneactive.com/centres/Middlesbrough-Sports-Village"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Middlesbrough Sports Village"</span>,
            <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"0140"</span>,
            <span class="hljs-attr">"address"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
              <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
              <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
              <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
              <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
              <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
            },
            <span class="hljs-attr">"geo"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"GeoCoordinates"</span>,
              <span class="hljs-attr">"latitude"</span>: <span class="hljs-number">54.543964</span>,
              <span class="hljs-attr">"longitude"</span>: <span class="hljs-number">-1.20978500000001</span>
            }
          }
        }
      }
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"totalPaymentTax"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
      <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
      <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
    }
  ]
}</span></code></pre>
      </div><p>Note if the response includes <code>orderRequiresApproval</code> with a value of <code>true</code> the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-289">Broker</a> <em class="rfc2119">MUST</em> make it clear to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-213">Customer</a> of the additional process they are about to enter into, and once they are aware, move forward according to the <a href="#booking-flow-with-approval">Booking Flow with Approval</a> rather than the <a href="#simple-booking-flow">Simple Booking Flow</a>.</p><p>If there are any issues with the <code>OrderItem</code>s requested in the <code>OrderQuote</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-219">Booking System</a> <em class="rfc2119">MUST</em> respond with a <code>409 Conflict</code> response (as the error is expected to be resolved, and the request resubmitted, as per [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2616" title="Hypertext Transfer Protocol -- HTTP/1.1">RFC2616</a></cite>]), with <code>error</code> details provided against each offending <code>OrderItem</code>. Note that <code>totalPaymentDue</code> and <code>totalPaymentTax</code> <em class="rfc2119">MUST</em> be calculated <em>including</em> any <code>OrderItem</code>s that exclusively contain <code>IncompleteAttendeeDetailsError</code> or <code>IncompleteIntakeFormError</code> <code>error</code>s, and <em>excluding</em> any <code>OrderItem</code>s that include any other <code>error</code>s.</p><div class="example" id="example-30-orderquote-creation-c2-example-orderitem-error-response">
        <div class="marker">
    <a class="self-link" href="#example-30-orderquote-creation-c2-example-orderitem-error-response">Example<bdi> 30</bdi></a><span class="example-title">: OrderQuote Creation C2: example OrderItem error response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">409</span> Conflict
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderQuote"</span>,
  <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/order-quotes/e11429ea-467f-4270-ab62-e47368996fe8"</span>,
  <span class="hljs-attr">"orderRequiresApproval"</span>: <span class="hljs-literal">false</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/AgentBroker"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/organisations/123"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Better"</span>,
    <span class="hljs-attr">"taxMode"</span>: <span class="hljs-string">"https://openactive.io/TaxGross"</span>,
    <span class="hljs-attr">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A charitable social enterprise for all the community"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.better.org.uk"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.better.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 3457 8700"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"customerservices@gll.org"</span>,
    <span class="hljs-attr">"vatID"</span>: <span class="hljs-string">"GB 789 1234 56"</span>,
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    },
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PrivacyPolicy"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
      },
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TermsOfUse"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>,
        <span class="hljs-attr">"dateModified"</span>: <span class="hljs-string">"2019-04-16T20:31:13Z"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">true</span>
      }
    ]
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"bookingService"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"BookingService"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Playwaze"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.playwaze.com"</span>,
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms of Service"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://brokerexample.com/terms.html"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
      }
    ]
  },
  <span class="hljs-attr">"lease"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Lease"</span>,
    <span class="hljs-attr">"leaseExpires"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderItemConfirmed"</span>,
      <span class="hljs-attr">"unitTaxSpecification"</span>: [
        {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
          <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
        }
      ],
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
        <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
        <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
        <span class="hljs-attr">"maximumAttendeeCapacity"</span>: <span class="hljs-number">30</span>,
        <span class="hljs-attr">"remainingAttendeeCapacity"</span>: <span class="hljs-number">20</span>,
        <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
        <span class="hljs-attr">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
        <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
        <span class="hljs-attr">"superEvent"</span>: {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"SessionSeries"</span>,
          <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://api.example.com/events/452"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bodypump"</span>,
          <span class="hljs-attr">"activity"</span>: [
            {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Concept"</span>,
              <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://openactive.io/activity-list#5e78bcbe-36db-425a-9064-bf96d09cc351"</span>,
              <span class="hljs-attr">"prefLabel"</span>: <span class="hljs-string">"Bodypump™"</span>,
              <span class="hljs-attr">"inScheme"</span>: <span class="hljs-string">"https://openactive.io/activity-list"</span>
            }
          ],
          <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
          <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
          <span class="hljs-attr">"location"</span>: {
            <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Place"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.everyoneactive.com/centres/Middlesbrough-Sports-Village"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Middlesbrough Sports Village"</span>,
            <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"0140"</span>,
            <span class="hljs-attr">"address"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
              <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
              <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
              <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
              <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
              <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
            },
            <span class="hljs-attr">"geo"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"GeoCoordinates"</span>,
              <span class="hljs-attr">"latitude"</span>: <span class="hljs-number">54.543964</span>,
              <span class="hljs-attr">"longitude"</span>: <span class="hljs-number">-1.20978500000001</span>
            }
          }
        }
      },
      <span class="hljs-attr">"error"</span>: [
        {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OpportunityIsFullError"</span>,
          <span class="hljs-attr">"description"</span>: <span class="hljs-string">"There are no spaces remaining in this opportunity"</span>
        }
      ]
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">0</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"totalPaymentTax"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
      <span class="hljs-attr">"price"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
      <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
    }
  ]
}</span></code></pre>
      </div><p>If there are issues with other properties of the <code>OrderQuote</code> outside of <code>orderedItem</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-220">Booking System</a> <em class="rfc2119">MUST</em> respond with a JSON-LD response which includes only the appropriate <code>OpenBookingError</code> and the appropriate status code.</p><div class="example" id="example-31-orderquote-creation-c2-example-failure-response">
        <div class="marker">
    <a class="self-link" href="#example-31-orderquote-creation-c2-example-failure-response">Example<bdi> 31</bdi></a><span class="example-title">: OrderQuote Creation C2: example failure response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">500</span> Internal Server Error
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TemporarilyUnableToProduceOrderQuoteError"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Temporary error occurred in the database"</span>
}</span></code></pre>
      </div></section><section id="orderquote-deletion"><h4 id="x9-2-3-orderquote-deletion"><bdi class="secno">9.2.3 </bdi>OrderQuote Deletion<a class="self-link" aria-label="§" href="#orderquote-deletion"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Relative Path</th>
</tr>
</thead>
<tbody><tr>
<td><dfn id="dfn-orderquote-deletion">OrderQuote Deletion</dfn></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td></td>
<td>OrderQuote</td>
<td>DELETE</td>
<td><code>/order-quotes/{uuid}</code></td>
</tr>
</tbody></table><p>Deleting an <code>OrderQuote</code> releases any <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-39">Lease</a> associated with it, which the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-290">Broker</a> <em class="rfc2119">SHOULD</em> do as a courtesy if the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-214">Customer</a> has abandoned their journey. An OrderQuote Deletion request <em class="rfc2119">MUST</em> simply return a 204 success status in all cases (including cases where the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-221">Booking Systems</a> has not implemented leasing), as the <code>OrderQuote</code> itself is ephemeral.</p><div class="example" id="example-32-orderquote-deletion-example-request">
        <div class="marker">
    <a class="self-link" href="#example-32-orderquote-deletion-example-request">Example<bdi> 32</bdi></a><span class="example-title">: OrderQuote Deletion: example request</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">DELETE</span> <span class="hljs-string">/api/order-quotes/e11429ea-467f-4270-ab62-e47368996fe8</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>example.com
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1</code></pre>
      </div><div class="example" id="example-33-orderquote-deletion-example-response">
        <div class="marker">
    <a class="self-link" href="#example-33-orderquote-deletion-example-response">Example<bdi> 33</bdi></a><span class="example-title">: OrderQuote Deletion: example response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">204</span> No Content
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1</code></pre>
      </div></section><section id="orderproposal-creation-p"><h4 id="x9-2-4-orderproposal-creation-p"><bdi class="secno">9.2.4 </bdi>OrderProposal Creation P<a class="self-link" aria-label="§" href="#orderproposal-creation-p"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Relative Path</th>
</tr>
</thead>
<tbody><tr>
<td>OrderProposal Creation <dfn id="dfn-p"><b>P</b></dfn></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>Yes</td>
<td>OrderProposal</td>
<td>PUT</td>
<td><code>/order-proposals/{uuid}</code></td>
</tr>
</tbody></table><p><a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-31"><b>P</b></a> is a PUT endpoint that creates and returns the submitted <code>OrderProposal</code> with an <code>orderProposalStatus</code> of <code>https://openactive.io/AwaitingSellerConfirmation</code>. The details submitted are identical to those required for <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-78"><b>B</b></a> with the addition of an optional <code>lease</code>.</p><div class="example" id="example-34-orderproposal-creation-example-request">
        <div class="marker">
    <a class="self-link" href="#example-34-orderproposal-creation-example-request">Example<bdi> 34</bdi></a><span class="example-title">: OrderProposal Creation: example request</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/api/order-proposals/e11429ea-467f-4270-ab62-e47368996fe8</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>example.com
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderProposal"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/AgentBroker"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/organisations/123"</span>
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>
      }
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"payment"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Payment"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"AcmeBroker Points"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"1234567890npduy2f"</span>
  }
}</span></code></pre>
      </div><p>If successful the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-222">Booking System</a> will respond with an <code>OrderProposal</code>:</p><div class="example" id="example-35-orderproposal-creation-example-success-response">
        <div class="marker">
    <a class="self-link" href="#example-35-orderproposal-creation-example-success-response">Example<bdi> 35</bdi></a><span class="example-title">: OrderProposal Creation: example success response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">201</span> Created
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1
<span class="hljs-attribute">Location</span><span class="hljs-punctuation">: </span>/api/order-proposals/e11429ea-467f-4270-ab62-e47368996fe8

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderProposal"</span>,
  <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/order-proposals/e11429ea-467f-4270-ab62-e47368996fe8"</span>,
  <span class="hljs-attr">"orderNumber"</span>: <span class="hljs-string">"AB000001"</span>,
  <span class="hljs-attr">"orderProposalVersion"</span>: <span class="hljs-string">"https://example.com/api/order-proposals/e11429ea-467f-4270-ab62-e47368996fe8/versions/8eb1a6ce-3f5b-40b0-87a7-bddb4c5518bd"</span>,
  <span class="hljs-attr">"orderProposalStatus"</span>: <span class="hljs-string">"https://openactive.io/AwaitingSellerConfirmation"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/AgentBroker"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/organisations/123"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Better"</span>,
    <span class="hljs-attr">"taxMode"</span>: <span class="hljs-string">"https://openactive.io/TaxGross"</span>,
    <span class="hljs-attr">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A charitable social enterprise for all the community"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.better.org.uk"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.better.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 3457 8700"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"customerservices@gll.org"</span>,
    <span class="hljs-attr">"vatID"</span>: <span class="hljs-string">"GB 789 1234 56"</span>,
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    },
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PrivacyPolicy"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
      },
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TermsOfUse"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>,
        <span class="hljs-attr">"dateModified"</span>: <span class="hljs-string">"2019-04-16T20:31:13Z"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">true</span>
      }
    ]
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"bookingService"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"BookingService"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Playwaze"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.playwaze.com"</span>,
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms of Service"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://brokerexample.com/terms.html"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
      }
    ]
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderItemProposed"</span>,
      <span class="hljs-attr">"unitTaxSpecification"</span>: [
        {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
          <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
        }
      ],
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
        <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
        <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
        <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
        <span class="hljs-attr">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
        <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
        <span class="hljs-attr">"superEvent"</span>: {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"SessionSeries"</span>,
          <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://api.example.com/events/452"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bodypump"</span>,
          <span class="hljs-attr">"activity"</span>: [
            {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Concept"</span>,
              <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://openactive.io/activity-list#5e78bcbe-36db-425a-9064-bf96d09cc351"</span>,
              <span class="hljs-attr">"prefLabel"</span>: <span class="hljs-string">"Bodypump™"</span>,
              <span class="hljs-attr">"inScheme"</span>: <span class="hljs-string">"https://openactive.io/activity-list"</span>
            }
          ],
          <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
          <span class="hljs-attr">"location"</span>: {
            <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Place"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.everyoneactive.com/centres/Middlesbrough-Sports-Village"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Middlesbrough Sports Village"</span>,
            <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"0140"</span>,
            <span class="hljs-attr">"address"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
              <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
              <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
              <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
              <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
              <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
            },
            <span class="hljs-attr">"geo"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"GeoCoordinates"</span>,
              <span class="hljs-attr">"latitude"</span>: <span class="hljs-number">54.543964</span>,
              <span class="hljs-attr">"longitude"</span>: <span class="hljs-number">-1.20978500000001</span>
            }
          }
        }
      }
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"totalPaymentTax"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
      <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
      <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
    }
  ],
  <span class="hljs-attr">"payment"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Payment"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"AcmeBroker Points"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"1234567890npduy2f"</span>
  },
  <span class="hljs-attr">"lease"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Lease"</span>,
    <span class="hljs-attr">"leaseExpires"</span>: <span class="hljs-string">"2018-10-01T11:00:00Z"</span>
  }
}</span></code></pre>
      </div><p>If there are issues with any properties of the <code>OrderProposal</code>, including the <code>orderedItem</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-223">Booking System</a> <em class="rfc2119">MUST</em> respond with an error response which includes only the appropriate <code>OpenBookingError</code> and the appropriate status code. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-291">Broker</a> is expected to retry the <code>OrderQuote</code> to get specific <code>orderedItem</code> level errors.</p><div class="example" id="example-36-orderproposal-creation-example-failure-response">
        <div class="marker">
    <a class="self-link" href="#example-36-orderproposal-creation-example-failure-response">Example<bdi> 36</bdi></a><span class="example-title">: OrderProposal Creation: example failure response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">400</span> Bad Request
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"IncompleteBrokerDetailsError"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Only 'https://openactive.io/CustomerRejected' is permitted for this property."</span>
}</span></code></pre>
      </div><p>Note that any validation errors raised at <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-32"><b>P</b></a> regarding any property values <em class="rfc2119">MUST</em> also be raised at <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-51"><b>C2</b></a> (and ideally also <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-42"><b>C1</b></a> if relevant), so it should be very unusual to receive an error at <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-33"><b>P</b></a>.</p></section><section id="orderproposal-update"><h4 id="x9-2-5-orderproposal-update"><bdi class="secno">9.2.5 </bdi>OrderProposal Update<a class="self-link" aria-label="§" href="#orderproposal-update"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Relative Path</th>
</tr>
</thead>
<tbody><tr>
<td><dfn id="dfn-orderproposal-update">OrderProposal Update</dfn></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td></td>
<td>OrderProposal</td>
<td>PATCH</td>
<td><code>/order-proposals/{uuid}</code></td>
</tr>
</tbody></table><p>The endpoint accepts a simple PATCH containing either or both of <code>orderProposalStatus</code> and <code>orderCustomerNote</code>.</p><div class="example" id="example-37-orderproposal-update-example-request">
        <div class="marker">
    <a class="self-link" href="#example-37-orderproposal-update-example-request">Example<bdi> 37</bdi></a><span class="example-title">: OrderProposal Update: example request</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PATCH</span> <span class="hljs-string">/api/order-proposals/e11429ea-467f-4270-ab62-e47368996fe8</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>example.com
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderProposal"</span>,
  <span class="hljs-attr">"orderProposalStatus"</span>: <span class="hljs-string">"https://openactive.io/CustomerRejected"</span>,
  <span class="hljs-attr">"orderCustomerNote"</span>: <span class="hljs-string">"Sorry I've actually made other plans, hope you find someone!"</span>
}</span></code></pre>
      </div><div class="example" id="example-38-orderproposal-update-example-response">
        <div class="marker">
    <a class="self-link" href="#example-38-orderproposal-update-example-response">Example<bdi> 38</bdi></a><span class="example-title">: OrderProposal Update: example response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">204</span> No Content
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1</code></pre>
      </div><p>A PATCH to update <code>orderProposalStatus</code> <em class="rfc2119">MUST</em> have the value <code>https://openactive.io/CustomerRejected</code>, as that is the only permissible value based on the logic defined in this version of the specification. If another value for <code>orderProposalStatus</code> is specified the endpoint <em class="rfc2119">MUST</em> return an <code>PatchNotAllowedOnProperty</code> error with its status code.</p><div class="example" id="example-39-orderproposal-update-example-property-error-response">
        <div class="marker">
    <a class="self-link" href="#example-39-orderproposal-update-example-property-error-response">Example<bdi> 39</bdi></a><span class="example-title">: OrderProposal Update: example property error response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">400</span> Bad Request
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PatchNotAllowedOnProperty"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Only 'https://openactive.io/CustomerRejected' is permitted for this property."</span>
}</span></code></pre>
      </div><p>If the PATCH request includes any properties other than <code>@type</code>, <code>@context</code>, <code>orderProposalStatus</code> and <code>orderCustomerNote</code> (excluding any properties with a custom namespace), the endpoint <em class="rfc2119">MUST</em> return a <code>PatchContainsExcessiveProperties</code> error with its status code.</p><div class="example" id="example-40-orderproposal-update-example-property-error-response-for-excessive-properties">
        <div class="marker">
    <a class="self-link" href="#example-40-orderproposal-update-example-property-error-response-for-excessive-properties">Example<bdi> 40</bdi></a><span class="example-title">: OrderProposal Update: example property error response for excessive properties</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">400</span> Bad Request
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PatchContainsExcessiveProperties"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"PATCH includes unexpected properties that are not permitted."</span>
}</span></code></pre>
      </div></section><section id="order-creation-b"><h4 id="x9-2-6-order-creation-b"><bdi class="secno">9.2.6 </bdi>Order Creation B<a class="self-link" aria-label="§" href="#order-creation-b"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Relative Path</th>
</tr>
</thead>
<tbody><tr>
<td>Order Creation <dfn id="dfn-b"><b>B</b></dfn></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>Yes</td>
<td>Order</td>
<td>PUT</td>
<td><code>/orders/{uuid}</code></td>
</tr>
</tbody></table><p>A PUT request to the Order Creation endpoint of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-224">Booking System</a> with an object of type <code>Order</code> will create the <code>Order</code> and complete the booking from the point of the view of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-225">Booking System</a>.</p><div class="example" id="example-41-order-creation-example-request">
        <div class="marker">
    <a class="self-link" href="#example-41-order-creation-example-request">Example<bdi> 41</bdi></a><span class="example-title">: Order Creation: example request</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/api/orders/e11429ea-467f-4270-ab62-e47368996fe8</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>example.com
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Order"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/AgentBroker"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/organisations/123"</span>
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>
      }
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"payment"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Payment"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"AcmeBroker Points"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"1234567890npduy2f"</span>
  }
}</span></code></pre>
      </div><p>For the <code>Order</code> response and the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-91">Orders feed</a>, the <code>OrderItem</code>s <em class="rfc2119">MUST</em> include a unique <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-27"><code><code>@id</code></code></a>. This allows <code>OrderItem</code>s to be referenced in subsequent PATCH calls once the <code>Order</code> has been created.</p><p>If successful the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-226">Booking System</a> will respond with a newly created <code>Order</code> resource:</p><div class="example" id="example-42-order-creation-example-response">
        <div class="marker">
    <a class="self-link" href="#example-42-order-creation-example-response">Example<bdi> 42</bdi></a><span class="example-title">: Order Creation: example response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">201</span> Created
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1
<span class="hljs-attribute">Location</span><span class="hljs-punctuation">: </span>/api/orders/e11429ea-467f-4270-ab62-e47368996fe8

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Order"</span>,
  <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/orders/e11429ea-467f-4270-ab62-e47368996fe8"</span>,
  <span class="hljs-attr">"orderNumber"</span>: <span class="hljs-string">"AB000001"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/AgentBroker"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/organisations/123"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Better"</span>,
    <span class="hljs-attr">"taxMode"</span>: <span class="hljs-string">"https://openactive.io/TaxGross"</span>,
    <span class="hljs-attr">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A charitable social enterprise for all the community"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.better.org.uk"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.better.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 3457 8700"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"customerservices@gll.org"</span>,
    <span class="hljs-attr">"vatID"</span>: <span class="hljs-string">"GB 789 1234 56"</span>,
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    },
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PrivacyPolicy"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
      },
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TermsOfUse"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>,
        <span class="hljs-attr">"dateModified"</span>: <span class="hljs-string">"2019-04-16T20:31:13Z"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">true</span>
      }
    ]
  },
  <span class="hljs-attr">"bookingService"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"BookingService"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Playwaze"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.playwaze.com"</span>,
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms of Service"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://brokerexample.com/terms.html"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
      }
    ]
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/orders/e11429ea-467f-4270-ab62-e47368996fe8#/orderedItem/1234"</span>,
      <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderItemConfirmed"</span>,
      <span class="hljs-attr">"unitTaxSpecification"</span>: [
        {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
          <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
        }
      ],
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
        <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
        <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
        <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
        <span class="hljs-attr">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
        <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
        <span class="hljs-attr">"superEvent"</span>: {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"SessionSeries"</span>,
          <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://api.example.com/events/452"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bodypump"</span>,
          <span class="hljs-attr">"activity"</span>: [
            {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Concept"</span>,
              <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://openactive.io/activity-list#5e78bcbe-36db-425a-9064-bf96d09cc351"</span>,
              <span class="hljs-attr">"prefLabel"</span>: <span class="hljs-string">"Bodypump™"</span>,
              <span class="hljs-attr">"inScheme"</span>: <span class="hljs-string">"https://openactive.io/activity-list"</span>
            }
          ],
          <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
          <span class="hljs-attr">"location"</span>: {
            <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Place"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.everyoneactive.com/centres/Middlesbrough-Sports-Village"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Middlesbrough Sports Village"</span>,
            <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"0140"</span>,
            <span class="hljs-attr">"address"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
              <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
              <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
              <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
              <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
              <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
            },
            <span class="hljs-attr">"geo"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"GeoCoordinates"</span>,
              <span class="hljs-attr">"latitude"</span>: <span class="hljs-number">54.543964</span>,
              <span class="hljs-attr">"longitude"</span>: <span class="hljs-number">-1.20978500000001</span>
            }
          }
        }
      },
      <span class="hljs-attr">"accessPass"</span>: [
        {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Barcode"</span>,
          <span class="hljs-attr">"text"</span>: <span class="hljs-string">"0123456789"</span>
        }
      ]
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"totalPaymentTax"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
      <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
      <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
    }
  ],
  <span class="hljs-attr">"payment"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Payment"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"AcmeBroker Points"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"1234567890npduy2f"</span>
  }
}</span></code></pre>
      </div><p>Technical or conformance issues with any properties of the <code>Order</code>, including in an <code>orderedItem</code>, <em class="rfc2119">MUST</em> cause the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-227">Booking System</a> to respond with only the appropriate <code>OpenBookingError</code> and associated status code. Following an <code>UnableToProcessOrderItemError</code> or <code>OpportunityHasInsufficientCapacityError</code>, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-292">Broker</a> is expected to retry the <code>OrderQuote</code> at <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-52"><b>C2</b></a> to get specific <code>orderedItem</code> level errors. Any validation errors raised at <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-79"><b>B</b></a> regarding any property values <em class="rfc2119">MUST</em> also be raised at <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-53"><b>C2</b></a> (and ideally also <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-43"><b>C1</b></a> if relevant), so it should be very unusual to receive an error at <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-80"><b>B</b></a>.</p><div class="example" id="example-43-order-creation-example-failure-response">
        <div class="marker">
    <a class="self-link" href="#example-43-order-creation-example-failure-response">Example<bdi> 43</bdi></a><span class="example-title">: Order Creation: example failure response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">409</span> Conflict
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"UnableToProcessOrderItemError"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"An error occurred while processing the items within this booking."</span>
}</span></code></pre>
      </div><p>For the <a href="#booking-flow-with-approval">Booking Flow with Approval</a> specifically, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-293">Broker</a> decides to proceed from <a href="#dfn-a" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-a-4"><b>A</b></a> to <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-81"><b>B</b></a> by supplying a minimal <code>Order</code> to <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-82"><b>B</b></a> that contains just the <code>orderProposalVersion</code> and any additional <code>payment</code> data if reauthorisation was required.</p><div class="example" id="example-44-order-creation-example-request-from-orderproposal">
        <div class="marker">
    <a class="self-link" href="#example-44-order-creation-example-request-from-orderproposal">Example<bdi> 44</bdi></a><span class="example-title">: Order Creation: example request from OrderProposal</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/api/orders/e11429ea-467f-4270-ab62-e47368996fe8</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>example.com
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Order"</span>,
  <span class="hljs-attr">"orderProposalVersion"</span>: <span class="hljs-string">"https://example.com/api/order-proposals/e11429ea-467f-4270-ab62-e47368996fe8/versions/8eb1a6ce-3f5b-40b0-87a7-bddb4c5518bd"</span>,
  <span class="hljs-attr">"payment"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Payment"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"AcmeBroker Points"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"1234567890npduy2f"</span>
  }
}</span></code></pre>
      </div></section><section id="order-deletion"><h4 id="x9-2-7-order-deletion"><bdi class="secno">9.2.7 </bdi>Order Deletion<a class="self-link" aria-label="§" href="#order-deletion"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Relative Path</th>
</tr>
</thead>
<tbody><tr>
<td><dfn id="dfn-order-deletion">Order Deletion</dfn></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td></td>
<td>Order</td>
<td>DELETE</td>
<td><code>/orders/{uuid}</code></td>
</tr>
</tbody></table><p>Deleting an <code>Order</code> allows for the whole Booking Flow to be reversed for fatal error and testing scenarios.</p><p>The corresponding <code>Order</code> <em class="rfc2119">MUST</em> be marked as <code>deleted</code> in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-92">Orders feed</a>, only if it is already present in the feed (which is unlikely during the <a href="#simple-booking-flow">Simple Booking Flow</a>).</p><p>When an <code>Order</code> is deleted the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-228">Booking System</a> <em class="rfc2119">SHOULD</em> hard delete it as though it had not been created in the first place (with only a stub <code>deleted</code> record remaining, for the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-93">Orders feed</a>, if necessary), but <em class="rfc2119">MAY</em> soft delete it providing all related personal data is purged. The audit for the deletion is guaranteed to be stored in the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-294">Broker</a> in all cases.</p><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-229">Booking System</a> <em class="rfc2119">MUST</em> return an <code>OrderAlreadyExistsError</code> in response to <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-44"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-54"><b>C2</b></a>, <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-34"><b>P</b></a> or <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-83"><b>B</b></a> if the request includes a soft deleted or stubbed  <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-51">Order UUID</a>.</p><p>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-295">Broker</a> <em class="rfc2119">MUST NOT</em> use Order Deletion for cancellation, but instead only use it in the unusual case of a fatal error or testing. An appropriate approach for cancellation is defined <a href="#order-cancellation">below</a>.</p><div class="example" id="example-45-order-deletion-example-request">
        <div class="marker">
    <a class="self-link" href="#example-45-order-deletion-example-request">Example<bdi> 45</bdi></a><span class="example-title">: Order Deletion: example request</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">DELETE</span> <span class="hljs-string">/api/orders/e11429ea-467f-4270-ab62-e47368996fe8</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>example.com
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1</code></pre>
      </div><p>An Order Deletion request <em class="rfc2119">MUST</em> simply return a 204 success status when an <code>Order</code> is successfully deleted.</p><div class="example" id="example-46-order-deletion-example-success-response">
        <div class="marker">
    <a class="self-link" href="#example-46-order-deletion-example-success-response">Example<bdi> 46</bdi></a><span class="example-title">: Order Deletion: example success response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">204</span> No Content
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1</code></pre>
      </div><p>An Order Deletion request <em class="rfc2119">MUST</em> return a 404 status when the specified <code>Order</code> is not recognised, and <em class="rfc2119">SHOULD</em> return a <code>NotFoundError</code> response.</p><div class="example" id="example-47-order-deletion-example-not-found-response">
        <div class="marker">
    <a class="self-link" href="#example-47-order-deletion-example-not-found-response">Example<bdi> 47</bdi></a><span class="example-title">: Order Deletion: example not found response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">404</span> Not Found
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"NotFoundError"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"This Order does not exist."</span>
}</span></code></pre>
      </div></section><section id="order-cancellation"><h4 id="x9-2-8-order-cancellation"><bdi class="secno">9.2.8 </bdi>Order Cancellation<a class="self-link" aria-label="§" href="#order-cancellation"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Relative Path</th>
</tr>
</thead>
<tbody><tr>
<td><dfn id="dfn-order-cancellation">Order Cancellation</dfn></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td></td>
<td>Order</td>
<td>PATCH</td>
<td><code>/orders/{uuid}</code></td>
</tr>
</tbody></table><p>Cancellation of an <code>Order</code> may be requested by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-215">Customer</a>. <code>OrderItem</code>s omitted from the PATCH request <em class="rfc2119">MUST</em> be ignored.</p><div class="example" id="example-48-order-cancellation-example-order-request">
        <div class="marker">
    <a class="self-link" href="#example-48-order-cancellation-example-order-request">Example<bdi> 48</bdi></a><span class="example-title">: Order Cancellation: example Order request</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PATCH</span> <span class="hljs-string">/api/orders/e11429ea-467f-4270-ab62-e47368996fe8</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>example.com
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Order"</span>,
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/orders/e11429ea-467f-4270-ab62-e47368996fe8#/orderedItem/1234"</span>,
      <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/CustomerCancelled"</span>
    }
  ]
}</span></code></pre>
      </div><p>The request is idempotent, and hence the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-230">Booking System</a> <em class="rfc2119">MUST</em> return the same success response if any of the provided <code>OrderItem</code>s have already been cancelled. The cancellation request succeeds and fails atomically.</p><div class="example" id="example-49-order-cancellation-example-success-response">
        <div class="marker">
    <a class="self-link" href="#example-49-order-cancellation-example-success-response">Example<bdi> 49</bdi></a><span class="example-title">: Order Cancellation: example success response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">204</span> No Content
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1</code></pre>
      </div><p>In the case of cancellation failure due to cancellation rules within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-231">Booking System</a> the endpoint <em class="rfc2119">MUST</em> return a <code>CancellationNotPermittedError</code> including a <code>description</code> of the reason, which <em class="rfc2119">MUST</em> be communicated to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-216">Customer</a>.</p><div class="example" id="example-50-order-cancellation-example-error-response">
        <div class="marker">
    <a class="self-link" href="#example-50-order-cancellation-example-error-response">Example<bdi> 50</bdi></a><span class="example-title">: Order Cancellation: example error response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">400</span> Bad Request
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"CancellationNotPermittedError"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"The horse has already been fed, and cannot be put back in the box."</span>
}</span></code></pre>
      </div><p>A PATCH to update <code>orderItemStatus</code> <em class="rfc2119">MUST</em> have the value <code>https://openactive.io/CustomerCancelled</code>, as that is the only permissible value based on the logic defined in this version of the specification. If another value for <code>orderItemStatus</code> is specified the endpoint <em class="rfc2119">MUST</em> return an <code>PatchNotAllowedOnProperty</code> error with its status code.</p><div class="example" id="example-51-order-cancellation-example-property-error-response">
        <div class="marker">
    <a class="self-link" href="#example-51-order-cancellation-example-property-error-response">Example<bdi> 51</bdi></a><span class="example-title">: Order Cancellation: example property error response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">400</span> Bad Request
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PatchNotAllowedOnProperty"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Only 'https://openactive.io/CustomerCancelled' is permitted for this property."</span>
}</span></code></pre>
      </div><p>If the PATCH request includes any properties other than <code>@type</code>, <code>@context</code>, <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-28"><code><code>@id</code></code></a>, <code>orderedItem</code> and <code>orderItemStatus</code> (excluding any properties with a custom namespace), the endpoint <em class="rfc2119">MUST</em> return a <code>PatchContainsExcessiveProperties</code> error with its status code.</p><div class="example" id="example-52-order-cancellation-example-property-error-response-for-excessive-properties">
        <div class="marker">
    <a class="self-link" href="#example-52-order-cancellation-example-property-error-response-for-excessive-properties">Example<bdi> 52</bdi></a><span class="example-title">: Order Cancellation: example property error response for excessive properties</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">400</span> Bad Request
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PatchContainsExcessiveProperties"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"PATCH includes unexpected properties that are not permitted."</span>
}</span></code></pre>
      </div></section><section id="orders-rpde-feed"><h4 id="x9-2-9-orders-rpde-feed"><bdi class="secno">9.2.9 </bdi>Orders RPDE feed<a class="self-link" aria-label="§" href="#orders-rpde-feed"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Relative Path</th>
</tr>
</thead>
<tbody><tr>
<td><a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-94">Orders feed</a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>Yes</td>
<td>Orders feed</td>
<td>GET</td>
<td><code>/orders-rpde</code></td>
</tr>
</tbody></table><p>This [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] feed is described at length in the <a href="#orders-feed-notifications-updates-and-refunds">Orders feed</a> section.</p><p>The <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-95">Orders feed</a> <em class="rfc2119">MUST NOT</em> include the full contents of the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-72">Opportunities</a> within the <code>orderedItem</code>, and instead <em class="rfc2119">MUST</em> only include the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-73">Opportunity</a> properties <code>@type</code> and <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-29"><code><code>@id</code></code></a>, if <code>orderedItem</code> is included in the feed.</p><p>The <code>acceptedOffer</code> property within the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-96">Orders feed</a> <em class="rfc2119">MUST</em> include a snapshot of the <code>Offer</code> at the point it was booked or from the last <a href="#dfn-replacement" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-replacement-20">Replacement</a>, if <code>acceptedOffer</code> is included in the feed, as it reflects the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-217">Customer</a>'s purchase.</p><p>An illustrative request and response is provided here.</p><div class="example" id="example-53-order-rpde-feed-example-request">
        <div class="marker">
    <a class="self-link" href="#example-53-order-rpde-feed-example-request">Example<bdi> 53</bdi></a><span class="example-title">: Order RPDE Feed: example request</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/api/orders-rpde</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>example.com
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1</code></pre>
      </div><div class="example" id="example-54-order-rpde-feed-example-response">
        <div class="marker">
    <a class="self-link" href="#example-54-order-rpde-feed-example-response">Example<bdi> 54</bdi></a><span class="example-title">: Order RPDE Feed: example response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"next"</span>: <span class="hljs-string">"https://example.com/api/orders-rpde?afterTimestamp=1521565719&amp;afterId=e11429ea-467f-4270-ab62-e47368996fe8"</span>,
  <span class="hljs-attr">"items"</span>: [
    {
      <span class="hljs-attr">"state"</span>: <span class="hljs-string">"updated"</span>,
      <span class="hljs-attr">"kind"</span>: <span class="hljs-string">"Order"</span>,
      <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"e11429ea-467f-4270-ab62-e47368996fe8"</span>,
      <span class="hljs-attr">"modified"</span>: <span class="hljs-number">1521565719</span>,
      <span class="hljs-attr">"data"</span>: {
        <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Order"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/orders/e11429ea-467f-4270-ab62-e47368996fe8"</span>,
        <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"e11429ea-467f-4270-ab62-e47368996fe8"</span>,
        <span class="hljs-attr">"orderedItem"</span>: [
          {
            <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
            <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/orders/e11429ea-467f-4270-ab62-e47368996fe8#/orderedItem/1234"</span>,
            <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderItemConfirmed"</span>,
            <span class="hljs-attr">"unitTaxSpecification"</span>: [
              {
                <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
                <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
                <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
                <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
                <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
              }
            ],
            <span class="hljs-attr">"acceptedOffer"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Offer"</span>,
              <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
              <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
              <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
              <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
              <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
              <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
              <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
              <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
            },
            <span class="hljs-attr">"orderedItem"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
              <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>
            },
            <span class="hljs-attr">"accessPass"</span>: [
              {
                <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Barcode"</span>,
                <span class="hljs-attr">"text"</span>: <span class="hljs-string">"0123456789"</span>
              }
            ]
          }
        ],
        <span class="hljs-attr">"totalPaymentDue"</span>: {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
        },
        <span class="hljs-attr">"totalPaymentTax"</span>: [
          {
            <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
            <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
            <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
            <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
          }
        ]
      }
    }
  ]
}</span></code></pre>
      </div></section><section id="order-status"><h4 id="x9-2-10-order-status"><bdi class="secno">9.2.10 </bdi>Order Status<a class="self-link" aria-label="§" href="#order-status"></a></h4><table>
<thead>
<tr>
<th>Endpoint Name</th>
<th>Status</th>
<th>Returns Body</th>
<th>Resource</th>
<th>HTTP Verb</th>
<th>Relative Path</th>
</tr>
</thead>
<tbody><tr>
<td><dfn id="dfn-order-status">Order Status</dfn></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td>Yes</td>
<td>Order</td>
<td>GET</td>
<td><code>/orders/{uuid}</code></td>
</tr>
</tbody></table><p>A <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-232">Booking System</a> <em class="rfc2119">SHOULD</em> provide an endpoint to allow a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-296">Broker</a> to retrieve complete <code>Order</code>s. In future versions of the specification, endpoints may be provided which permit a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-297">Broker</a> to see all <code>Order</code>s created by a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-218">Customer</a>. In this current implementation, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-298">Broker</a> <em class="rfc2119">MUST</em> keep its own record of <code>Order</code>s as described elsewhere in this specification, and not rely on this <em class="rfc2119">RECOMMENDED</em> Order Status endpoint.</p><p>This endpoint <em class="rfc2119">MUST</em> include the full contents of the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-74">Opportunity</a> within the <code>orderedItem</code>, as per <a href="#opportunity-data-properties">Opportunity data properties</a>.</p><div class="example" id="example-55-order-status-example-request">
        <div class="marker">
    <a class="self-link" href="#example-55-order-status-example-request">Example<bdi> 55</bdi></a><span class="example-title">: Order Status: example request</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">GET</span> <span class="hljs-string">/api/orders/e11429ea-467f-4270-ab62-e47368996fe8</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>example.com
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1</code></pre>
      </div><div class="example" id="example-56-order-status-example-response">
        <div class="marker">
    <a class="self-link" href="#example-56-order-status-example-response">Example<bdi> 56</bdi></a><span class="example-title">: Order Status: example response</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">200</span> OK
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1
<span class="hljs-attribute">Location</span><span class="hljs-punctuation">: </span>/api/orders/e11429ea-467f-4270-ab62-e47368996fe8

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Order"</span>,
  <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/orders/e11429ea-467f-4270-ab62-e47368996fe8"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/AgentBroker"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/organisations/123"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"CRUOZWJ1"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Better"</span>,
    <span class="hljs-attr">"taxMode"</span>: <span class="hljs-string">"https://openactive.io/TaxGross"</span>,
    <span class="hljs-attr">"legalName"</span>: <span class="hljs-string">"Greenwich Leisure Limited"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A charitable social enterprise for all the community"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.better.org.uk"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.better.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 3457 8700"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"customerservices@gll.org"</span>,
    <span class="hljs-attr">"vatID"</span>: <span class="hljs-string">"GB 789 1234 56"</span>,
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    },
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PrivacyPolicy"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Privacy Policy"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/privacy-policy"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
      },
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TermsOfUse"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms and Conditions"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/terms-and-conditions"</span>,
        <span class="hljs-attr">"dateModified"</span>: <span class="hljs-string">"2019-04-16T20:31:13Z"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">true</span>
      }
    ]
  },
  <span class="hljs-attr">"bookingService"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"BookingService"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Playwaze"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://www.playwaze.com"</span>,
    <span class="hljs-attr">"termsOfService"</span>: [
      {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Terms"</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Terms of Service"</span>,
        <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://brokerexample.com/terms.html"</span>,
        <span class="hljs-attr">"requiresExplicitConsent"</span>: <span class="hljs-literal">false</span>
      }
    ]
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/orders/e11429ea-467f-4270-ab62-e47368996fe8#/orderedItem/1234"</span>,
      <span class="hljs-attr">"orderItemStatus"</span>: <span class="hljs-string">"https://openactive.io/OrderItemConfirmed"</span>,
      <span class="hljs-attr">"unitTaxSpecification"</span>: [
        {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
          <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
          <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
          <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
        }
      ],
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>,
        <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Winger space for Speedball."</span>,
        <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Speedball winger position"</span>,
        <span class="hljs-attr">"price"</span>: <span class="hljs-number">10</span>,
        <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
        <span class="hljs-attr">"validFromBeforeStartDate"</span>: <span class="hljs-string">"P6D"</span>,
        <span class="hljs-attr">"allowCustomerCancellationFullRefund"</span>: <span class="hljs-literal">true</span>,
        <span class="hljs-attr">"latestCancellationBeforeStartDate"</span>: <span class="hljs-string">"P1D"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>,
        <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">123</span>,
        <span class="hljs-attr">"eventStatus"</span>: <span class="hljs-string">"https://schema.org/EventScheduled"</span>,
        <span class="hljs-attr">"startDate"</span>: <span class="hljs-string">"2018-10-30T11:00:00Z"</span>,
        <span class="hljs-attr">"endDate"</span>: <span class="hljs-string">"2018-10-30T12:00:00Z"</span>,
        <span class="hljs-attr">"duration"</span>: <span class="hljs-string">"PT1H"</span>,
        <span class="hljs-attr">"superEvent"</span>: {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"SessionSeries"</span>,
          <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://api.example.com/events/452"</span>,
          <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Bodypump"</span>,
          <span class="hljs-attr">"activity"</span>: [
            {
              <span class="hljs-attr">"type"</span>: <span class="hljs-string">"Concept"</span>,
              <span class="hljs-attr">"id"</span>: <span class="hljs-string">"https://openactive.io/activity-list#5e78bcbe-36db-425a-9064-bf96d09cc351"</span>,
              <span class="hljs-attr">"prefLabel"</span>: <span class="hljs-string">"Bodypump™"</span>,
              <span class="hljs-attr">"inScheme"</span>: <span class="hljs-string">"https://openactive.io/activity-list"</span>
            }
          ],
          <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://example.com/events/452"</span>,
          <span class="hljs-attr">"location"</span>: {
            <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Place"</span>,
            <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://www.everyoneactive.com/centres/Middlesbrough-Sports-Village"</span>,
            <span class="hljs-attr">"name"</span>: <span class="hljs-string">"Middlesbrough Sports Village"</span>,
            <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"0140"</span>,
            <span class="hljs-attr">"address"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
              <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
              <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
              <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
              <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
              <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
            },
            <span class="hljs-attr">"geo"</span>: {
              <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"GeoCoordinates"</span>,
              <span class="hljs-attr">"latitude"</span>: <span class="hljs-number">54.543964</span>,
              <span class="hljs-attr">"longitude"</span>: <span class="hljs-number">-1.20978500000001</span>
            }
          }
        }
      },
      <span class="hljs-attr">"accessPass"</span>: [
        {
          <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Barcode"</span>,
          <span class="hljs-attr">"text"</span>: <span class="hljs-string">"0123456789"</span>
        }
      ]
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"totalPaymentTax"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TaxChargeSpecification"</span>,
      <span class="hljs-attr">"name"</span>: <span class="hljs-string">"VAT at 20%"</span>,
      <span class="hljs-attr">"price"</span>: <span class="hljs-number">1</span>,
      <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>,
      <span class="hljs-attr">"rate"</span>: <span class="hljs-number">0.2</span>
    }
  ],
  <span class="hljs-attr">"payment"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Payment"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"AcmeBroker Points"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"1234567890npduy2f"</span>
  }
}</span></code></pre>
      </div></section></section></section><section class="normative" id="model"><h2 id="x10-model"><bdi class="secno">10. </bdi>Model<a class="self-link" aria-label="§" href="#model"></a></h2><p>These models are designed to be compatible with [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>]. Conformance criteria for <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-27">Opportunity Data</a> used in the context of the Booking API are at some points stricter or more relaxed than are defined in the [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] specification itself.</p><p>The following sections include more detail about the properties available to describe each type. Some properties are considered to be essential to ensure the provision of a minimally useful set of information for a successful booking to be made. These <em class="rfc2119">REQUIRED</em> properties <em class="rfc2119">MUST</em> be provided, unless otherwise specified in the associated notes.</p><p>Other properties are marked as <em class="rfc2119">OPTIONAL</em> or <em class="rfc2119">RECOMMENDED</em>. Implementers <em class="rfc2119">SHOULD</em> provide <em class="rfc2119">RECOMMENDED</em> properties if it is feasible to do so, as they will improve the quality of the user experience that is achievable for both the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-219">Customer</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-107">Seller</a>.</p><p>Where data is not available to populate <em class="rfc2119">RECOMMENDED</em> and <em class="rfc2119">OPTIONAL</em> properties, publishers <em class="rfc2119">MUST</em> exclude these from their requests and responses. Requests and responses <em class="rfc2119">MUST NOT</em> include properties with null values, empty strings or empty arrays.</p><p>Implementers <em class="rfc2119">MAY</em> include additional properties. See the section on <a href="#handling-specification-dependencies-and-extensions">Handling Specification Dependencies and Extensions</a> for more information.</p><p>Applications that implement this API <em class="rfc2119">MUST</em> ignore any properties that they do not understand or do not support. This allows the API to evolve as required.</p><section id="order-model"><h3 id="x10-1-order-model"><bdi class="secno">10.1 </bdi>Order Model<a class="self-link" aria-label="§" href="#order-model"></a></h3><section id="schema-order"><h4 id="x10-1-1-schema-order"><bdi class="secno">10.1.1 </bdi><code>schema:Order</code><a class="self-link" aria-label="§" href="#schema-order"></a></h4><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Order</code></td>
</tr>
<tr>
<td><a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-30"><code><code>@id</code></code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>URI</td>
<td>A URI providing a unique identifier for the resource, which <em class="rfc2119">MUST</em> be constructed as specified depending on the whether the resource was created at <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-45"><b>C1</b></a> / <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-55"><b>C2</b></a> (<code>{baseUri}/order-quotes/{uuid}</code>), <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-35"><b>P</b></a> (<code>{baseUri}/order-proposals/{uuid}</code>) or <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-84"><b>B</b></a> (<code>{baseUri}/orders/{uuid}</code>), based on the <a href="#dfn-base-uri" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-base-uri-6">Base URI</a> and <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-52">Order UUID</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/identifier"><code>schema:identifier</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-53">Order UUID</a> of the <code>Order</code>, <code>OrderQuote</code> or <code>OrderProposal</code>, which is <em class="rfc2119">REQUIRED</em> within the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-97">Orders feed</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/seller"><code>schema:seller</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Organization"><code>schema:Organization</code></a> or a <a href="https://schema.org/Person"><code>schema:Person</code></a></td>
<td>The organisation or person providing access to events or facilities via a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-233">Booking System</a>. e.g. a leisure provider or independent running a yoga classes.</td>
</tr>
<tr>
<td><a href="https://openactive.io/taxCalculationExcluded"><code>oa:taxCalculationExcluded</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Boolean"><code>schema:Boolean</code></a></td>
<td>Set to <code>true</code> when business-to-business tax calculation is required by the <code>seller</code> or <code>brokerRole</code> settings, but not supported by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-299">Broker</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/broker"><code>schema:broker</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Organization"><code>schema:Organization</code></a></td>
<td>The organisation, independent of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-108">Seller</a>, that provides an application allowing <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-220">Customers</a> to make bookings. If <code>brokerRole</code> is set to <code>https://openactive.io/NoBroker</code> this property <em class="rfc2119">MUST NOT</em> be included.</td>
</tr>
<tr>
<td><a href="https://openactive.io/brokerRole"><code>oa:brokerRole</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://openactive.io/BrokerType"><code>oa:BrokerType</code></a></td>
<td>Either <code>https://openactive.io/AgentBroker</code>, <code>https://openactive.io/ResellerBroker</code> or <code>https://openactive.io/NoBroker</code>, as agreed in advance between the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-300">Broker</a> and <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-109">Seller</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/orderNumber"><code>schema:orderNumber</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The Customer-facing identifier of the <code>Order</code>.</td>
</tr>
<tr>
<td><a href="https://schema.org/customer"><code>schema:customer</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Organization"><code>schema:Organization</code></a> or a <a href="https://schema.org/Person"><code>schema:Person</code></a></td>
<td>The person or organization purchasing the Order.</td>
</tr>
<tr>
<td><a href="https://openactive.io/bookingService"><code>oa:bookingService</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://openactive.io/BookingService"><code>oa:BookingService</code></a></td>
<td>Details about the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-234">Booking System</a></td>
</tr>
<tr>
<td><a href="https://schema.org/orderedItem"><code>schema:orderedItem</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>Array of <a href="https://schema.org/OrderItem"><code>schema:OrderItem</code></a></td>
<td>The items that constitute the <code>Order</code></td>
</tr>
<tr>
<td><a href="https://schema.org/totalPaymentDue"><code>schema:totalPaymentDue</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/PriceSpecification"><code>schema:PriceSpecification</code></a></td>
<td>The total price of the <code>Order</code>, which includes or excludes tax depending on the <code>taxMode</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/totalPaymentTax"><code>oa:totalPaymentTax</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>Array of <a href="https://openactive.io/TaxChargeSpecification"><code>oa:TaxChargeSpecification</code></a></td>
<td>Breakdown of tax payable for the <code>Order</code>. <em class="rfc2119">MUST NOT</em> be included if <code>taxCalculationExcluded</code> is <code>true</code>. Due to differing approaches to tax arithmetic and rounding errors, the contents of this property may not be exactly equal to the sum of the <code>unitTaxSpecification</code> values of the <code>OrderItem</code>s. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-301">Broker</a> <em class="rfc2119">MUST NOT</em> attempt to perform any tax calculations, and <em class="rfc2119">MUST</em> simply display these values as-is.</td>
</tr>
<tr>
<td><a href="https://openactive.io/payment"><code>oa:payment</code></a></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://openactive.io/Payment"><code>oa:Payment</code></a></td>
<td>The payment associated with the Order by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-302">Broker</a>. It is <em class="rfc2119">REQUIRED</em> for cases where a payment has been taken.</td>
</tr>
<tr>
<td><a href="https://openactive.io/orderCreationStatus"><code>oa:orderCreationStatus</code></a></td>
<td>-</td>
<td>-</td>
<td><a href="https://openactive.io/OrderCreationStatus"><code>oa:OrderCreationStatus</code></a></td>
<td>Can include <code>https://openactive.io/OrderCreationPaymentAuthorized</code>, <code>https://openactive.io/OrderCreationPaymentDue</code>, <code>https://openactive.io/OrderCreationPaymentCaptured</code>, <code>https://openactive.io/OrderCreationComplete</code>. This property is internal to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-303">Broker</a> in this version of the specification.</td>
</tr>
<tr>
<td><a href="https://openactive.io/orderProposalVersion"><code>oa:orderProposalVersion</code></a></td>
<td>-</td>
<td>-</td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The unique URL representing this version of the <code>OrderProposal</code>, or the version of the <code>OrderProposal</code> to which this <code>Order</code> is related. This URL <em class="rfc2119">MUST</em> be constructed by appending <code>/versions/{versionUUID}</code> to the <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-31"><code><code>@id</code></code></a> of the <code>OrderProposal</code>, where <code>{versionUUID}</code> is replaced by the <a href="#dfn-orderproposal-version-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orderproposal-version-uuid-2">OrderProposal Version UUID</a>. This property <em class="rfc2119">MUST</em> only be included in the <code>OrderProposal</code> responses from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-235">Booking System</a> and in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-98">Orders feed</a>, and in the <code>Order</code> request at <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-85"><b>B</b></a>. It <em class="rfc2119">MUST NOT</em> be included in <code>OrderQuote</code> requests or responses, or in <code>Order</code> responses.</td>
</tr>
</tbody></table></section><section id="oa-orderquote"><h4 id="x10-1-2-oa-orderquote"><bdi class="secno">10.1.2 </bdi><code>oa:OrderQuote</code><a class="self-link" aria-label="§" href="#oa-orderquote"></a></h4><p><code>OrderQuote</code> subclasses <code>Order</code>, and includes all of the above properties as specified for <code>Order</code> with the addition of <code>oa:lease</code>, <code>oa:orderRequiresApproval</code>, and with <code>totalPaymentDue</code> <em class="rfc2119">REQUIRED</em> only in the response.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>OrderQuote</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/lease"><code>oa:lease</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://openactive.io/Lease"><code>oa:Lease</code></a></td>
<td>The <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-40">Lease</a> on the OrderItems which lasts for the duration specified by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-236">Booking System</a>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/orderRequiresApproval"><code>oa:orderRequiresApproval</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Boolean"><code>schema:Boolean</code></a></td>
<td>Whether the <a href="#booking-flow-with-approval">Booking Flow with Approval</a> <em class="rfc2119">MUST</em> be used to book the set of <code>OrderItem</code>s included. <em class="rfc2119">MUST</em> be <code>true</code> if any of the <code>OrderItem</code>s require approval.</td>
</tr>
</tbody></table></section><section id="oa-orderproposal"><h4 id="x10-1-3-oa-orderproposal"><bdi class="secno">10.1.3 </bdi><code>oa:OrderProposal</code><a class="self-link" aria-label="§" href="#oa-orderproposal"></a></h4><p><code>OrderProposal</code> subclasses <code>OrderQuote</code>, and includes all of the above properties as specified for <code>OrderQuote</code>, with the further addition of <code>oa:orderProposalStatus</code>, <code>oa:orderSellerNote</code>, <code>oa:orderCustomerNote</code>, and with <code>totalPaymentDue</code> <em class="rfc2119">REQUIRED</em> in the request and response, and <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-99">Orders feed</a>. It does not include <code>oa:orderRequiresApproval</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>OrderProposal</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/orderProposalStatus"><code>oa:orderProposalStatus</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>Array of <a href="https://openactive.io/OrderProposalStatus"><code>oa:OrderProposalStatus</code></a></td>
<td>Can include <code>https://openactive.io/AwaitingSellerConfirmation</code>, <code>https://openactive.io/SellerAccepted</code>, <code>https://openactive.io/SellerRejected</code>, <code>https://openactive.io/CustomerRejected</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/orderSellerNote"><code>oa:orderSellerNote</code></a></td>
<td>-</td>
<td>-</td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
</tr>
<tr>
<td><a href="https://openactive.io/orderCustomerNote"><code>oa:orderCustomerNote</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>-</td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
</tr>
</tbody></table></section><section id="schema-organization-or-schema-person-for-seller"><h4 id="x10-1-4-schema-organization-or-schema-person-for-seller"><bdi class="secno">10.1.4 </bdi><code>schema:Organization</code> or <code>schema:Person</code> for <code>seller</code><a class="self-link" aria-label="§" href="#schema-organization-or-schema-person-for-seller"></a></h4><p>The <code>seller</code> <em class="rfc2119">MUST</em> be a <code>schema:Organization</code> or <code>schema:Person</code> with the following properties, in order for tax receipts to be successfully generated.</p><p>The <code>seller</code> is specified with each <code>Order</code> to allow for <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-237">Booking System</a>s to cater for multiple <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-110">Seller</a>s.</p><p>In line with [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>], both the <code>schema:Organization</code> or <code>schema:Person</code> types support a common set of properties that capture the basic information required.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Organization</code> or <code>Person</code></td>
</tr>
<tr>
<td><a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-32"><code><code>@id</code></code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>URI</td>
<td>A URI providing a unique identifier for the resource.</td>
</tr>
<tr>
<td><a href="https://schema.org/identifier"><code>schema:identifier</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-111">Seller</a> used by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-238">Booking System</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Trading name of the <code>Organization</code>, or name of the <code>Person</code>. Note <code>givenName</code> and <code>familyName</code> <em class="rfc2119">MUST NOT</em> be used for a <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-112">Seller</a> that is a <code>Person</code>.</td>
</tr>
<tr>
<td><a href="https://schema.org/legalName"><code>schema:legalName</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Legal name of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-113">Seller</a>, used on tax receipts.</td>
</tr>
<tr>
<td><a href="https://schema.org/email"><code>schema:email</code></a></td>
<td>-</td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Email address used to contact the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-114">Seller</a>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/taxMode"><code>oa:taxMode</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://openactive.io/TaxMode"><code>oa:TaxMode</code></a></td>
<td>Either <code>https://openactive.io/TaxNet</code> or <code>https://openactive.io/TaxGross</code></td>
</tr>
<tr>
<td><a href="https://schema.org/vatID"><code>schema:vatID</code></a></td>
<td>-</td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The Value-added Tax ID of the of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-115">Seller</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/telephone"><code>schema:telephone</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Telephone number of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-116">Seller</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/url"><code>schema:url</code></a></td>
<td>-</td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The URL of the website of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-117">Seller</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/logo"><code>schema:logo</code></a></td>
<td>-</td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/ImageObject"><code>schema:ImageObject</code></a></td>
<td>Logo of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-118">Seller</a>, for tax receipts and display during the booking journey.</td>
</tr>
<tr>
<td><a href="https://schema.org/address"><code>schema:address</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/PostalAddress"><code>schema:PostalAddress</code></a></td>
<td>Address of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-119">Seller</a>, used on tax receipts.</td>
</tr>
<tr>
<td><a href="https://schema.org/termsOfService"><code>schema:termsOfService</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>Array of <a href="https://openactive.io/Terms"><code>oa:Terms</code></a></td>
<td>The terms of service of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-120">Seller</a>.</td>
</tr>
</tbody></table></section><section id="schema-organization-for-broker"><h4 id="x10-1-5-schema-organization-for-broker"><bdi class="secno">10.1.5 </bdi><code>schema:Organization</code> for <code>broker</code><a class="self-link" aria-label="§" href="#schema-organization-for-broker"></a></h4><p>The <code>broker</code> <em class="rfc2119">MUST</em> be a <code>schema:Organization</code> with the following properties, in order for the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-239">Booking System</a> to represent the third-party booking.</p><p>The <code>broker</code> is specified with each <code>Order</code> to account for scenarios where multiple <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-304">Broker</a> brands are in use.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Organization</code></td>
</tr>
<tr>
<td><a href="https://schema.org/identifier"><code>schema:identifier</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the brand used by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-305">Broker</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/name"><code>schema:name</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Name of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-306">Broker</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/email"><code>schema:email</code></a></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Support email address used to contact the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-307">Broker</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/telephone"><code>schema:telephone</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Support telephone number of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-308">Broker</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/url"><code>schema:url</code></a></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The URL of the website of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-309">Broker</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/logo"><code>schema:logo</code></a></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/ImageObject"><code>schema:ImageObject</code></a></td>
<td>Logo of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-310">Broker</a>, used within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-240">Booking System</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/termsOfService"><code>schema:termsOfService</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>-</td>
<td>Array of <a href="https://openactive.io/Terms"><code>oa:Terms</code></a></td>
<td>The terms of service of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-311">Broker</a>.</td>
</tr>
</tbody></table></section><section id="schema-orderitem"><h4 id="x10-1-6-schema-orderitem"><bdi class="secno">10.1.6 </bdi><code>schema:OrderItem</code><a class="self-link" aria-label="§" href="#schema-orderitem"></a></h4><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>OrderItem</code></td>
</tr>
<tr>
<td><a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-33"><code><code>@id</code></code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>A URI providing a unique identifier for the <code>OrderItem</code>, which <em class="rfc2119">SHOULD</em> be constructed by appending <code>#/orderedItem/{orderItemId}</code> to the <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-34"><code><code>@id</code></code></a> of the <code>Order</code>, where <code>{orderItemId}</code> is replaced by the <code>identifier</code> of the <code>OrderItem</code>, which may be a string or an integer depending on the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-241">Booking System</a>. This property is <em class="rfc2119">REQUIRED</em> for <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-86"><b>B</b></a> responses and <em class="rfc2119">MUST NOT</em> be included for <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-46"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-56"><b>C2</b></a> or <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-36"><b>P</b></a> responses.</td>
</tr>
<tr>
<td><a href="https://schema.org/position"><code>schema:position</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Integer"><code>schema:Integer</code></a></td>
<td>An integer representing the order of <code>OrderItem</code>s within the array, as JSON-LD does not support array ordering. This allows the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-312">Broker</a> to match any <code>error</code>s provided in the response to their request. The <code>position</code> of an <code>OrderItem</code> in the response <em class="rfc2119">MUST</em> match the <code>position</code> for the same <code>OrderItem</code> provided in request, and implementations <em class="rfc2119">MUST</em> use this value to match responses with requests instead of relying on the order of the elements in the array. This is <em class="rfc2119">REQUIRED</em> for <a href="#dfn-c1" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c1-47"><b>C1</b></a>, <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-57"><b>C2</b></a>, <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-37"><b>P</b></a> and <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-87"><b>B</b></a> requests and responses, but <em class="rfc2119">MUST NOT</em> be persisted or be present in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-100">Orders feed</a> or other endpoints.</td>
</tr>
<tr>
<td><a href="https://schema.org/orderItemStatus"><code>schema:orderItemStatus</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/OrderItemStatus"><code>schema:OrderItemStatus</code></a></td>
<td>Either <code>https://openactive.io/SellerCancelled</code>, <code>https://openactive.io/CustomerCancelled</code>, <code>https://openactive.io/OrderItemProposed</code>, <code>https://openactive.io/OrderItemConfirmed</code>, or <code>https://openactive.io/CustomerAttended</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/unitTaxSpecification"><code>oa:unitTaxSpecification</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>Array of <a href="https://openactive.io/TaxChargeSpecification"><code>oa:TaxChargeSpecification</code></a></td>
<td>Breakdown of tax payable for the OrderItem. <em class="rfc2119">MUST NOT</em> be included if <code>taxCalculationExcluded</code> is <code>true</code>.</td>
</tr>
<tr>
<td><a href="https://schema.org/acceptedOffer"><code>schema:acceptedOffer</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Offer"><code>schema:Offer</code></a></td>
<td>The offer from the associated <code>orderedItem</code> that has been selected by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-221">Customer</a>. The price of this includes or excludes tax depending on the <code>taxMode</code> of the <code>seller</code>.</td>
</tr>
<tr>
<td><a href="https://schema.org/orderedItem"><code>schema:orderedItem</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://openactive.io/ScheduledSession"><code>oa:ScheduledSession</code></a>, <a href="https://openactive.io/Slot"><code>oa:Slot</code></a>, <a href="https://openactive.io/HeadlineEvent"><code>oa:HeadlineEvent</code></a>, <a href="https://schema.org/Event"><code>schema:Event</code></a> or <a href="https://schema.org/CourseInstance"><code>schema:CourseInstance</code></a></td>
<td>The specific <a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-15">bookable</a> Thing that has been selected by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-222">Customer</a>. See the [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] specification for more information on these types. Note that the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-313">Broker</a>'s requests and the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-101">Orders feed</a> <em class="rfc2119">MUST</em> only include the <code>@type</code> and <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-35"><code><code>@id</code></code></a> within these objects; in these contexts, all other properties are ignored. See <a href="#opportunity-data-properties">Opportunity data properties</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/additionalProperty"><code>schema:additionalProperty</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>Array of <a href="https://schema.org/PropertyValue"><code>schema:PropertyValue</code></a></td>
<td><code>PropertyValue</code> that contains a text value useful for reconciliation.</td>
</tr>
<tr>
<td><a href="https://schema.org/accessCode"><code>schema:accessCode</code></a></td>
<td>-</td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td>Array of <a href="https://schema.org/PropertyValue"><code>schema:PropertyValue</code></a></td>
<td><code>PropertyValue</code> that contains a text value usable for entrance. Not applicable for an <code>OrderQuote</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/accessPass"><code>oa:accessPass</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td>Array of <a href="https://schema.org/ImageObject"><code>schema:ImageObject</code></a></td>
<td><code>ImageObject</code> or <code>Barcode</code> that contains reference to an asset (e.g. Barcode, QR code image or PDF) usable for entrance. Not applicable for an <code>OrderQuote</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/accessChannel"><code>oa:accessChannel</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/VirtualLocation"><code>schema:VirtualLocation</code></a></td>
<td>Channel through which the user can participate in the Opportunity. Not applicable for an <code>OrderQuote</code>.</td>
</tr>
<tr>
<td><a href="https://schema.org/error"><code>schema:error</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>Array of <a href="https://openactive.io/OpenBookingError"><code>oa:OpenBookingError</code></a></td>
<td>Array of errors related to the <code>OrderItem</code> being included in the <code>Order</code>, only applicable for an <code>OrderQuote</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/cancellationMessage"><code>oa:cancellationMessage</code></a></td>
<td>-</td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A message set by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-121">Seller</a> in the event of <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-75">Opportunity</a> cancellation, only applicable for an <code>Order</code> and where the <code>OrderItem</code> has <code>orderItemStatus</code> set to <code>https://openactive.io/SellerCancelled</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/customerNotice"><code>oa:customerNotice</code></a></td>
<td>-</td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A message set by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-122">Seller</a> to trigger a notification to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-223">Customer</a>, only applicable for an <code>Order</code> and where the <code>OrderItem</code> has <code>orderItemStatus</code> set to <code>https://openactive.io/OrderItemConfirmed</code> or <code>https://openactive.io/CustomerAttended</code></td>
</tr>
<tr>
<td><a href="https://schema.org/attendee"><code>schema:attendee</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://schema.org/Person"><code>schema:Person</code></a></td>
<td>The person attending the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-76">Opportunity</a> related to the <code>OrderItem</code>.</td>
</tr>
<tr>
<td><a href="http://openactive.io/attendeeDetailsRequired"><code>oa:attendeeDetailsRequired</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>Array of <a href="https://schema.org/Property"><code>schema:Property</code></a></td>
<td>The properties of <code>schema:Person</code> that are required to describe an <code>attendee</code> for this <code>OrderItem</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/orderItemIntakeForm"><code>oa:orderItemIntakeForm</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>Array of <a href="https://schema.org/PropertyValueSpecification"><code>schema:PropertyValueSpecification</code></a></td>
<td><code>PropertyValueSpecification</code>s that describe fields in the <code>orderItemIntakeForm</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/orderItemIntakeFormResponse"><code>oa:orderItemIntakeFormResponse</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>Array of <a href="https://schema.org/PropertyValue"><code>schema:PropertyValue</code></a></td>
<td><code>PropertyValue</code>s that contains a text value responses to the <code>orderItemIntakeForm</code>.</td>
</tr>
</tbody></table></section><section id="schema-offer"><h4 id="x10-1-7-schema-offer"><bdi class="secno">10.1.7 </bdi><code>schema:Offer</code><a class="self-link" aria-label="§" href="#schema-offer"></a></h4><p>Use of properties of <code>Offer</code> defined in the [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] is also encouraged.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Offer</code></td>
</tr>
<tr>
<td><a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-36"><code><code>@id</code></code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>A URI providing a unique identifier for the Offer</td>
</tr>
<tr>
<td><a href="https://schema.org/price"><code>schema:price</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Float"><code>schema:Float</code></a> or <a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The offer price available to <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-224">Customers</a>, which includes or excludes tax depending on the <code>taxMode</code> of the <code>seller</code>. Note that representing <code>price</code> as a Float leads to the possibility of software rounding errors; accordingly use of Text is recommended here.</td>
</tr>
<tr>
<td><a href="https://schema.org/priceCurrency"><code>schema:priceCurrency</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The currency of the <code>price</code>. Specified as a 3-letter ISO 4217 value. If an <code>Offer</code> has a zero <code>price</code>, then this property is not required. Otherwise the <code>priceCurrency</code> <em class="rfc2119">MUST</em> be specified.</td>
</tr>
<tr>
<td><a href="https://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The name of the <code>Offer</code> suitable for communication to <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-225">Customers</a>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/ageRestriction"><code>oa:ageRestriction</code></a></td>
<td>-</td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/QuantitativeValue"><code>schema:QuantitativeValue</code></a></td>
<td>Indicates that an Offer is restricted to a specific age range. Specified as a <a href="https://schema.org/QuantitativeValue">QuantitativeValue</a> with <a href="https://schema.org/minValue">minValue</a> and <a href="https://schema.org/maxValue">maxValue</a> properties.</td>
</tr>
<tr>
<td><a href="https://openactive.io/advanceBooking"><code>oa:advanceBooking</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://openactive.io/RequiredStatusType"><code>oa:RequiredStatusType</code></a></td>
<td>Indicates whether to accept this offer, a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-226">Customer</a> must book in advance, whether they must pay on attending, or have option to do either. Values <em class="rfc2119">MUST</em> be one of <code>https://openactive.io/Required</code>, <code>https://openactive.io/Optional</code> or <code>https://openactive.io/Unavailable</code>. The default behaviour of this specification is <code>https://openactive.io/Required</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/prepayment"><code>oa:prepayment</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://openactive.io/RequiredStatusType"><code>oa:RequiredStatusType</code></a></td>
<td>Indicates if accepting this <code>Offer</code> requires a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-227">Customer</a> to pay in advance, pay when attending, or have the option to do either. Values <em class="rfc2119">MUST</em> be one of <code>https://openactive.io/Required</code>, <code>https://openactive.io/Optional</code> or <code>https://openactive.io/Unavailable</code>. The default behaviour of this specification is <code>https://openactive.io/Unavailable</code> for <code>Offer</code>s with a <code>price</code> of <code>0</code>, and <code>https://openactive.io/Required</code> otherwise. If an <code>Offer</code>s has a <code>price</code> of <code>0</code> the value of this property <em class="rfc2119">MUST</em> be either <code>https://openactive.io/Unavailable</code> or unspecified.</td>
</tr>
<tr>
<td><a href="https://openactive.io/availableChannel"><code>oa:availableChannel</code></a></td>
<td>-</td>
<td>-</td>
<td>Array of <a href="https://openactive.io/AvailableChannelType"><code>oa:AvailableChannelType</code></a></td>
<td>The channels through which a booking can be made. <em class="rfc2119">MUST</em> be included in <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-28">Opportunity Data</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] open feeds, but <em class="rfc2119">MUST NOT</em> be included in other requests or responses. Can include <code>https://openactive.io/OpenBookingPrepayment</code>, <code>https://openactive.io/TelephoneAdvanceBooking</code>, <code>https://openactive.io/TelephonePrepayment</code>, <code>https://openactive.io/OnlinePrepayment</code>.</td>
</tr>
<tr>
<td><a href="https://openactive.io/validFromBeforeStartDate"><code>oa:validFromBeforeStartDate</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://schema.org/Duration"><code>schema:Duration</code></a></td>
<td>The duration before the <code>startDate</code> for which this Offer is valid, given in <a href="https://www.iso.org/iso-8601-date-and-time-format.html">ISO 8601</a> format. This is a relatively-defined equivalent of <a href="https://schema.org/validFrom"><code>schema:validFrom</code></a>, to allow for Offer inheritance.</td>
</tr>
<tr>
<td><a href="https://openactive.io/allowCustomerCancellationFullRefund"><code>oa:allowCustomerCancellationFullRefund</code></a></td>
<td>-</td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/Boolean"><code>schema:Boolean</code></a></td>
<td>Whether the opportunity can be cancelled with a full refund at any time before the <code>startDate</code>, or before the <code>latestCancellationBeforeStartDate</code> if provided.</td>
</tr>
<tr>
<td><a href="https://openactive.io/latestCancellationBeforeStartDate"><code>oa:latestCancellationBeforeStartDate</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://schema.org/Duration"><code>schema:Duration</code></a></td>
<td>The duration before the <code>startDate</code> during which this Offer may <strong>not</strong> be cancelled, given in <a href="https://www.iso.org/iso-8601-date-and-time-format.html">ISO 8601</a> format.</td>
</tr>
<tr>
<td><a href="https://openactive.io/openBookingFlowRequirement"><code>oa:openBookingFlowRequirement</code></a></td>
<td>-</td>
<td>-</td>
<td>Array of <a href="https://openactive.io/OpenBookingFlowRequirement"><code>oa:OpenBookingFlowRequirement</code></a></td>
<td>Can include <code>https://openactive.io/OpenBookingIntakeForm</code>, <code>https://openactive.io/OpenBookingAttendeeDetails</code>, <code>https://openactive.io/OpenBookingApproval</code>, <code>https://openactive.io/OpenBookingNegotiation</code>, <code>https://openactive.io/OpenBookingMessageExchange</code>. If any features of the specification covered by this property are required to book the <code>Offer</code>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-242">Booking System</a> <em class="rfc2119">MUST</em> include this property within <code>Offer</code>s in its <a href="#dfn-opportunity-data" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-data-29">Opportunity Data</a> [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] open feeds. This property <em class="rfc2119">MUST NOT</em> be included in the request or response of any of the <a href="#endpoints">endpoints</a> defined within this specification.</td>
</tr>
</tbody></table><p>Note that for an <code>Offer</code> to be <a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-16">bookable</a> under this specification, <code>availableChannel</code> must include <code>https://openactive.io/OpenBookingPrepayment</code>.</p></section><section id="schema-offeroverride"><h4 id="x10-1-8-schema-offeroverride"><bdi class="secno">10.1.8 </bdi><code>schema:OfferOverride</code><a class="self-link" aria-label="§" href="#schema-offeroverride"></a></h4><p><code>OfferOverride</code> subclasses <code>Offer</code>, but does not include the properties <code>availableChannel</code>, <code>advanceBooking</code>, <code>prepayment</code>, <code>ageRestriction</code>, <code>validFromBeforeStartDate</code>, <code>latestCancellationBeforeStartDate</code>, and <code>openBookingFlowRequirement</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>OfferOverride</code></td>
</tr>
<tr>
<td><a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-37"><code><code>@id</code></code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>A URI providing a unique identifier for the Offer</td>
</tr>
<tr>
<td><a href="https://schema.org/price"><code>schema:price</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Float"><code>schema:Float</code></a></td>
<td>The offer price available to <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-228">Customers</a>, which includes or excludes tax depending on the <code>taxMode</code> of the <code>seller</code>. Note that representing <code>price</code> as a Float leads to the possibility of software rounding errors; accordingly use of Text is recommended here.</td>
</tr>
<tr>
<td><a href="https://schema.org/priceCurrency"><code>schema:priceCurrency</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The currency of the <code>price</code>. Specified as a 3-letter ISO 4217 value. If a <code>PriceSpecification</code> has a zero <code>price</code>, then this property is not required. Otherwise the <code>priceCurrency</code> <em class="rfc2119">MUST</em> be specified.</td>
</tr>
<tr>
<td><a href="https://schema.org/name"><code>schema:name</code></a></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The name of the <code>Offer</code> suitable for communication to <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-229">Customers</a>.</td>
</tr>
</tbody></table></section><section id="schema-person-for-customer-or-attendee"><h4 id="x10-1-9-schema-person-for-customer-or-attendee"><bdi class="secno">10.1.9 </bdi><code>schema:Person</code> for <code>customer</code> or <code>attendee</code><a class="self-link" aria-label="§" href="#schema-person-for-customer-or-attendee"></a></h4><p>For business-to-consumer transactions, the <code>customer</code> <em class="rfc2119">MUST</em> be a <code>schema:Person</code>.</p><p>The required fields below relate to a <code>schema:Person</code> when used in the <code>customer</code> property. When used in the <code>attendee</code> property, required fields depend entirely on the <code>attendeeDetailsRequired</code> property.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Person</code></td>
</tr>
<tr>
<td><a href="https://schema.org/identifier"><code>schema:identifier</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-230">Customer</a> or <code>attendee</code> used by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-314">Broker</a> and/or <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-31">Payment Provider</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/email"><code>schema:email</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Email address used to uniquely identify the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-231">Customer</a> or <code>attendee</code>.</td>
</tr>
<tr>
<td><a href="https://schema.org/givenName"><code>schema:givenName</code></a></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Name of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-232">Customer</a> or <code>attendee</code>.</td>
</tr>
<tr>
<td><a href="https://schema.org/familyName"><code>schema:familyName</code></a></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Name of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-233">Customer</a> or <code>attendee</code>.</td>
</tr>
<tr>
<td><a href="https://schema.org/telephone"><code>schema:telephone</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Telephone number of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-234">Customer</a> or <code>attendee</code>.</td>
</tr>
</tbody></table><p>Note that in all cases any <code>Person</code> received from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-243">Booking System</a> when it is reflected back in the response <em class="rfc2119">MUST</em> only contain exactly the data that was provided by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-315">Broker</a> and <em class="rfc2119">MUST NOT</em> contain any additional data that may be known about the <code>Person</code> by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-244">Booking System</a>. It is strongly <em class="rfc2119">RECOMMENDED</em> that the personal data received by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-245">Booking System</a> be treated as a "guest checkout" and is not used to create a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-235">Customer</a> record in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-246">Booking System</a>.</p><p>In this current iteration of the Booking API specification, the programmatic matching of <code>Person</code> records provided by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-316">Broker</a> to existing records within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-247">Booking System</a> is considered to be out of scope, and is <em class="rfc2119">NOT RECOMMENDED</em>. </p><p>The <code>identifier</code> property <em class="rfc2119">MAY</em> be provided by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-317">Broker</a> if a unique identifier for the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-236">Customer</a> or <code>attendee</code> is available, to allow the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-248">Booking System</a> to provide analytics based on repeat visits of the same guest. However such an <code>identifier</code> <em class="rfc2119">MUST</em> only be matched within each unique set of <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-2">Authentication Credentials</a> to prevent identifier collisions across <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-2">Booking Partners</a>.</p><p>For conformance with this specification the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-249">Booking System</a> <em class="rfc2119">MUST NOT</em> require more data about the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-237">Customer</a> than is specified as <em class="rfc2119">REQUIRED</em> properties above.</p></section><section id="schema-organization-for-customer"><h4 id="x10-1-10-schema-organization-for-customer"><bdi class="secno">10.1.10 </bdi><code>schema:Organization</code> for <code>customer</code><a class="self-link" aria-label="§" href="#schema-organization-for-customer"></a></h4><p>For business-to-business transactions, the <code>customer</code> <em class="rfc2119">MUST</em> be a <code>schema:Organization</code> with the following properties.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Organization</code></td>
</tr>
<tr>
<td><a href="https://schema.org/identifier"><code>schema:identifier</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-238">Customer</a> used by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-318">Broker</a> and/or <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-32">Payment Provider</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/email"><code>schema:email</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Email address used to uniquely identify the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-239">Customer</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/name"><code>schema:name</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Name of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-240">Customer</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/telephone"><code>schema:telephone</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Telephone number of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-241">Customer</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/address"><code>schema:address</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/PostalAddress"><code>schema:PostalAddress</code></a></td>
<td>Address of the business <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-242">Customer</a>.</td>
</tr>
</tbody></table><p>Note that any <code>Organization</code> received from the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-250">Booking System</a> when it is reflected back in the response <em class="rfc2119">MUST</em> only contain exactly the data that was provided by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-319">Broker</a> and <em class="rfc2119">MUST NOT</em> contain any additional data that may be known about the <code>Organization</code> by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-251">Booking System</a>.</p></section><section id="schema-postaladdress"><h4 id="x10-1-11-schema-postaladdress"><bdi class="secno">10.1.11 </bdi><code>schema:PostalAddress</code><a class="self-link" aria-label="§" href="#schema-postaladdress"></a></h4><p>For <code>schema:Organization</code> when used for <code>customer</code> or <code>seller</code>, the following properties are required.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>PostalAddress</code></td>
</tr>
<tr>
<td><a href="https://schema.org/streetAddress"><code>schema:streetAddress</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Street address</td>
</tr>
<tr>
<td><a href="https://schema.org/addressLocality"><code>schema:addressLocality</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Town or other area</td>
</tr>
<tr>
<td><a href="https://schema.org/addressRegion"><code>schema:addressRegion</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Region</td>
</tr>
<tr>
<td><a href="https://schema.org/postalCode"><code>schema:postalCode</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Postcode</td>
</tr>
<tr>
<td><a href="https://schema.org/addressCountry"><code>schema:addressCountry</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>ISO 3166-1 alpha-2 country code.</td>
</tr>
</tbody></table></section><section id="oa-lease"><h4 id="x10-1-12-oa-lease"><bdi class="secno">10.1.12 </bdi><code>oa:Lease</code><a class="self-link" aria-label="§" href="#oa-lease"></a></h4><p>Used to represent a <code>lease</code>. <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-41">Leases</a> are defined as objects in this specification to provide for future extension.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Lease</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/leaseExpires"><code>oa:leaseExpires</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/DateTime"><code>schema:DateTime</code></a></td>
<td>Expiry DateTime of the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-42">Lease</a> in <a href="https://www.iso.org/iso-8601-date-and-time-format.html">ISO 8601</a> format</td>
</tr>
<tr>
<td><a href="https://schema.org/identifier"><code>schema:identifier</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Optional identifier of the <a href="#dfn-lease" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-lease-43">Lease</a> if useful for audit or debugging purposes.</td>
</tr>
</tbody></table></section><section id="schema-pricespecification"><h4 id="x10-1-13-schema-pricespecification"><bdi class="secno">10.1.13 </bdi><code>schema:PriceSpecification</code><a class="self-link" aria-label="§" href="#schema-pricespecification"></a></h4><p>Used for <code>totalPaymentDue</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>PriceSpecification</code></td>
</tr>
<tr>
<td><a href="https://schema.org/price"><code>schema:price</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Float"><code>schema:Float</code></a></td>
<td>The total amount.</td>
</tr>
<tr>
<td><a href="https://schema.org/priceCurrency"><code>schema:priceCurrency</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The currency of the <code>price</code>. Specified as a 3-letter ISO 4217 value. If a <code>PriceSpecification</code> has a zero <code>price</code>, then this property is not required. Otherwise the <code>priceCurrency</code> <em class="rfc2119">MUST</em> be specified.</td>
</tr>
<tr>
<td><a href="https://openactive.io/prepayment"><code>oa:prepayment</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://openactive.io/RequiredStatusType"><code>oa:RequiredStatusType</code></a></td>
<td>When used for <code>totalPaymentDue</code>, indicates if proceeding with booking requires a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-243">Customer</a> to pay in advance, pay when attending, or have the option to do either. Values <em class="rfc2119">MUST</em> be one of <code>https://openactive.io/Required</code>, <code>https://openactive.io/Optional</code> or <code>https://openactive.io/Unavailable</code>. The default behaviour of this specification is <code>https://openactive.io/Unavailable</code> when <code>price</code> is <code>0</code>, and <code>https://openactive.io/Required</code> otherwise. If the <code>price</code> is <code>0</code> the value of this property <em class="rfc2119">MUST</em> be either <code>https://openactive.io/Unavailable</code> or unspecified.</td>
</tr>
</tbody></table></section><section id="oa-taxchargespecification"><h4 id="x10-1-14-oa-taxchargespecification"><bdi class="secno">10.1.14 </bdi><code>oa:TaxChargeSpecification</code><a class="self-link" aria-label="§" href="#oa-taxchargespecification"></a></h4><p><code>TaxChargeSpecification</code> subclasses <code>PriceSpecification</code>, and so includes the same properties and a few additional ones, listed below; however it does not include <code>prepayment</code>.</p><p><code>TaxChargeSpecification</code> properties are intended to be rendered to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-244">Customer</a> as-is, and are not designed to be manipulated by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-320">Broker</a>. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-321">Broker</a> <em class="rfc2119">MUST NOT</em> attempt to perform any tax calculations.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>TaxChargeSpecification</code></td>
</tr>
<tr>
<td><a href="https://schema.org/price"><code>schema:price</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Float"><code>schema:Float</code></a></td>
<td>The monetary value of the tax charge.</td>
</tr>
<tr>
<td><a href="https://schema.org/priceCurrency"><code>schema:priceCurrency</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The currency of the tax charge. Specified as a 3-letter ISO 4217 value. If an tax charge has a zero <code>price</code>, then this property is not required. Otherwise the <code>priceCurrency</code> <em class="rfc2119">MUST</em> be specified.</td>
</tr>
<tr>
<td><a href="https://schema.org/identifier"><code>schema:identifier</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://schema.org/Integer"><code>schema:Integer</code></a>, <a href="https://schema.org/Text"><code>schema:Text</code></a>, <a href="https://schema.org/PropertyValue"><code>schema:PropertyValue</code></a> or an array of <a href="https://schema.org/PropertyValue"><code>schema:PropertyValue</code></a></td>
<td>A local identifier for the tax charge e.g. "VAT-20", used to identify the type of tax within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-252">Booking System</a>. Note an array of <code>PropertyValue</code> can be used to provide multiple identifiers where available.</td>
</tr>
<tr>
<td><a href="https://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The name of the tax charge, e.g. "VAT at 0% for EU transactions"</td>
</tr>
<tr>
<td><a href="https://openactive.io/rate"><code>oa:rate</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://schema.org/Float"><code>schema:Float</code></a></td>
<td>The rate of VAT.</td>
</tr>
</tbody></table></section><section id="oa-payment"><h4 id="x10-1-15-oa-payment"><bdi class="secno">10.1.15 </bdi><code>oa:Payment</code><a class="self-link" aria-label="§" href="#oa-payment"></a></h4><p>Used for <code>payment</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Payment</code></td>
</tr>
<tr>
<td><a href="https://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Optional free text description of the payment method for the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-253">Booking System</a>, to help the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-123">Seller</a> in discussions with the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-245">Customer</a> (e.g. "AcmeBroker Points" or "AcmeBroker via Credit Card").</td>
</tr>
<tr>
<td><a href="https://schema.org/identifier"><code>schema:identifier</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The identifier of the payment held by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-322">Broker</a> and/or <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-33">Payment Provider</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/paymentMethod"><code>schema:paymentMethod</code></a></td>
<td>-</td>
<td>-</td>
<td><a href="https://schema.org/PaymentMethod"><code>schema:PaymentMethod</code></a></td>
<td><code>paymentMethod</code> <em class="rfc2119">MUST NOT</em> be used, and is reserved for future versions of this specification.</td>
</tr>
<tr>
<td><a href="https://schema.org/accountId"><code>schema:accountId</code></a></td>
<td>-</td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A reference used by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-124">Seller</a> to group transactions, which is used to aid reconciliation.</td>
</tr>
<tr>
<td><a href="https://openactive.io/paymentProviderId"><code>oa:paymentProviderId</code></a></td>
<td>-</td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A reference to the specific <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-34">Payment Provider</a> that is used.</td>
</tr>
</tbody></table></section><section id="oa-dynamicpayment"><h4 id="x10-1-16-oa-dynamicpayment"><bdi class="secno">10.1.16 </bdi><code>oa:DynamicPayment</code><a class="self-link" aria-label="§" href="#oa-dynamicpayment"></a></h4><p><code>oa:DynamicPayment</code> subclasses <code>oa:Payment</code>, and includes all of the above properties as specified for <code>Payment</code>, but with <code>accountId</code> being <em class="rfc2119">REQUIRED</em>.</p><p>Used for fully dynamic pricing, where price is not known at the point of purchase.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>DynamicPayment</code></td>
</tr>
<tr>
<td><a href="https://schema.org/accountId"><code>schema:accountId</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A reference used by the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-125">Seller</a> to group transactions related, which is used to aid reconciliation.</td>
</tr>
</tbody></table></section><section id="oa-bookingservice"><h4 id="x10-1-17-oa-bookingservice"><bdi class="secno">10.1.17 </bdi><code>oa:BookingService</code><a class="self-link" aria-label="§" href="#oa-bookingservice"></a></h4><p><code>oa:BookingService</code> subclasses <code>schema:Service</code>.</p><p> Describes the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-254">Booking System</a>; used for <code>BookingService</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>BookingService</code></td>
</tr>
<tr>
<td><a href="https://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The name of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-255">Booking System</a></td>
</tr>
<tr>
<td><a href="https://schema.org/url"><code>schema:url</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The URL of the website of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-256">Booking System</a>.</td>
</tr>
<tr>
<td><a href="https://schema.org/termsOfService"><code>schema:termsOfService</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td>Array of <a href="https://openactive.io/Terms"><code>oa:Terms</code></a></td>
<td>The terms of service of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-257">Booking System</a>.</td>
</tr>
</tbody></table></section><section id="oa-terms"><h4 id="x10-1-18-oa-terms"><bdi class="secno">10.1.18 </bdi><code>oa:Terms</code><a class="self-link" aria-label="§" href="#oa-terms"></a></h4><p>Used for <code>termsOfService</code>.</p><p><code>oa:Terms</code> subclasses <code>schema:DigitalDocument</code>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Broker Request</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>Terms</code></td>
</tr>
<tr>
<td><a href="https://schema.org/name"><code>schema:name</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>The name of the terms. The name must distinguish this from other terms fields provided, e.g. "Terms and Conditions" or "Privacy Policy"</td>
</tr>
<tr>
<td><a href="https://schema.org/url"><code>schema:url</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>The URL of the webpage containing the contents of the terms.</td>
</tr>
<tr>
<td><a href="https://openactive.io/requiresExplicitConsent"><code>oa:requiresExplicitConsent</code></a></td>
<td>-</td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Boolean"><code>schema:Boolean</code></a></td>
<td>Whether the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-246">Customer</a> <em class="rfc2119">MUST</em> provide explicit consent to these terms before the booking is confirmed.</td>
</tr>
<tr>
<td><a href="https://schema.org/dateModified"><code>schema:dateModified</code></a></td>
<td>-</td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://schema.org/DateTime"><code>schema:DateTime</code></a></td>
<td>The date and time at which the webpage containing the contents of the terms, located at the <code>url</code>, was last updated. This property is <em class="rfc2119">RECOMMENDED</em> when <code>requiresExplicitConsent</code> is <code>true</code>.</td>
</tr>
</tbody></table></section><section id="oa-privacypolicy"><h4 id="x10-1-19-oa-privacypolicy"><bdi class="secno">10.1.19 </bdi><code>oa:PrivacyPolicy</code><a class="self-link" aria-label="§" href="#oa-privacypolicy"></a></h4><p>Used for <code>termsOfService</code>.</p><p><code>oa:PrivacyPolicy</code> subclasses <code>oa:Terms</code>.</p><p>A specific subclass for Privacy Policies, to help the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-323">Broker</a> distinguish these types of <code>Terms</code> in their user experience.</p></section><section id="oa-termsofuse"><h4 id="x10-1-20-oa-termsofuse"><bdi class="secno">10.1.20 </bdi><code>oa:TermsOfUse</code><a class="self-link" aria-label="§" href="#oa-termsofuse"></a></h4><p>Used for <code>termsOfService</code>.</p><p><code>oa:TermsOfUse</code> subclasses <code>oa:Terms</code>.</p><p>A specific subclass for Terms of Use, to help the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-324">Broker</a> distinguish these types of <code>Terms</code> in their user experience.</p></section><section id="schema-propertyvaluespecification"><h4 id="x10-1-21-schema-propertyvaluespecification"><bdi class="secno">10.1.21 </bdi><code>schema:PropertyValueSpecification</code><a class="self-link" aria-label="§" href="#schema-propertyvaluespecification"></a></h4><p><code>schema:PropertyValueSpecification</code> <em class="rfc2119">MUST NOT</em> be used in its abstract form, but is instead subclassed into more specific types.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>PropertyValueSpecification</code></td>
</tr>
<tr>
<td><a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-38"><code><code>@id</code></code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>A URI providing a unique identifier for the <code>PropertyValueSpecification</code> to be referenced in the <code>PropertyValue</code> response.</td>
</tr>
<tr>
<td><a href="https://schema.org/name"><code>schema:name</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Display label for the field.</td>
</tr>
<tr>
<td><a href="https://schema.org/description"><code>schema:description</code></a></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Descriptive help text for the field.</td>
</tr>
<tr>
<td><a href="https://schema.org/valueRequired"><code>schema:valueRequired</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Specifies that a value for the field is required to proceed with the booking.</td>
</tr>
</tbody></table></section><section id="oa-shortanswerformfieldspecification"><h4 id="x10-1-22-oa-shortanswerformfieldspecification"><bdi class="secno">10.1.22 </bdi><code>oa:ShortAnswerFormFieldSpecification</code><a class="self-link" aria-label="§" href="#oa-shortanswerformfieldspecification"></a></h4><p>Used for <code>orderItemIntakeForm</code>.</p><p><code>oa:ShortAnswerFormFieldSpecification</code> subclasses <code>schema:PropertyValueSpecification</code>.</p><p>Specifies a single-line text box field.</p></section><section id="oa-paragraphformfieldspecification"><h4 id="x10-1-23-oa-paragraphformfieldspecification"><bdi class="secno">10.1.23 </bdi><code>oa:ParagraphFormFieldSpecification</code><a class="self-link" aria-label="§" href="#oa-paragraphformfieldspecification"></a></h4><p>Used for <code>orderItemIntakeForm</code>.</p><p><code>oa:ParagraphFormFieldSpecification</code> subclasses <code>schema:PropertyValueSpecification</code>.</p><p>Specifies a multi-line text box field.</p></section><section id="oa-dropdownformfieldspecification"><h4 id="x10-1-24-oa-dropdownformfieldspecification"><bdi class="secno">10.1.24 </bdi><code>oa:DropdownFormFieldSpecification</code><a class="self-link" aria-label="§" href="#oa-dropdownformfieldspecification"></a></h4><p>Used for <code>orderItemIntakeForm</code>.</p><p><code>oa:DropdownFormFieldSpecification</code> subclasses <code>schema:PropertyValueSpecification</code>, with the addition of <code>oa:valueOption</code>.</p><p>Specifies a list of options in a dropdown format.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>DropdownFormFieldSpecification</code></td>
</tr>
<tr>
<td><a href="https://openactive.io/valueOption"><code>oa:valueOption</code></a></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td>Array of <a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Specifies an array of display values for the dropdown.</td>
</tr>
</tbody></table></section><section id="oa-booleanformfieldspecification"><h4 id="x10-1-25-oa-booleanformfieldspecification"><bdi class="secno">10.1.25 </bdi><code>oa:BooleanFormFieldSpecification</code><a class="self-link" aria-label="§" href="#oa-booleanformfieldspecification"></a></h4><p>Used for <code>orderItemIntakeForm</code>.</p><p><code>oa:BooleanFormFieldSpecification</code> subclasses <code>schema:PropertyValueSpecification</code>, without <code>oa:valueRequired</code>.</p><p>Specifies a <code>true</code> or <code>false</code> response.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Booking System Response</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>BooleanFormFieldSpecification</code></td>
</tr>
<tr>
<td><a href="https://schema.org/valueRequired"><code>schema:valueRequired</code></a></td>
<td>-</td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><em class="rfc2119">MUST NOT</em> be included.</td>
</tr>
</tbody></table></section><section id="schema-propertyvalue"><h4 id="x10-1-26-schema-propertyvalue"><bdi class="secno">10.1.26 </bdi><code>schema:PropertyValue</code><a class="self-link" aria-label="§" href="#schema-propertyvalue"></a></h4><p><code>schema:PropertyValue</code> is used for a variety of purposes within this specification. Its <em class="rfc2119">REQUIRED</em> properties are dependent on the context in which it is used, and are specified throughout this specification.</p><p>The use here is in keeping with the Schema.org definition of <a href="https://schema.org/PropertyValue"><code>PropertyValue</code></a>.</p><table>
<thead>
<tr>
<th>Property</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>PropertyValue</code></td>
</tr>
<tr>
<td><a href="https://schema.org/propertyID"><code>schema:propertyID</code></a></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>References the <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-39"><code><code>@id</code></code></a> of the <code>PropertyValueSpecification</code> to which this <code>PropertyValue</code> relates.</td>
</tr>
<tr>
<td><a href="https://schema.org/name"><code>schema:name</code></a></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Name of the property.</td>
</tr>
<tr>
<td><a href="https://schema.org/description"><code>schema:description</code></a></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Additional human-readable version of the <code>value</code> of the property.</td>
</tr>
<tr>
<td><a href="https://schema.org/value"><code>schema:value</code></a></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Machine-readable value of the property.</td>
</tr>
</tbody></table></section></section><section id="error-model"><h3 id="x10-2-error-model"><bdi class="secno">10.2 </bdi>Error Model<a class="self-link" aria-label="§" href="#error-model"></a></h3><section id="oa-openbookingerror"><h4 id="x10-2-1-oa-openbookingerror"><bdi class="secno">10.2.1 </bdi><code>oa:OpenBookingError</code><a class="self-link" aria-label="§" href="#oa-openbookingerror"></a></h4><p>This class has been modelled closely on [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc7807" title="Problem Details for HTTP APIs">RFC7807</a></cite>].</p><table>
<thead>
<tr>
<th>Property</th>
<th>Status</th>
<th>Type</th>
<th>Notes</th>
</tr>
</thead>
<tbody><tr>
<td><code>@type</code></td>
<td><em class="rfc2119">REQUIRED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td><code>OpenBookingError</code></td>
</tr>
<tr>
<td><a href="https://schema.org/name"><code>schema:name</code></a></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A short, human-readable summary of the problem type, that <em class="rfc2119">MUST</em> communicate the associated "Use Case" defined in this section of the specification. It <em class="rfc2119">SHOULD NOT</em> change from occurrence to occurrence of the problem, except for purposes of localization.</td>
</tr>
<tr>
<td><a href="https://schema.org/description"><code>schema:description</code></a></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>A human-readable explanation specific to this occurrence of the problem, providing specific information about why the error occurred in this particular case.</td>
</tr>
<tr>
<td><a href="https://openactive.io/instance"><code>oa:instance</code></a></td>
<td><em class="rfc2119">RECOMMENDED</em></td>
<td><a href="https://schema.org/URL"><code>schema:URL</code></a></td>
<td>A URI reference that identifies the specific occurrence of the problem. It may or may not yield further information if dereferenced.</td>
</tr>
<tr>
<td><a href="https://openactive.io/statusCode"><code>oa:statusCode</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://schema.org/Integer"><code>schema:Integer</code></a></td>
<td>An integer representing the HTTP status code, that <em class="rfc2119">MUST</em> match the associated "Status Code" defined in this section of the specification.</td>
</tr>
<tr>
<td><a href="https://openactive.io/requestId"><code>oa:requestId</code></a></td>
<td><em class="rfc2119">OPTIONAL</em></td>
<td><a href="https://schema.org/Text"><code>schema:Text</code></a></td>
<td>Used by technical support for diagnostics purposes.</td>
</tr>
</tbody></table></section><section id="oa-openbookingerror-subclasses"><h4 id="x10-2-2-oa-openbookingerror-subclasses"><bdi class="secno">10.2.2 </bdi><code>oa:OpenBookingError</code> subclasses<a class="self-link" aria-label="§" href="#oa-openbookingerror-subclasses"></a></h4><p>A number of <code>OpenBookingError</code> subclasses are specified to identify the problem type.</p><section id="order-creation-orderquote-orderproposal-and-order-error-responses"><h5 id="x10-2-2-1-order-creation-orderquote-orderproposal-and-order-error-responses"><bdi class="secno">10.2.2.1 </bdi>Order Creation - <code>OrderQuote</code>, <code>OrderProposal</code> and <code>Order</code> error responses<a class="self-link" aria-label="§" href="#order-creation-orderquote-orderproposal-and-order-error-responses"></a></h5><table>
<thead>
<tr>
<th>Error Type (<code>@type</code>)</th>
<th>Status Code (<code>oa:statusCode</code>)</th>
<th>Use Case (<code>schema:name</code>)</th>
</tr>
</thead>
<tbody><tr>
<td><code>IncompleteCustomerDetailsError</code></td>
<td>400</td>
<td>The <code>email</code> address of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-247">Customer</a> is not supplied within a <code>Person</code> object; or the <code>customer</code> property supplied is not a valid <code>Person</code> or <code>Organization</code> object.</td>
</tr>
<tr>
<td><code>IncompleteBrokerDetailsError</code></td>
<td>400</td>
<td>The <code>name</code> property is not supplied within the <code>Organisation</code> object describing the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-325">Broker</a>; or the <code>broker</code> property supplied is not a valid <code>Organisation</code> object.</td>
</tr>
<tr>
<td><code>UnnecessaryPaymentDetailsError</code></td>
<td>400</td>
<td>The <code>payment</code> property of the <code>Order</code> is provided when it is expected to be absent.</td>
</tr>
<tr>
<td><code>MissingPaymentDetailsError</code></td>
<td>400</td>
<td>The <code>payment</code> property of the <code>Order</code> is absent when it is expected to be provided.</td>
</tr>
<tr>
<td><code>IncompletePaymentDetailsError</code></td>
<td>400</td>
<td>The <code>payment</code> property of the <code>Order</code> does not include <code>identifier</code>.</td>
</tr>
<tr>
<td><code>InvalidPaymentDetailsError</code></td>
<td>400</td>
<td>The <code>payment</code> property of the <code>OrderQuote</code> or <code>Order</code> contains data that is not accepted by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-258">Booking System</a> for reconciliation, e.g. an invalid <code>accountId</code>.</td>
</tr>
<tr>
<td><code>TotalPaymentDueMismatchError</code></td>
<td>400</td>
<td>The <code>totalPaymentDue</code> property of the submitted <code>Order</code> or <code>OrderProposal</code> does not match the value calculated for that <code>Order</code> or <code>OrderProposal</code> by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-259">Booking System</a>.</td>
</tr>
<tr>
<td><code>OpportunityHasInsufficientCapacityError</code></td>
<td>409</td>
<td>There are not enough available spaces in any <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-77">Opportunity</a> that was included the <code>Order</code>.</td>
</tr>
<tr>
<td><code>UnableToProcessOrderItemError</code></td>
<td>409</td>
<td><code>OrderItem</code> errors would have been generated at <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-58"><b>C2</b></a> given the same set of <code>OrderItem</code>s. The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-326">Broker</a> is expected to retry <a href="#dfn-c2" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-c2-59"><b>C2</b></a> to retrieve such errors. <br> This error <em class="rfc2119">MUST</em> only be used as a response from <a href="#dfn-p" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-p-38"><b>P</b></a> or <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-88"><b>B</b></a>.</td>
</tr>
<tr>
<td><code>OrderAlreadyExistsError</code></td>
<td>500</td>
<td>The <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-54">Order UUID</a> used for an <code>OrderQuote</code> already represents a completed <code>Order</code> with a different set of <code>OrderItem</code>s to those specified (note call to <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-89"><b>B</b></a> is idempotent for the case where <code>OrderItem</code>s match). This happens in the rare event of a <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-55">Order UUID</a> clash.</td>
</tr>
<tr>
<td><code>OrderProposalVersionOutdatedError</code></td>
<td>500</td>
<td><a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-90"><b>B</b></a> failed due to a newer version of the <code>OrderProposal</code> existing than that specified by the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-327">Broker</a> in <code>orderProposalVersion</code>.</td>
</tr>
<tr>
<td><code>OrderCreationFailedError</code></td>
<td>500</td>
<td><a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-91"><b>B</b></a> failed for a reason not specified by a defined type of error in the Open Booking API specification.</td>
</tr>
<tr>
<td><code>UnexpectedOrderTypeError</code></td>
<td>500</td>
<td>The <code>@type</code> of the JSON-LD object submitted to the endpoint did not match the expected <code>@type</code>, as defined in the Open Booking API specification.</td>
</tr>
<tr>
<td><code>SellerNotFoundError</code></td>
<td>500</td>
<td>The <code>@id</code> of the <code>seller</code> included in the request was not found within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-260">Booking System</a>.</td>
</tr>
<tr>
<td><code>SellerMismatchError</code></td>
<td>500</td>
<td>At least one of the <code>OrderItem</code>s did not match the specified <code>seller</code>.</td>
</tr>
</tbody></table></section><section id="order-cancellation-orderquote-orderproposal-and-order-error-responses"><h5 id="x10-2-2-2-order-cancellation-orderquote-orderproposal-and-order-error-responses"><bdi class="secno">10.2.2.2 </bdi>Order Cancellation - <code>OrderQuote</code>, <code>OrderProposal</code> and <code>Order</code> error responses<a class="self-link" aria-label="§" href="#order-cancellation-orderquote-orderproposal-and-order-error-responses"></a></h5><table>
<thead>
<tr>
<th>Error Type (<code>@type</code>)</th>
<th>Status Code (<code>oa:statusCode</code>)</th>
<th>Use Case (<code>schema:name</code>)</th>
</tr>
</thead>
<tbody><tr>
<td><code>CancellationNotPermittedError</code></td>
<td>400</td>
<td>Cancellation is not permitted due to internal rules of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-261">Booking System</a> not otherwise exposed to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-328">Broker</a>. <br> The <code>description</code> property of the object <em class="rfc2119">MUST</em> include a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-248">Customer</a>-facing description of the reason that cancellation is not permitted.</td>
</tr>
<tr>
<td><code>OrderItemNotWithinOrderError</code></td>
<td>500</td>
<td>The <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-56">Order UUID</a> for at least one provided <code>OrderItem</code> does not match the <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-57">Order UUID</a> of the <code>Order</code> being PATCHed.</td>
</tr>
<tr>
<td><code>OrderItemIdInvalidError</code></td>
<td>500</td>
<td>The <code>@id</code> of at least one of the provided <code>OrderItem</code>s is invalid.</td>
</tr>
</tbody></table></section><section id="order-creation-orderitem-errors"><h5 id="x10-2-2-3-order-creation-orderitem-errors"><bdi class="secno">10.2.2.3 </bdi>Order Creation - <code>OrderItem</code> errors<a class="self-link" aria-label="§" href="#order-creation-orderitem-errors"></a></h5><p>Note that all <code>OrderItem</code> errors for an <code>OrderQuote</code> request result in a <code>409 Conflict</code> response, as the error is expected to be resolved, and the request resubmitted, as per [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2616" title="Hypertext Transfer Protocol -- HTTP/1.1">RFC2616</a></cite>] section 10.4.10.</p><table>
<thead>
<tr>
<th>Error Type (<code>@type</code>)</th>
<th>Status Code (<code>oa:statusCode</code>)</th>
<th>Use Case (<code>schema:name</code>)</th>
</tr>
</thead>
<tbody><tr>
<td><code>IncompleteAttendeeDetailsError</code></td>
<td>409</td>
<td>The <code>attendeeDetailsRequired</code> properties of the <code>attendee</code> are not supplied within a <code>Person</code> object.</td>
</tr>
<tr>
<td><code>IncompleteOrderItemError</code></td>
<td>409</td>
<td>There is a missing <code>acceptedOffer</code> or <code>orderedItem</code> property on the <code>OrderItem</code>.</td>
</tr>
<tr>
<td><code>IncompleteIntakeFormError</code></td>
<td>409</td>
<td>The <code>orderItemIntakeFormResponse</code> is missing fields that are specified as <code>valueRequired</code> within the <code>orderItemIntakeForm</code>.</td>
</tr>
<tr>
<td><code>InvalidIntakeFormError</code></td>
<td>409</td>
<td>The <code>orderItemIntakeFormResponse</code> contains invalid fields that do not match those specified by the <code>orderItemIntakeForm</code>.</td>
</tr>
<tr>
<td><code>UnacceptableOfferError</code></td>
<td>409</td>
<td>The <code>@id</code> provided for the <code>acceptedOffer</code> is not a URL which corresponds to an applicable <code>Offer</code> for the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-78">Opportunity</a>.</td>
</tr>
<tr>
<td><code>UnknownOfferError</code></td>
<td>409</td>
<td>The <code>@id</code> provided for the <code>acceptedOffer</code> is not a URL which corresponds to an <code>Offer</code> within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-262">Booking System</a>.</td>
</tr>
<tr>
<td><code>UnknownOpportunityError</code></td>
<td>409</td>
<td>The <code>@id</code> provided for the <code>orderedItem</code> is not a URL which corresponds to an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-79">Opportunity</a> within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-263">Booking System</a>.</td>
</tr>
<tr>
<td><code>InvalidOpportunityOrOfferIdError</code></td>
<td>409</td>
<td>The <code>@id</code> provided for the <code>orderedItem</code> or <code>acceptedOffer</code> does not match a recognised URL format within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-264">Booking System</a>.</td>
</tr>
<tr>
<td><code>OpportunityOfferPairNotBookableError</code></td>
<td>409</td>
<td>The <code>orderedItem</code> and <code>acceptedOffer</code> combination specified are not "<a href="#dfn-bookability" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-bookability-17">bookable</a>", as defined in the Open Booking API specification.</td>
</tr>
<tr>
<td><code>OpportunityIntractableError</code></td>
<td>409</td>
<td>The <code>orderedItem</code> and <code>acceptedOffer</code> combination specified currently cannot be booked due to an inconsistent state within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-265">Booking System</a>.</td>
</tr>
<tr>
<td><code>OpportunityIsInConflictError</code></td>
<td>409</td>
<td>The specific <code>OrderItem</code>s against which this error is emitted are not able to be booked together.</td>
</tr>
<tr>
<td><code>OpportunityIsFullError</code></td>
<td>409</td>
<td>There are no available spaces for the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-80">Opportunity</a> contained in the <code>orderedItem</code> property.</td>
</tr>
<tr>
<td><code>OpportunityHasInsufficientCapacityError</code></td>
<td>409</td>
<td>There are not enough available spaces in the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-81">Opportunity</a> contained in the <code>orderedItem</code> property of the <code>OrderItem</code> to fulfil the number of repeated <code>OrderItem</code>s. <br> If the <code>OrderItem</code> is repeated (for multiple attendees) this error <em class="rfc2119">MUST</em> only be included in the API response against the <code>OrderItem</code>s which are in excess of the capacity - for example in an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-82">Opportunity</a> with a <code>remainingAttendeeCapacity</code> of 2 and with 5 <code>OrderItem</code>s related to it, this error would only be emitted against 3 of the <code>OrderItem</code>s.</td>
</tr>
<tr>
<td><code>OpportunityCapacityIsReservedByLeaseError</code></td>
<td>409</td>
<td>The available capacity required to book a specific <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-83">Opportunity</a> is reserved by a lease held by another <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-249">Customer</a>. <br> If the <code>OrderItem</code> is repeated (for multiple attendees) this error <em class="rfc2119">MUST</em> only be included in the API response against the <code>OrderItem</code>s which are in excess of the capacity but which are reserved by the lease of another <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-250">Customer</a> - for example in an <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-84">Opportunity</a> with a <code>remainingAttendeeCapacity</code> of 3, with 1 additional space held by another lease, then for an <code>OrderQuote</code> with 9 <code>OrderItem</code>s related to it, this error would only be emitted against 1 of the <code>OrderItem</code>s, with <code>OpportunityHasInsufficientCapacityError</code> emitted against the other 5 of the <code>OrderItem</code>s. This helps a <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-251">Customer</a> to know whether they should try again.</td>
</tr>
</tbody></table></section><section id="api-authentication"><h5 id="x10-2-2-4-api-authentication"><bdi class="secno">10.2.2.4 </bdi>API authentication<a class="self-link" aria-label="§" href="#api-authentication"></a></h5><table>
<thead>
<tr>
<th>Error Type (<code>@type</code>)</th>
<th>Status Code (<code>oa:statusCode</code>)</th>
<th>Use Case (<code>schema:name</code>)</th>
</tr>
</thead>
<tbody><tr>
<td><code>UnauthenticatedError</code></td>
<td>403</td>
<td>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-329">Broker</a> did not supply any form of authentication.</td>
</tr>
<tr>
<td><code>NoAPITokenError</code></td>
<td>403</td>
<td>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-330">Broker</a> did not supply an API key.</td>
</tr>
<tr>
<td><code>InvalidAPITokenError</code></td>
<td>401</td>
<td>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-331">Broker</a> supplied an invalid API key, either malformed or expired.</td>
</tr>
<tr>
<td><code>InvalidAuthorizationDetailsError</code></td>
<td>401</td>
<td>The <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-332">Broker</a> supplied an invalid set of authorization details, either malformed or expired.</td>
</tr>
</tbody></table></section><section id="technical-errors"><h5 id="x10-2-2-5-technical-errors"><bdi class="secno">10.2.2.5 </bdi>Technical errors<a class="self-link" aria-label="§" href="#technical-errors"></a></h5><table>
<thead>
<tr>
<th>Error Type (<code>@type</code>)</th>
<th>Status Code (<code>oa:statusCode</code>)</th>
<th>Use Case (<code>schema:name</code>)</th>
</tr>
</thead>
<tbody><tr>
<td><code>TemporarilyUnableToProduceOrderQuoteError</code></td>
<td>503</td>
<td>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-266">Booking System</a> is unable for technical reasons to produce an <code>OrderQuote</code> where the data provided to it is sufficient to allow it to do so.</td>
</tr>
<tr>
<td><code>TemporarilyUnableToCreateOrderError</code></td>
<td>503</td>
<td>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-267">Booking System</a> is unable for technical reasons to create an <code>Order</code> where the data provided to it is sufficient to allow it to do so.</td>
</tr>
<tr>
<td><code>TemporarilyUnableToUpdateOrderError</code></td>
<td>503</td>
<td>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-268">Booking System</a> is unable for technical reasons to update an <code>Order</code> (which includes processing the PATCH for cancellation) where the data provided to it is sufficient to allow it to do so.</td>
</tr>
<tr>
<td><code>TemporarilyUnableToDeleteOrderError</code></td>
<td>503</td>
<td>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-269">Booking System</a> is unable for technical reasons to delete an <code>Order</code> where the data provided to it is sufficient to allow it to do so.</td>
</tr>
</tbody></table></section><section id="generic-errors"><h5 id="x10-2-2-6-generic-errors"><bdi class="secno">10.2.2.6 </bdi>Generic errors<a class="self-link" aria-label="§" href="#generic-errors"></a></h5><table>
<thead>
<tr>
<th>Error Type (<code>@type</code>)</th>
<th>Status Code (<code>oa:statusCode</code>)</th>
<th>Use Case (<code>schema:name</code>)</th>
</tr>
</thead>
<tbody><tr>
<td><code>UnknownOrderError</code></td>
<td>404</td>
<td>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-270">Booking System</a> has no <code>Order</code> matching the one requested.</td>
</tr>
<tr>
<td><code>UnknownOrIncorrectEndpointError</code></td>
<td>404</td>
<td>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-271">Booking System</a> has no endpoint matching the one requested.</td>
</tr>
<tr>
<td><code>NotFoundError</code></td>
<td>404</td>
<td>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-272">Booking System</a> does not have the generic resource specified.</td>
</tr>
<tr>
<td><code>MethodNotAllowedError</code></td>
<td>405</td>
<td>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-273">Booking System</a> does not recognise the specific HTTP verb used for the endpoint requested.</td>
</tr>
<tr>
<td><code>PatchContainsExcessivePropertiesError</code></td>
<td>400</td>
<td>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-274">Booking System</a> recognises a PATCH request but the request object contains properties that the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-333">Broker</a> is not permitted to update. Custom namespace properties are always excluded from consideration.</td>
</tr>
<tr>
<td><code>PatchNotAllowedOnPropertyError</code></td>
<td>400</td>
<td>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-275">Booking System</a> recognises a PATCH request but the request object contains one or many properties that the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-334">Broker</a> is not permitted to update to the requested value.</td>
</tr>
<tr>
<td><code>GoneError</code></td>
<td>410</td>
<td>An <code>Order</code> has been soft-deleted by an Order Deletion request.</td>
</tr>
<tr>
<td><code>TooManyRequestsError</code></td>
<td>429</td>
<td>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-276">Booking System</a> is rate-limiting the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-335">Broker</a>.</td>
</tr>
</tbody></table></section></section><section id="oa-internalopenbookingerror-subclasses"><h4 id="x10-2-3-oa-internalopenbookingerror-subclasses"><bdi class="secno">10.2.3 </bdi><code>oa:InternalOpenBookingError</code> subclasses<a class="self-link" aria-label="§" href="#oa-internalopenbookingerror-subclasses"></a></h4><p><code>InternalOpenBookingError</code> subclasses <code>OpenBookingError</code>, and is designed to be used to report the origin of unexpected exceptions.</p><p>A number of <code>InternalOpenBookingError</code> subclasses are specified to identify the problem type, listed below in addition to the <code>InternalOpenBookingError</code>.</p><table>
<thead>
<tr>
<th>Error Type (<code>@type</code>)</th>
<th>Status Code (<code>oa:statusCode</code>)</th>
<th>Use Case (<code>schema:name</code>)</th>
</tr>
</thead>
<tbody><tr>
<td><code>InternalOpenBookingError</code></td>
<td>500</td>
<td>A generic internal error type, which is not intended to be used directly.</td>
</tr>
<tr>
<td><code>InternalApplicationError</code></td>
<td>500</td>
<td>An unexpected exception has been thrown by the application.</td>
</tr>
<tr>
<td><code>InternalLibraryError</code></td>
<td>500</td>
<td>An unexpected exception has been thrown by an OpenActive SDK library or component.</td>
</tr>
<tr>
<td><code>InternalLibraryConfigurationError</code></td>
<td>500</td>
<td>An exception has been thrown due to the misconfiguration of an OpenActive SDK library or component.</td>
</tr>
</tbody></table></section></section></section><section class="normative" id="common-requirements"><h2 id="x11-common-requirements"><bdi class="secno">11. </bdi>Common Requirements<a class="self-link" aria-label="§" href="#common-requirements"></a></h2><p>This section defines some common functionality that applies to the design of the
whole API.</p><section id="versioning-policy"><h3 id="x11-1-versioning-policy"><bdi class="secno">11.1 </bdi>Versioning Policy<a class="self-link" aria-label="§" href="#versioning-policy"></a></h3><p>The broad goal is to ensure that future versions of this specification remain backwards compatible. This will ensure that existing implementations remain valid.</p><p>New types of resource, relationships and properties can easily be added to extend the model without impacting existing functionality or interfaces. Potential breaking changes would include changing the definitions of existing properties, removing them from the specification, or changing the definition of existing interfaces.</p><p>To avoid this, the goal will be to:</p><ul>
<li>Evolve the definitions of existing properties to broadly retain their current meaning and legal values, and to ensure that changes remain compatible with existing interfaces.</li>
<li>Deprecate, rather than remove properties or functionality that are judged, based on implementation experience, to be less useful or confusing. Deprecated properties will be clearly marked in both the human and machine-readable versions of the OpenActive namespace.</li>
<li>Use version numbering to indicate potential for breaking changes. Minor versions, e.g. 1.1, 2.1, etc should be backwards compatible. Major versions, e.g. 2.0, 3.0 are likely to include breaking changes.</li>
<li>Additional features within minor version specification releases that are required to complete a booking for a particular opportunity should make use of the <code>openBookingFlowRequirement</code> property in the open data feeds to allow <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-336">Brokers</a> to ignore such opportunities if they do not support the requisite feature.</li>
<li>Proposed changes to the specification will also be communicated in advance of their formal release, through the sharing of public Editor's Drafts. This will provide opportunities for implementers to update their applications.</li>
</ul><section id="media-types"><h4 id="x11-1-1-media-types"><bdi class="secno">11.1.1 </bdi>Media types<a class="self-link" aria-label="§" href="#media-types"></a></h4><p>Custom media types are used in this API to allow clients to choose the format
of the data they receive, and for <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-277">Booking Systems</a> to stipulate which versions
of the specification they support.</p><p><a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-278">Booking Systems</a> <em class="rfc2119">MAY</em> choose to support additional media types but <em class="rfc2119">MUST</em> support the
media type(s) defined by this specification.</p><p>Media types used in the <code>Accept</code> header of requests and <code>Content-Type</code> header of responses will conform to the following pattern, which includes only the major version of the specification:</p><pre><code aria-busy="false" class="hljs">application/vnd.openactive.booking+json; version=x
</code></pre><p>The current media type is:</p><pre><code aria-busy="false" class="hljs">application/vnd.openactive.booking+json; version=1
</code></pre><p> <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-337">Brokers</a> will receive data in the most current format within that major version (e.g. 1.1, 1.2 etc).</p></section></section><section id="handling-specification-dependencies-and-extensions"><h3 id="x11-2-handling-specification-dependencies-and-extensions"><bdi class="secno">11.2 </bdi>Handling Specification Dependencies and Extensions<a class="self-link" aria-label="§" href="#handling-specification-dependencies-and-extensions"></a></h3><section id="realtime-paged-data-exchange-1-0"><h4 id="x11-2-1-realtime-paged-data-exchange-1-0"><bdi class="secno">11.2.1 </bdi>Realtime Paged Data Exchange 1.0<a class="self-link" aria-label="§" href="#realtime-paged-data-exchange-1-0"></a></h4><p>The <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-102">Orders feed</a> defined in this specification is an [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] feed which conforms exactly to [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] 1.0, except for <a href="https://www.openactive.io/realtime-paged-data-exchange/#content-type">section 5.1.3</a> where instead it uses media type <code>application/vnd.openactive.booking+json; version=1</code>.</p><p>Although additional <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-103">Orders feed</a> conforming to later versions of the [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] specification and even to later versions of this specification <em class="rfc2119">MAY</em> be implemented in parallel, implementations that are compliant with this version of the specification <em class="rfc2119">MUST</em> utilise an <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-104">Orders feed</a> that conforms to [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] 1.0.</p></section><section id="modelling-opportunity-data-2-x-where-x-0"><h4 id="x11-2-2-modelling-opportunity-data-2-x-where-x-0"><bdi class="secno">11.2.2 </bdi>Modelling Opportunity Data 2.x (where x &gt;= 0)<a class="self-link" aria-label="§" href="#modelling-opportunity-data-2-x-where-x-0"></a></h4><p>The model defined in this specification builds on the model defined in [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] 2.0. Concepts from the model fall into three categories:</p><ul>
<li>The <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-85">Opportunity</a>, and all types used within it, are defined entirely in [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] and not within this specification. This is covered in below in <a href="#opportunity-data-extensions">Opportunity data extensions</a>.</li>
<li>The <code>Offer</code> which is defined across both [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] and within this specification. If any conflict exists in the definition of properties and values between this specification and a future version of [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>], the definition in this specification <em class="rfc2119">MUST</em> take precedent.</li>
<li>For all other types defined in both specifications, the conformance criteria in this specification <em class="rfc2119">MUST</em> take precedent, and any conformance criteria in [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] related to such types <em class="rfc2119">MUST</em> be ignored.</li>
</ul><section id="opportunity-data-extensions"><h5 id="x11-2-2-1-opportunity-data-extensions"><bdi class="secno">11.2.2.1 </bdi>Opportunity data extensions<a class="self-link" aria-label="§" href="#opportunity-data-extensions"></a></h5><p>Within the scope of the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-86">Opportunity</a> (<code>orderedItem</code>) and <code>Offer</code> (<code>acceptedOffer</code>), the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-279">Booking System</a> <em class="rfc2119">MAY</em> include additional properties, where such properties are either:</p><ul>
<li>Specified in future minor versions of the [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] 2.x (where x &gt; 0).</li>
<li>Defined in custom vocabularies as described in [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] 2.0 Section 5.13.3, including the [<cite><a class="bibref" data-link-type="biblio" href="#bib-openactive-beta-namespace" title="OpenActive Beta Namespace">OpenActive-Beta-Namespace</a></cite>].</li>
</ul><p>Within the scope of the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-87">Opportunity</a> (<code>orderedItem</code>), the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-280">Booking System</a> <em class="rfc2119">MAY</em> include additional properties, where such properties are:</p><ul>
<li>Defined in Schema.org as described in [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] 2.0 Section 5.13.2.</li>
</ul><p>To ensure backward compatibility, within the scope of the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-88">Opportunity</a> (<code>orderedItem</code>) and <code>Offer</code> (<code>acceptedOffer</code>), the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-281">Booking System</a> <em class="rfc2119">MUST</em>:</p><ul>
<li>Conform to the [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] 2.0 specification by providing <em class="rfc2119">REQUIRED</em> fields, unless otherwise stated in this specification.</li>
<li>Provide any data that is vital for the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-252">Customer</a> to make an informed decision about the product they are purchasing (such as important restrictions on purchase), using properties specified within this specification and [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] 2.0, and hence not rely on additional properties.</li>
</ul><p>A <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-338">Broker</a> <em class="rfc2119">MUST</em> ensure that any values of properties found in the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-89">Opportunity</a> (<code>orderedItem</code>) and <code>Offer</code> (<code>acceptedOffer</code>), that are defined within this specification and [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] 2.0, and that are vital for the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-253">Customer</a> to make an informed decision about the product they are purchasing, are communicated to the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-254">Customer</a>. A <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-339">Broker</a> <em class="rfc2119">MAY</em>, at its discretion, also choose to communicate the value of additional properties.</p></section><section id="booking-functionality-extensions"><h5 id="x11-2-2-2-booking-functionality-extensions"><bdi class="secno">11.2.2.2 </bdi>Booking functionality extensions<a class="self-link" aria-label="§" href="#booking-functionality-extensions"></a></h5><p>Any extension to the functionality of this specification <em class="rfc2119">MUST NOT</em> be inferred from additional properties included in future minor versions of the [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] specification. Given the scope of the [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] specification, such additional properties will serve simply to provide greater expressivity to the <a href="#dfn-opportunity" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-opportunity-90">Opportunities</a> and <code>Offer</code>s the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-255">Customer</a> is selecting. Functional extensions to the booking process itself fall properly within the scope of Open Booking API specification, and hence should be integrated with future versions of this specification.</p><p>The [<cite><a class="bibref" data-link-type="biblio" href="#bib-openactive-beta-namespace" title="OpenActive Beta Namespace">OpenActive-Beta-Namespace</a></cite>] and properties in custom namespaces (as described in the [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] specification) <em class="rfc2119">MAY</em> be used to extend and experiment with new functionality for future inclusion in <em>this</em> specification. However all functionality <em class="rfc2119">MUST</em> work as described in this specification should these extensions be completely ignored by either the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-340">Broker</a>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-282">Booking System</a> or both. </p></section></section><section id="general-extension-mechanism"><h4 id="x11-2-3-general-extension-mechanism"><bdi class="secno">11.2.3 </bdi>General extension mechanism<a class="self-link" aria-label="§" href="#general-extension-mechanism"></a></h4><p>Additional <em class="rfc2119">OPTIONAL</em> extension terms (including properties, classes and enumerations) <em class="rfc2119">MAY</em> be included in any request and response defined within this specification using a custom namespace (as specified in the [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] specification), and the presence and values of such extension terms <em class="rfc2119">MAY</em> alter the behaviour of the API.</p><p>An API implementing this specification <em class="rfc2119">MAY</em> also choose to define additional extension endpoints, which <em class="rfc2119">MUST</em> accept and require a different media type to that defined in this specification.</p><p>To ensure full compatibility with this specification, use of such extension terms and extension endpoints <em class="rfc2119">MUST NOT</em> be required as part of the operations defined in this specification, and the API <em class="rfc2119">MUST</em> function in complete conformity with this specification when such extension terms and extension endpoints are omitted or ignored.</p><p>Any extension terms and extension endpoints defined for an API implementation <em class="rfc2119">MUST</em> be fully documented, in order to ensure that the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-126">Seller</a> has a complete view of the functionality it is exposing to the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-341">Broker</a>.</p><section id="extension-example-member-booking"><h5 id="x11-2-3-1-extension-example-member-booking"><bdi class="secno">11.2.3.1 </bdi>Extension example: Member booking<a class="self-link" aria-label="§" href="#extension-example-member-booking"></a></h5><p>The example below demonstrates hypothetical extension terms defined in <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-92"><b>B</b></a> to allow for existing registered members to book without supplying customer details or payment details, using the custom <code>"acme"</code> namespace and associated context.</p><div class="example" id="example-57-extension-example-member-booking">
        <div class="marker">
    <a class="self-link" href="#example-57-extension-example-member-booking">Example<bdi> 57</bdi></a><span class="example-title">: Extension Example: Member booking</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/api/orders/e11429ea-467f-4270-ab62-e47368996fe8</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>example.com
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: [
    <span class="hljs-string">"https://openactive.io/"</span>,
    <span class="hljs-string">"https://acmesystem.example.com/api/context.jsonld"</span>
  ],
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Order"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/NoBroker"</span>,
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"acme:Member"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"MLD23947233"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: [
    {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
      <span class="hljs-attr">"position"</span>: <span class="hljs-number">0</span>,
      <span class="hljs-attr">"acceptedOffer"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Offer"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>
      },
      <span class="hljs-attr">"orderedItem"</span>: {
        <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
        <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>
      }
    }
  ],
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"payment"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"acme:StoredPaymentMethod"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-number">93482</span>
  }
}</span></code></pre>
      </div></section><section id="extension-example-additional-information-during-the-ordering-process"><h5 id="x11-2-3-2-extension-example-additional-information-during-the-ordering-process"><bdi class="secno">11.2.3.2 </bdi>Extension example: Additional information during the ordering process<a class="self-link" aria-label="§" href="#extension-example-additional-information-during-the-ordering-process"></a></h5><p>The example below demonstrates hypothetical extension terms defined in <a href="#dfn-b" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-b-93"><b>B</b></a> that adds additional <em class="rfc2119">OPTIONAL</em> properties to help track a bespoke agreement, using the custom <code>"acme"</code> namespace and associated context.</p><div class="example" id="example-58-extension-example-bespoke-agreement-data">
        <div class="marker">
    <a class="self-link" href="#example-58-extension-example-bespoke-agreement-data">Example<bdi> 58</bdi></a><span class="example-title">: Extension Example: Bespoke agreement data</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">PUT</span> <span class="hljs-string">/api/orders/e11429ea-467f-4270-ab62-e47368996fe8</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>example.com
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: [
    <span class="hljs-string">"https://openactive.io/"</span>,
    <span class="hljs-string">"https://acmesystem.example.com/api/context.jsonld"</span>
  ],
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Order"</span>,
  <span class="hljs-attr">"brokerRole"</span>: <span class="hljs-string">"https://openactive.io/AgentBroker"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"seller"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/api/organisations/123"</span>
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  },
  <span class="hljs-attr">"orderedItem"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"OrderItem"</span>,
    <span class="hljs-attr">"acceptedOffer"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Offer"</span>,
      <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452#/offers/878"</span>
    },
    <span class="hljs-attr">"orderedItem"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ScheduledSession"</span>,
      <span class="hljs-attr">"@id"</span>: <span class="hljs-string">"https://example.com/events/452/subEvents/132"</span>
    },
    <span class="hljs-attr">"acme:agreement"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"acme:ContractAgreement"</span>,
      <span class="hljs-attr">"acme:multiple"</span>: <span class="hljs-number">3</span>,
      <span class="hljs-attr">"acme:commissionCategory"</span>: <span class="hljs-string">"https://acmesystem.example.com/ns/BandA"</span>
    }
  },
  <span class="hljs-attr">"totalPaymentDue"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PriceSpecification"</span>,
    <span class="hljs-attr">"price"</span>: <span class="hljs-number">5</span>,
    <span class="hljs-attr">"priceCurrency"</span>: <span class="hljs-string">"GBP"</span>
  },
  <span class="hljs-attr">"payment"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Payment"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"AcmeBroker Points"</span>,
    <span class="hljs-attr">"identifier"</span>: <span class="hljs-string">"1234567890npduy2f"</span>
  }
}</span></code></pre>
      </div></section><section id="extension-example-integrated-payments"><h5 id="x11-2-3-3-extension-example-integrated-payments"><bdi class="secno">11.2.3.3 </bdi>Extension example: Integrated Payments<a class="self-link" aria-label="§" href="#extension-example-integrated-payments"></a></h5><p>In some limited circumstances it might also be desirable for an Open Booking API to act as a facade over a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-283">Booking System</a>, <a href="#dfn-payment-provider" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-payment-provider-35">Payment Provider</a>, and Invoicing systems. For these circumstances the <code>Payment</code> type may be subclassed to facilitate full payment, using a custom namespace and associated context.</p><div class="example" id="example-59-extension-example-integrated-payments">
        <div class="marker">
    <a class="self-link" href="#example-59-extension-example-integrated-payments">Example<bdi> 59</bdi></a><span class="example-title">: Extension Example: Integrated Payments</span>
  </div> <pre aria-busy="false"><code class="hljs css">"payment": {
  <span class="hljs-string">"@type"</span>: <span class="hljs-string">"acme:IntegratedPayment"</span>,
  <span class="hljs-string">"identifier"</span>: <span class="hljs-string">"12345678ABCD"</span>,
  <span class="hljs-string">"paymentMethod"</span>: <span class="hljs-string">"acme:StripePayment"</span>,
  <span class="hljs-string">"acme:token"</span>: <span class="hljs-string">"tok_KPte7942xySKBKyrBu11yEpf"</span>
},</code></pre>
      </div><p>Note that due to the variety of business models available in the OpenActive ecosystem, conformance to this specification requires that the use of any native payment functionality in the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-284">Booking System</a> be <em class="rfc2119">OPTIONAL</em>.</p></section><section id="extension-example-waiting-list-endpoint"><h5 id="x11-2-3-4-extension-example-waiting-list-endpoint"><bdi class="secno">11.2.3.4 </bdi>Extension example: Waiting list endpoint<a class="self-link" aria-label="§" href="#extension-example-waiting-list-endpoint"></a></h5><p>The example below demonstrates a hypothetical extension endpoint to support waiting list registration.</p><div class="example" id="example-60-extension-example-waiting-list-endpoint">
        <div class="marker">
    <a class="self-link" href="#example-60-extension-example-waiting-list-endpoint">Example<bdi> 60</bdi></a><span class="example-title">: Extension Example: Waiting List Endpoint</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-keyword">POST</span> <span class="hljs-string">/api/sessions/{session-id}/waiting-list</span> <span class="hljs-meta">HTTP/1.1</span>
<span class="hljs-attribute">Host</span><span class="hljs-punctuation">: </span>example.com
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:35 GMT
<span class="hljs-attribute">Accept</span><span class="hljs-punctuation">: </span>application/vnd.acmesystem.booking+json; version=0.3

<span class="json">{
  <span class="hljs-attr">"@context"</span>: [
    <span class="hljs-string">"https://openactive.io/"</span>,
    <span class="hljs-string">"https://acmesystem.example.com/api/context.jsonld"</span>
  ],
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"acme:WaitingListEntry"</span>,
  <span class="hljs-attr">"broker"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Organization"</span>,
    <span class="hljs-attr">"name"</span>: <span class="hljs-string">"MyFitnessApp"</span>,
    <span class="hljs-attr">"url"</span>: <span class="hljs-string">"https://myfitnessapp.example.com"</span>,
    <span class="hljs-attr">"description"</span>: <span class="hljs-string">"A fitness app for all the community"</span>,
    <span class="hljs-attr">"logo"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"ImageObject"</span>,
      <span class="hljs-attr">"url"</span>: <span class="hljs-string">"http://data.myfitnessapp.org.uk/images/logo.png"</span>
    },
    <span class="hljs-attr">"address"</span>: {
      <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"PostalAddress"</span>,
      <span class="hljs-attr">"streetAddress"</span>: <span class="hljs-string">"Alan Peacock Way"</span>,
      <span class="hljs-attr">"addressLocality"</span>: <span class="hljs-string">"Village East"</span>,
      <span class="hljs-attr">"addressRegion"</span>: <span class="hljs-string">"Middlesbrough"</span>,
      <span class="hljs-attr">"postalCode"</span>: <span class="hljs-string">"TS4 3AE"</span>,
      <span class="hljs-attr">"addressCountry"</span>: <span class="hljs-string">"GB"</span>
    }
  },
  <span class="hljs-attr">"customer"</span>: {
    <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"Person"</span>,
    <span class="hljs-attr">"email"</span>: <span class="hljs-string">"geoffcapes@example.com"</span>,
    <span class="hljs-attr">"telephone"</span>: <span class="hljs-string">"020 811 8055"</span>,
    <span class="hljs-attr">"givenName"</span>: <span class="hljs-string">"Geoff"</span>,
    <span class="hljs-attr">"familyName"</span>: <span class="hljs-string">"Capes"</span>
  }
}</span></code></pre>
      </div></section></section></section><section id="response-formats"><h3 id="x11-3-response-formats"><bdi class="secno">11.3 </bdi>Response formats<a class="self-link" aria-label="§" href="#response-formats"></a></h3><p>Requests and response documents exchanged via this API will all be valid
[<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>] documents, with the exception of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-105">Orders feed</a>, where only documents
included in the <code>data</code> property are valid [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>].</p><p>The [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>] documents <em class="rfc2119">MUST</em> include a [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>] <code>context</code> that refers
to the [<cite><a class="bibref" data-link-type="biblio" href="#bib-openactive-vocabulary" title="OpenActive Vocabulary">OpenActive-Vocabulary</a></cite>] as follows:</p><div class="example" id="example-61-minimal-json-ld-document">
        <div class="marker">
    <a class="self-link" href="#example-61-minimal-json-ld-document">Example<bdi> 61</bdi></a><span class="example-title">: minimal JSON-LD document</span>
  </div> <pre aria-busy="false"><code class="hljs json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>
}</code></pre>
      </div><p>Unless otherwise specified the request and response documents <em class="rfc2119">MUST</em> conform to
the [<cite><a class="bibref" data-link-type="biblio" href="#bib-modelling-opportunity-data" title="Modelling Opportunity Data">Modelling-Opportunity-Data</a></cite>] data model.</p><section id="globally-unique-identifiers"><h4 id="x11-3-1-globally-unique-identifiers"><bdi class="secno">11.3.1 </bdi>Globally unique identifiers<a class="self-link" aria-label="§" href="#globally-unique-identifiers"></a></h4><p><dfn id="dfn-id"><code>@id</code></dfn> properties are used as identifiers throughout this specification, for compatibility with [<cite><a class="bibref" data-link-type="biblio" href="#bib-json-ld" title="JSON-LD 1.0">JSON-LD</a></cite>]. The value of such a property <em class="rfc2119">MUST</em> always be an absolute URI that provides a stable globally unique identifier for the resource, as described in [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc3986" title="Uniform Resource Identifier (URI): Generic Syntax">RFC3986</a></cite>].</p><p>The primary purpose of the URI format in this context is to provide natural namespacing for the identifier. Hence, the URI itself <em class="rfc2119">MAY</em> not resolve to a valid endpoint (unless otherwise specified), but <em class="rfc2119">MUST</em> use a domain name controlled by the resource owner. In all cases where <a href="#dfn-id" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-40"><code><code>@id</code></code></a> is referenced in this specification, the resource owner is the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-285">Booking System</a>.</p></section></section><section id="errors"><h3 id="x11-4-errors"><bdi class="secno">11.4 </bdi>Errors<a class="self-link" aria-label="§" href="#errors"></a></h3><p>Error responses <em class="rfc2119">MUST</em> be served using an appropriate HTTP 4XX status code or HTTP 5XX status code specified in the model.</p><p>All error responses from this API <em class="rfc2119">MUST</em> be returned in a JSON-LD format subclass of the <code>OpenBookingError</code> using a content type of <code>application/vnd.openactive.booking+json; version=1</code>.</p><div class="example" id="example-62-error-response-example">
        <div class="marker">
    <a class="self-link" href="#example-62-error-response-example">Example<bdi> 62</bdi></a><span class="example-title">: Error response example</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">400</span> Bad Request
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"IncompleteCustomerDetailsError"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"No customer details supplied"</span>
}</span></code></pre>
      </div></section><section id="rate-limiting"><h3 id="x11-5-rate-limiting"><bdi class="secno">11.5 </bdi>Rate Limiting<a class="self-link" aria-label="§" href="#rate-limiting"></a></h3><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-286">Booking System</a> <em class="rfc2119">MAY</em> choose to apply rate limiting for each unique set of <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-3">Authentication Credentials</a>. In such circumstances where a request is rate limited, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-287">Booking System</a> <em class="rfc2119">MUST</em> return a response with status code 429.</p><p>To allow for a broad range of API management solutions to be used, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-342">Broker</a> <em class="rfc2119">MUST</em> rely only on the status code 429 when detecting and retrying a rate-limited request, as specified elsewhere in this specification. The following guidance is included to encourage convergence in implementations where possible. </p><p>All rate-limited responses from this API <em class="rfc2119">SHOULD</em> return a JSON-LD format <code>TooManyRequestsError</code> object using a content type of <code>application/vnd.openactive.booking+json; version=1</code> with status code 429.</p><p>The response <em class="rfc2119">SHOULD</em> also include the <code>Retry-After</code> HTTP Header with a value set to the number of seconds after which the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-343">Broker</a> <em class="rfc2119">SHOULD</em> retry as per [<cite><a class="bibref" data-link-type="biblio" href="#bib-rfc2616" title="Hypertext Transfer Protocol -- HTTP/1.1">RFC2616</a></cite>] section 14.37. </p><div class="example" id="example-63-rate-limited-response-example">
        <div class="marker">
    <a class="self-link" href="#example-63-rate-limited-response-example">Example<bdi> 63</bdi></a><span class="example-title">: Rate limited response example</span>
  </div> <pre aria-busy="false"><code class="hljs http"><span class="hljs-meta">HTTP/1.1</span> <span class="hljs-number">429</span> Too Many Requests
<span class="hljs-attribute">Date</span><span class="hljs-punctuation">: </span>Mon, 8 Oct 2018 20:52:36 GMT
<span class="hljs-attribute">Content-Type</span><span class="hljs-punctuation">: </span>application/vnd.openactive.booking+json; version=1
<span class="hljs-attribute">Retry-After</span><span class="hljs-punctuation">: </span>8

<span class="json">{
  <span class="hljs-attr">"@context"</span>: <span class="hljs-string">"https://openactive.io/"</span>,
  <span class="hljs-attr">"@type"</span>: <span class="hljs-string">"TooManyRequestsError"</span>,
  <span class="hljs-attr">"description"</span>: <span class="hljs-string">"Rate Limit Reached. Retry in 8 seconds."</span>
}</span></code></pre>
      </div></section><section id="security"><h3 id="x11-6-security"><bdi class="secno">11.6 </bdi>Security<a class="self-link" aria-label="§" href="#security"></a></h3><p>Although this specification does not mandate a specific means of securing an API, it does mandate that at a minimum all HTTP requests and responses <em class="rfc2119">MUST</em> be secured using SSL.</p></section><section id="authentication"><h3 id="x11-7-authentication"><bdi class="secno">11.7 </bdi>Authentication<a class="self-link" aria-label="§" href="#authentication"></a></h3><p>All of the API transactions described in this document <em class="rfc2119">MUST</em> require authentication.</p><p><dfn data-plurals="authentication credential" id="dfn-authentication-credentials">Authentication Credentials</dfn> to facilitate access to the Open Booking API on behalf of multiple <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-344">Brokers</a> are uniquely and securely provisioned to the authenticating party by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-288">Booking System</a>.</p><p>The term <dfn data-plurals="booking partners" id="dfn-booking-partner">Booking Partner</dfn> is used to refer to the authenticating party represented by the <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-4">Authentication Credentials</a>, which is distinct from the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-345">Broker</a> represented by the <code>broker</code> property. The <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-3">Booking Partner</a> may be a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-346">Broker</a>, or a <a href="#dfn-middleware" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-middleware-1">Middleware</a>, or any other authenticating party (including the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-127">Seller</a> if <code>brokerRole</code> is set to <code>NoBroker</code>).</p><p><a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-5">Authentication Credentials</a> also grant granular authorisation for the specific <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-4">Booking Partner</a> to access all <a href="#endpoints">endpoints</a> on behalf of explicitly consenting <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-128">Sellers</a>; with the exception of the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-106">Orders feed</a>, which does not require granular authorisation. Access to a single <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-107">Orders feed</a> containing data items relating to all authorised <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-129">Sellers</a> of the <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-5">Booking Partner</a> <em class="rfc2119">MUST</em> be available via their <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-6">Authentication Credentials</a>, and such data items <em class="rfc2119">MUST</em> be marked as [<cite><a class="bibref" data-link-type="biblio" href="#bib-rpde" title="Realtime Paged Data Exchange">RPDE</a></cite>] <code>"state": "deleted"</code> when such authorisation is revoked.</p><p><a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-7">Authentication Credentials</a> <em class="rfc2119">MUST</em> be capable of being reprovisioned (e.g. a new [<cite><a class="bibref" data-link-type="biblio" href="#bib-oauth2" title="OAuth 2.0">OAuth2</a></cite>] Client Secret generated) without losing any association to their related <code>Order</code> data.</p><section id="api-level-authentication-and-data-security"><h4 id="x11-7-1-api-level-authentication-and-data-security"><bdi class="secno">11.7.1 </bdi>API level authentication and data security<a class="self-link" aria-label="§" href="#api-level-authentication-and-data-security"></a></h4><p>The content and data available to all endpoints provided by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-289">Booking System</a> <em class="rfc2119">MUST</em> be specific to the <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-8">Authentication Credentials</a> in order to ensure that bookings are secure. It is the responsibility of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-290">Booking System</a> to ensure that only the <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-9">Authentication Credentials</a> responsible for creating an <code>Order</code> (including any of its subclasses) can subsequently access, amend, or cancel that <code>Order</code>; and only do so if the associated <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-130">Seller</a>'s authorisation for that <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-6">Booking Partner</a> is still active.</p><p>For security, <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-58">Order UUID</a>s <em class="rfc2119">MUST</em> only be considered unique within a given set of <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-10">Authentication Credentials</a>. It <em class="rfc2119">MUST</em> be possible for two different <code>Order</code>s that are created via two different <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-11">Authentication Credentials</a> to exist with the same <a href="#dfn-order-uuid" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-order-uuid-59">Order UUID</a>.</p><p>This specification does not mandate a particular authentication method, but its recommendation is that implementers should consider using [<cite><a class="bibref" data-link-type="biblio" href="#bib-oauth2" title="OAuth 2.0">OAuth2</a></cite>] as it is well-defined, widely supported and can be used in a variety of different application flows (e.g. via a JavaScript web application or between servers). For <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-291">Booking Systems</a> that support multiple <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-131">Sellers</a>, OpenID Connect ([<cite><a class="bibref" data-link-type="biblio" href="#bib-openidconnect" title="OpenID Connect">OpenIdConnect</a></cite>]) is recommended in addition to this for the <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-7">Booking Partner</a> to access a particular <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-132">Seller</a>.</p><p>Other server-to-server authentication mechanisms such as basic authentication, API key or bearer token-based mechanisms are also appropriate.</p></section><section id="middleware-as-a-catalyst"><h4 id="x11-7-2-middleware-as-a-catalyst"><bdi class="secno">11.7.2 </bdi>Middleware as a catalyst<a class="self-link" aria-label="§" href="#middleware-as-a-catalyst"></a></h4><p>This specification permits trusted <dfn id="dfn-middleware">Middleware</dfn> to use a single set of <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-12">Authentication Credentials</a> to interact with the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-292">Booking System</a> for their authorised <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-133">Sellers</a> on behalf of multiple <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-347">Brokers</a>. This lowers the barrier to entry for the creation of new <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-348">Brokers</a> that might otherwise need to establish <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-13">Authentication Credentials</a> and/or relationships with a large number of <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-134">Sellers</a>.</p><figure id="fig-authentication-credentials-may-facilitate-access-to-the-booking-system-directly-broker-or-indirectly-middleware-for-a-specific-seller">
 <img src="authentication-credentials.png" alt="Authentication Credentials and Middleware" height="430" width="705">
 <figcaption>Figure <bdi class="figno">17</bdi> <span class="fig-title">Authentication Credentials may facilitate access to the Booking System directly (Broker) or indirectly (Middleware), for a specific Seller</span></figcaption>
</figure><p>The definition of the <a href="#dfn-middleware" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-middleware-2">Middleware</a> role in this specification is intentionally broad: it is simply any party that handles <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-14">Authentication Credentials</a> and lies between one or many public-facing <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-349">Brokers</a> and the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-135">Seller</a>. 'Middleware' thus includes not only dedicated middleware technology companies, but also parent organisations or agencies that manage a number of brands, affiliate platforms, etc.</p><p>This specification thus keeps <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-15">Authentication Credentials</a> separate from the concept of a <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-350">Broker</a> within the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-293">Booking System</a>. While all <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-351">Brokers</a> must be associated with a set of <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-16">Authentication Credentials</a>, note that this is a one-to-many relationship: one set of <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-17">Authentication Credentials</a> <em class="rfc2119">MUST</em> be able be used on behalf of many <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-352">Brokers</a>. The introduction of a new <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-353">Broker</a> (as specified by the <code>broker</code> property) <em class="rfc2119">MUST</em> be possible by simply including the details within the requests of this API, with no additional out-of-band registration required.</p><figure id="fig-data-is-isolated-between-authentication-credentials-with-one-set-of-authentication-credentials-allowing-access-to-many-brokers">
 <img src="authentication-credentials-data-isolation.png" alt="Data Isolation within Authentication Credentials" height="264" width="556">
 <figcaption>Figure <bdi class="figno">18</bdi> <span class="fig-title">Data is isolated between Authentication Credentials, with one set of Authentication Credentials allowing access to many Brokers</span></figcaption>
</figure><p>In terms of implementation, all data partitioning and security <em class="rfc2119">MUST</em> be based on the <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-18">Authentication Credentials</a>; the <code>broker</code> property within the <code>Order</code> is for information only.</p><p>A client using the same <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-19">Authentication Credentials</a> <em class="rfc2119">MUST</em> be able to represent more than one <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-354">Broker</a>, and the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-294">Booking System</a> <em class="rfc2119">MUST</em> make no assumptions regarding which <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-355">Broker</a> is being represented by a particular set of <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-20">Authentication Credentials</a>. For the avoidance of doubt: the same <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-356">Broker</a> accessing a <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-295">Booking System</a> using two sets of <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-21">Authentication Credentials</a> <em class="rfc2119">MUST NOT</em> be able to access <code>Order</code>s created by one set of <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-22">Authentication Credentials</a> when using the other, and is considered as two separate identically-named <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-357">Brokers</a> by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-296">Booking System</a>.</p><p>Note that the <code>broker</code> property in the request body is to help the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-297">Booking System</a> to clarify which <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-358">Broker</a> is making the request and to help them in situations such as <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-256">Customer</a> queries. It is not designed as any part of an authentication which <em class="rfc2119">MUST</em> be performed outside of the JSON body of the request. Authentication tokens <em class="rfc2119">MUST NOT</em> be present within the <code>broker</code> property of the submitted JSON.</p><p>The <code>broker</code> property <em class="rfc2119">MUST</em> contain the details of the actual <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-359">Broker</a> rather than any <a href="#dfn-middleware" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-middleware-3">Middleware</a>.</p><p>Where information regarding the <a href="#dfn-middleware" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-middleware-4">Middleware</a> or any other <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-8">Booking Partner</a> is required for audit, this <em class="rfc2119">SHOULD</em> be captured by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-298">Booking System</a> at the point of provision of <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-23">Authentication Credentials</a>.</p><p>The <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-299">Booking System</a> <em class="rfc2119">MAY</em> choose to produce usage reports against <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-9">Booking Partners</a> via their unique <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-24">Authentication Credentials</a>, as well as against <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-360">Brokers</a> identified by the <code>broker</code> property, to report at different levels of granularity. However <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-300">Booking Systems</a> <em class="rfc2119">MUST NOT</em> produce reconciliation reports based on anything other than the information provided to the <code>Payment</code> object, i.e. there <em class="rfc2119">MUST</em> be no assumed link between the <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-25">Authentication Credentials</a> used for access, the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-361">Broker</a> (<code>broker</code>) data provided for information to the API, and the <code>Payment</code> data detailing the account into which the money is deposited for reconciliation. It <em class="rfc2119">MUST</em> be possible for the same <code>Payment</code> details to be used across multiple <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-26">Authentication Credentials</a> and <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-362">Brokers</a>.</p><p>Any <a href="#dfn-middleware" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-middleware-5">Middleware</a> that conforms with this specification <em class="rfc2119">MUST</em> provide data partitioning and security with respect to <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-363">Broker</a> access, to ensure that <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-364">Brokers</a> only have access to their own data.</p></section><section id="customer-level-authentication"><h4 id="x11-7-3-customer-level-authentication"><bdi class="secno">11.7.3 </bdi>Customer level authentication<a class="self-link" aria-label="§" href="#customer-level-authentication"></a></h4><p>OpenID Connect ([<cite><a class="bibref" data-link-type="biblio" href="#bib-openidconnect" title="OpenID Connect">OpenIdConnect</a></cite>]) is recommended as standard way of verifying the identity of the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-257">Customer</a>.</p><p>One principle relating to authentication and the Booking API is that <code>Order</code>s created by a specific <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-258">Customer</a> <em class="rfc2119">MUST NOT</em> be able to be changed by any other <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-259">Customer</a>. It is the responsibility of the <a href="#dfn-broker" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-broker-365">Broker</a> to ensure that subsequent requests to an <code>Order</code> should only be initiated by the <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-260">Customer</a> which created the <code>Order</code>.</p></section><section id="openid-connect-booking-partner-authentication-for-multiple-seller-systems"><h4 id="x11-7-4-openid-connect-booking-partner-authentication-for-multiple-seller-systems"><bdi class="secno">11.7.4 </bdi>OpenID Connect Booking Partner Authentication for Multiple Seller Systems<a class="self-link" aria-label="§" href="#openid-connect-booking-partner-authentication-for-multiple-seller-systems"></a></h4><p>For <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-301">Booking Systems</a> that support multiple <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-136">Sellers</a>, OpenID Connect ([<cite><a class="bibref" data-link-type="biblio" href="#bib-openidconnect" title="OpenID Connect">OpenIdConnect</a></cite>]) is recommended when providing the <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-10">Booking Partner</a> access to a particular <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-137">Seller</a>.</p><p>In order to support convergence amongst implementations, a number of recommendations are included below, which include recommended terms for names of <a href="#dfn-scope" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-scope-1">Scopes</a> and <a href="#dfn-claims" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-claims-1">Claims</a>.</p><p>This section requires a basic understanding of OpenID Connect.</p><section id="oauth-flows-and-scopes"><h5 id="x11-7-4-1-oauth-flows-and-scopes"><bdi class="secno">11.7.4.1 </bdi>OAuth Flows and Scopes<a class="self-link" aria-label="§" href="#oauth-flows-and-scopes"></a></h5><p>The objective of an OAuth flow is for the <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-11">Booking Partner</a> to acquire an <dfn data-plurals="access tokens" id="dfn-access-token">Access Token</dfn>, which is an <a href="#dfn-authentication-credentials" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authentication-credentials-27">Authentication Credential</a> that provides access to a subset the Open Booking API <a href="#endpoints">endpoints</a> of the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-302">Booking System</a> for a particular <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-138">Seller</a>, or to the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-108">Orders feed</a> for all authorised <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-139">Sellers</a>.</p><p>The <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-12">Booking Partner</a> <em class="rfc2119">SHOULD</em> include the relevant <a href="#dfn-access-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-access-token-1">Access Token</a> in the <code>Authorization</code> header when accessing the Open Booking API endpoints.</p><p>An expiry duration of 15 minutes is <em class="rfc2119">RECOMMENDED</em> for <a href="#dfn-access-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-access-token-2">Access Token</a>, to ensure the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-140">Seller</a> has sufficient control.</p><p>The recommended flows are as following:</p><ul>
<li><p><a href="#dfn-authorization-code-flow" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authorization-code-flow-1">Authorization Code Flow</a> for <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-141">Sellers</a> to approve <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-13">Booking Partners</a> to interact with bookings on their behalf.</p>
</li>
<li><p><a href="#dfn-client-credentials-flow" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-client-credentials-flow-1">Client Credentials Flow</a> to provide access to a single <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-109">Orders feed</a> for all authorised <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-142">Sellers</a>.</p>
</li>
</ul><p>An OAuth <dfn data-plurals="scopes" id="dfn-scope">Scope</dfn> defines access to a set of endpoints, and also expectations about <a href="#dfn-claims" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-claims-2">Claims</a> returned. An <a href="#dfn-access-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-access-token-3">Access Token</a> can be requested that includes a number of scopes, via the relevant OAuth flow.</p><p>The <em class="rfc2119">RECOMMENDED</em> <a href="#dfn-scope" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-scope-2">Scopes</a> and flows are defined in the table below:</p><table>
  <thead>
    <tr>
      <th style="text-align:left">Scope</th>
      <th style="text-align:left">Endpoints</th>
      <th style="text-align:left">OAuth flow used to acquire Access Token</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left"><code>openactive-openbooking</code>
      </td>
      <td style="text-align:left">
        <p>OrderQuote Creation (C1)</p>
        <p>OrderQuote Creation (C2)</p>
        <p>OrderQuote Deletion</p>
        <p>Order Creation (B)</p>
        <p>Order Deletion</p>
        <p>Order Cancellation</p>
        <p>Order Status</p>
      </td>
      <td style="text-align:left"><a href="#dfn-authorization-code-flow" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-authorization-code-flow-2">Authorization Code Flow<p></p></a></td>
    </tr>
    <tr>
      <td style="text-align:left"><code>openactive-ordersfeed</code>
      </td>
      <td style="text-align:left">Orders RPDE Feed</td>
      <td style="text-align:left"><a href="#dfn-client-credentials-flow" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-client-credentials-flow-2">Client Credentials Flow</a>
      </td>
    </tr>
  </tbody>
</table><p>In order to implement functionality to suspend bookings temporarily with a particular <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-143">Seller</a>, the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-303">Booking System</a> <em class="rfc2119">SHOULD</em> temporarily revoke access to the <code>openactive-openbooking</code> scope. The <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-144">Seller</a>'s items <em class="rfc2119">SHOULD</em> still be available in the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-110">Orders Feed</a>, and hence <a href="#dfn-customer" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-customer-261">Customers</a> are still able to receive refunds and notifications, but cannot make new bookings or initiate cancellations.</p><section id="authorization-code-flow"><h6 id="x11-7-4-1-1-authorization-code-flow"><bdi class="secno">11.7.4.1.1 </bdi>Authorization Code Flow<a class="self-link" aria-label="§" href="#authorization-code-flow"></a></h6><p>To access any of the <a href="#endpoints">endpoints</a> defined in this specification other than the <a href="#orders-rpde-feed">Orders RPDE Feed</a>, the <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-14">Booking Partner</a> <em class="rfc2119">SHOULD</em> first acquire a valid <a href="#dfn-access-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-access-token-4">Access Token</a> with an <code>openactive-openbooking</code> <a href="#dfn-scope" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-scope-3">Scope</a>, by having a particular <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-145">Seller</a> complete the <dfn id="dfn-authorization-code-flow">Authorization Code Flow</dfn>.</p><p>This flow presents the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-146">Seller</a> with an authentication and consent prompt, that they will be familiar from websites that offer "Login with my social media account" functionality:</p><figure id="fig-example-authorization-page-for-a-booking-partner-presented-by-a-booking-system">
 <img src="seller-authentication.png" alt="Seller Authentication Page" height="262" width="195">
 <figcaption>Figure <bdi class="figno">19</bdi> <span class="fig-title">Example authorization page for a Booking Partner, presented by a Booking System.</span></figcaption>
</figure><p>A <dfn id="dfn-refresh-token">Refresh Token</dfn> <em class="rfc2119">SHOULD</em> also be also provided during this flow, which allows the <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-15">Booking Partner</a> to request another <a href="#dfn-access-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-access-token-5">Access Token</a> once it has expired, without the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-147">Seller</a> needing to reauthenticate.</p><p>Additionally, a "one-time usage" <dfn data-plurals="id tokens" id="dfn-id-token">ID Token</dfn> <em class="rfc2119">SHOULD</em> be provided during this flow which contains the <code>SellerId</code> and other details of the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-148">Seller</a>. This allows the <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-16">Booking Partner</a> to store the <a href="#dfn-access-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-access-token-6">Access Token</a> and <a href="#dfn-refresh-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-refresh-token-1">Refresh Token</a> against the correct <code>SellerId</code> in their database, so they can use these when booking the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-149">Seller</a>'s opportunities.</p><p>The Authorization Request of this flow <em class="rfc2119">SHOULD</em> include the <code>openactive-openbooking</code>, <code>openid</code>, and <code>offline_access</code> <a href="#dfn-scope" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-scope-4">Scopes</a>, to ensure that an <a href="#dfn-access-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-access-token-7">Access Token</a>, <a href="#dfn-id-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-token-1">ID Token</a> and <a href="#dfn-refresh-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-refresh-token-2">Refresh Token</a> are all returned for the authenticating <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-150">Seller</a>.</p><p>For this flow, it is <em class="rfc2119">RECOMMENDED</em> that the OpenID Connect subject is not the end user who is following the OAuth flow, but is instead the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-151">Seller</a> that they represent - such that if, for example, the end user no longer works for the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-152">Seller</a> and deletes their account, their authentication grants remain unaffected. This recommendation conforms with OpenID Connect from a technical perspective, which is useful when utilising existing libraries.</p><figure id="fig-authorization-code-flow">
 <img src="authorization-code-flow.png" alt="Authorization Code Flow" height="320" width="599">
 <figcaption>Figure <bdi class="figno">20</bdi> <span class="fig-title">Authorization Code Flow</span></figcaption>
</figure></section><section id="client-credentials-flow"><h6 id="x11-7-4-1-2-client-credentials-flow"><bdi class="secno">11.7.4.1.2 </bdi>Client Credentials Flow<a class="self-link" aria-label="§" href="#client-credentials-flow"></a></h6><p>The straightforward <dfn id="dfn-client-credentials-flow">Client Credentials Flow</dfn> <em class="rfc2119">SHOULD</em> be used to retrieve an <a href="#dfn-access-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-access-token-8">Access Token</a> with an <code>openactive-ordersfeed</code> <a href="#dfn-scope" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-scope-5">Scope</a>, which grants access to the <a href="#dfn-orders-feed" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-orders-feed-111">Orders Feed</a> endpoint as above.</p><p>The Authorization Request of the flow <em class="rfc2119">SHOULD</em> include only the <code>openactive-ordersfeed</code> <a href="#dfn-scope" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-scope-6">Scope</a>.</p><figure id="fig-client-credentials-flow">
 <img src="client-credentials-flow.png" alt="Client Credentials Flow" height="207" width="596">
 <figcaption>Figure <bdi class="figno">21</bdi> <span class="fig-title">Client Credentials Flow</span></figcaption>
</figure></section></section><section id="custom-claims"><h5 id="x11-7-4-2-custom-claims"><bdi class="secno">11.7.4.2 </bdi>Custom Claims<a class="self-link" aria-label="§" href="#custom-claims"></a></h5><p><dfn data-plurals="claim" id="dfn-claims">Claims</dfn> are simply key-value pairs that are included in <a href="#dfn-access-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-access-token-9">Access Tokens</a> and <a href="#dfn-id-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-token-2">ID Tokens</a>; each <a href="#dfn-claims" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-claims-3">Claim</a> is "claiming" a fact about the subject (in this case, the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-153">Seller</a>). For example a token may include a "claim" that the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-154">Seller</a> has a name of "Acme Leisure".</p><p>The OpenActive namespace includes a number of terms for use as Custom Claims.</p><section id="id-token-claims"><h6 id="x11-7-4-2-1-id-token-claims"><bdi class="secno">11.7.4.2.1 </bdi>ID Token claims<a class="self-link" aria-label="§" href="#id-token-claims"></a></h6><p>The <a href="#dfn-id-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-token-3">ID Token</a> is designed to be read by the <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-17">Booking Partner</a> to give them information about the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-155">Seller</a> that has just authenticated.  This allows the <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-18">Booking Partner</a> to store the <a href="#dfn-access-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-access-token-10">Access Token</a> and <a href="#dfn-refresh-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-refresh-token-3">Refresh Token</a> against the correct <code>SellerId</code> in their database, so they can use these when booking the <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-156">Seller</a>'s opportunities.</p><p>It is <em class="rfc2119">RECOMMENDED</em> that the <code>openactive-openbooking</code> <a href="#dfn-scope" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-scope-7">Scope</a> includes an implicit request that <a href="#dfn-claims" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-claims-4">Claims</a> listed below are included in the <a href="#dfn-id-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-token-4">ID Token</a>.</p><p>The following custom claims are for use by the <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-19">Booking Partner</a>, and must conform to the custom claim names specified below. The custom claim names are collision-resistant in accordance with <a href="https://openid.net/specs/openid-connect-core-1_0.html#rfc.section.5.1.2">the OIDC specification</a>. </p><table>
<thead>
<tr>
<th align="left">Custom claim</th>
<th align="left">Description</th>
<th align="left">Exactly matches</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>https://openactive.io/sellerName</code></td>
<td align="left">The seller name.</td>
<td align="left"><code>name</code> of  <code>seller</code></td>
</tr>
<tr>
<td align="left"><code>https://openactive.io/sellerLogo</code></td>
<td align="left">A URL of the logo of the Seller.</td>
<td align="left"><code>logo</code> of  <code>seller</code></td>
</tr>
<tr>
<td align="left"><code>https://openactive.io/sellerUrl</code></td>
<td align="left">The URL of the website of the Seller.</td>
<td align="left"><code>url</code> of  <code>seller</code></td>
</tr>
<tr>
<td align="left"><code>https://openactive.io/sellerId</code></td>
<td align="left">The Seller ID as a JSON-LD ID. Also allows for compatibility with existing authentication implementations which might be using "sub" to include a different identifier. Booking partners will use this to determine which Seller ID the provided accessToken is intended for.</td>
<td align="left"><code>id</code> of  <code>seller</code></td>
</tr>
<tr>
<td align="left"><code>https://openactive.io/bookingServiceName</code></td>
<td align="left">The <code>name</code> of the Booking System</td>
<td align="left"><code>name</code> of  <code>bookingService</code></td>
</tr>
<tr>
<td align="left"><code>https://openactive.io/bookingServiceUrl</code></td>
<td align="left">The <code>url</code> of the website of the Booking System</td>
<td align="left"><code>url</code> of  <code>bookingService</code></td>
</tr>
</tbody></table></section><section id="access-token-claims"><h6 id="x11-7-4-2-2-access-token-claims"><bdi class="secno">11.7.4.2.2 </bdi>Access Token claims<a class="self-link" aria-label="§" href="#access-token-claims"></a></h6><p>To help simplify the implementation, it is recommended that <a href="#dfn-access-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-access-token-11">Access Tokens</a> include the following custom claims.</p><p>The <a href="#dfn-access-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-access-token-12">Access Token</a> is only read internally by the <a href="#dfn-booking-system" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-system-304">Booking System</a>, and so these claims are simply a recommendation. Hence the claim names do not need to be standardised as long as they are internally consistent.</p><table>
  <thead>
    <tr>
      <th style="text-align:left">Custom claim</th>
      <th style="text-align:left">Description</th>
      <th style="text-align:left">Scopes</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align:left"><code>https://openactive.io/clientId</code>
      </td>
      <td style="text-align:left">The <a href="#dfn-booking-partner" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-booking-partner-20">Booking Partner</a> Client ID that requested
        the <a href="#dfn-access-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-access-token-13">Access Token</a>. Note that this claim is due to be featured in a <a href="https://tools.ietf.org/html/draft-ietf-oauth-token-exchange-19#section-4.3">future OAuth 2.0 specification</a>, and it is <em class="rfc2119">RECOMMENDED</em> that the newly specified claim is used in preference to this one, once ratified.</td>
      <td style="text-align:left">
        <p><code>openactive-openbooking</code> and <code>openactive-ordersfeed</code>
        </p>
        </td>
    </tr>
    <tr>
      <td style="text-align:left"><code>https://openactive.io/sellerId</code>
      </td>
      <td style="text-align:left">Seller ID as a JSON-LD ID, which is useful to be provided
        to Open Booking API endpoints to determine which <a href="#dfn-seller" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-seller-157">Seller</a> the <a href="#dfn-access-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-access-token-14">Access Token</a> is intended
        for. It is consistent with the claim name used in the <a href="#dfn-id-token" class="internalDFN" data-link-type="dfn" id="ref-for-dfn-id-token-5">ID Token</a>.</td>
      <td style="text-align:left"><code>openactive-openbooking</code>
        </td>
    </tr>
  </tbody>
</table></section></section></section></section></section><section class="normative" id="future-versions-of-this-api"><h2 id="x12-future-versions-of-this-api"><bdi class="secno">12. </bdi>Future versions of this API<a class="self-link" aria-label="§" href="#future-versions-of-this-api"></a></h2><p>Future iterations of the specification be shaped by the OpenActive community, and we encourage you to get involved.</p></section><section class="appendix informative" id="acknowledgements"><h2 id="a-acknowledgements"><bdi class="secno">A. </bdi>Acknowledgements<a class="self-link" aria-label="§" href="#acknowledgements"></a></h2><p><em>This section is non-normative.</em></p><p>The editors thank <a href="https://www.w3.org/community/openactive/participants">all members</a> of the OpenActive Community Group for their contributions.</p><p>Icons made by Freepik, Darius Dan, Eucalyp, smalllikeart, bqlqn, Maxim Basinski from <a href="https://www.flaticon.com">www.flaticon.com</a>.</p></section><section id="references" class="appendix"><h2 id="b-references"><bdi class="secno">B. </bdi>References<a class="self-link" aria-label="§" href="#references"></a></h2><section id="normative-references">
    <h3 id="b-1-normative-references"><bdi class="secno">B.1 </bdi>Normative references<a class="self-link" aria-label="§" href="#normative-references"></a></h3>
    <dl class="bibliography"><dt id="bib-dataset-api-discovery">[Dataset-API-Discovery]</dt><dd><a href="https://www.openactive.io/dataset-api-discovery/EditorsDraft/"><cite>Dataset API Discovery</cite></a>.  OpenActive Community Group. URL: <a href="https://www.openactive.io/dataset-api-discovery/EditorsDraft/">https://www.openactive.io/dataset-api-discovery/EditorsDraft/</a></dd><dt id="bib-json-ld">[JSON-LD]</dt><dd><a href="https://www.w3.org/TR/json-ld/"><cite>JSON-LD 1.0</cite></a>.  W3C. W3C Recommendation. URL: <a href="https://www.w3.org/TR/json-ld/">https://www.w3.org/TR/json-ld/</a></dd><dt id="bib-modelling-opportunity-data">[Modelling-Opportunity-Data]</dt><dd><a href="https://www.openactive.io/modelling-opportunity-data/"><cite>Modelling Opportunity Data</cite></a>.  OpenActive Community Group. URL: <a href="https://www.openactive.io/modelling-opportunity-data/">https://www.openactive.io/modelling-opportunity-data/</a></dd><dt id="bib-oauth2">[OAuth2]</dt><dd><a href="https://oauth.net/2/"><cite>OAuth 2.0</cite></a>. URL: <a href="https://oauth.net/2/">https://oauth.net/2/</a></dd><dt id="bib-openactive-beta-namespace">[OpenActive-Beta-Namespace]</dt><dd><a href="https://www.openactive.io/ns-beta/"><cite>OpenActive Beta Namespace</cite></a>.  OpenActive Community Group. URL: <a href="https://www.openactive.io/ns-beta/">https://www.openactive.io/ns-beta/</a></dd><dt id="bib-openactive-vocabulary">[OpenActive-Vocabulary]</dt><dd><a href="https://www.openactive.io/ns/"><cite>OpenActive Vocabulary</cite></a>.  OpenActive Community Group. URL: <a href="https://www.openactive.io/ns/">https://www.openactive.io/ns/</a></dd><dt id="bib-openidconnect">[OpenIdConnect]</dt><dd><a href="https://openid.net/connect/"><cite>OpenID Connect</cite></a>. URL: <a href="https://openid.net/connect/">https://openid.net/connect/</a></dd><dt id="bib-rfc2119">[RFC2119]</dt><dd><a href="https://tools.ietf.org/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. S. Bradner.  IETF. March 1997. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc2119">https://tools.ietf.org/html/rfc2119</a></dd><dt id="bib-rfc2616">[RFC2616]</dt><dd><a href="https://tools.ietf.org/html/rfc2616"><cite>Hypertext Transfer Protocol -- HTTP/1.1</cite></a>. R. Fielding; J. Gettys; J. Mogul; H. Frystyk; L. Masinter; P. Leach; T. Berners-Lee.  IETF. June 1999. Draft Standard. URL: <a href="https://tools.ietf.org/html/rfc2616">https://tools.ietf.org/html/rfc2616</a></dd><dt id="bib-rfc3986">[RFC3986]</dt><dd><a href="https://tools.ietf.org/html/rfc3986"><cite>Uniform Resource Identifier (URI): Generic Syntax</cite></a>. T. Berners-Lee; R. Fielding; L. Masinter.  IETF. January 2005. Internet Standard. URL: <a href="https://tools.ietf.org/html/rfc3986">https://tools.ietf.org/html/rfc3986</a></dd><dt id="bib-rfc4122">[RFC4122]</dt><dd><a href="https://tools.ietf.org/html/rfc4122"><cite>A Universally Unique IDentifier (UUID) URN Namespace</cite></a>. P. Leach; M. Mealling; R. Salz.  IETF. July 2005. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc4122">https://tools.ietf.org/html/rfc4122</a></dd><dt id="bib-rfc7807">[RFC7807]</dt><dd><a href="https://tools.ietf.org/html/rfc7807"><cite>Problem Details for HTTP APIs</cite></a>. M. Nottingham; E. Wilde.  IETF. March 2016. Proposed Standard. URL: <a href="https://tools.ietf.org/html/rfc7807">https://tools.ietf.org/html/rfc7807</a></dd><dt id="bib-rfc8174">[RFC8174]</dt><dd><a href="https://tools.ietf.org/html/rfc8174"><cite>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</cite></a>. B. Leiba.  IETF. May 2017. Best Current Practice. URL: <a href="https://tools.ietf.org/html/rfc8174">https://tools.ietf.org/html/rfc8174</a></dd><dt id="bib-rpde">[RPDE]</dt><dd><a href="https://www.openactive.io/realtime-paged-data-exchange/"><cite>Realtime Paged Data Exchange</cite></a>.  OpenActive Community Group. URL: <a href="https://www.openactive.io/realtime-paged-data-exchange/">https://www.openactive.io/realtime-paged-data-exchange/</a></dd></dl>
  </section></section><p role="navigation" id="back-to-top">
    <a href="#title"><abbr title="Back to Top">↑</abbr></a>
  </p><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-opportunity">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-opportunity">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-opportunity-1">1. Introduction</a> <a href="#ref-for-dfn-opportunity-2">(2)</a> <a href="#ref-for-dfn-opportunity-3">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-4">1.1.1 Out of Scope in this version</a> <a href="#ref-for-dfn-opportunity-5">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-6">1.1.2 Out of Scope by design</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-7">5.1 Booking flow overview</a> <a href="#ref-for-dfn-opportunity-8">(2)</a> <a href="#ref-for-dfn-opportunity-9">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-10">5.3 Booking pre-conditions</a> <a href="#ref-for-dfn-opportunity-11">(2)</a> <a href="#ref-for-dfn-opportunity-12">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-13">5.4.1 Customer Journey</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-14">5.4.3 Leasing</a> <a href="#ref-for-dfn-opportunity-15">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-16">5.4.6 Step-by-step process description</a> <a href="#ref-for-dfn-opportunity-17">(2)</a> <a href="#ref-for-dfn-opportunity-18">(3)</a> <a href="#ref-for-dfn-opportunity-19">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-20">5.4.8.1 Broker contract with Booking System</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-21">5.5.1 Customer Journey</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-22">5.5.2 High-level API flow</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-23">5.5.3 Proposal Leasing</a> <a href="#ref-for-dfn-opportunity-24">(2)</a> <a href="#ref-for-dfn-opportunity-25">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-26">5.5.6 Step-by-step process description</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-27">6.1.2 Contractual Relationships</a> <a href="#ref-for-dfn-opportunity-28">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-29">7.3.3 DynamicPayment</a> <a href="#ref-for-dfn-opportunity-30">(2)</a> <a href="#ref-for-dfn-opportunity-31">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-32">7.5 Tax mode</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-33">7.6.1 Free opportunities</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-34">7.7 Offer overrides</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-35">8.1 Definition of a 'bookable' Opportunity and Offer pair</a> <a href="#ref-for-dfn-opportunity-36">(2)</a> <a href="#ref-for-dfn-opportunity-37">(3)</a> <a href="#ref-for-dfn-opportunity-38">(4)</a> <a href="#ref-for-dfn-opportunity-39">(5)</a> <a href="#ref-for-dfn-opportunity-40">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-41">8.1.1 Booking restrictions</a> <a href="#ref-for-dfn-opportunity-42">(2)</a> <a href="#ref-for-dfn-opportunity-43">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-44">8.1.2 Opportunity data properties</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-45">8.2 Amending the OrderQuote before B</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-46">8.3.1 Refund after the opportunity has occurred</a> <a href="#ref-for-dfn-opportunity-47">(2)</a> <a href="#ref-for-dfn-opportunity-48">(3)</a> <a href="#ref-for-dfn-opportunity-49">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-50">8.3.2 Customer requested cancellation</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-51">8.4.3.1 totalPaymentDue invariant</a> <a href="#ref-for-dfn-opportunity-52">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-53">8.4.4 Broker: Processing the Orders feed</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-54">8.4.8 Customer notice notifications</a> <a href="#ref-for-dfn-opportunity-55">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-56">8.4.9 Change of logistics notifications</a> <a href="#ref-for-dfn-opportunity-57">(2)</a> <a href="#ref-for-dfn-opportunity-58">(3)</a> <a href="#ref-for-dfn-opportunity-59">(4)</a> <a href="#ref-for-dfn-opportunity-60">(5)</a> <a href="#ref-for-dfn-opportunity-61">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-62">8.4.10 Opportunity attendance updates</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-63">8.4.11 Other notifications</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-64">8.7 Access control</a> <a href="#ref-for-dfn-opportunity-65">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-66">8.7.4 Remote access control</a> <a href="#ref-for-dfn-opportunity-67">(2)</a> <a href="#ref-for-dfn-opportunity-68">(3)</a> <a href="#ref-for-dfn-opportunity-69">(4)</a> <a href="#ref-for-dfn-opportunity-70">(5)</a> <a href="#ref-for-dfn-opportunity-71">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-72">9.2.9 Orders RPDE feed</a> <a href="#ref-for-dfn-opportunity-73">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-74">9.2.10 Order Status</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-75">10.1.6 schema:OrderItem</a> <a href="#ref-for-dfn-opportunity-76">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-77">10.2.2.1 Order Creation - OrderQuote, OrderProposal and Order error responses</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-78">10.2.2.3 Order Creation - OrderItem errors</a> <a href="#ref-for-dfn-opportunity-79">(2)</a> <a href="#ref-for-dfn-opportunity-80">(3)</a> <a href="#ref-for-dfn-opportunity-81">(4)</a> <a href="#ref-for-dfn-opportunity-82">(5)</a> <a href="#ref-for-dfn-opportunity-83">(6)</a> <a href="#ref-for-dfn-opportunity-84">(7)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-85">11.2.2 Modelling Opportunity Data 2.x (where x &gt;= 0)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-86">11.2.2.1 Opportunity data extensions</a> <a href="#ref-for-dfn-opportunity-87">(2)</a> <a href="#ref-for-dfn-opportunity-88">(3)</a> <a href="#ref-for-dfn-opportunity-89">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-90">11.2.2.2 Booking functionality extensions</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-opportunity-data">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-opportunity-data">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-opportunity-data-1">1. Introduction</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-data-2">1.1.2 Out of Scope by design</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-data-3">5.3 Booking pre-conditions</a> <a href="#ref-for-dfn-opportunity-data-4">(2)</a> <a href="#ref-for-dfn-opportunity-data-5">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-data-6">5.4.6 Step-by-step process description</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-data-7">5.4.8.2 Booking System contract with the Broker</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-data-8">7.4.2 Business-to-business tax calculation by Booking System is optional</a> <a href="#ref-for-dfn-opportunity-data-9">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-data-10">7.5 Tax mode</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-data-11">8.1 Definition of a 'bookable' Opportunity and Offer pair</a> <a href="#ref-for-dfn-opportunity-data-12">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-data-13">8.1.2 Opportunity data properties</a> <a href="#ref-for-dfn-opportunity-data-14">(2)</a> <a href="#ref-for-dfn-opportunity-data-15">(3)</a> <a href="#ref-for-dfn-opportunity-data-16">(4)</a> <a href="#ref-for-dfn-opportunity-data-17">(5)</a> <a href="#ref-for-dfn-opportunity-data-18">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-data-19">8.4 Orders feed: Notifications, updates and refunds</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-data-20">8.4.4 Broker: Processing the Orders feed</a> <a href="#ref-for-dfn-opportunity-data-21">(2)</a> <a href="#ref-for-dfn-opportunity-data-22">(3)</a> <a href="#ref-for-dfn-opportunity-data-23">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-data-24">8.4.8 Customer notice notifications</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-data-25">8.4.9 Change of logistics notifications</a> <a href="#ref-for-dfn-opportunity-data-26">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-data-27">10. Model</a> 
  </li><li>
    <a href="#ref-for-dfn-opportunity-data-28">10.1.7 schema:Offer</a> <a href="#ref-for-dfn-opportunity-data-29">(2)</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-customer">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-customer">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-customer-1">1. Introduction</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-2">1.1 Scope and requirements</a> <a href="#ref-for-dfn-customer-3">(2)</a> <a href="#ref-for-dfn-customer-4">(3)</a> <a href="#ref-for-dfn-customer-5">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-6">1.1.1 Out of Scope in this version</a> <a href="#ref-for-dfn-customer-7">(2)</a> <a href="#ref-for-dfn-customer-8">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-9">1.1.2 Out of Scope by design</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-10">4. Key Actors</a> <a href="#ref-for-dfn-customer-11">(2)</a> <a href="#ref-for-dfn-customer-12">(3)</a> <a href="#ref-for-dfn-customer-13">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-14">5.1 Booking flow overview</a> <a href="#ref-for-dfn-customer-15">(2)</a> <a href="#ref-for-dfn-customer-16">(3)</a> <a href="#ref-for-dfn-customer-17">(4)</a> <a href="#ref-for-dfn-customer-18">(5)</a> <a href="#ref-for-dfn-customer-19">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-20">5.3 Booking pre-conditions</a> <a href="#ref-for-dfn-customer-21">(2)</a> <a href="#ref-for-dfn-customer-22">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-23">5.4.1 Customer Journey</a> <a href="#ref-for-dfn-customer-24">(2)</a> <a href="#ref-for-dfn-customer-25">(3)</a> <a href="#ref-for-dfn-customer-26">(4)</a> <a href="#ref-for-dfn-customer-27">(5)</a> <a href="#ref-for-dfn-customer-28">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-29">5.4.2 High-level API flow</a> <a href="#ref-for-dfn-customer-30">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-31">5.4.3 Leasing</a> <a href="#ref-for-dfn-customer-32">(2)</a> <a href="#ref-for-dfn-customer-33">(3)</a> <a href="#ref-for-dfn-customer-34">(4)</a> <a href="#ref-for-dfn-customer-35">(5)</a> <a href="#ref-for-dfn-customer-36">(6)</a> <a href="#ref-for-dfn-customer-37">(7)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-38">5.4.4 High-level type flow</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-39">5.4.5.1 Order statuses in the Booking System</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-40">5.4.6 Step-by-step process description</a> <a href="#ref-for-dfn-customer-41">(2)</a> <a href="#ref-for-dfn-customer-42">(3)</a> <a href="#ref-for-dfn-customer-43">(4)</a> <a href="#ref-for-dfn-customer-44">(5)</a> <a href="#ref-for-dfn-customer-45">(6)</a> <a href="#ref-for-dfn-customer-46">(7)</a> <a href="#ref-for-dfn-customer-47">(8)</a> <a href="#ref-for-dfn-customer-48">(9)</a> <a href="#ref-for-dfn-customer-49">(10)</a> <a href="#ref-for-dfn-customer-50">(11)</a> <a href="#ref-for-dfn-customer-51">(12)</a> <a href="#ref-for-dfn-customer-52">(13)</a> <a href="#ref-for-dfn-customer-53">(14)</a> <a href="#ref-for-dfn-customer-54">(15)</a> <a href="#ref-for-dfn-customer-55">(16)</a> <a href="#ref-for-dfn-customer-56">(17)</a> <a href="#ref-for-dfn-customer-57">(18)</a> <a href="#ref-for-dfn-customer-58">(19)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-59">5.4.7 Booking Flow Rollback</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-60">5.4.7.2 Booking halted at OrderCreationPaymentDue</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-61">5.4.8.1 Broker contract with Booking System</a> <a href="#ref-for-dfn-customer-62">(2)</a> <a href="#ref-for-dfn-customer-63">(3)</a> <a href="#ref-for-dfn-customer-64">(4)</a> <a href="#ref-for-dfn-customer-65">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-66">5.4.8.2 Booking System contract with the Broker</a> <a href="#ref-for-dfn-customer-67">(2)</a> <a href="#ref-for-dfn-customer-68">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-69">5.5.1 Customer Journey</a> <a href="#ref-for-dfn-customer-70">(2)</a> <a href="#ref-for-dfn-customer-71">(3)</a> <a href="#ref-for-dfn-customer-72">(4)</a> <a href="#ref-for-dfn-customer-73">(5)</a> <a href="#ref-for-dfn-customer-74">(6)</a> <a href="#ref-for-dfn-customer-75">(7)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-76">5.5.2 High-level API flow</a> <a href="#ref-for-dfn-customer-77">(2)</a> <a href="#ref-for-dfn-customer-78">(3)</a> <a href="#ref-for-dfn-customer-79">(4)</a> <a href="#ref-for-dfn-customer-80">(5)</a> <a href="#ref-for-dfn-customer-81">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-82">5.5.3 Proposal Leasing</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-83">5.5.5.1 Minimal Proposal Implementation</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-84">5.5.5.1.1 Proposal Approval</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-85">5.5.5.1.2 Proposal Rejection</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-86">5.5.5.2 Proposal Amendment</a> <a href="#ref-for-dfn-customer-87">(2)</a> <a href="#ref-for-dfn-customer-88">(3)</a> <a href="#ref-for-dfn-customer-89">(4)</a> <a href="#ref-for-dfn-customer-90">(5)</a> <a href="#ref-for-dfn-customer-91">(6)</a> <a href="#ref-for-dfn-customer-92">(7)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-93">5.5.5.3 Message Exchange</a> <a href="#ref-for-dfn-customer-94">(2)</a> <a href="#ref-for-dfn-customer-95">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-96">5.5.6 Step-by-step process description</a> <a href="#ref-for-dfn-customer-97">(2)</a> <a href="#ref-for-dfn-customer-98">(3)</a> <a href="#ref-for-dfn-customer-99">(4)</a> <a href="#ref-for-dfn-customer-100">(5)</a> <a href="#ref-for-dfn-customer-101">(6)</a> <a href="#ref-for-dfn-customer-102">(7)</a> <a href="#ref-for-dfn-customer-103">(8)</a> <a href="#ref-for-dfn-customer-104">(9)</a> <a href="#ref-for-dfn-customer-105">(10)</a> <a href="#ref-for-dfn-customer-106">(11)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-107">5.5.7.1 Broker contract with Booking System</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-108">5.6.1 Customer Details capture</a> <a href="#ref-for-dfn-customer-109">(2)</a> <a href="#ref-for-dfn-customer-110">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-111">5.6.2 Attendee Details capture</a> <a href="#ref-for-dfn-customer-112">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-113">5.6.3.4 Form validation and auto-fill</a> <a href="#ref-for-dfn-customer-114">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-115">6. Broker Roles</a> <a href="#ref-for-dfn-customer-116">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-117">6.1.2 Contractual Relationships</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-118">6.1.3 Taxation</a> <a href="#ref-for-dfn-customer-119">(2)</a> <a href="#ref-for-dfn-customer-120">(3)</a> <a href="#ref-for-dfn-customer-121">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-122">6.1.4 Scope of Specification</a> <a href="#ref-for-dfn-customer-123">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-124">6.2.1 Definition</a> <a href="#ref-for-dfn-customer-125">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-126">6.2.2 Contractual Relationships</a> <a href="#ref-for-dfn-customer-127">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-128">6.2.3 Taxation</a> <a href="#ref-for-dfn-customer-129">(2)</a> <a href="#ref-for-dfn-customer-130">(3)</a> <a href="#ref-for-dfn-customer-131">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-132">6.2.4 Scope of Specification</a> <a href="#ref-for-dfn-customer-133">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-134">6.2.6 Informed purchase</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-135">6.3.1 Definition</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-136">6.3.2 Contractual Relationships</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-137">6.3.3 Taxation</a> <a href="#ref-for-dfn-customer-138">(2)</a> <a href="#ref-for-dfn-customer-139">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-140">6.3.4 Scope of Specification</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-141">7.1 Roles and responsibilities overview</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-142">7.2 Invoices and Tax receipts</a> <a href="#ref-for-dfn-customer-143">(2)</a> <a href="#ref-for-dfn-customer-144">(3)</a> <a href="#ref-for-dfn-customer-145">(4)</a> <a href="#ref-for-dfn-customer-146">(5)</a> <a href="#ref-for-dfn-customer-147">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-148">7.3.2 Basic Payment</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-149">7.3.2.1 Payment reconciliation detail validation</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-150">7.3.3 DynamicPayment</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-151">7.4.1 Business-to-consumer tax calculation by Booking System is mandatory</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-152">7.4.2 Business-to-business tax calculation by Booking System is optional</a> <a href="#ref-for-dfn-customer-153">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-154">7.5 Tax mode</a> <a href="#ref-for-dfn-customer-155">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-156">7.6 Booking without payment</a> <a href="#ref-for-dfn-customer-157">(2)</a> <a href="#ref-for-dfn-customer-158">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-159">7.7 Offer overrides</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-160">8.1 Definition of a 'bookable' Opportunity and Offer pair</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-161">8.1.1 Booking restrictions</a> <a href="#ref-for-dfn-customer-162">(2)</a> <a href="#ref-for-dfn-customer-163">(3)</a> <a href="#ref-for-dfn-customer-164">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-165">8.2 Amending the OrderQuote before B</a> <a href="#ref-for-dfn-customer-166">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-167">8.3 Cancellation after B</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-168">8.3.2 Customer requested cancellation</a> <a href="#ref-for-dfn-customer-169">(2)</a> <a href="#ref-for-dfn-customer-170">(3)</a> <a href="#ref-for-dfn-customer-171">(4)</a> <a href="#ref-for-dfn-customer-172">(5)</a> <a href="#ref-for-dfn-customer-173">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-174">8.3.3 Seller requested cancellation</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-175">8.4 Orders feed: Notifications, updates and refunds</a> <a href="#ref-for-dfn-customer-176">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-177">8.4.4 Broker: Processing the Orders feed</a> <a href="#ref-for-dfn-customer-178">(2)</a> <a href="#ref-for-dfn-customer-179">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-180">8.4.6 Cancellation, replacement, refund calculation and notification</a> <a href="#ref-for-dfn-customer-181">(2)</a> <a href="#ref-for-dfn-customer-182">(3)</a> <a href="#ref-for-dfn-customer-183">(4)</a> <a href="#ref-for-dfn-customer-184">(5)</a> <a href="#ref-for-dfn-customer-185">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-186">8.4.8 Customer notice notifications</a> <a href="#ref-for-dfn-customer-187">(2)</a> <a href="#ref-for-dfn-customer-188">(3)</a> <a href="#ref-for-dfn-customer-189">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-190">8.4.9 Change of logistics notifications</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-191">8.4.10 Opportunity attendance updates</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-192">8.4.11 Other notifications</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-193">8.5 Amending the Order after B</a> <a href="#ref-for-dfn-customer-194">(2)</a> <a href="#ref-for-dfn-customer-195">(3)</a> <a href="#ref-for-dfn-customer-196">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-197">8.6 Delivery of Terms and Conditions and Privacy Policy</a> <a href="#ref-for-dfn-customer-198">(2)</a> <a href="#ref-for-dfn-customer-199">(3)</a> <a href="#ref-for-dfn-customer-200">(4)</a> <a href="#ref-for-dfn-customer-201">(5)</a> <a href="#ref-for-dfn-customer-202">(6)</a> <a href="#ref-for-dfn-customer-203">(7)</a> <a href="#ref-for-dfn-customer-204">(8)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-205">8.7 Access control</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-206">8.7.1 Text-based access control</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-207">8.7.4 Remote access control</a> <a href="#ref-for-dfn-customer-208">(2)</a> <a href="#ref-for-dfn-customer-209">(3)</a> <a href="#ref-for-dfn-customer-210">(4)</a> <a href="#ref-for-dfn-customer-211">(5)</a> <a href="#ref-for-dfn-customer-212">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-213">9.2.2 OrderQuote Creation C2</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-214">9.2.3 OrderQuote Deletion</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-215">9.2.8 Order Cancellation</a> <a href="#ref-for-dfn-customer-216">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-217">9.2.9 Orders RPDE feed</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-218">9.2.10 Order Status</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-219">10. Model</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-220">10.1.1 schema:Order</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-221">10.1.6 schema:OrderItem</a> <a href="#ref-for-dfn-customer-222">(2)</a> <a href="#ref-for-dfn-customer-223">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-224">10.1.7 schema:Offer</a> <a href="#ref-for-dfn-customer-225">(2)</a> <a href="#ref-for-dfn-customer-226">(3)</a> <a href="#ref-for-dfn-customer-227">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-228">10.1.8 schema:OfferOverride</a> <a href="#ref-for-dfn-customer-229">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-230">10.1.9 schema:Person for customer or attendee</a> <a href="#ref-for-dfn-customer-231">(2)</a> <a href="#ref-for-dfn-customer-232">(3)</a> <a href="#ref-for-dfn-customer-233">(4)</a> <a href="#ref-for-dfn-customer-234">(5)</a> <a href="#ref-for-dfn-customer-235">(6)</a> <a href="#ref-for-dfn-customer-236">(7)</a> <a href="#ref-for-dfn-customer-237">(8)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-238">10.1.10 schema:Organization for customer</a> <a href="#ref-for-dfn-customer-239">(2)</a> <a href="#ref-for-dfn-customer-240">(3)</a> <a href="#ref-for-dfn-customer-241">(4)</a> <a href="#ref-for-dfn-customer-242">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-243">10.1.13 schema:PriceSpecification</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-244">10.1.14 oa:TaxChargeSpecification</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-245">10.1.15 oa:Payment</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-246">10.1.18 oa:Terms</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-247">10.2.2.1 Order Creation - OrderQuote, OrderProposal and Order error responses</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-248">10.2.2.2 Order Cancellation - OrderQuote, OrderProposal and Order error responses</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-249">10.2.2.3 Order Creation - OrderItem errors</a> <a href="#ref-for-dfn-customer-250">(2)</a> <a href="#ref-for-dfn-customer-251">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-252">11.2.2.1 Opportunity data extensions</a> <a href="#ref-for-dfn-customer-253">(2)</a> <a href="#ref-for-dfn-customer-254">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-255">11.2.2.2 Booking functionality extensions</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-256">11.7.2 Middleware as a catalyst</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-257">11.7.3 Customer level authentication</a> <a href="#ref-for-dfn-customer-258">(2)</a> <a href="#ref-for-dfn-customer-259">(3)</a> <a href="#ref-for-dfn-customer-260">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-261">11.7.4.1 OAuth Flows and Scopes</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-broker">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-broker">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-broker-1">1. Introduction</a> <a href="#ref-for-dfn-broker-2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-3">1.1 Scope and requirements</a> <a href="#ref-for-dfn-broker-4">(2)</a> <a href="#ref-for-dfn-broker-5">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-6">1.1.1 Out of Scope in this version</a> <a href="#ref-for-dfn-broker-7">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-8">1.1.2 Out of Scope by design</a> <a href="#ref-for-dfn-broker-9">(2)</a> <a href="#ref-for-dfn-broker-10">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-11">1.3 Audience</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-12">4. Key Actors</a> <a href="#ref-for-dfn-broker-13">(2)</a> <a href="#ref-for-dfn-broker-14">(3)</a> <a href="#ref-for-dfn-broker-15">(4)</a> <a href="#ref-for-dfn-broker-16">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-17">5.1 Booking flow overview</a> <a href="#ref-for-dfn-broker-18">(2)</a> <a href="#ref-for-dfn-broker-19">(3)</a> <a href="#ref-for-dfn-broker-20">(4)</a> <a href="#ref-for-dfn-broker-21">(5)</a> <a href="#ref-for-dfn-broker-22">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-23">5.3 Booking pre-conditions</a> <a href="#ref-for-dfn-broker-24">(2)</a> <a href="#ref-for-dfn-broker-25">(3)</a> <a href="#ref-for-dfn-broker-26">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-27">5.4.2 High-level API flow</a> <a href="#ref-for-dfn-broker-28">(2)</a> <a href="#ref-for-dfn-broker-29">(3)</a> <a href="#ref-for-dfn-broker-30">(4)</a> <a href="#ref-for-dfn-broker-31">(5)</a> <a href="#ref-for-dfn-broker-32">(6)</a> <a href="#ref-for-dfn-broker-33">(7)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-34">5.4.3 Leasing</a> <a href="#ref-for-dfn-broker-35">(2)</a> <a href="#ref-for-dfn-broker-36">(3)</a> <a href="#ref-for-dfn-broker-37">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-38">5.4.4 High-level type flow</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-39">5.4.5 Order statuses</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-40">5.4.5.1 Order statuses in the Booking System</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-41">5.4.5.2 Order statuses in the Broker</a> <a href="#ref-for-dfn-broker-42">(2)</a> <a href="#ref-for-dfn-broker-43">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-44">5.4.6 Step-by-step process description</a> <a href="#ref-for-dfn-broker-45">(2)</a> <a href="#ref-for-dfn-broker-46">(3)</a> <a href="#ref-for-dfn-broker-47">(4)</a> <a href="#ref-for-dfn-broker-48">(5)</a> <a href="#ref-for-dfn-broker-49">(6)</a> <a href="#ref-for-dfn-broker-50">(7)</a> <a href="#ref-for-dfn-broker-51">(8)</a> <a href="#ref-for-dfn-broker-52">(9)</a> <a href="#ref-for-dfn-broker-53">(10)</a> <a href="#ref-for-dfn-broker-54">(11)</a> <a href="#ref-for-dfn-broker-55">(12)</a> <a href="#ref-for-dfn-broker-56">(13)</a> <a href="#ref-for-dfn-broker-57">(14)</a> <a href="#ref-for-dfn-broker-58">(15)</a> <a href="#ref-for-dfn-broker-59">(16)</a> <a href="#ref-for-dfn-broker-60">(17)</a> <a href="#ref-for-dfn-broker-61">(18)</a> <a href="#ref-for-dfn-broker-62">(19)</a> <a href="#ref-for-dfn-broker-63">(20)</a> <a href="#ref-for-dfn-broker-64">(21)</a> <a href="#ref-for-dfn-broker-65">(22)</a> <a href="#ref-for-dfn-broker-66">(23)</a> <a href="#ref-for-dfn-broker-67">(24)</a> <a href="#ref-for-dfn-broker-68">(25)</a> <a href="#ref-for-dfn-broker-69">(26)</a> <a href="#ref-for-dfn-broker-70">(27)</a> <a href="#ref-for-dfn-broker-71">(28)</a> <a href="#ref-for-dfn-broker-72">(29)</a> <a href="#ref-for-dfn-broker-73">(30)</a> <a href="#ref-for-dfn-broker-74">(31)</a> <a href="#ref-for-dfn-broker-75">(32)</a> <a href="#ref-for-dfn-broker-76">(33)</a> <a href="#ref-for-dfn-broker-77">(34)</a> <a href="#ref-for-dfn-broker-78">(35)</a> <a href="#ref-for-dfn-broker-79">(36)</a> <a href="#ref-for-dfn-broker-80">(37)</a> <a href="#ref-for-dfn-broker-81">(38)</a> <a href="#ref-for-dfn-broker-82">(39)</a> <a href="#ref-for-dfn-broker-83">(40)</a> <a href="#ref-for-dfn-broker-84">(41)</a> <a href="#ref-for-dfn-broker-85">(42)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-86">5.4.7 Booking Flow Rollback</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-87">5.4.7.2 Booking halted at OrderCreationPaymentDue</a> <a href="#ref-for-dfn-broker-88">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-89">5.4.7.3 Booking halted at OrderCreationPaymentAuthorized</a> <a href="#ref-for-dfn-broker-90">(2)</a> <a href="#ref-for-dfn-broker-91">(3)</a> <a href="#ref-for-dfn-broker-92">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-93">5.4.8 Contracts</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-94">5.4.8.1 Broker contract with Booking System</a> <a href="#ref-for-dfn-broker-95">(2)</a> <a href="#ref-for-dfn-broker-96">(3)</a> <a href="#ref-for-dfn-broker-97">(4)</a> <a href="#ref-for-dfn-broker-98">(5)</a> <a href="#ref-for-dfn-broker-99">(6)</a> <a href="#ref-for-dfn-broker-100">(7)</a> <a href="#ref-for-dfn-broker-101">(8)</a> <a href="#ref-for-dfn-broker-102">(9)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-103">5.4.8.2 Booking System contract with the Broker</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-104">5.5.2 High-level API flow</a> <a href="#ref-for-dfn-broker-105">(2)</a> <a href="#ref-for-dfn-broker-106">(3)</a> <a href="#ref-for-dfn-broker-107">(4)</a> <a href="#ref-for-dfn-broker-108">(5)</a> <a href="#ref-for-dfn-broker-109">(6)</a> <a href="#ref-for-dfn-broker-110">(7)</a> <a href="#ref-for-dfn-broker-111">(8)</a> <a href="#ref-for-dfn-broker-112">(9)</a> <a href="#ref-for-dfn-broker-113">(10)</a> <a href="#ref-for-dfn-broker-114">(11)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-115">5.5.5 OrderProposal statuses</a> <a href="#ref-for-dfn-broker-116">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-117">5.5.5.1 Minimal Proposal Implementation</a> <a href="#ref-for-dfn-broker-118">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-119">5.5.5.1.1 Proposal Approval</a> <a href="#ref-for-dfn-broker-120">(2)</a> <a href="#ref-for-dfn-broker-121">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-122">5.5.5.1.2 Proposal Rejection</a> <a href="#ref-for-dfn-broker-123">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-124">5.5.5.2 Proposal Amendment</a> <a href="#ref-for-dfn-broker-125">(2)</a> <a href="#ref-for-dfn-broker-126">(3)</a> <a href="#ref-for-dfn-broker-127">(4)</a> <a href="#ref-for-dfn-broker-128">(5)</a> <a href="#ref-for-dfn-broker-129">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-130">5.5.5.3 Message Exchange</a> <a href="#ref-for-dfn-broker-131">(2)</a> <a href="#ref-for-dfn-broker-132">(3)</a> <a href="#ref-for-dfn-broker-133">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-134">5.5.6 Step-by-step process description</a> <a href="#ref-for-dfn-broker-135">(2)</a> <a href="#ref-for-dfn-broker-136">(3)</a> <a href="#ref-for-dfn-broker-137">(4)</a> <a href="#ref-for-dfn-broker-138">(5)</a> <a href="#ref-for-dfn-broker-139">(6)</a> <a href="#ref-for-dfn-broker-140">(7)</a> <a href="#ref-for-dfn-broker-141">(8)</a> <a href="#ref-for-dfn-broker-142">(9)</a> <a href="#ref-for-dfn-broker-143">(10)</a> <a href="#ref-for-dfn-broker-144">(11)</a> <a href="#ref-for-dfn-broker-145">(12)</a> <a href="#ref-for-dfn-broker-146">(13)</a> <a href="#ref-for-dfn-broker-147">(14)</a> <a href="#ref-for-dfn-broker-148">(15)</a> <a href="#ref-for-dfn-broker-149">(16)</a> <a href="#ref-for-dfn-broker-150">(17)</a> <a href="#ref-for-dfn-broker-151">(18)</a> <a href="#ref-for-dfn-broker-152">(19)</a> <a href="#ref-for-dfn-broker-153">(20)</a> <a href="#ref-for-dfn-broker-154">(21)</a> <a href="#ref-for-dfn-broker-155">(22)</a> <a href="#ref-for-dfn-broker-156">(23)</a> <a href="#ref-for-dfn-broker-157">(24)</a> <a href="#ref-for-dfn-broker-158">(25)</a> <a href="#ref-for-dfn-broker-159">(26)</a> <a href="#ref-for-dfn-broker-160">(27)</a> <a href="#ref-for-dfn-broker-161">(28)</a> <a href="#ref-for-dfn-broker-162">(29)</a> <a href="#ref-for-dfn-broker-163">(30)</a> <a href="#ref-for-dfn-broker-164">(31)</a> <a href="#ref-for-dfn-broker-165">(32)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-166">5.5.7.1 Broker contract with Booking System</a> <a href="#ref-for-dfn-broker-167">(2)</a> <a href="#ref-for-dfn-broker-168">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-169">5.6.2 Attendee Details capture</a> <a href="#ref-for-dfn-broker-170">(2)</a> <a href="#ref-for-dfn-broker-171">(3)</a> <a href="#ref-for-dfn-broker-172">(4)</a> <a href="#ref-for-dfn-broker-173">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-174">5.6.3 Additional Details capture</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-175">5.6.3.4 Form validation and auto-fill</a> <a href="#ref-for-dfn-broker-176">(2)</a> <a href="#ref-for-dfn-broker-177">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-178">6. Broker Roles</a> <a href="#ref-for-dfn-broker-179">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-180">6.1.4 Scope of Specification</a> <a href="#ref-for-dfn-broker-181">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-182">6.1.5 Conformance criteria</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-183">6.2.5 Conformance criteria</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-184">6.2.6 Informed purchase</a> <a href="#ref-for-dfn-broker-185">(2)</a> <a href="#ref-for-dfn-broker-186">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-187">7.1 Roles and responsibilities overview</a> <a href="#ref-for-dfn-broker-188">(2)</a> <a href="#ref-for-dfn-broker-189">(3)</a> <a href="#ref-for-dfn-broker-190">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-191">7.2 Invoices and Tax receipts</a> <a href="#ref-for-dfn-broker-192">(2)</a> <a href="#ref-for-dfn-broker-193">(3)</a> <a href="#ref-for-dfn-broker-194">(4)</a> <a href="#ref-for-dfn-broker-195">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-196">7.3.2.1 Payment reconciliation detail validation</a> <a href="#ref-for-dfn-broker-197">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-198">7.3.3 DynamicPayment</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-199">7.3.4 Payment reconciliation identifiers</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-200">7.4.2 Business-to-business tax calculation by Booking System is optional</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-201">7.6 Booking without payment</a> <a href="#ref-for-dfn-broker-202">(2)</a> <a href="#ref-for-dfn-broker-203">(3)</a> <a href="#ref-for-dfn-broker-204">(4)</a> <a href="#ref-for-dfn-broker-205">(5)</a> <a href="#ref-for-dfn-broker-206">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-207">7.6.1 Free opportunities</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-208">7.7 Offer overrides</a> <a href="#ref-for-dfn-broker-209">(2)</a> <a href="#ref-for-dfn-broker-210">(3)</a> <a href="#ref-for-dfn-broker-211">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-212">8.1 Definition of a 'bookable' Opportunity and Offer pair</a> <a href="#ref-for-dfn-broker-213">(2)</a> <a href="#ref-for-dfn-broker-214">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-215">8.1.1 Booking restrictions</a> <a href="#ref-for-dfn-broker-216">(2)</a> <a href="#ref-for-dfn-broker-217">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-218">8.2 Amending the OrderQuote before B</a> <a href="#ref-for-dfn-broker-219">(2)</a> <a href="#ref-for-dfn-broker-220">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-221">8.3.1 Refund after the opportunity has occurred</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-222">8.3.2 Customer requested cancellation</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-223">8.4 Orders feed: Notifications, updates and refunds</a> <a href="#ref-for-dfn-broker-224">(2)</a> <a href="#ref-for-dfn-broker-225">(3)</a> <a href="#ref-for-dfn-broker-226">(4)</a> <a href="#ref-for-dfn-broker-227">(5)</a> <a href="#ref-for-dfn-broker-228">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-229">8.4.1 Orders Feed Inconsistencies</a> <a href="#ref-for-dfn-broker-230">(2)</a> <a href="#ref-for-dfn-broker-231">(3)</a> <a href="#ref-for-dfn-broker-232">(4)</a> <a href="#ref-for-dfn-broker-233">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-234">8.4.2 Order stores with eventual consistency</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-235">8.4.3.1 totalPaymentDue invariant</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-236">8.4.4 Broker: Processing the Orders feed</a> <a href="#ref-for-dfn-broker-237">(2)</a> <a href="#ref-for-dfn-broker-238">(3)</a> <a href="#ref-for-dfn-broker-239">(4)</a> <a href="#ref-for-dfn-broker-240">(5)</a> <a href="#ref-for-dfn-broker-241">(6)</a> <a href="#ref-for-dfn-broker-242">(7)</a> <a href="#ref-for-dfn-broker-243">(8)</a> <a href="#ref-for-dfn-broker-244">(9)</a> <a href="#ref-for-dfn-broker-245">(10)</a> <a href="#ref-for-dfn-broker-246">(11)</a> <a href="#ref-for-dfn-broker-247">(12)</a> <a href="#ref-for-dfn-broker-248">(13)</a> <a href="#ref-for-dfn-broker-249">(14)</a> <a href="#ref-for-dfn-broker-250">(15)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-251">8.4.5 New Orders and OrderProposals</a> <a href="#ref-for-dfn-broker-252">(2)</a> <a href="#ref-for-dfn-broker-253">(3)</a> <a href="#ref-for-dfn-broker-254">(4)</a> <a href="#ref-for-dfn-broker-255">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-256">8.4.6 Cancellation, replacement, refund calculation and notification</a> <a href="#ref-for-dfn-broker-257">(2)</a> <a href="#ref-for-dfn-broker-258">(3)</a> <a href="#ref-for-dfn-broker-259">(4)</a> <a href="#ref-for-dfn-broker-260">(5)</a> <a href="#ref-for-dfn-broker-261">(6)</a> <a href="#ref-for-dfn-broker-262">(7)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-263">8.4.7 Partial Refunds and out-of-band arrangements</a> <a href="#ref-for-dfn-broker-264">(2)</a> <a href="#ref-for-dfn-broker-265">(3)</a> <a href="#ref-for-dfn-broker-266">(4)</a> <a href="#ref-for-dfn-broker-267">(5)</a> <a href="#ref-for-dfn-broker-268">(6)</a> <a href="#ref-for-dfn-broker-269">(7)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-270">8.4.8 Customer notice notifications</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-271">8.4.9 Change of logistics notifications</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-272">8.4.11 Other notifications</a> <a href="#ref-for-dfn-broker-273">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-274">8.5 Amending the Order after B</a> <a href="#ref-for-dfn-broker-275">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-276">8.6 Delivery of Terms and Conditions and Privacy Policy</a> <a href="#ref-for-dfn-broker-277">(2)</a> <a href="#ref-for-dfn-broker-278">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-279">8.7 Access control</a> <a href="#ref-for-dfn-broker-280">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-281">8.7.3 Extension point for barcode-based access control</a> <a href="#ref-for-dfn-broker-282">(2)</a> <a href="#ref-for-dfn-broker-283">(3)</a> <a href="#ref-for-dfn-broker-284">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-285">8.7.4 Remote access control</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-286">9. Endpoints</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-287">9.1 Paths and Verbs</a> <a href="#ref-for-dfn-broker-288">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-289">9.2.2 OrderQuote Creation C2</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-290">9.2.3 OrderQuote Deletion</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-291">9.2.4 OrderProposal Creation P</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-292">9.2.6 Order Creation B</a> <a href="#ref-for-dfn-broker-293">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-294">9.2.7 Order Deletion</a> <a href="#ref-for-dfn-broker-295">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-296">9.2.10 Order Status</a> <a href="#ref-for-dfn-broker-297">(2)</a> <a href="#ref-for-dfn-broker-298">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-299">10.1.1 schema:Order</a> <a href="#ref-for-dfn-broker-300">(2)</a> <a href="#ref-for-dfn-broker-301">(3)</a> <a href="#ref-for-dfn-broker-302">(4)</a> <a href="#ref-for-dfn-broker-303">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-304">10.1.5 schema:Organization for broker</a> <a href="#ref-for-dfn-broker-305">(2)</a> <a href="#ref-for-dfn-broker-306">(3)</a> <a href="#ref-for-dfn-broker-307">(4)</a> <a href="#ref-for-dfn-broker-308">(5)</a> <a href="#ref-for-dfn-broker-309">(6)</a> <a href="#ref-for-dfn-broker-310">(7)</a> <a href="#ref-for-dfn-broker-311">(8)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-312">10.1.6 schema:OrderItem</a> <a href="#ref-for-dfn-broker-313">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-314">10.1.9 schema:Person for customer or attendee</a> <a href="#ref-for-dfn-broker-315">(2)</a> <a href="#ref-for-dfn-broker-316">(3)</a> <a href="#ref-for-dfn-broker-317">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-318">10.1.10 schema:Organization for customer</a> <a href="#ref-for-dfn-broker-319">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-320">10.1.14 oa:TaxChargeSpecification</a> <a href="#ref-for-dfn-broker-321">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-322">10.1.15 oa:Payment</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-323">10.1.19 oa:PrivacyPolicy</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-324">10.1.20 oa:TermsOfUse</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-325">10.2.2.1 Order Creation - OrderQuote, OrderProposal and Order error responses</a> <a href="#ref-for-dfn-broker-326">(2)</a> <a href="#ref-for-dfn-broker-327">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-328">10.2.2.2 Order Cancellation - OrderQuote, OrderProposal and Order error responses</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-329">10.2.2.4 API authentication</a> <a href="#ref-for-dfn-broker-330">(2)</a> <a href="#ref-for-dfn-broker-331">(3)</a> <a href="#ref-for-dfn-broker-332">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-333">10.2.2.6 Generic errors</a> <a href="#ref-for-dfn-broker-334">(2)</a> <a href="#ref-for-dfn-broker-335">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-336">11.1 Versioning Policy</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-337">11.1.1 Media types</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-338">11.2.2.1 Opportunity data extensions</a> <a href="#ref-for-dfn-broker-339">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-340">11.2.2.2 Booking functionality extensions</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-341">11.2.3 General extension mechanism</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-342">11.5 Rate Limiting</a> <a href="#ref-for-dfn-broker-343">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-344">11.7 Authentication</a> <a href="#ref-for-dfn-broker-345">(2)</a> <a href="#ref-for-dfn-broker-346">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-347">11.7.2 Middleware as a catalyst</a> <a href="#ref-for-dfn-broker-348">(2)</a> <a href="#ref-for-dfn-broker-349">(3)</a> <a href="#ref-for-dfn-broker-350">(4)</a> <a href="#ref-for-dfn-broker-351">(5)</a> <a href="#ref-for-dfn-broker-352">(6)</a> <a href="#ref-for-dfn-broker-353">(7)</a> <a href="#ref-for-dfn-broker-354">(8)</a> <a href="#ref-for-dfn-broker-355">(9)</a> <a href="#ref-for-dfn-broker-356">(10)</a> <a href="#ref-for-dfn-broker-357">(11)</a> <a href="#ref-for-dfn-broker-358">(12)</a> <a href="#ref-for-dfn-broker-359">(13)</a> <a href="#ref-for-dfn-broker-360">(14)</a> <a href="#ref-for-dfn-broker-361">(15)</a> <a href="#ref-for-dfn-broker-362">(16)</a> <a href="#ref-for-dfn-broker-363">(17)</a> <a href="#ref-for-dfn-broker-364">(18)</a> 
  </li><li>
    <a href="#ref-for-dfn-broker-365">11.7.3 Customer level authentication</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-booking-system">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-booking-system">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-booking-system-1">1. Introduction</a> <a href="#ref-for-dfn-booking-system-2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-3">1.1 Scope and requirements</a> <a href="#ref-for-dfn-booking-system-4">(2)</a> <a href="#ref-for-dfn-booking-system-5">(3)</a> <a href="#ref-for-dfn-booking-system-6">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-7">1.1.1 Out of Scope in this version</a> <a href="#ref-for-dfn-booking-system-8">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-9">1.3 Audience</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-10">4. Key Actors</a> <a href="#ref-for-dfn-booking-system-11">(2)</a> <a href="#ref-for-dfn-booking-system-12">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-13">5.1 Booking flow overview</a> <a href="#ref-for-dfn-booking-system-14">(2)</a> <a href="#ref-for-dfn-booking-system-15">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-16">5.2 Booking flow modularity</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-17">5.3 Booking pre-conditions</a> <a href="#ref-for-dfn-booking-system-18">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-19">5.4.2 High-level API flow</a> <a href="#ref-for-dfn-booking-system-20">(2)</a> <a href="#ref-for-dfn-booking-system-21">(3)</a> <a href="#ref-for-dfn-booking-system-22">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-23">5.4.3 Leasing</a> <a href="#ref-for-dfn-booking-system-24">(2)</a> <a href="#ref-for-dfn-booking-system-25">(3)</a> <a href="#ref-for-dfn-booking-system-26">(4)</a> <a href="#ref-for-dfn-booking-system-27">(5)</a> <a href="#ref-for-dfn-booking-system-28">(6)</a> <a href="#ref-for-dfn-booking-system-29">(7)</a> <a href="#ref-for-dfn-booking-system-30">(8)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-31">5.4.4 High-level type flow</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-32">5.4.5 Order statuses</a> <a href="#ref-for-dfn-booking-system-33">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-34">5.4.5.1 Order statuses in the Booking System</a> <a href="#ref-for-dfn-booking-system-35">(2)</a> <a href="#ref-for-dfn-booking-system-36">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-37">5.4.5.2 Order statuses in the Broker</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-38">5.4.6 Step-by-step process description</a> <a href="#ref-for-dfn-booking-system-39">(2)</a> <a href="#ref-for-dfn-booking-system-40">(3)</a> <a href="#ref-for-dfn-booking-system-41">(4)</a> <a href="#ref-for-dfn-booking-system-42">(5)</a> <a href="#ref-for-dfn-booking-system-43">(6)</a> <a href="#ref-for-dfn-booking-system-44">(7)</a> <a href="#ref-for-dfn-booking-system-45">(8)</a> <a href="#ref-for-dfn-booking-system-46">(9)</a> <a href="#ref-for-dfn-booking-system-47">(10)</a> <a href="#ref-for-dfn-booking-system-48">(11)</a> <a href="#ref-for-dfn-booking-system-49">(12)</a> <a href="#ref-for-dfn-booking-system-50">(13)</a> <a href="#ref-for-dfn-booking-system-51">(14)</a> <a href="#ref-for-dfn-booking-system-52">(15)</a> <a href="#ref-for-dfn-booking-system-53">(16)</a> <a href="#ref-for-dfn-booking-system-54">(17)</a> <a href="#ref-for-dfn-booking-system-55">(18)</a> <a href="#ref-for-dfn-booking-system-56">(19)</a> <a href="#ref-for-dfn-booking-system-57">(20)</a> <a href="#ref-for-dfn-booking-system-58">(21)</a> <a href="#ref-for-dfn-booking-system-59">(22)</a> <a href="#ref-for-dfn-booking-system-60">(23)</a> <a href="#ref-for-dfn-booking-system-61">(24)</a> <a href="#ref-for-dfn-booking-system-62">(25)</a> <a href="#ref-for-dfn-booking-system-63">(26)</a> <a href="#ref-for-dfn-booking-system-64">(27)</a> <a href="#ref-for-dfn-booking-system-65">(28)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-66">5.4.7.2 Booking halted at OrderCreationPaymentDue</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-67">5.4.8 Contracts</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-68">5.4.8.2 Booking System contract with the Broker</a> <a href="#ref-for-dfn-booking-system-69">(2)</a> <a href="#ref-for-dfn-booking-system-70">(3)</a> <a href="#ref-for-dfn-booking-system-71">(4)</a> <a href="#ref-for-dfn-booking-system-72">(5)</a> <a href="#ref-for-dfn-booking-system-73">(6)</a> <a href="#ref-for-dfn-booking-system-74">(7)</a> <a href="#ref-for-dfn-booking-system-75">(8)</a> <a href="#ref-for-dfn-booking-system-76">(9)</a> <a href="#ref-for-dfn-booking-system-77">(10)</a> <a href="#ref-for-dfn-booking-system-78">(11)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-79">5.5 Booking Flow with Approval</a> <a href="#ref-for-dfn-booking-system-80">(2)</a> <a href="#ref-for-dfn-booking-system-81">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-82">5.5.2 High-level API flow</a> <a href="#ref-for-dfn-booking-system-83">(2)</a> <a href="#ref-for-dfn-booking-system-84">(3)</a> <a href="#ref-for-dfn-booking-system-85">(4)</a> <a href="#ref-for-dfn-booking-system-86">(5)</a> <a href="#ref-for-dfn-booking-system-87">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-88">5.5.3 Proposal Leasing</a> <a href="#ref-for-dfn-booking-system-89">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-90">5.5.5 OrderProposal statuses</a> <a href="#ref-for-dfn-booking-system-91">(2)</a> <a href="#ref-for-dfn-booking-system-92">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-93">5.5.5.1 Minimal Proposal Implementation</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-94">5.5.5.1.1 Proposal Approval</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-95">5.5.5.1.2 Proposal Rejection</a> <a href="#ref-for-dfn-booking-system-96">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-97">5.5.5.2 Proposal Amendment</a> <a href="#ref-for-dfn-booking-system-98">(2)</a> <a href="#ref-for-dfn-booking-system-99">(3)</a> <a href="#ref-for-dfn-booking-system-100">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-101">5.5.5.3 Message Exchange</a> <a href="#ref-for-dfn-booking-system-102">(2)</a> <a href="#ref-for-dfn-booking-system-103">(3)</a> <a href="#ref-for-dfn-booking-system-104">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-105">5.5.6 Step-by-step process description</a> <a href="#ref-for-dfn-booking-system-106">(2)</a> <a href="#ref-for-dfn-booking-system-107">(3)</a> <a href="#ref-for-dfn-booking-system-108">(4)</a> <a href="#ref-for-dfn-booking-system-109">(5)</a> <a href="#ref-for-dfn-booking-system-110">(6)</a> <a href="#ref-for-dfn-booking-system-111">(7)</a> <a href="#ref-for-dfn-booking-system-112">(8)</a> <a href="#ref-for-dfn-booking-system-113">(9)</a> <a href="#ref-for-dfn-booking-system-114">(10)</a> <a href="#ref-for-dfn-booking-system-115">(11)</a> <a href="#ref-for-dfn-booking-system-116">(12)</a> <a href="#ref-for-dfn-booking-system-117">(13)</a> <a href="#ref-for-dfn-booking-system-118">(14)</a> <a href="#ref-for-dfn-booking-system-119">(15)</a> <a href="#ref-for-dfn-booking-system-120">(16)</a> <a href="#ref-for-dfn-booking-system-121">(17)</a> <a href="#ref-for-dfn-booking-system-122">(18)</a> <a href="#ref-for-dfn-booking-system-123">(19)</a> <a href="#ref-for-dfn-booking-system-124">(20)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-125">5.5.7.2 Booking System contract with the Broker</a> <a href="#ref-for-dfn-booking-system-126">(2)</a> <a href="#ref-for-dfn-booking-system-127">(3)</a> <a href="#ref-for-dfn-booking-system-128">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-129">5.6.2 Attendee Details capture</a> <a href="#ref-for-dfn-booking-system-130">(2)</a> <a href="#ref-for-dfn-booking-system-131">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-132">5.6.3 Additional Details capture</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-133">5.6.3.2 Dropdown fields</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-134">5.6.3.4 Form validation and auto-fill</a> <a href="#ref-for-dfn-booking-system-135">(2)</a> <a href="#ref-for-dfn-booking-system-136">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-137">6.1.4 Scope of Specification</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-138">7.1 Roles and responsibilities overview</a> <a href="#ref-for-dfn-booking-system-139">(2)</a> <a href="#ref-for-dfn-booking-system-140">(3)</a> <a href="#ref-for-dfn-booking-system-141">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-142">7.2 Invoices and Tax receipts</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-143">7.3 Payments and Refunds</a> <a href="#ref-for-dfn-booking-system-144">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-145">7.3.2 Basic Payment</a> <a href="#ref-for-dfn-booking-system-146">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-147">7.3.2.1 Payment reconciliation detail validation</a> <a href="#ref-for-dfn-booking-system-148">(2)</a> <a href="#ref-for-dfn-booking-system-149">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-150">7.3.3 DynamicPayment</a> <a href="#ref-for-dfn-booking-system-151">(2)</a> <a href="#ref-for-dfn-booking-system-152">(3)</a> <a href="#ref-for-dfn-booking-system-153">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-154">7.3.4 Payment reconciliation identifiers</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-155">7.4.1 Business-to-consumer tax calculation by Booking System is mandatory</a> <a href="#ref-for-dfn-booking-system-156">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-157">7.4.2 Business-to-business tax calculation by Booking System is optional</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-158">7.6 Booking without payment</a> <a href="#ref-for-dfn-booking-system-159">(2)</a> <a href="#ref-for-dfn-booking-system-160">(3)</a> <a href="#ref-for-dfn-booking-system-161">(4)</a> <a href="#ref-for-dfn-booking-system-162">(5)</a> <a href="#ref-for-dfn-booking-system-163">(6)</a> <a href="#ref-for-dfn-booking-system-164">(7)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-165">7.6.2 Payment error conditions</a> <a href="#ref-for-dfn-booking-system-166">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-167">7.7 Offer overrides</a> <a href="#ref-for-dfn-booking-system-168">(2)</a> <a href="#ref-for-dfn-booking-system-169">(3)</a> <a href="#ref-for-dfn-booking-system-170">(4)</a> <a href="#ref-for-dfn-booking-system-171">(5)</a> <a href="#ref-for-dfn-booking-system-172">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-173">8.1 Definition of a 'bookable' Opportunity and Offer pair</a> <a href="#ref-for-dfn-booking-system-174">(2)</a> <a href="#ref-for-dfn-booking-system-175">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-176">8.1.1 Booking restrictions</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-177">8.1.2 Opportunity data properties</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-178">8.1.3 acceptedOffer properties</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-179">8.2 Amending the OrderQuote before B</a> <a href="#ref-for-dfn-booking-system-180">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-181">8.3 Cancellation after B</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-182">8.3.2 Customer requested cancellation</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-183">8.4 Orders feed: Notifications, updates and refunds</a> <a href="#ref-for-dfn-booking-system-184">(2)</a> <a href="#ref-for-dfn-booking-system-185">(3)</a> <a href="#ref-for-dfn-booking-system-186">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-187">8.4.1 Orders Feed Inconsistencies</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-188">8.4.3 Booking System: Updating the Orders feed</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-189">8.4.3.1 totalPaymentDue invariant</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-190">8.4.4 Broker: Processing the Orders feed</a> <a href="#ref-for-dfn-booking-system-191">(2)</a> <a href="#ref-for-dfn-booking-system-192">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-193">8.4.5 New Orders and OrderProposals</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-194">8.4.6 Cancellation, replacement, refund calculation and notification</a> <a href="#ref-for-dfn-booking-system-195">(2)</a> <a href="#ref-for-dfn-booking-system-196">(3)</a> <a href="#ref-for-dfn-booking-system-197">(4)</a> <a href="#ref-for-dfn-booking-system-198">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-199">8.4.7 Partial Refunds and out-of-band arrangements</a> <a href="#ref-for-dfn-booking-system-200">(2)</a> <a href="#ref-for-dfn-booking-system-201">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-202">8.4.10 Opportunity attendance updates</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-203">8.4.11 Other notifications</a> <a href="#ref-for-dfn-booking-system-204">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-205">8.6 Delivery of Terms and Conditions and Privacy Policy</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-206">8.7.2 Image-based access control</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-207">8.7.3 Extension point for barcode-based access control</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-208">9. Endpoints</a> <a href="#ref-for-dfn-booking-system-209">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-210">9.1 Paths and Verbs</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-211">9.1.1 Order Endpoint RESTful Semantics</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-212">9.2.1 OrderQuote Creation C1</a> <a href="#ref-for-dfn-booking-system-213">(2)</a> <a href="#ref-for-dfn-booking-system-214">(3)</a> <a href="#ref-for-dfn-booking-system-215">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-216">9.2.2 OrderQuote Creation C2</a> <a href="#ref-for-dfn-booking-system-217">(2)</a> <a href="#ref-for-dfn-booking-system-218">(3)</a> <a href="#ref-for-dfn-booking-system-219">(4)</a> <a href="#ref-for-dfn-booking-system-220">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-221">9.2.3 OrderQuote Deletion</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-222">9.2.4 OrderProposal Creation P</a> <a href="#ref-for-dfn-booking-system-223">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-224">9.2.6 Order Creation B</a> <a href="#ref-for-dfn-booking-system-225">(2)</a> <a href="#ref-for-dfn-booking-system-226">(3)</a> <a href="#ref-for-dfn-booking-system-227">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-228">9.2.7 Order Deletion</a> <a href="#ref-for-dfn-booking-system-229">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-230">9.2.8 Order Cancellation</a> <a href="#ref-for-dfn-booking-system-231">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-232">9.2.10 Order Status</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-233">10.1.1 schema:Order</a> <a href="#ref-for-dfn-booking-system-234">(2)</a> <a href="#ref-for-dfn-booking-system-235">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-236">10.1.2 oa:OrderQuote</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-237">10.1.4 schema:Organization or schema:Person for seller</a> <a href="#ref-for-dfn-booking-system-238">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-239">10.1.5 schema:Organization for broker</a> <a href="#ref-for-dfn-booking-system-240">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-241">10.1.6 schema:OrderItem</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-242">10.1.7 schema:Offer</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-243">10.1.9 schema:Person for customer or attendee</a> <a href="#ref-for-dfn-booking-system-244">(2)</a> <a href="#ref-for-dfn-booking-system-245">(3)</a> <a href="#ref-for-dfn-booking-system-246">(4)</a> <a href="#ref-for-dfn-booking-system-247">(5)</a> <a href="#ref-for-dfn-booking-system-248">(6)</a> <a href="#ref-for-dfn-booking-system-249">(7)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-250">10.1.10 schema:Organization for customer</a> <a href="#ref-for-dfn-booking-system-251">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-252">10.1.14 oa:TaxChargeSpecification</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-253">10.1.15 oa:Payment</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-254">10.1.17 oa:BookingService</a> <a href="#ref-for-dfn-booking-system-255">(2)</a> <a href="#ref-for-dfn-booking-system-256">(3)</a> <a href="#ref-for-dfn-booking-system-257">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-258">10.2.2.1 Order Creation - OrderQuote, OrderProposal and Order error responses</a> <a href="#ref-for-dfn-booking-system-259">(2)</a> <a href="#ref-for-dfn-booking-system-260">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-261">10.2.2.2 Order Cancellation - OrderQuote, OrderProposal and Order error responses</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-262">10.2.2.3 Order Creation - OrderItem errors</a> <a href="#ref-for-dfn-booking-system-263">(2)</a> <a href="#ref-for-dfn-booking-system-264">(3)</a> <a href="#ref-for-dfn-booking-system-265">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-266">10.2.2.5 Technical errors</a> <a href="#ref-for-dfn-booking-system-267">(2)</a> <a href="#ref-for-dfn-booking-system-268">(3)</a> <a href="#ref-for-dfn-booking-system-269">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-270">10.2.2.6 Generic errors</a> <a href="#ref-for-dfn-booking-system-271">(2)</a> <a href="#ref-for-dfn-booking-system-272">(3)</a> <a href="#ref-for-dfn-booking-system-273">(4)</a> <a href="#ref-for-dfn-booking-system-274">(5)</a> <a href="#ref-for-dfn-booking-system-275">(6)</a> <a href="#ref-for-dfn-booking-system-276">(7)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-277">11.1.1 Media types</a> <a href="#ref-for-dfn-booking-system-278">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-279">11.2.2.1 Opportunity data extensions</a> <a href="#ref-for-dfn-booking-system-280">(2)</a> <a href="#ref-for-dfn-booking-system-281">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-282">11.2.2.2 Booking functionality extensions</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-283">11.2.3.3 Extension example: Integrated Payments</a> <a href="#ref-for-dfn-booking-system-284">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-285">11.3.1 Globally unique identifiers</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-286">11.5 Rate Limiting</a> <a href="#ref-for-dfn-booking-system-287">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-288">11.7 Authentication</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-289">11.7.1 API level authentication and data security</a> <a href="#ref-for-dfn-booking-system-290">(2)</a> <a href="#ref-for-dfn-booking-system-291">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-292">11.7.2 Middleware as a catalyst</a> <a href="#ref-for-dfn-booking-system-293">(2)</a> <a href="#ref-for-dfn-booking-system-294">(3)</a> <a href="#ref-for-dfn-booking-system-295">(4)</a> <a href="#ref-for-dfn-booking-system-296">(5)</a> <a href="#ref-for-dfn-booking-system-297">(6)</a> <a href="#ref-for-dfn-booking-system-298">(7)</a> <a href="#ref-for-dfn-booking-system-299">(8)</a> <a href="#ref-for-dfn-booking-system-300">(9)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-301">11.7.4 OpenID Connect Booking Partner Authentication for Multiple Seller Systems</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-302">11.7.4.1 OAuth Flows and Scopes</a> <a href="#ref-for-dfn-booking-system-303">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-system-304">11.7.4.2.2 Access Token claims</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-seller">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-seller">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-seller-1">1.1 Scope and requirements</a> <a href="#ref-for-dfn-seller-2">(2)</a> <a href="#ref-for-dfn-seller-3">(3)</a> <a href="#ref-for-dfn-seller-4">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-5">1.1.1 Out of Scope in this version</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-6">1.1.2 Out of Scope by design</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-7">4. Key Actors</a> <a href="#ref-for-dfn-seller-8">(2)</a> <a href="#ref-for-dfn-seller-9">(3)</a> <a href="#ref-for-dfn-seller-10">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-11">5.1 Booking flow overview</a> <a href="#ref-for-dfn-seller-12">(2)</a> <a href="#ref-for-dfn-seller-13">(3)</a> <a href="#ref-for-dfn-seller-14">(4)</a> <a href="#ref-for-dfn-seller-15">(5)</a> <a href="#ref-for-dfn-seller-16">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-17">5.3 Booking pre-conditions</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-18">5.4.3 Leasing</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-19">5.4.5.1 Order statuses in the Booking System</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-20">5.4.6 Step-by-step process description</a> <a href="#ref-for-dfn-seller-21">(2)</a> <a href="#ref-for-dfn-seller-22">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-23">5.4.8.1 Broker contract with Booking System</a> <a href="#ref-for-dfn-seller-24">(2)</a> <a href="#ref-for-dfn-seller-25">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-26">5.4.8.2 Booking System contract with the Broker</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-27">5.5 Booking Flow with Approval</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-28">5.5.1 Customer Journey</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-29">5.5.2 High-level API flow</a> <a href="#ref-for-dfn-seller-30">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-31">5.5.3 Proposal Leasing</a> <a href="#ref-for-dfn-seller-32">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-33">5.5.5.1 Minimal Proposal Implementation</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-34">5.5.5.1.1 Proposal Approval</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-35">5.5.5.1.2 Proposal Rejection</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-36">5.5.5.2 Proposal Amendment</a> <a href="#ref-for-dfn-seller-37">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-38">5.5.5.3 Message Exchange</a> <a href="#ref-for-dfn-seller-39">(2)</a> <a href="#ref-for-dfn-seller-40">(3)</a> <a href="#ref-for-dfn-seller-41">(4)</a> <a href="#ref-for-dfn-seller-42">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-43">5.5.6 Step-by-step process description</a> <a href="#ref-for-dfn-seller-44">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-45">5.5.7.2 Booking System contract with the Broker</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-46">5.6.2 Attendee Details capture</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-47">6. Broker Roles</a> <a href="#ref-for-dfn-seller-48">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-49">6.1.2 Contractual Relationships</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-50">6.1.3 Taxation</a> <a href="#ref-for-dfn-seller-51">(2)</a> <a href="#ref-for-dfn-seller-52">(3)</a> <a href="#ref-for-dfn-seller-53">(4)</a> <a href="#ref-for-dfn-seller-54">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-55">6.1.4 Scope of Specification</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-56">6.2.1 Definition</a> <a href="#ref-for-dfn-seller-57">(2)</a> <a href="#ref-for-dfn-seller-58">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-59">6.2.2 Contractual Relationships</a> <a href="#ref-for-dfn-seller-60">(2)</a> <a href="#ref-for-dfn-seller-61">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-62">6.2.3 Taxation</a> <a href="#ref-for-dfn-seller-63">(2)</a> <a href="#ref-for-dfn-seller-64">(3)</a> <a href="#ref-for-dfn-seller-65">(4)</a> <a href="#ref-for-dfn-seller-66">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-67">6.2.4 Scope of Specification</a> <a href="#ref-for-dfn-seller-68">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-69">6.2.6 Informed purchase</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-70">6.3.1 Definition</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-71">6.3.2 Contractual Relationships</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-72">6.3.3 Taxation</a> <a href="#ref-for-dfn-seller-73">(2)</a> <a href="#ref-for-dfn-seller-74">(3)</a> <a href="#ref-for-dfn-seller-75">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-76">6.3.4 Scope of Specification</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-77">7.1 Roles and responsibilities overview</a> <a href="#ref-for-dfn-seller-78">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-79">7.2 Invoices and Tax receipts</a> <a href="#ref-for-dfn-seller-80">(2)</a> <a href="#ref-for-dfn-seller-81">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-82">7.3.1 Virtual payments</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-83">7.3.2 Basic Payment</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-84">7.3.2.1 Payment reconciliation detail validation</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-85">7.3.3 DynamicPayment</a> <a href="#ref-for-dfn-seller-86">(2)</a> <a href="#ref-for-dfn-seller-87">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-88">7.3.4 Payment reconciliation identifiers</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-89">7.4.2 Business-to-business tax calculation by Booking System is optional</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-90">7.5 Tax mode</a> <a href="#ref-for-dfn-seller-91">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-92">7.7 Offer overrides</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-93">8.1 Definition of a 'bookable' Opportunity and Offer pair</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-94">8.1.1 Booking restrictions</a> <a href="#ref-for-dfn-seller-95">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-96">8.3 Cancellation after B</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-97">8.3.1 Refund after the opportunity has occurred</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-98">8.3.3 Seller requested cancellation</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-99">8.4.1 Orders Feed Inconsistencies</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-100">8.4.6 Cancellation, replacement, refund calculation and notification</a> <a href="#ref-for-dfn-seller-101">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-102">8.4.7 Partial Refunds and out-of-band arrangements</a> <a href="#ref-for-dfn-seller-103">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-104">8.4.8 Customer notice notifications</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-105">8.5 Amending the Order after B</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-106">8.6 Delivery of Terms and Conditions and Privacy Policy</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-107">10. Model</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-108">10.1.1 schema:Order</a> <a href="#ref-for-dfn-seller-109">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-110">10.1.4 schema:Organization or schema:Person for seller</a> <a href="#ref-for-dfn-seller-111">(2)</a> <a href="#ref-for-dfn-seller-112">(3)</a> <a href="#ref-for-dfn-seller-113">(4)</a> <a href="#ref-for-dfn-seller-114">(5)</a> <a href="#ref-for-dfn-seller-115">(6)</a> <a href="#ref-for-dfn-seller-116">(7)</a> <a href="#ref-for-dfn-seller-117">(8)</a> <a href="#ref-for-dfn-seller-118">(9)</a> <a href="#ref-for-dfn-seller-119">(10)</a> <a href="#ref-for-dfn-seller-120">(11)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-121">10.1.6 schema:OrderItem</a> <a href="#ref-for-dfn-seller-122">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-123">10.1.15 oa:Payment</a> <a href="#ref-for-dfn-seller-124">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-125">10.1.16 oa:DynamicPayment</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-126">11.2.3 General extension mechanism</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-127">11.7 Authentication</a> <a href="#ref-for-dfn-seller-128">(2)</a> <a href="#ref-for-dfn-seller-129">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-130">11.7.1 API level authentication and data security</a> <a href="#ref-for-dfn-seller-131">(2)</a> <a href="#ref-for-dfn-seller-132">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-133">11.7.2 Middleware as a catalyst</a> <a href="#ref-for-dfn-seller-134">(2)</a> <a href="#ref-for-dfn-seller-135">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-136">11.7.4 OpenID Connect Booking Partner Authentication for Multiple Seller Systems</a> <a href="#ref-for-dfn-seller-137">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-138">11.7.4.1 OAuth Flows and Scopes</a> <a href="#ref-for-dfn-seller-139">(2)</a> <a href="#ref-for-dfn-seller-140">(3)</a> <a href="#ref-for-dfn-seller-141">(4)</a> <a href="#ref-for-dfn-seller-142">(5)</a> <a href="#ref-for-dfn-seller-143">(6)</a> <a href="#ref-for-dfn-seller-144">(7)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-145">11.7.4.1.1 Authorization Code Flow</a> <a href="#ref-for-dfn-seller-146">(2)</a> <a href="#ref-for-dfn-seller-147">(3)</a> <a href="#ref-for-dfn-seller-148">(4)</a> <a href="#ref-for-dfn-seller-149">(5)</a> <a href="#ref-for-dfn-seller-150">(6)</a> <a href="#ref-for-dfn-seller-151">(7)</a> <a href="#ref-for-dfn-seller-152">(8)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-153">11.7.4.2 Custom Claims</a> <a href="#ref-for-dfn-seller-154">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-155">11.7.4.2.1 ID Token claims</a> <a href="#ref-for-dfn-seller-156">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-seller-157">11.7.4.2.2 Access Token claims</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-payment-provider">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-payment-provider">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-payment-provider-1">4. Key Actors</a> <a href="#ref-for-dfn-payment-provider-2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-3">5.4.2 High-level API flow</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-4">5.4.6 Step-by-step process description</a> <a href="#ref-for-dfn-payment-provider-5">(2)</a> <a href="#ref-for-dfn-payment-provider-6">(3)</a> <a href="#ref-for-dfn-payment-provider-7">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-8">5.4.7.2 Booking halted at OrderCreationPaymentDue</a> <a href="#ref-for-dfn-payment-provider-9">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-10">5.4.7.3 Booking halted at OrderCreationPaymentAuthorized</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-11">5.4.8.1 Broker contract with Booking System</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-12">5.5.2 High-level API flow</a> <a href="#ref-for-dfn-payment-provider-13">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-14">5.5.5.2 Proposal Amendment</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-15">5.5.6 Step-by-step process description</a> <a href="#ref-for-dfn-payment-provider-16">(2)</a> <a href="#ref-for-dfn-payment-provider-17">(3)</a> <a href="#ref-for-dfn-payment-provider-18">(4)</a> <a href="#ref-for-dfn-payment-provider-19">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-20">6.1.4 Scope of Specification</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-21">6.2.4 Scope of Specification</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-22">6.3.4 Scope of Specification</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-23">7.1 Roles and responsibilities overview</a> <a href="#ref-for-dfn-payment-provider-24">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-25">7.3 Payments and Refunds</a> <a href="#ref-for-dfn-payment-provider-26">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-27">7.3.2 Basic Payment</a> <a href="#ref-for-dfn-payment-provider-28">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-29">7.6.1 Free opportunities</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-30">8.4.6 Cancellation, replacement, refund calculation and notification</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-31">10.1.9 schema:Person for customer or attendee</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-32">10.1.10 schema:Organization for customer</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-33">10.1.15 oa:Payment</a> <a href="#ref-for-dfn-payment-provider-34">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-provider-35">11.2.3.3 Extension example: Integrated Payments</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-order-uuid">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-order-uuid">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-order-uuid-1">5.4.2 High-level API flow</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-2">5.4.6 Step-by-step process description</a> <a href="#ref-for-dfn-order-uuid-3">(2)</a> <a href="#ref-for-dfn-order-uuid-4">(3)</a> <a href="#ref-for-dfn-order-uuid-5">(4)</a> <a href="#ref-for-dfn-order-uuid-6">(5)</a> <a href="#ref-for-dfn-order-uuid-7">(6)</a> <a href="#ref-for-dfn-order-uuid-8">(7)</a> <a href="#ref-for-dfn-order-uuid-9">(8)</a> <a href="#ref-for-dfn-order-uuid-10">(9)</a> <a href="#ref-for-dfn-order-uuid-11">(10)</a> <a href="#ref-for-dfn-order-uuid-12">(11)</a> <a href="#ref-for-dfn-order-uuid-13">(12)</a> <a href="#ref-for-dfn-order-uuid-14">(13)</a> <a href="#ref-for-dfn-order-uuid-15">(14)</a> <a href="#ref-for-dfn-order-uuid-16">(15)</a> <a href="#ref-for-dfn-order-uuid-17">(16)</a> <a href="#ref-for-dfn-order-uuid-18">(17)</a> <a href="#ref-for-dfn-order-uuid-19">(18)</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-20">5.4.7.2 Booking halted at OrderCreationPaymentDue</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-21">5.4.7.3 Booking halted at OrderCreationPaymentAuthorized</a> <a href="#ref-for-dfn-order-uuid-22">(2)</a> <a href="#ref-for-dfn-order-uuid-23">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-24">5.4.8.1 Broker contract with Booking System</a> <a href="#ref-for-dfn-order-uuid-25">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-26">5.4.8.2 Booking System contract with the Broker</a> <a href="#ref-for-dfn-order-uuid-27">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-28">5.5.2 High-level API flow</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-29">5.5.5 OrderProposal statuses</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-30">5.5.6 Step-by-step process description</a> <a href="#ref-for-dfn-order-uuid-31">(2)</a> <a href="#ref-for-dfn-order-uuid-32">(3)</a> <a href="#ref-for-dfn-order-uuid-33">(4)</a> <a href="#ref-for-dfn-order-uuid-34">(5)</a> <a href="#ref-for-dfn-order-uuid-35">(6)</a> <a href="#ref-for-dfn-order-uuid-36">(7)</a> <a href="#ref-for-dfn-order-uuid-37">(8)</a> <a href="#ref-for-dfn-order-uuid-38">(9)</a> <a href="#ref-for-dfn-order-uuid-39">(10)</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-40">8.2 Amending the OrderQuote before B</a> <a href="#ref-for-dfn-order-uuid-41">(2)</a> <a href="#ref-for-dfn-order-uuid-42">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-43">8.4.1 Orders Feed Inconsistencies</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-44">8.4.4 Broker: Processing the Orders feed</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-45">8.5 Amending the Order after B</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-46">9.1 Paths and Verbs</a> <a href="#ref-for-dfn-order-uuid-47">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-48">9.1.1 Order Endpoint RESTful Semantics</a> <a href="#ref-for-dfn-order-uuid-49">(2)</a> <a href="#ref-for-dfn-order-uuid-50">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-51">9.2.7 Order Deletion</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-52">10.1.1 schema:Order</a> <a href="#ref-for-dfn-order-uuid-53">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-54">10.2.2.1 Order Creation - OrderQuote, OrderProposal and Order error responses</a> <a href="#ref-for-dfn-order-uuid-55">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-56">10.2.2.2 Order Cancellation - OrderQuote, OrderProposal and Order error responses</a> <a href="#ref-for-dfn-order-uuid-57">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-order-uuid-58">11.7.1 API level authentication and data security</a> <a href="#ref-for-dfn-order-uuid-59">(2)</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-lease">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-lease">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-lease-1">5.1 Booking flow overview</a> 
  </li><li>
    <a href="#ref-for-dfn-lease-2">5.4.3 Leasing</a> <a href="#ref-for-dfn-lease-3">(2)</a> <a href="#ref-for-dfn-lease-4">(3)</a> <a href="#ref-for-dfn-lease-5">(4)</a> <a href="#ref-for-dfn-lease-6">(5)</a> <a href="#ref-for-dfn-lease-7">(6)</a> <a href="#ref-for-dfn-lease-8">(7)</a> <a href="#ref-for-dfn-lease-9">(8)</a> <a href="#ref-for-dfn-lease-10">(9)</a> <a href="#ref-for-dfn-lease-11">(10)</a> <a href="#ref-for-dfn-lease-12">(11)</a> <a href="#ref-for-dfn-lease-13">(12)</a> <a href="#ref-for-dfn-lease-14">(13)</a> 
  </li><li>
    <a href="#ref-for-dfn-lease-15">5.4.6 Step-by-step process description</a> <a href="#ref-for-dfn-lease-16">(2)</a> <a href="#ref-for-dfn-lease-17">(3)</a> <a href="#ref-for-dfn-lease-18">(4)</a> <a href="#ref-for-dfn-lease-19">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-lease-20">5.5.3 Proposal Leasing</a> <a href="#ref-for-dfn-lease-21">(2)</a> <a href="#ref-for-dfn-lease-22">(3)</a> <a href="#ref-for-dfn-lease-23">(4)</a> <a href="#ref-for-dfn-lease-24">(5)</a> <a href="#ref-for-dfn-lease-25">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-lease-26">5.5.6 Step-by-step process description</a> <a href="#ref-for-dfn-lease-27">(2)</a> <a href="#ref-for-dfn-lease-28">(3)</a> <a href="#ref-for-dfn-lease-29">(4)</a> <a href="#ref-for-dfn-lease-30">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-lease-31">8.2 Amending the OrderQuote before B</a> <a href="#ref-for-dfn-lease-32">(2)</a> <a href="#ref-for-dfn-lease-33">(3)</a> <a href="#ref-for-dfn-lease-34">(4)</a> <a href="#ref-for-dfn-lease-35">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-lease-36">9.1.1 Order Endpoint RESTful Semantics</a> 
  </li><li>
    <a href="#ref-for-dfn-lease-37">9.2.1 OrderQuote Creation C1</a> 
  </li><li>
    <a href="#ref-for-dfn-lease-38">9.2.2 OrderQuote Creation C2</a> 
  </li><li>
    <a href="#ref-for-dfn-lease-39">9.2.3 OrderQuote Deletion</a> 
  </li><li>
    <a href="#ref-for-dfn-lease-40">10.1.2 oa:OrderQuote</a> 
  </li><li>
    <a href="#ref-for-dfn-lease-41">10.1.12 oa:Lease</a> <a href="#ref-for-dfn-lease-42">(2)</a> <a href="#ref-for-dfn-lease-43">(3)</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-anonymous-lease">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-anonymous-lease">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-anonymous-lease-1">5.4.3 Leasing</a> 
  </li><li>
    <a href="#ref-for-dfn-anonymous-lease-2">5.4.6 Step-by-step process description</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-named-lease">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-named-lease">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-named-lease-1">5.4.3 Leasing</a> 
  </li><li>
    <a href="#ref-for-dfn-named-lease-2">5.4.6 Step-by-step process description</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-payment-authorisation">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-payment-authorisation">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-payment-authorisation-1">5.4.5.2 Order statuses in the Broker</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-authorisation-2">5.5.6 Step-by-step process description</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-authorisation-3">8.4.1 Orders Feed Inconsistencies</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-payment-capture">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-payment-capture">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-payment-capture-1">5.4.5.2 Order statuses in the Broker</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-capture-2">5.4.6 Step-by-step process description</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-capture-3">5.4.7.2 Booking halted at OrderCreationPaymentDue</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-capture-4">5.5.6 Step-by-step process description</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-invoice-generation">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-invoice-generation">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-invoice-generation-1">5.4.5.2 Order statuses in the Broker</a> 
  </li><li>
    <a href="#ref-for-dfn-invoice-generation-2">5.4.7.1 Booking halted at OrderCreationPaymentCaptured</a> 
  </li><li>
    <a href="#ref-for-dfn-invoice-generation-3">5.4.7.2 Booking halted at OrderCreationPaymentDue</a> 
  </li><li>
    <a href="#ref-for-dfn-invoice-generation-4">5.5.6 Step-by-step process description</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-customer-notification">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-customer-notification">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-customer-notification-1">5.4.5.2 Order statuses in the Broker</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-notification-2">5.4.7.1 Booking halted at OrderCreationPaymentCaptured</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-notification-3">5.4.7.2 Booking halted at OrderCreationPaymentDue</a> 
  </li><li>
    <a href="#ref-for-dfn-customer-notification-4">5.5.6 Step-by-step process description</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-refunds-and-cancellation">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-refunds-and-cancellation">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-refunds-and-cancellation-1">5.5.6 Step-by-step process description</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-orderproposal-version-uuid">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-orderproposal-version-uuid">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-orderproposal-version-uuid-1">5.5.6 Step-by-step process description</a> 
  </li><li>
    <a href="#ref-for-dfn-orderproposal-version-uuid-2">10.1.1 schema:Order</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-a">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-a">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-a-1">5.5.2 High-level API flow</a> 
  </li><li>
    <a href="#ref-for-dfn-a-2">5.5.7.1 Broker contract with Booking System</a> 
  </li><li>
    <a href="#ref-for-dfn-a-3">5.5.7.2 Booking System contract with the Broker</a> 
  </li><li>
    <a href="#ref-for-dfn-a-4">9.2.6 Order Creation B</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-payment-re-authorisation">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-payment-re-authorisation">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
      <li>Not referenced in this document.</li>
    </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-order">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-order">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-order-1">5.4.8.2 Booking System contract with the Broker</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-invoice">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-invoice">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-invoice-1">6.1.5 Conformance criteria</a> 
  </li><li>
    <a href="#ref-for-dfn-invoice-2">6.2.5 Conformance criteria</a> 
  </li><li>
    <a href="#ref-for-dfn-invoice-3">6.3.5 Conformance criteria</a> 
  </li><li>
    <a href="#ref-for-dfn-invoice-4">7.1 Roles and responsibilities overview</a> <a href="#ref-for-dfn-invoice-5">(2)</a> <a href="#ref-for-dfn-invoice-6">(3)</a> <a href="#ref-for-dfn-invoice-7">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-invoice-8">7.2 Invoices and Tax receipts</a> <a href="#ref-for-dfn-invoice-9">(2)</a> <a href="#ref-for-dfn-invoice-10">(3)</a> <a href="#ref-for-dfn-invoice-11">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-invoice-12">8.4.6 Cancellation, replacement, refund calculation and notification</a> <a href="#ref-for-dfn-invoice-13">(2)</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-payment">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-payment">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-payment-1">5.1 Booking flow overview</a> <a href="#ref-for-dfn-payment-2">(2)</a> <a href="#ref-for-dfn-payment-3">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-4">7.1 Roles and responsibilities overview</a> <a href="#ref-for-dfn-payment-5">(2)</a> <a href="#ref-for-dfn-payment-6">(3)</a> <a href="#ref-for-dfn-payment-7">(4)</a> <a href="#ref-for-dfn-payment-8">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-9">7.3 Payments and Refunds</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-10">7.3.1 Virtual payments</a> <a href="#ref-for-dfn-payment-11">(2)</a> <a href="#ref-for-dfn-payment-12">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-13">7.3.2 Basic Payment</a> 
  </li><li>
    <a href="#ref-for-dfn-payment-14">8.4.6 Cancellation, replacement, refund calculation and notification</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-refund">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-refund">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-refund-1">7.1 Roles and responsibilities overview</a> <a href="#ref-for-dfn-refund-2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-refund-3">7.3 Payments and Refunds</a> 
  </li><li>
    <a href="#ref-for-dfn-refund-4">8.4.6 Cancellation, replacement, refund calculation and notification</a> <a href="#ref-for-dfn-refund-5">(2)</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-free-opportunities">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-free-opportunities">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-free-opportunities-1">7.6.1 Free opportunities</a> 
  </li><li>
    <a href="#ref-for-dfn-free-opportunities-2">7.7 Offer overrides</a> 
  </li><li>
    <a href="#ref-for-dfn-free-opportunities-3">8.4.6 Cancellation, replacement, refund calculation and notification</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-bookability">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-bookability">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-bookability-1">1.1.1 Out of Scope in this version</a> 
  </li><li>
    <a href="#ref-for-dfn-bookability-2">5.3 Booking pre-conditions</a> 
  </li><li>
    <a href="#ref-for-dfn-bookability-3">5.4.6 Step-by-step process description</a> 
  </li><li>
    <a href="#ref-for-dfn-bookability-4">7.3.3 DynamicPayment</a> 
  </li><li>
    <a href="#ref-for-dfn-bookability-5">8.1 Definition of a 'bookable' Opportunity and Offer pair</a> <a href="#ref-for-dfn-bookability-6">(2)</a> <a href="#ref-for-dfn-bookability-7">(3)</a> <a href="#ref-for-dfn-bookability-8">(4)</a> <a href="#ref-for-dfn-bookability-9">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-bookability-10">8.1.1 Booking restrictions</a> <a href="#ref-for-dfn-bookability-11">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-bookability-12">8.1.2 Opportunity data properties</a> <a href="#ref-for-dfn-bookability-13">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-bookability-14">8.4.3.1 totalPaymentDue invariant</a> 
  </li><li>
    <a href="#ref-for-dfn-bookability-15">10.1.6 schema:OrderItem</a> 
  </li><li>
    <a href="#ref-for-dfn-bookability-16">10.1.7 schema:Offer</a> 
  </li><li>
    <a href="#ref-for-dfn-bookability-17">10.2.2.3 Order Creation - OrderItem errors</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-orders-feed">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-orders-feed">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-orders-feed-1">5.4.2 High-level API flow</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-2">5.4.6 Step-by-step process description</a> <a href="#ref-for-dfn-orders-feed-3">(2)</a> <a href="#ref-for-dfn-orders-feed-4">(3)</a> <a href="#ref-for-dfn-orders-feed-5">(4)</a> <a href="#ref-for-dfn-orders-feed-6">(5)</a> <a href="#ref-for-dfn-orders-feed-7">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-8">5.4.7.3 Booking halted at OrderCreationPaymentAuthorized</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-9">5.4.8.1 Broker contract with Booking System</a> <a href="#ref-for-dfn-orders-feed-10">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-11">5.4.8.2 Booking System contract with the Broker</a> <a href="#ref-for-dfn-orders-feed-12">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-13">5.5.2 High-level API flow</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-14">5.5.5 OrderProposal statuses</a> <a href="#ref-for-dfn-orders-feed-15">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-16">5.5.5.1.1 Proposal Approval</a> <a href="#ref-for-dfn-orders-feed-17">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-18">5.5.5.1.2 Proposal Rejection</a> <a href="#ref-for-dfn-orders-feed-19">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-20">5.5.5.2 Proposal Amendment</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-21">5.5.5.3 Message Exchange</a> <a href="#ref-for-dfn-orders-feed-22">(2)</a> <a href="#ref-for-dfn-orders-feed-23">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-24">5.5.6 Step-by-step process description</a> <a href="#ref-for-dfn-orders-feed-25">(2)</a> <a href="#ref-for-dfn-orders-feed-26">(3)</a> <a href="#ref-for-dfn-orders-feed-27">(4)</a> <a href="#ref-for-dfn-orders-feed-28">(5)</a> <a href="#ref-for-dfn-orders-feed-29">(6)</a> <a href="#ref-for-dfn-orders-feed-30">(7)</a> <a href="#ref-for-dfn-orders-feed-31">(8)</a> <a href="#ref-for-dfn-orders-feed-32">(9)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-33">5.5.7.1 Broker contract with Booking System</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-34">5.5.7.2 Booking System contract with the Broker</a> <a href="#ref-for-dfn-orders-feed-35">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-36">7.2 Invoices and Tax receipts</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-37">7.3.3 DynamicPayment</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-38">8.1.2 Opportunity data properties</a> <a href="#ref-for-dfn-orders-feed-39">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-40">8.1.3 acceptedOffer properties</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-41">8.3 Cancellation after B</a> <a href="#ref-for-dfn-orders-feed-42">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-43">8.3.2 Customer requested cancellation</a> <a href="#ref-for-dfn-orders-feed-44">(2)</a> <a href="#ref-for-dfn-orders-feed-45">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-46">8.3.3 Seller requested cancellation</a> <a href="#ref-for-dfn-orders-feed-47">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-48">8.4 Orders feed: Notifications, updates and refunds</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-49">8.4.1 Orders Feed Inconsistencies</a> <a href="#ref-for-dfn-orders-feed-50">(2)</a> <a href="#ref-for-dfn-orders-feed-51">(3)</a> <a href="#ref-for-dfn-orders-feed-52">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-53">8.4.2 Order stores with eventual consistency</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-54">8.4.3 Booking System: Updating the Orders feed</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-55">8.4.3.1 totalPaymentDue invariant</a> <a href="#ref-for-dfn-orders-feed-56">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-57">8.4.4 Broker: Processing the Orders feed</a> <a href="#ref-for-dfn-orders-feed-58">(2)</a> <a href="#ref-for-dfn-orders-feed-59">(3)</a> <a href="#ref-for-dfn-orders-feed-60">(4)</a> <a href="#ref-for-dfn-orders-feed-61">(5)</a> <a href="#ref-for-dfn-orders-feed-62">(6)</a> <a href="#ref-for-dfn-orders-feed-63">(7)</a> <a href="#ref-for-dfn-orders-feed-64">(8)</a> <a href="#ref-for-dfn-orders-feed-65">(9)</a> <a href="#ref-for-dfn-orders-feed-66">(10)</a> <a href="#ref-for-dfn-orders-feed-67">(11)</a> <a href="#ref-for-dfn-orders-feed-68">(12)</a> <a href="#ref-for-dfn-orders-feed-69">(13)</a> <a href="#ref-for-dfn-orders-feed-70">(14)</a> <a href="#ref-for-dfn-orders-feed-71">(15)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-72">8.4.5 New Orders and OrderProposals</a> <a href="#ref-for-dfn-orders-feed-73">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-74">8.4.6 Cancellation, replacement, refund calculation and notification</a> <a href="#ref-for-dfn-orders-feed-75">(2)</a> <a href="#ref-for-dfn-orders-feed-76">(3)</a> <a href="#ref-for-dfn-orders-feed-77">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-78">8.4.8 Customer notice notifications</a> <a href="#ref-for-dfn-orders-feed-79">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-80">8.4.9 Change of logistics notifications</a> <a href="#ref-for-dfn-orders-feed-81">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-82">8.4.10 Opportunity attendance updates</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-83">8.4.11 Other notifications</a> <a href="#ref-for-dfn-orders-feed-84">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-85">8.5 Amending the Order after B</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-86">9.1 Paths and Verbs</a> <a href="#ref-for-dfn-orders-feed-87">(2)</a> <a href="#ref-for-dfn-orders-feed-88">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-89">9.1.1 Order Endpoint RESTful Semantics</a> <a href="#ref-for-dfn-orders-feed-90">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-91">9.2.6 Order Creation B</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-92">9.2.7 Order Deletion</a> <a href="#ref-for-dfn-orders-feed-93">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-94">9.2.9 Orders RPDE feed</a> <a href="#ref-for-dfn-orders-feed-95">(2)</a> <a href="#ref-for-dfn-orders-feed-96">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-97">10.1.1 schema:Order</a> <a href="#ref-for-dfn-orders-feed-98">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-99">10.1.3 oa:OrderProposal</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-100">10.1.6 schema:OrderItem</a> <a href="#ref-for-dfn-orders-feed-101">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-102">11.2.1 Realtime Paged Data Exchange 1.0</a> <a href="#ref-for-dfn-orders-feed-103">(2)</a> <a href="#ref-for-dfn-orders-feed-104">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-105">11.3 Response formats</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-106">11.7 Authentication</a> <a href="#ref-for-dfn-orders-feed-107">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-108">11.7.4.1 OAuth Flows and Scopes</a> <a href="#ref-for-dfn-orders-feed-109">(2)</a> <a href="#ref-for-dfn-orders-feed-110">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-orders-feed-111">11.7.4.1.2 Client Credentials Flow</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-cancellation">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-cancellation">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-cancellation-1">8.4.3.1 totalPaymentDue invariant</a> 
  </li><li>
    <a href="#ref-for-dfn-cancellation-2">8.4.6 Cancellation, replacement, refund calculation and notification</a> <a href="#ref-for-dfn-cancellation-3">(2)</a> <a href="#ref-for-dfn-cancellation-4">(3)</a> <a href="#ref-for-dfn-cancellation-5">(4)</a> <a href="#ref-for-dfn-cancellation-6">(5)</a> <a href="#ref-for-dfn-cancellation-7">(6)</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-replacement">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-replacement">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-replacement-1">8.1.2 Opportunity data properties</a> 
  </li><li>
    <a href="#ref-for-dfn-replacement-2">8.1.3 acceptedOffer properties</a> 
  </li><li>
    <a href="#ref-for-dfn-replacement-3">8.4.3.1 totalPaymentDue invariant</a> <a href="#ref-for-dfn-replacement-4">(2)</a> <a href="#ref-for-dfn-replacement-5">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-replacement-6">8.4.4 Broker: Processing the Orders feed</a> <a href="#ref-for-dfn-replacement-7">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-replacement-8">8.4.6 Cancellation, replacement, refund calculation and notification</a> <a href="#ref-for-dfn-replacement-9">(2)</a> <a href="#ref-for-dfn-replacement-10">(3)</a> <a href="#ref-for-dfn-replacement-11">(4)</a> <a href="#ref-for-dfn-replacement-12">(5)</a> <a href="#ref-for-dfn-replacement-13">(6)</a> <a href="#ref-for-dfn-replacement-14">(7)</a> <a href="#ref-for-dfn-replacement-15">(8)</a> <a href="#ref-for-dfn-replacement-16">(9)</a> 
  </li><li>
    <a href="#ref-for-dfn-replacement-17">8.4.9 Change of logistics notifications</a> 
  </li><li>
    <a href="#ref-for-dfn-replacement-18">8.5 Amending the Order after B</a> <a href="#ref-for-dfn-replacement-19">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-replacement-20">9.2.9 Orders RPDE feed</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-base-uri">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-base-uri">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-base-uri-1">9. Endpoints</a> 
  </li><li>
    <a href="#ref-for-dfn-base-uri-2">9.1 Paths and Verbs</a> <a href="#ref-for-dfn-base-uri-3">(2)</a> <a href="#ref-for-dfn-base-uri-4">(3)</a> <a href="#ref-for-dfn-base-uri-5">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-base-uri-6">10.1.1 schema:Order</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-c1">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-c1">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-c1-1">5.4.2 High-level API flow</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-2">5.4.3 Leasing</a> <a href="#ref-for-dfn-c1-3">(2)</a> <a href="#ref-for-dfn-c1-4">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-5">5.4.4 High-level type flow</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-6">5.4.6 Step-by-step process description</a> <a href="#ref-for-dfn-c1-7">(2)</a> <a href="#ref-for-dfn-c1-8">(3)</a> <a href="#ref-for-dfn-c1-9">(4)</a> <a href="#ref-for-dfn-c1-10">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-11">5.4.8.1 Broker contract with Booking System</a> <a href="#ref-for-dfn-c1-12">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-13">5.4.8.2 Booking System contract with the Broker</a> <a href="#ref-for-dfn-c1-14">(2)</a> <a href="#ref-for-dfn-c1-15">(3)</a> <a href="#ref-for-dfn-c1-16">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-17">5.5.2 High-level API flow</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-18">5.5.3 Proposal Leasing</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-19">5.5.6 Step-by-step process description</a> <a href="#ref-for-dfn-c1-20">(2)</a> <a href="#ref-for-dfn-c1-21">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-22">7.3.2.1 Payment reconciliation detail validation</a> <a href="#ref-for-dfn-c1-23">(2)</a> <a href="#ref-for-dfn-c1-24">(3)</a> <a href="#ref-for-dfn-c1-25">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-26">7.3.3 DynamicPayment</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-27">7.5 Tax mode</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-28">7.6 Booking without payment</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-29">7.6.1 Free opportunities</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-30">7.7 Offer overrides</a> <a href="#ref-for-dfn-c1-31">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-32">8.1.2 Opportunity data properties</a> <a href="#ref-for-dfn-c1-33">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-34">8.1.3 acceptedOffer properties</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-35">8.2 Amending the OrderQuote before B</a> <a href="#ref-for-dfn-c1-36">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-37">9.1 Paths and Verbs</a> <a href="#ref-for-dfn-c1-38">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-39">9.2.1 OrderQuote Creation C1</a> <a href="#ref-for-dfn-c1-40">(2)</a> <a href="#ref-for-dfn-c1-41">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-42">9.2.4 OrderProposal Creation P</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-43">9.2.6 Order Creation B</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-44">9.2.7 Order Deletion</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-45">10.1.1 schema:Order</a> 
  </li><li>
    <a href="#ref-for-dfn-c1-46">10.1.6 schema:OrderItem</a> <a href="#ref-for-dfn-c1-47">(2)</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-c2">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-c2">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-c2-1">5.4.2 High-level API flow</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-2">5.4.3 Leasing</a> <a href="#ref-for-dfn-c2-3">(2)</a> <a href="#ref-for-dfn-c2-4">(3)</a> <a href="#ref-for-dfn-c2-5">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-6">5.4.4 High-level type flow</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-7">5.4.6 Step-by-step process description</a> <a href="#ref-for-dfn-c2-8">(2)</a> <a href="#ref-for-dfn-c2-9">(3)</a> <a href="#ref-for-dfn-c2-10">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-11">5.4.8.1 Broker contract with Booking System</a> <a href="#ref-for-dfn-c2-12">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-13">5.4.8.2 Booking System contract with the Broker</a> <a href="#ref-for-dfn-c2-14">(2)</a> <a href="#ref-for-dfn-c2-15">(3)</a> <a href="#ref-for-dfn-c2-16">(4)</a> <a href="#ref-for-dfn-c2-17">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-18">5.5.2 High-level API flow</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-19">5.5.3 Proposal Leasing</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-20">5.5.6 Step-by-step process description</a> <a href="#ref-for-dfn-c2-21">(2)</a> <a href="#ref-for-dfn-c2-22">(3)</a> <a href="#ref-for-dfn-c2-23">(4)</a> <a href="#ref-for-dfn-c2-24">(5)</a> <a href="#ref-for-dfn-c2-25">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-26">5.6.2 Attendee Details capture</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-27">5.6.3.4 Form validation and auto-fill</a> <a href="#ref-for-dfn-c2-28">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-29">7.3.2.1 Payment reconciliation detail validation</a> <a href="#ref-for-dfn-c2-30">(2)</a> <a href="#ref-for-dfn-c2-31">(3)</a> <a href="#ref-for-dfn-c2-32">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-33">7.3.3 DynamicPayment</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-34">7.5 Tax mode</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-35">7.6 Booking without payment</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-36">7.6.1 Free opportunities</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-37">7.7 Offer overrides</a> <a href="#ref-for-dfn-c2-38">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-39">8.1.2 Opportunity data properties</a> <a href="#ref-for-dfn-c2-40">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-41">8.1.3 acceptedOffer properties</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-42">8.2 Amending the OrderQuote before B</a> <a href="#ref-for-dfn-c2-43">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-44">8.5 Amending the Order after B</a> <a href="#ref-for-dfn-c2-45">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-46">9.1 Paths and Verbs</a> <a href="#ref-for-dfn-c2-47">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-48">9.2.1 OrderQuote Creation C1</a> <a href="#ref-for-dfn-c2-49">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-50">9.2.2 OrderQuote Creation C2</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-51">9.2.4 OrderProposal Creation P</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-52">9.2.6 Order Creation B</a> <a href="#ref-for-dfn-c2-53">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-54">9.2.7 Order Deletion</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-55">10.1.1 schema:Order</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-56">10.1.6 schema:OrderItem</a> <a href="#ref-for-dfn-c2-57">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-c2-58">10.2.2.1 Order Creation - OrderQuote, OrderProposal and Order error responses</a> <a href="#ref-for-dfn-c2-59">(2)</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-orderquote-deletion">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-orderquote-deletion">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-orderquote-deletion-1">9.1 Paths and Verbs</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-p">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-p">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-p-1">5.5.2 High-level API flow</a> 
  </li><li>
    <a href="#ref-for-dfn-p-2">5.5.5.1.1 Proposal Approval</a> 
  </li><li>
    <a href="#ref-for-dfn-p-3">5.5.6 Step-by-step process description</a> <a href="#ref-for-dfn-p-4">(2)</a> <a href="#ref-for-dfn-p-5">(3)</a> <a href="#ref-for-dfn-p-6">(4)</a> <a href="#ref-for-dfn-p-7">(5)</a> <a href="#ref-for-dfn-p-8">(6)</a> 
  </li><li>
    <a href="#ref-for-dfn-p-9">5.5.7.1 Broker contract with Booking System</a> <a href="#ref-for-dfn-p-10">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-p-11">5.5.7.2 Booking System contract with the Broker</a> <a href="#ref-for-dfn-p-12">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-p-13">7.3.2.1 Payment reconciliation detail validation</a> <a href="#ref-for-dfn-p-14">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-p-15">7.3.3 DynamicPayment</a> 
  </li><li>
    <a href="#ref-for-dfn-p-16">7.5 Tax mode</a> 
  </li><li>
    <a href="#ref-for-dfn-p-17">7.6 Booking without payment</a> <a href="#ref-for-dfn-p-18">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-p-19">7.6.1 Free opportunities</a> 
  </li><li>
    <a href="#ref-for-dfn-p-20">7.6.2 Payment error conditions</a> 
  </li><li>
    <a href="#ref-for-dfn-p-21">7.7 Offer overrides</a> <a href="#ref-for-dfn-p-22">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-p-23">8.1.2 Opportunity data properties</a> <a href="#ref-for-dfn-p-24">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-p-25">8.1.3 acceptedOffer properties</a> 
  </li><li>
    <a href="#ref-for-dfn-p-26">8.4 Orders feed: Notifications, updates and refunds</a> 
  </li><li>
    <a href="#ref-for-dfn-p-27">8.4.4 Broker: Processing the Orders feed</a> <a href="#ref-for-dfn-p-28">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-p-29">8.4.5 New Orders and OrderProposals</a> 
  </li><li>
    <a href="#ref-for-dfn-p-30">9.1 Paths and Verbs</a> 
  </li><li>
    <a href="#ref-for-dfn-p-31">9.2.4 OrderProposal Creation P</a> <a href="#ref-for-dfn-p-32">(2)</a> <a href="#ref-for-dfn-p-33">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-p-34">9.2.7 Order Deletion</a> 
  </li><li>
    <a href="#ref-for-dfn-p-35">10.1.1 schema:Order</a> 
  </li><li>
    <a href="#ref-for-dfn-p-36">10.1.6 schema:OrderItem</a> <a href="#ref-for-dfn-p-37">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-p-38">10.2.2.1 Order Creation - OrderQuote, OrderProposal and Order error responses</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-orderproposal-update">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-orderproposal-update">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-orderproposal-update-1">9.1 Paths and Verbs</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-b">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-b">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-b-1">5.4.2 High-level API flow</a> 
  </li><li>
    <a href="#ref-for-dfn-b-2">5.4.3 Leasing</a> 
  </li><li>
    <a href="#ref-for-dfn-b-3">5.4.4 High-level type flow</a> 
  </li><li>
    <a href="#ref-for-dfn-b-4">5.4.5 Order statuses</a> 
  </li><li>
    <a href="#ref-for-dfn-b-5">5.4.5.2 Order statuses in the Broker</a> 
  </li><li>
    <a href="#ref-for-dfn-b-6">5.4.6 Step-by-step process description</a> <a href="#ref-for-dfn-b-7">(2)</a> <a href="#ref-for-dfn-b-8">(3)</a> <a href="#ref-for-dfn-b-9">(4)</a> <a href="#ref-for-dfn-b-10">(5)</a> <a href="#ref-for-dfn-b-11">(6)</a> <a href="#ref-for-dfn-b-12">(7)</a> <a href="#ref-for-dfn-b-13">(8)</a> <a href="#ref-for-dfn-b-14">(9)</a> <a href="#ref-for-dfn-b-15">(10)</a> <a href="#ref-for-dfn-b-16">(11)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-17">5.4.8.1 Broker contract with Booking System</a> <a href="#ref-for-dfn-b-18">(2)</a> <a href="#ref-for-dfn-b-19">(3)</a> <a href="#ref-for-dfn-b-20">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-21">5.4.8.2 Booking System contract with the Broker</a> <a href="#ref-for-dfn-b-22">(2)</a> <a href="#ref-for-dfn-b-23">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-24">5.5.2 High-level API flow</a> 
  </li><li>
    <a href="#ref-for-dfn-b-25">5.5.5 OrderProposal statuses</a> <a href="#ref-for-dfn-b-26">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-27">5.5.5.1.1 Proposal Approval</a> <a href="#ref-for-dfn-b-28">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-29">5.5.5.2 Proposal Amendment</a> 
  </li><li>
    <a href="#ref-for-dfn-b-30">5.5.6 Step-by-step process description</a> <a href="#ref-for-dfn-b-31">(2)</a> <a href="#ref-for-dfn-b-32">(3)</a> <a href="#ref-for-dfn-b-33">(4)</a> <a href="#ref-for-dfn-b-34">(5)</a> <a href="#ref-for-dfn-b-35">(6)</a> <a href="#ref-for-dfn-b-36">(7)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-37">5.5.7.1 Broker contract with Booking System</a> 
  </li><li>
    <a href="#ref-for-dfn-b-38">7.2 Invoices and Tax receipts</a> <a href="#ref-for-dfn-b-39">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-40">7.3.2.1 Payment reconciliation detail validation</a> <a href="#ref-for-dfn-b-41">(2)</a> <a href="#ref-for-dfn-b-42">(3)</a> <a href="#ref-for-dfn-b-43">(4)</a> <a href="#ref-for-dfn-b-44">(5)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-45">7.3.3 DynamicPayment</a> 
  </li><li>
    <a href="#ref-for-dfn-b-46">7.5 Tax mode</a> 
  </li><li>
    <a href="#ref-for-dfn-b-47">7.6 Booking without payment</a> <a href="#ref-for-dfn-b-48">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-49">7.6.1 Free opportunities</a> 
  </li><li>
    <a href="#ref-for-dfn-b-50">7.6.2 Payment error conditions</a> 
  </li><li>
    <a href="#ref-for-dfn-b-51">7.7 Offer overrides</a> <a href="#ref-for-dfn-b-52">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-53">8.1.2 Opportunity data properties</a> <a href="#ref-for-dfn-b-54">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-55">8.1.3 acceptedOffer properties</a> 
  </li><li>
    <a href="#ref-for-dfn-b-56">8.2 Amending the OrderQuote before B</a> 
  </li><li>
    <a href="#ref-for-dfn-b-57">8.3 Cancellation after B</a> <a href="#ref-for-dfn-b-58">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-59">8.4 Orders feed: Notifications, updates and refunds</a> 
  </li><li>
    <a href="#ref-for-dfn-b-60">8.4.1 Orders Feed Inconsistencies</a> 
  </li><li>
    <a href="#ref-for-dfn-b-61">8.4.3.1 totalPaymentDue invariant</a> 
  </li><li>
    <a href="#ref-for-dfn-b-62">8.4.4 Broker: Processing the Orders feed</a> <a href="#ref-for-dfn-b-63">(2)</a> <a href="#ref-for-dfn-b-64">(3)</a> <a href="#ref-for-dfn-b-65">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-66">8.4.5 New Orders and OrderProposals</a> 
  </li><li>
    <a href="#ref-for-dfn-b-67">8.4.6 Cancellation, replacement, refund calculation and notification</a> 
  </li><li>
    <a href="#ref-for-dfn-b-68">8.4.9 Change of logistics notifications</a> 
  </li><li>
    <a href="#ref-for-dfn-b-69">8.5 Amending the Order after B</a> <a href="#ref-for-dfn-b-70">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-71">8.6 Delivery of Terms and Conditions and Privacy Policy</a> 
  </li><li>
    <a href="#ref-for-dfn-b-72">8.7.3 Extension point for barcode-based access control</a> 
  </li><li>
    <a href="#ref-for-dfn-b-73">8.7.4 Remote access control</a> <a href="#ref-for-dfn-b-74">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-75">9.1 Paths and Verbs</a> 
  </li><li>
    <a href="#ref-for-dfn-b-76">9.2.1 OrderQuote Creation C1</a> 
  </li><li>
    <a href="#ref-for-dfn-b-77">9.2.2 OrderQuote Creation C2</a> 
  </li><li>
    <a href="#ref-for-dfn-b-78">9.2.4 OrderProposal Creation P</a> 
  </li><li>
    <a href="#ref-for-dfn-b-79">9.2.6 Order Creation B</a> <a href="#ref-for-dfn-b-80">(2)</a> <a href="#ref-for-dfn-b-81">(3)</a> <a href="#ref-for-dfn-b-82">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-83">9.2.7 Order Deletion</a> 
  </li><li>
    <a href="#ref-for-dfn-b-84">10.1.1 schema:Order</a> <a href="#ref-for-dfn-b-85">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-86">10.1.6 schema:OrderItem</a> <a href="#ref-for-dfn-b-87">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-88">10.2.2.1 Order Creation - OrderQuote, OrderProposal and Order error responses</a> <a href="#ref-for-dfn-b-89">(2)</a> <a href="#ref-for-dfn-b-90">(3)</a> <a href="#ref-for-dfn-b-91">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-b-92">11.2.3.1 Extension example: Member booking</a> 
  </li><li>
    <a href="#ref-for-dfn-b-93">11.2.3.2 Extension example: Additional information during the ordering process</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-order-deletion">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-order-deletion">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-order-deletion-1">9.1 Paths and Verbs</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-order-cancellation">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-order-cancellation">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-order-cancellation-1">8.3.1 Refund after the opportunity has occurred</a> 
  </li><li>
    <a href="#ref-for-dfn-order-cancellation-2">8.3.2 Customer requested cancellation</a> 
  </li><li>
    <a href="#ref-for-dfn-order-cancellation-3">8.5 Amending the Order after B</a> 
  </li><li>
    <a href="#ref-for-dfn-order-cancellation-4">9.1 Paths and Verbs</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-order-status">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-order-status">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-order-status-1">8.1.2 Opportunity data properties</a> 
  </li><li>
    <a href="#ref-for-dfn-order-status-2">9.1 Paths and Verbs</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-id">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-id">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-id-1">5.4.6 Step-by-step process description</a> <a href="#ref-for-dfn-id-2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-id-3">5.4.8.1 Broker contract with Booking System</a> 
  </li><li>
    <a href="#ref-for-dfn-id-4">5.5.6 Step-by-step process description</a> <a href="#ref-for-dfn-id-5">(2)</a> <a href="#ref-for-dfn-id-6">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-id-7">5.5.7.1 Broker contract with Booking System</a> 
  </li><li>
    <a href="#ref-for-dfn-id-8">5.6.2 Attendee Details capture</a> 
  </li><li>
    <a href="#ref-for-dfn-id-9">5.6.3.4 Form validation and auto-fill</a> <a href="#ref-for-dfn-id-10">(2)</a> <a href="#ref-for-dfn-id-11">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-id-12">8.1 Definition of a 'bookable' Opportunity and Offer pair</a> <a href="#ref-for-dfn-id-13">(2)</a> <a href="#ref-for-dfn-id-14">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-id-15">8.1.2 Opportunity data properties</a> <a href="#ref-for-dfn-id-16">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-id-17">8.3.1 Refund after the opportunity has occurred</a> 
  </li><li>
    <a href="#ref-for-dfn-id-18">8.3.2 Customer requested cancellation</a> 
  </li><li>
    <a href="#ref-for-dfn-id-19">8.4.4 Broker: Processing the Orders feed</a> <a href="#ref-for-dfn-id-20">(2)</a> <a href="#ref-for-dfn-id-21">(3)</a> <a href="#ref-for-dfn-id-22">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-id-23">8.4.6 Cancellation, replacement, refund calculation and notification</a> 
  </li><li>
    <a href="#ref-for-dfn-id-24">8.4.9 Change of logistics notifications</a> <a href="#ref-for-dfn-id-25">(2)</a> <a href="#ref-for-dfn-id-26">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-id-27">9.2.6 Order Creation B</a> 
  </li><li>
    <a href="#ref-for-dfn-id-28">9.2.8 Order Cancellation</a> 
  </li><li>
    <a href="#ref-for-dfn-id-29">9.2.9 Orders RPDE feed</a> 
  </li><li>
    <a href="#ref-for-dfn-id-30">10.1.1 schema:Order</a> <a href="#ref-for-dfn-id-31">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-id-32">10.1.4 schema:Organization or schema:Person for seller</a> 
  </li><li>
    <a href="#ref-for-dfn-id-33">10.1.6 schema:OrderItem</a> <a href="#ref-for-dfn-id-34">(2)</a> <a href="#ref-for-dfn-id-35">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-id-36">10.1.7 schema:Offer</a> 
  </li><li>
    <a href="#ref-for-dfn-id-37">10.1.8 schema:OfferOverride</a> 
  </li><li>
    <a href="#ref-for-dfn-id-38">10.1.21 schema:PropertyValueSpecification</a> 
  </li><li>
    <a href="#ref-for-dfn-id-39">10.1.26 schema:PropertyValue</a> 
  </li><li>
    <a href="#ref-for-dfn-id-40">11.3.1 Globally unique identifiers</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-authentication-credentials">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-authentication-credentials">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-authentication-credentials-1">5.4.6 Step-by-step process description</a> 
  </li><li>
    <a href="#ref-for-dfn-authentication-credentials-2">10.1.9 schema:Person for customer or attendee</a> 
  </li><li>
    <a href="#ref-for-dfn-authentication-credentials-3">11.5 Rate Limiting</a> 
  </li><li>
    <a href="#ref-for-dfn-authentication-credentials-4">11.7 Authentication</a> <a href="#ref-for-dfn-authentication-credentials-5">(2)</a> <a href="#ref-for-dfn-authentication-credentials-6">(3)</a> <a href="#ref-for-dfn-authentication-credentials-7">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-authentication-credentials-8">11.7.1 API level authentication and data security</a> <a href="#ref-for-dfn-authentication-credentials-9">(2)</a> <a href="#ref-for-dfn-authentication-credentials-10">(3)</a> <a href="#ref-for-dfn-authentication-credentials-11">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-authentication-credentials-12">11.7.2 Middleware as a catalyst</a> <a href="#ref-for-dfn-authentication-credentials-13">(2)</a> <a href="#ref-for-dfn-authentication-credentials-14">(3)</a> <a href="#ref-for-dfn-authentication-credentials-15">(4)</a> <a href="#ref-for-dfn-authentication-credentials-16">(5)</a> <a href="#ref-for-dfn-authentication-credentials-17">(6)</a> <a href="#ref-for-dfn-authentication-credentials-18">(7)</a> <a href="#ref-for-dfn-authentication-credentials-19">(8)</a> <a href="#ref-for-dfn-authentication-credentials-20">(9)</a> <a href="#ref-for-dfn-authentication-credentials-21">(10)</a> <a href="#ref-for-dfn-authentication-credentials-22">(11)</a> <a href="#ref-for-dfn-authentication-credentials-23">(12)</a> <a href="#ref-for-dfn-authentication-credentials-24">(13)</a> <a href="#ref-for-dfn-authentication-credentials-25">(14)</a> <a href="#ref-for-dfn-authentication-credentials-26">(15)</a> 
  </li><li>
    <a href="#ref-for-dfn-authentication-credentials-27">11.7.4.1 OAuth Flows and Scopes</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-booking-partner">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-booking-partner">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-booking-partner-1">4. Key Actors</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-partner-2">10.1.9 schema:Person for customer or attendee</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-partner-3">11.7 Authentication</a> <a href="#ref-for-dfn-booking-partner-4">(2)</a> <a href="#ref-for-dfn-booking-partner-5">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-partner-6">11.7.1 API level authentication and data security</a> <a href="#ref-for-dfn-booking-partner-7">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-partner-8">11.7.2 Middleware as a catalyst</a> <a href="#ref-for-dfn-booking-partner-9">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-partner-10">11.7.4 OpenID Connect Booking Partner Authentication for Multiple Seller Systems</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-partner-11">11.7.4.1 OAuth Flows and Scopes</a> <a href="#ref-for-dfn-booking-partner-12">(2)</a> <a href="#ref-for-dfn-booking-partner-13">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-partner-14">11.7.4.1.1 Authorization Code Flow</a> <a href="#ref-for-dfn-booking-partner-15">(2)</a> <a href="#ref-for-dfn-booking-partner-16">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-partner-17">11.7.4.2.1 ID Token claims</a> <a href="#ref-for-dfn-booking-partner-18">(2)</a> <a href="#ref-for-dfn-booking-partner-19">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-booking-partner-20">11.7.4.2.2 Access Token claims</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-middleware">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-middleware">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-middleware-1">11.7 Authentication</a> 
  </li><li>
    <a href="#ref-for-dfn-middleware-2">11.7.2 Middleware as a catalyst</a> <a href="#ref-for-dfn-middleware-3">(2)</a> <a href="#ref-for-dfn-middleware-4">(3)</a> <a href="#ref-for-dfn-middleware-5">(4)</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-access-token">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-access-token">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-access-token-1">11.7.4.1 OAuth Flows and Scopes</a> <a href="#ref-for-dfn-access-token-2">(2)</a> <a href="#ref-for-dfn-access-token-3">(3)</a> 
  </li><li>
    <a href="#ref-for-dfn-access-token-4">11.7.4.1.1 Authorization Code Flow</a> <a href="#ref-for-dfn-access-token-5">(2)</a> <a href="#ref-for-dfn-access-token-6">(3)</a> <a href="#ref-for-dfn-access-token-7">(4)</a> 
  </li><li>
    <a href="#ref-for-dfn-access-token-8">11.7.4.1.2 Client Credentials Flow</a> 
  </li><li>
    <a href="#ref-for-dfn-access-token-9">11.7.4.2 Custom Claims</a> 
  </li><li>
    <a href="#ref-for-dfn-access-token-10">11.7.4.2.1 ID Token claims</a> 
  </li><li>
    <a href="#ref-for-dfn-access-token-11">11.7.4.2.2 Access Token claims</a> <a href="#ref-for-dfn-access-token-12">(2)</a> <a href="#ref-for-dfn-access-token-13">(3)</a> <a href="#ref-for-dfn-access-token-14">(4)</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-scope">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-scope">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-scope-1">11.7.4 OpenID Connect Booking Partner Authentication for Multiple Seller Systems</a> 
  </li><li>
    <a href="#ref-for-dfn-scope-2">11.7.4.1 OAuth Flows and Scopes</a> 
  </li><li>
    <a href="#ref-for-dfn-scope-3">11.7.4.1.1 Authorization Code Flow</a> <a href="#ref-for-dfn-scope-4">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-scope-5">11.7.4.1.2 Client Credentials Flow</a> <a href="#ref-for-dfn-scope-6">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-scope-7">11.7.4.2.1 ID Token claims</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-authorization-code-flow">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-authorization-code-flow">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-authorization-code-flow-1">11.7.4.1 OAuth Flows and Scopes</a> <a href="#ref-for-dfn-authorization-code-flow-2">(2)</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-refresh-token">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-refresh-token">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-refresh-token-1">11.7.4.1.1 Authorization Code Flow</a> <a href="#ref-for-dfn-refresh-token-2">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-refresh-token-3">11.7.4.2.1 ID Token claims</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-id-token">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-id-token">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-id-token-1">11.7.4.1.1 Authorization Code Flow</a> 
  </li><li>
    <a href="#ref-for-dfn-id-token-2">11.7.4.2 Custom Claims</a> 
  </li><li>
    <a href="#ref-for-dfn-id-token-3">11.7.4.2.1 ID Token claims</a> <a href="#ref-for-dfn-id-token-4">(2)</a> 
  </li><li>
    <a href="#ref-for-dfn-id-token-5">11.7.4.2.2 Access Token claims</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-client-credentials-flow">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-client-credentials-flow">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-client-credentials-flow-1">11.7.4.1 OAuth Flows and Scopes</a> <a href="#ref-for-dfn-client-credentials-flow-2">(2)</a> 
  </li>
  </ul>
    </aside><aside class="dfn-panel" hidden="" id="dfn-panel-for-dfn-claims">
      <span class="caret"></span>
      <div>
        <a class="self-link" href="#dfn-claims">Permalink</a>
         
      </div>
      <b>Referenced in:</b>
      <ul>
    <li>
    <a href="#ref-for-dfn-claims-1">11.7.4 OpenID Connect Booking Partner Authentication for Multiple Seller Systems</a> 
  </li><li>
    <a href="#ref-for-dfn-claims-2">11.7.4.1 OAuth Flows and Scopes</a> 
  </li><li>
    <a href="#ref-for-dfn-claims-3">11.7.4.2 Custom Claims</a> 
  </li><li>
    <a href="#ref-for-dfn-claims-4">11.7.4.2.1 ID Token claims</a> 
  </li>
  </ul>
    </aside><script id="respec-dfn-panel">(() => {
// @ts-check
if (document.respec) {
  document.respec.ready.then(dfnPanel);
} else {
  dfnPanel();
}

function dfnPanel() {
  /** @type {HTMLElement} */
  let panel;
  document.body.addEventListener("click", event => {
    if (!(event.target instanceof HTMLElement)) return;

    /** @type {HTMLElement} */
    const el = event.target;

    const action = deriveAction(el);
    switch (action) {
      case "show": {
        if (panel) hidePanel(panel);
        /** @type {HTMLElement} */
        const dfn = el.closest("dfn, .index-term");
        panel = document.getElementById(`dfn-panel-for-${dfn.id}`);
        displayPanel(dfn, panel, { x: event.clientX, y: event.clientY });
        break;
      }
      case "dock": {
        panel.style.left = null;
        panel.style.top = null;
        panel.classList.add("docked");
        break;
      }
      case "hide": {
        hidePanel(panel);
        break;
      }
    }
  });
}

/** @param {HTMLElement} clickTarget */
function deriveAction(clickTarget) {
  const hitALink = !!clickTarget.closest("a");
  if (clickTarget.closest("dfn, .index-term")) {
    return hitALink ? null : "show";
  }
  if (clickTarget.closest(".dfn-panel")) {
    if (hitALink) {
      const clickedSelfLink = clickTarget.classList.contains("self-link");
      return clickedSelfLink ? "hide" : "dock";
    }
    const panel = clickTarget.closest(".dfn-panel");
    return panel.classList.contains("docked") ? "hide" : null;
  }
  if (document.querySelector(".dfn-panel:not([hidden])")) {
    return "hide";
  }
  return null;
}

/**
 * @param {HTMLElement} dfn
 * @param {HTMLElement} panel
 * @param {{ x: number, y: number }} clickPosition
 */
function displayPanel(dfn, panel, { x, y }) {
  panel.hidden = false;
  // distance (px) between edge of panel and the pointing triangle (caret)
  const MARGIN = 20;

  const dfnRects = dfn.getClientRects();
  // Find the `top` offset when the `dfn` can be spread across multiple lines
  let closestTop = 0;
  let minDiff = Infinity;
  for (const rect of dfnRects) {
    const { top, bottom } = rect;
    const diffFromClickY = Math.abs((top + bottom) / 2 - y);
    if (diffFromClickY < minDiff) {
      minDiff = diffFromClickY;
      closestTop = top;
    }
  }

  const top = window.scrollY + closestTop + dfnRects[0].height;
  const left = x - MARGIN;
  panel.style.left = `${left}px`;
  panel.style.top = `${top}px`;

  // Find if the panel is flowing out of the window
  const panelRect = panel.getBoundingClientRect();
  const SCREEN_WIDTH = Math.min(window.innerWidth, window.screen.width);
  if (panelRect.right > SCREEN_WIDTH) {
    const newLeft = Math.max(MARGIN, x + MARGIN - panelRect.width);
    const newCaretOffset = left - newLeft;
    panel.style.left = `${newLeft}px`;
    /** @type {HTMLElement} */
    const caret = panel.querySelector(".caret");
    caret.style.left = `${newCaretOffset}px`;
  }
}

/** @param {HTMLElement} panel */
function hidePanel(panel) {
  panel.hidden = true;
  panel.classList.remove("docked");
}
})()</script><script src="https://www.w3.org/scripts/TR/2016/fixup.js"></script></body></html>